function e(e){const t=Object.create(null);for(const n of e.split(","))t[n]=1;return e=>e in t}const t={},n=[],r=()=>{},s=()=>!1,i=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),a=e=>e.startsWith("onUpdate:"),o=Object.assign,c=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},l=Object.prototype.hasOwnProperty,u=(e,t)=>l.call(e,t),d=Array.isArray,h=e=>"[object Map]"===_(e),m=e=>"[object Set]"===_(e),p=e=>"[object Date]"===_(e),f=e=>"[object RegExp]"===_(e),g=e=>"function"==typeof e,b=e=>"string"==typeof e,y=e=>"symbol"==typeof e,w=e=>null!==e&&"object"==typeof e,k=e=>(w(e)||g(e))&&g(e.then)&&g(e.catch),T=Object.prototype.toString,_=e=>T.call(e),v=e=>_(e).slice(8,-1),S=e=>"[object Object]"===_(e),E=e=>b(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,C=e(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),I=e("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo"),x=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},A=/-(\w)/g,P=x(e=>e.replace(A,(e,t)=>t?t.toUpperCase():"")),O=/\B([A-Z])/g,N=x(e=>e.replace(O,"-$1").toLowerCase()),R=x(e=>e.charAt(0).toUpperCase()+e.slice(1)),M=x(e=>e?`on${R(e)}`:""),D=(e,t)=>!Object.is(e,t),F=(e,...t)=>{for(let n=0;n<e.length;n++)e[n](...t)},L=(e,t,n,r=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:r,value:n})},B=e=>{const t=parseFloat(e);return isNaN(t)?e:t},z=e=>{const t=b(e)?Number(e):NaN;return isNaN(t)?e:t};let U;const $=()=>U||(U="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),V=/^[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/;const j={1:"TEXT",2:"CLASS",4:"STYLE",8:"PROPS",16:"FULL_PROPS",32:"NEED_HYDRATION",64:"STABLE_FRAGMENT",128:"KEYED_FRAGMENT",256:"UNKEYED_FRAGMENT",512:"NEED_PATCH",1024:"DYNAMIC_SLOTS",2048:"DEV_ROOT_FRAGMENT",[-1]:"CACHED",[-2]:"BAIL"},W={1:"STABLE",2:"DYNAMIC",3:"FORWARDED"},H=e("Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol"),q=H;function X(e,t=0,n=e.length){if((t=Math.max(0,Math.min(t,e.length)))>(n=Math.max(0,Math.min(n,e.length))))return"";let r=e.split(/(\r?\n)/);const s=r.filter((e,t)=>t%2==1);r=r.filter((e,t)=>t%2==0);let i=0;const a=[];for(let o=0;o<r.length;o++)if(i+=r[o].length+(s[o]&&s[o].length||0),i>=t){for(let e=o-2;e<=o+2||n>i;e++){if(e<0||e>=r.length)continue;const c=e+1;a.push(`${c}${" ".repeat(Math.max(3-String(c).length,0))}|  ${r[e]}`);const l=r[e].length,u=s[e]&&s[e].length||0;if(e===o){const e=t-(i-(l+u)),r=Math.max(1,n>i?l-e:n-t);a.push("   |  "+" ".repeat(e)+"^".repeat(r))}else if(e>o){if(n>i){const e=Math.max(Math.min(n-i,l),1);a.push("   |  "+"^".repeat(e))}i+=l+u}}break}return a.join("\n")}function G(e){if(d(e)){const t={};for(let n=0;n<e.length;n++){const r=e[n],s=b(r)?J(r):G(r);if(s)for(const e in s)t[e]=s[e]}return t}if(b(e)||w(e))return e}const K=/;(?![^(]*\))/g,Y=/:([^]+)/,Q=/\/\*[^]*?\*\//g;function J(e){const t={};return e.replace(Q,"").split(K).forEach(e=>{if(e){const n=e.split(Y);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function Z(e){let t="";if(b(e))t=e;else if(d(e))for(let n=0;n<e.length;n++){const r=Z(e[n]);r&&(t+=r+" ")}else if(w(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}function ee(e){if(!e)return null;let{class:t,style:n}=e;return t&&!b(t)&&(e.class=Z(t)),n&&(e.style=G(n)),e}const te=e("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot"),ne=e("svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view"),re=e("annotation,annotation-xml,maction,maligngroup,malignmark,math,menclose,merror,mfenced,mfrac,mfraction,mglyph,mi,mlabeledtr,mlongdiv,mmultiscripts,mn,mo,mover,mpadded,mphantom,mprescripts,mroot,mrow,ms,mscarries,mscarry,msgroup,msline,mspace,msqrt,msrow,mstack,mstyle,msub,msubsup,msup,mtable,mtd,mtext,mtr,munder,munderover,none,semantics"),se=e("area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr"),ie="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",ae=e(ie),oe=e(ie+",async,autofocus,autoplay,controls,default,defer,disabled,hidden,inert,loop,open,required,reversed,scoped,seamless,checked,muted,multiple,selected");function ce(e){return!!e||""===e}const le=/[>/="'\u0009\u000a\u000c\u0020]/,ue={};const de=e("accept,accept-charset,accesskey,action,align,allow,alt,async,autocapitalize,autocomplete,autofocus,autoplay,background,bgcolor,border,buffered,capture,challenge,charset,checked,cite,class,code,codebase,color,cols,colspan,content,contenteditable,contextmenu,controls,coords,crossorigin,csp,data,datetime,decoding,default,defer,dir,dirname,disabled,download,draggable,dropzone,enctype,enterkeyhint,for,form,formaction,formenctype,formmethod,formnovalidate,formtarget,headers,height,hidden,high,href,hreflang,http-equiv,icon,id,importance,inert,integrity,ismap,itemprop,keytype,kind,label,lang,language,loading,list,loop,low,manifest,max,maxlength,minlength,media,min,multiple,muted,name,novalidate,open,optimum,pattern,ping,placeholder,poster,preload,radiogroup,readonly,referrerpolicy,rel,required,reversed,rows,rowspan,sandbox,scope,scoped,selected,shape,size,sizes,slot,span,spellcheck,src,srcdoc,srclang,srcset,start,step,style,summary,tabindex,target,title,translate,type,usemap,value,width,wrap"),he=e("xmlns,accent-height,accumulate,additive,alignment-baseline,alphabetic,amplitude,arabic-form,ascent,attributeName,attributeType,azimuth,baseFrequency,baseline-shift,baseProfile,bbox,begin,bias,by,calcMode,cap-height,class,clip,clipPathUnits,clip-path,clip-rule,color,color-interpolation,color-interpolation-filters,color-profile,color-rendering,contentScriptType,contentStyleType,crossorigin,cursor,cx,cy,d,decelerate,descent,diffuseConstant,direction,display,divisor,dominant-baseline,dur,dx,dy,edgeMode,elevation,enable-background,end,exponent,fill,fill-opacity,fill-rule,filter,filterRes,filterUnits,flood-color,flood-opacity,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,format,from,fr,fx,fy,g1,g2,glyph-name,glyph-orientation-horizontal,glyph-orientation-vertical,glyphRef,gradientTransform,gradientUnits,hanging,height,href,hreflang,horiz-adv-x,horiz-origin-x,id,ideographic,image-rendering,in,in2,intercept,k,k1,k2,k3,k4,kernelMatrix,kernelUnitLength,kerning,keyPoints,keySplines,keyTimes,lang,lengthAdjust,letter-spacing,lighting-color,limitingConeAngle,local,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mask,maskContentUnits,maskUnits,mathematical,max,media,method,min,mode,name,numOctaves,offset,opacity,operator,order,orient,orientation,origin,overflow,overline-position,overline-thickness,panose-1,paint-order,path,pathLength,patternContentUnits,patternTransform,patternUnits,ping,pointer-events,points,pointsAtX,pointsAtY,pointsAtZ,preserveAlpha,preserveAspectRatio,primitiveUnits,r,radius,referrerPolicy,refX,refY,rel,rendering-intent,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,result,rotate,rx,ry,scale,seed,shape-rendering,slope,spacing,specularConstant,specularExponent,speed,spreadMethod,startOffset,stdDeviation,stemh,stemv,stitchTiles,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,string,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,style,surfaceScale,systemLanguage,tabindex,tableValues,target,targetX,targetY,text-anchor,text-decoration,text-rendering,textLength,to,transform,transform-origin,type,u1,u2,underline-position,underline-thickness,unicode,unicode-bidi,unicode-range,units-per-em,v-alphabetic,v-hanging,v-ideographic,v-mathematical,values,vector-effect,version,vert-adv-y,vert-origin-x,vert-origin-y,viewBox,viewTarget,visibility,width,widths,word-spacing,writing-mode,x,x-height,x1,x2,xChannelSelector,xlink:actuate,xlink:arcrole,xlink:href,xlink:role,xlink:show,xlink:title,xlink:type,xmlns:xlink,xml:base,xml:lang,xml:space,y,y1,y2,yChannelSelector,z,zoomAndPan"),me=e("accent,accentunder,actiontype,align,alignmentscope,altimg,altimg-height,altimg-valign,altimg-width,alttext,bevelled,close,columnsalign,columnlines,columnspan,denomalign,depth,dir,display,displaystyle,encoding,equalcolumns,equalrows,fence,fontstyle,fontweight,form,frame,framespacing,groupalign,height,href,id,indentalign,indentalignfirst,indentalignlast,indentshift,indentshiftfirst,indentshiftlast,indextype,justify,largetop,largeop,lquote,lspace,mathbackground,mathcolor,mathsize,mathvariant,maxsize,minlabelspacing,mode,other,overflow,position,rowalign,rowlines,rowspan,rquote,rspace,scriptlevel,scriptminsize,scriptsizemultiplier,selection,separator,separators,shift,side,src,stackalign,stretchy,subscriptshift,superscriptshift,symmetric,voffset,width,widths,xlink:href,xlink:show,xlink:type,xmlns");const pe=/["'&<>]/;const fe=/^-?>|<!--|-->|--!>|<!-$/g;const ge=/[ !"#$%&'()*+,./:;<=>?@[\\\]^`{|}~]/g;function be(e,t){if(e===t)return!0;let n=p(e),r=p(t);if(n||r)return!(!n||!r)&&e.getTime()===t.getTime();if(n=y(e),r=y(t),n||r)return e===t;if(n=d(e),r=d(t),n||r)return!(!n||!r)&&function(e,t){if(e.length!==t.length)return!1;let n=!0;for(let r=0;n&&r<e.length;r++)n=be(e[r],t[r]);return n}(e,t);if(n=w(e),r=w(t),n||r){if(!n||!r)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e){const r=e.hasOwnProperty(n),s=t.hasOwnProperty(n);if(r&&!s||!r&&s||!be(e[n],t[n]))return!1}}return String(e)===String(t)}function ye(e,t){return e.findIndex(e=>be(e,t))}const we=e=>!(!e||!0!==e.__v_isRef),ke=e=>b(e)?e:null==e?"":d(e)||w(e)&&(e.toString===T||!g(e.toString))?we(e)?ke(e.value):JSON.stringify(e,Te,2):String(e),Te=(e,t)=>we(t)?Te(e,t.value):h(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[t,n],r)=>(e[_e(t,r)+" =>"]=n,e),{})}:m(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>_e(e))}:y(t)?_e(t):!w(t)||d(t)||S(t)?t:String(t),_e=(e,t="")=>{var n;return y(e)?`Symbol(${null!=(n=e.description)?n:t})`:e},ve=Object.freeze(Object.defineProperty({__proto__:null,EMPTY_ARR:n,EMPTY_OBJ:t,NO:s,NOOP:r,PatchFlagNames:j,PatchFlags:{TEXT:1,1:"TEXT",CLASS:2,2:"CLASS",STYLE:4,4:"STYLE",PROPS:8,8:"PROPS",FULL_PROPS:16,16:"FULL_PROPS",NEED_HYDRATION:32,32:"NEED_HYDRATION",STABLE_FRAGMENT:64,64:"STABLE_FRAGMENT",KEYED_FRAGMENT:128,128:"KEYED_FRAGMENT",UNKEYED_FRAGMENT:256,256:"UNKEYED_FRAGMENT",NEED_PATCH:512,512:"NEED_PATCH",DYNAMIC_SLOTS:1024,1024:"DYNAMIC_SLOTS",DEV_ROOT_FRAGMENT:2048,2048:"DEV_ROOT_FRAGMENT",CACHED:-1,"-1":"CACHED",BAIL:-2,"-2":"BAIL"},ShapeFlags:{ELEMENT:1,1:"ELEMENT",FUNCTIONAL_COMPONENT:2,2:"FUNCTIONAL_COMPONENT",STATEFUL_COMPONENT:4,4:"STATEFUL_COMPONENT",TEXT_CHILDREN:8,8:"TEXT_CHILDREN",ARRAY_CHILDREN:16,16:"ARRAY_CHILDREN",SLOTS_CHILDREN:32,32:"SLOTS_CHILDREN",TELEPORT:64,64:"TELEPORT",SUSPENSE:128,128:"SUSPENSE",COMPONENT_SHOULD_KEEP_ALIVE:256,256:"COMPONENT_SHOULD_KEEP_ALIVE",COMPONENT_KEPT_ALIVE:512,512:"COMPONENT_KEPT_ALIVE",COMPONENT:6,6:"COMPONENT"},SlotFlags:{STABLE:1,1:"STABLE",DYNAMIC:2,2:"DYNAMIC",FORWARDED:3,3:"FORWARDED"},camelize:P,capitalize:R,cssVarNameEscapeSymbolsRE:ge,def:L,escapeHtml:function(e){const t=""+e,n=pe.exec(t);if(!n)return t;let r,s,i="",a=0;for(s=n.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#39;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}a!==s&&(i+=t.slice(a,s)),a=s+1,i+=r}return a!==s?i+t.slice(a,s):i},escapeHtmlComment:function(e){return e.replace(fe,"")},extend:o,genCacheKey:function(e,t){return e+JSON.stringify(t,(e,t)=>"function"==typeof t?t.toString():t)},genPropsAccessExp:function(e){return V.test(e)?`__props.${e}`:`__props[${JSON.stringify(e)}]`},generateCodeFrame:X,getEscapedCssVarName:function(e,t){return e.replace(ge,e=>t?'"'===e?'\\\\\\"':`\\\\${e}`:`\\${e}`)},getGlobalThis:$,hasChanged:D,hasOwn:u,hyphenate:N,includeBooleanAttr:ce,invokeArrayFns:F,isArray:d,isBooleanAttr:oe,isBuiltInDirective:I,isDate:p,isFunction:g,isGloballyAllowed:H,isGloballyWhitelisted:q,isHTMLTag:te,isIntegerKey:E,isKnownHtmlAttr:de,isKnownMathMLAttr:me,isKnownSvgAttr:he,isMap:h,isMathMLTag:re,isModelListener:a,isObject:w,isOn:i,isPlainObject:S,isPromise:k,isRegExp:f,isRenderableAttrValue:function(e){if(null==e)return!1;const t=typeof e;return"string"===t||"number"===t||"boolean"===t},isReservedProp:C,isSSRSafeAttrName:function(e){if(ue.hasOwnProperty(e))return ue[e];const t=le.test(e);return ue[e]=!t},isSVGTag:ne,isSet:m,isSpecialBooleanAttr:ae,isString:b,isSymbol:y,isVoidTag:se,looseEqual:be,looseIndexOf:ye,looseToNumber:B,makeMap:e,normalizeClass:Z,normalizeProps:ee,normalizeStyle:G,objectToString:T,parseStringStyle:J,propsToAttrMap:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},remove:c,slotFlagsText:W,stringifyStyle:function(e){if(!e)return"";if(b(e))return e;let t="";for(const n in e){const r=e[n];if(b(r)||"number"==typeof r){t+=`${n.startsWith("--")?n:N(n)}:${r};`}}return t},toDisplayString:ke,toHandlerKey:M,toNumber:z,toRawType:v,toTypeString:_},Symbol.toStringTag,{value:"Module"}));let Se,Ee;class Ce{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Se,!e&&Se&&(this.index=(Se.scopes||(Se.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let e,t;if(this._isPaused=!0,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){let e,t;if(this._isPaused=!1,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Se;try{return Se=this,e()}finally{Se=t}}}on(){1===++this._on&&(this.prevScope=Se,Se=this)}off(){this._on>0&&0===--this._on&&(Se=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){let t,n;for(this._active=!1,t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0}}}function Ie(){return Se}const xe=new WeakSet;class Ae{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Se&&Se.active&&Se.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,xe.has(this)&&(xe.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||Re(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,qe(this),Fe(this);const e=Ee,t=Ve;Ee=this,Ve=!0;try{return this.fn()}finally{Le(this),Ee=e,Ve=t,this.flags&=-3}}stop(){if(1&this.flags){for(let e=this.deps;e;e=e.nextDep)Ue(e);this.deps=this.depsTail=void 0,qe(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?xe.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Be(this)&&this.run()}get dirty(){return Be(this)}}let Pe,Oe,Ne=0;function Re(e,t=!1){if(e.flags|=8,t)return e.next=Oe,void(Oe=e);e.next=Pe,Pe=e}function Me(){Ne++}function De(){if(--Ne>0)return;if(Oe){let e=Oe;for(Oe=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let e;for(;Pe;){let n=Pe;for(Pe=void 0;n;){const r=n.next;if(n.next=void 0,n.flags&=-9,1&n.flags)try{n.trigger()}catch(t){e||(e=t)}n=r}}if(e)throw e}function Fe(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Le(e){let t,n=e.depsTail,r=n;for(;r;){const e=r.prevDep;-1===r.version?(r===n&&(n=e),Ue(r),$e(r)):t=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=e}e.deps=t,e.depsTail=n}function Be(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(ze(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function ze(e){if(4&e.flags&&!(16&e.flags))return;if(e.flags&=-17,e.globalVersion===Xe)return;if(e.globalVersion=Xe,!e.isSSR&&128&e.flags&&(!e.deps&&!e._dirty||!Be(e)))return;e.flags|=2;const t=e.dep,n=Ee,r=Ve;Ee=e,Ve=!0;try{Fe(e);const n=e.fn(e._value);(0===t.version||D(n,e._value))&&(e.flags|=128,e._value=n,t.version++)}catch(s){throw t.version++,s}finally{Ee=n,Ve=r,Le(e),e.flags&=-3}}function Ue(e,t=!1){const{dep:n,prevSub:r,nextSub:s}=e;if(r&&(r.nextSub=s,e.prevSub=void 0),s&&(s.prevSub=r,e.nextSub=void 0),n.subs===e&&(n.subs=r,!r&&n.computed)){n.computed.flags&=-5;for(let e=n.computed.deps;e;e=e.nextDep)Ue(e,!0)}t||--n.sc||!n.map||n.map.delete(n.key)}function $e(e){const{prevDep:t,nextDep:n}=e;t&&(t.nextDep=n,e.prevDep=void 0),n&&(n.prevDep=t,e.nextDep=void 0)}let Ve=!0;const je=[];function We(){je.push(Ve),Ve=!1}function He(){const e=je.pop();Ve=void 0===e||e}function qe(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const e=Ee;Ee=void 0;try{t()}finally{Ee=e}}}let Xe=0;class Ge{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ke{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Ee||!Ve||Ee===this.computed)return;let t=this.activeLink;if(void 0===t||t.sub!==Ee)t=this.activeLink=new Ge(Ee,this),Ee.deps?(t.prevDep=Ee.depsTail,Ee.depsTail.nextDep=t,Ee.depsTail=t):Ee.deps=Ee.depsTail=t,Ye(t);else if(-1===t.version&&(t.version=this.version,t.nextDep)){const e=t.nextDep;e.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=e),t.prevDep=Ee.depsTail,t.nextDep=void 0,Ee.depsTail.nextDep=t,Ee.depsTail=t,Ee.deps===t&&(Ee.deps=e)}return t}trigger(e){this.version++,Xe++,this.notify(e)}notify(e){Me();try{0;for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{De()}}}function Ye(e){if(e.dep.sc++,4&e.sub.flags){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let e=t.deps;e;e=e.nextDep)Ye(e)}const n=e.dep.subs;n!==e&&(e.prevSub=n,n&&(n.nextSub=e)),e.dep.subs=e}}const Qe=new WeakMap,Je=Symbol(""),Ze=Symbol(""),et=Symbol("");function tt(e,t,n){if(Ve&&Ee){let t=Qe.get(e);t||Qe.set(e,t=new Map);let r=t.get(n);r||(t.set(n,r=new Ke),r.map=t,r.key=n),r.track()}}function nt(e,t,n,r,s,i){const a=Qe.get(e);if(!a)return void Xe++;const o=e=>{e&&e.trigger()};if(Me(),"clear"===t)a.forEach(o);else{const s=d(e),i=s&&E(n);if(s&&"length"===n){const e=Number(r);a.forEach((t,n)=>{("length"===n||n===et||!y(n)&&n>=e)&&o(t)})}else switch((void 0!==n||a.has(void 0))&&o(a.get(n)),i&&o(a.get(et)),t){case"add":s?i&&o(a.get("length")):(o(a.get(Je)),h(e)&&o(a.get(Ze)));break;case"delete":s||(o(a.get(Je)),h(e)&&o(a.get(Ze)));break;case"set":h(e)&&o(a.get(Je))}}De()}function rt(e){const t=Wt(e);return t===e?t:(tt(t,0,et),Vt(e)?t:t.map(qt))}function st(e){return tt(e=Wt(e),0,et),e}const it={__proto__:null,[Symbol.iterator](){return at(this,Symbol.iterator,qt)},concat(...e){return rt(this).concat(...e.map(e=>d(e)?rt(e):e))},entries(){return at(this,"entries",e=>(e[1]=qt(e[1]),e))},every(e,t){return ct(this,"every",e,t,void 0,arguments)},filter(e,t){return ct(this,"filter",e,t,e=>e.map(qt),arguments)},find(e,t){return ct(this,"find",e,t,qt,arguments)},findIndex(e,t){return ct(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return ct(this,"findLast",e,t,qt,arguments)},findLastIndex(e,t){return ct(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return ct(this,"forEach",e,t,void 0,arguments)},includes(...e){return ut(this,"includes",e)},indexOf(...e){return ut(this,"indexOf",e)},join(e){return rt(this).join(e)},lastIndexOf(...e){return ut(this,"lastIndexOf",e)},map(e,t){return ct(this,"map",e,t,void 0,arguments)},pop(){return dt(this,"pop")},push(...e){return dt(this,"push",e)},reduce(e,...t){return lt(this,"reduce",e,t)},reduceRight(e,...t){return lt(this,"reduceRight",e,t)},shift(){return dt(this,"shift")},some(e,t){return ct(this,"some",e,t,void 0,arguments)},splice(...e){return dt(this,"splice",e)},toReversed(){return rt(this).toReversed()},toSorted(e){return rt(this).toSorted(e)},toSpliced(...e){return rt(this).toSpliced(...e)},unshift(...e){return dt(this,"unshift",e)},values(){return at(this,"values",qt)}};function at(e,t,n){const r=st(e),s=r[t]();return r===e||Vt(e)||(s._next=s.next,s.next=()=>{const e=s._next();return e.value&&(e.value=n(e.value)),e}),s}const ot=Array.prototype;function ct(e,t,n,r,s,i){const a=st(e),o=a!==e&&!Vt(e),c=a[t];if(c!==ot[t]){const t=c.apply(e,i);return o?qt(t):t}let l=n;a!==e&&(o?l=function(t,r){return n.call(this,qt(t),r,e)}:n.length>2&&(l=function(t,r){return n.call(this,t,r,e)}));const u=c.call(a,l,r);return o&&s?s(u):u}function lt(e,t,n,r){const s=st(e);let i=n;return s!==e&&(Vt(e)?n.length>3&&(i=function(t,r,s){return n.call(this,t,r,s,e)}):i=function(t,r,s){return n.call(this,t,qt(r),s,e)}),s[t](i,...r)}function ut(e,t,n){const r=Wt(e);tt(r,0,et);const s=r[t](...n);return-1!==s&&!1!==s||!jt(n[0])?s:(n[0]=Wt(n[0]),r[t](...n))}function dt(e,t,n=[]){We(),Me();const r=Wt(e)[t].apply(e,n);return De(),He(),r}const ht=e("__proto__,__v_isRef,__isVue"),mt=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>"arguments"!==e&&"caller"!==e).map(e=>Symbol[e]).filter(y));function pt(e){y(e)||(e=String(e));const t=Wt(this);return tt(t,0,e),t.hasOwnProperty(e)}class ft{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if("__v_skip"===t)return e.__v_skip;const r=this._isReadonly,s=this._isShallow;if("__v_isReactive"===t)return!r;if("__v_isReadonly"===t)return r;if("__v_isShallow"===t)return s;if("__v_raw"===t)return n===(r?s?Mt:Rt:s?Nt:Ot).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const i=d(e);if(!r){let e;if(i&&(e=it[t]))return e;if("hasOwnProperty"===t)return pt}const a=Reflect.get(e,t,Gt(e)?e:n);return(y(t)?mt.has(t):ht(t))?a:(r||tt(e,0,t),s?a:Gt(a)?i&&E(t)?a:a.value:w(a)?r?Lt(a):Dt(a):a)}}class gt extends ft{constructor(e=!1){super(!1,e)}set(e,t,n,r){let s=e[t];if(!this._isShallow){const t=$t(s);if(Vt(n)||$t(n)||(s=Wt(s),n=Wt(n)),!d(e)&&Gt(s)&&!Gt(n))return!t&&(s.value=n,!0)}const i=d(e)&&E(t)?Number(t)<e.length:u(e,t),a=Reflect.set(e,t,n,Gt(e)?e:r);return e===Wt(r)&&(i?D(n,s)&&nt(e,"set",t,n):nt(e,"add",t,n)),a}deleteProperty(e,t){const n=u(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&n&&nt(e,"delete",t,void 0),r}has(e,t){const n=Reflect.has(e,t);return y(t)&&mt.has(t)||tt(e,0,t),n}ownKeys(e){return tt(e,0,d(e)?"length":Je),Reflect.ownKeys(e)}}class bt extends ft{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const yt=new gt,wt=new bt,kt=new gt(!0),Tt=new bt(!0),_t=e=>e,vt=e=>Reflect.getPrototypeOf(e);function St(e){return function(...t){return"delete"!==e&&("clear"===e?void 0:this)}}function Et(e,t){const n={get(n){const r=this.__v_raw,s=Wt(r),i=Wt(n);e||(D(n,i)&&tt(s,0,n),tt(s,0,i));const{has:a}=vt(s),o=t?_t:e?Xt:qt;return a.call(s,n)?o(r.get(n)):a.call(s,i)?o(r.get(i)):void(r!==s&&r.get(n))},get size(){const t=this.__v_raw;return!e&&tt(Wt(t),0,Je),Reflect.get(t,"size",t)},has(t){const n=this.__v_raw,r=Wt(n),s=Wt(t);return e||(D(t,s)&&tt(r,0,t),tt(r,0,s)),t===s?n.has(t):n.has(t)||n.has(s)},forEach(n,r){const s=this,i=s.__v_raw,a=Wt(i),o=t?_t:e?Xt:qt;return!e&&tt(a,0,Je),i.forEach((e,t)=>n.call(r,o(e),o(t),s))}};o(n,e?{add:St("add"),set:St("set"),delete:St("delete"),clear:St("clear")}:{add(e){t||Vt(e)||$t(e)||(e=Wt(e));const n=Wt(this);return vt(n).has.call(n,e)||(n.add(e),nt(n,"add",e,e)),this},set(e,n){t||Vt(n)||$t(n)||(n=Wt(n));const r=Wt(this),{has:s,get:i}=vt(r);let a=s.call(r,e);a||(e=Wt(e),a=s.call(r,e));const o=i.call(r,e);return r.set(e,n),a?D(n,o)&&nt(r,"set",e,n):nt(r,"add",e,n),this},delete(e){const t=Wt(this),{has:n,get:r}=vt(t);let s=n.call(t,e);s||(e=Wt(e),s=n.call(t,e)),r&&r.call(t,e);const i=t.delete(e);return s&&nt(t,"delete",e,void 0),i},clear(){const e=Wt(this),t=0!==e.size,n=e.clear();return t&&nt(e,"clear",void 0,void 0),n}});return["keys","values","entries",Symbol.iterator].forEach(r=>{n[r]=function(e,t,n){return function(...r){const s=this.__v_raw,i=Wt(s),a=h(i),o="entries"===e||e===Symbol.iterator&&a,c="keys"===e&&a,l=s[e](...r),u=n?_t:t?Xt:qt;return!t&&tt(i,0,c?Ze:Je),{next(){const{value:e,done:t}=l.next();return t?{value:e,done:t}:{value:o?[u(e[0]),u(e[1])]:u(e),done:t}},[Symbol.iterator](){return this}}}}(r,e,t)}),n}function Ct(e,t){const n=Et(e,t);return(t,r,s)=>"__v_isReactive"===r?!e:"__v_isReadonly"===r?e:"__v_raw"===r?t:Reflect.get(u(n,r)&&r in t?n:t,r,s)}const It={get:Ct(!1,!1)},xt={get:Ct(!1,!0)},At={get:Ct(!0,!1)},Pt={get:Ct(!0,!0)},Ot=new WeakMap,Nt=new WeakMap,Rt=new WeakMap,Mt=new WeakMap;function Dt(e){return $t(e)?e:zt(e,!1,yt,It,Ot)}function Ft(e){return zt(e,!1,kt,xt,Nt)}function Lt(e){return zt(e,!0,wt,At,Rt)}function Bt(e){return zt(e,!0,Tt,Pt,Mt)}function zt(e,t,n,r,s){if(!w(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const i=(a=e).__v_skip||!Object.isExtensible(a)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(v(a));var a;if(0===i)return e;const o=s.get(e);if(o)return o;const c=new Proxy(e,2===i?r:n);return s.set(e,c),c}function Ut(e){return $t(e)?Ut(e.__v_raw):!(!e||!e.__v_isReactive)}function $t(e){return!(!e||!e.__v_isReadonly)}function Vt(e){return!(!e||!e.__v_isShallow)}function jt(e){return!!e&&!!e.__v_raw}function Wt(e){const t=e&&e.__v_raw;return t?Wt(t):e}function Ht(e){return!u(e,"__v_skip")&&Object.isExtensible(e)&&L(e,"__v_skip",!0),e}const qt=e=>w(e)?Dt(e):e,Xt=e=>w(e)?Lt(e):e;function Gt(e){return!!e&&!0===e.__v_isRef}function Kt(e){return Qt(e,!1)}function Yt(e){return Qt(e,!0)}function Qt(e,t){return Gt(e)?e:new Jt(e,t)}class Jt{constructor(e,t){this.dep=new Ke,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Wt(e),this._value=t?e:qt(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||Vt(e)||$t(e);e=n?e:Wt(e),D(e,t)&&(this._rawValue=e,this._value=n?e:qt(e),this.dep.trigger())}}function Zt(e){return Gt(e)?e.value:e}const en={get:(e,t,n)=>"__v_raw"===t?e:Zt(Reflect.get(e,t,n)),set:(e,t,n,r)=>{const s=e[t];return Gt(s)&&!Gt(n)?(s.value=n,!0):Reflect.set(e,t,n,r)}};function tn(e){return Ut(e)?e:new Proxy(e,en)}class nn{constructor(e){this.__v_isRef=!0,this._value=void 0;const t=this.dep=new Ke,{get:n,set:r}=e(t.track.bind(t),t.trigger.bind(t));this._get=n,this._set=r}get value(){return this._value=this._get()}set value(e){this._set(e)}}function rn(e){return new nn(e)}class sn{constructor(e,t,n){this._object=e,this._key=t,this._defaultValue=n,this.__v_isRef=!0,this._value=void 0}get value(){const e=this._object[this._key];return this._value=void 0===e?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return function(e,t){const n=Qe.get(e);return n&&n.get(t)}(Wt(this._object),this._key)}}class an{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function on(e,t,n){const r=e[t];return Gt(r)?r:new sn(e,t,n)}class cn{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Ke(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Xe-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(8&this.flags)&&Ee!==this)return Re(this,!0),!0}get value(){const e=this.dep.track();return ze(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}const ln={},un=new WeakMap;let dn;function hn(e,t=!1,n=dn){if(n){let t=un.get(n);t||un.set(n,t=[]),t.push(e)}}function mn(e,t=1/0,n){if(t<=0||!w(e)||e.__v_skip)return e;if((n=n||new Set).has(e))return e;if(n.add(e),t--,Gt(e))mn(e.value,t,n);else if(d(e))for(let r=0;r<e.length;r++)mn(e[r],t,n);else if(m(e)||h(e))e.forEach(e=>{mn(e,t,n)});else if(S(e)){for(const r in e)mn(e[r],t,n);for(const r of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,r)&&mn(e[r],t,n)}return e}const pn=[];const fn={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update",16:"app unmount cleanup function"};function gn(e,t,n,r){try{return r?e(...r):e()}catch(s){yn(s,t,n)}}function bn(e,t,n,r){if(g(e)){const s=gn(e,t,n,r);return s&&k(s)&&s.catch(e=>{yn(e,t,n)}),s}if(d(e)){const s=[];for(let i=0;i<e.length;i++)s.push(bn(e[i],t,n,r));return s}}function yn(e,n,r,s=!0){n&&n.vnode;const{errorHandler:i,throwUnhandledErrorInProduction:a}=n&&n.appContext.config||t;if(n){let t=n.parent;const s=n.proxy,a=`https://vuejs.org/error-reference/#runtime-${r}`;for(;t;){const n=t.ec;if(n)for(let t=0;t<n.length;t++)if(!1===n[t](e,s,a))return;t=t.parent}if(i)return We(),gn(i,null,10,[e,s,a]),void He()}!function(e,t,n,r=!0,s=!1){if(s)throw e}(e,0,0,s,a)}const wn=[];let kn=-1;const Tn=[];let _n=null,vn=0;const Sn=Promise.resolve();let En=null;function Cn(e){const t=En||Sn;return e?t.then(this?e.bind(this):e):t}function In(e){if(!(1&e.flags)){const t=Nn(e),n=wn[wn.length-1];!n||!(2&e.flags)&&t>=Nn(n)?wn.push(e):wn.splice(function(e){let t=kn+1,n=wn.length;for(;t<n;){const r=t+n>>>1,s=wn[r],i=Nn(s);i<e||i===e&&2&s.flags?t=r+1:n=r}return t}(t),0,e),e.flags|=1,xn()}}function xn(){En||(En=Sn.then(Rn))}function An(e){d(e)?Tn.push(...e):_n&&-1===e.id?_n.splice(vn+1,0,e):1&e.flags||(Tn.push(e),e.flags|=1),xn()}function Pn(e,t,n=kn+1){for(;n<wn.length;n++){const t=wn[n];if(t&&2&t.flags){if(e&&t.id!==e.uid)continue;wn.splice(n,1),n--,4&t.flags&&(t.flags&=-2),t(),4&t.flags||(t.flags&=-2)}}}function On(e){if(Tn.length){const e=[...new Set(Tn)].sort((e,t)=>Nn(e)-Nn(t));if(Tn.length=0,_n)return void _n.push(...e);for(_n=e,vn=0;vn<_n.length;vn++){const e=_n[vn];4&e.flags&&(e.flags&=-2),8&e.flags||e(),e.flags&=-2}_n=null,vn=0}}const Nn=e=>null==e.id?2&e.flags?-1:1/0:e.id;function Rn(e){try{for(kn=0;kn<wn.length;kn++){const e=wn[kn];!e||8&e.flags||(4&e.flags&&(e.flags&=-2),gn(e,e.i,e.i?15:14),4&e.flags||(e.flags&=-2))}}finally{for(;kn<wn.length;kn++){const e=wn[kn];e&&(e.flags&=-2)}kn=-1,wn.length=0,On(),En=null,(wn.length||Tn.length)&&Rn()}}let Mn,Dn=[];let Fn=null,Ln=null;function Bn(e){const t=Fn;return Fn=e,Ln=e&&e.type.__scopeId||null,t}function zn(e,t=Fn,n){if(!t)return e;if(e._n)return e;const r=(...n)=>{r._d&&Fi(-1);const s=Bn(t);let i;try{i=e(...n)}finally{Bn(s),r._d&&Fi(1)}return i};return r._n=!0,r._c=!0,r._d=!0,r}function Un(e,n){if(null===Fn)return e;const r=wa(Fn),s=e.dirs||(e.dirs=[]);for(let i=0;i<n.length;i++){let[e,a,o,c=t]=n[i];e&&(g(e)&&(e={mounted:e,updated:e}),e.deep&&mn(a),s.push({dir:e,instance:r,value:a,oldValue:void 0,arg:o,modifiers:c}))}return e}function $n(e,t,n,r){const s=e.dirs,i=t&&t.dirs;for(let a=0;a<s.length;a++){const o=s[a];i&&(o.oldValue=i[a].value);let c=o.dir[r];c&&(We(),bn(c,n,8,[e.el,o,e,t]),He())}}const Vn=Symbol("_vte"),jn=e=>e.__isTeleport,Wn=e=>e&&(e.disabled||""===e.disabled),Hn=e=>e&&(e.defer||""===e.defer),qn=e=>"undefined"!=typeof SVGElement&&e instanceof SVGElement,Xn=e=>"function"==typeof MathMLElement&&e instanceof MathMLElement,Gn=(e,t)=>{const n=e&&e.to;if(b(n)){if(t){return t(n)}return null}return n},Kn={name:"Teleport",__isTeleport:!0,process(e,t,n,r,s,i,a,o,c,l){const{mc:u,pc:d,pbc:h,o:{insert:m,querySelector:p,createText:f,createComment:g}}=l,b=Wn(t.props);let{shapeFlag:y,children:w,dynamicChildren:k}=t;if(null==e){const e=t.el=f(""),l=t.anchor=f("");m(e,n,r),m(l,n,r);const d=(e,t)=>{16&y&&(s&&s.isCE&&(s.ce._teleportTarget=e),u(w,e,t,s,i,a,o,c))},h=()=>{const e=t.target=Gn(t.props,p),n=Zn(e,t,f,m);e&&("svg"!==a&&qn(e)?a="svg":"mathml"!==a&&Xn(e)&&(a="mathml"),b||(d(e,n),Jn(t,!1)))};b&&(d(n,l),Jn(t,!0)),Hn(t.props)?(t.el.__isMounted=!1,Xs(()=>{h(),delete t.el.__isMounted},i)):h()}else{if(Hn(t.props)&&!1===e.el.__isMounted)return void Xs(()=>{Kn.process(e,t,n,r,s,i,a,o,c,l)},i);t.el=e.el,t.targetStart=e.targetStart;const u=t.anchor=e.anchor,m=t.target=e.target,f=t.targetAnchor=e.targetAnchor,g=Wn(e.props),y=g?n:m,w=g?u:f;if("svg"===a||qn(m)?a="svg":("mathml"===a||Xn(m))&&(a="mathml"),k?(h(e.dynamicChildren,k,y,s,i,a,o),ei(e,t,!0)):c||d(e,t,y,w,s,i,a,o,!1),b)g?t.props&&e.props&&t.props.to!==e.props.to&&(t.props.to=e.props.to):Yn(t,n,u,l,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const e=t.target=Gn(t.props,p);e&&Yn(t,e,null,l,0)}else g&&Yn(t,m,f,l,1);Jn(t,b)}},remove(e,t,n,{um:r,o:{remove:s}},i){const{shapeFlag:a,children:o,anchor:c,targetStart:l,targetAnchor:u,target:d,props:h}=e;if(d&&(s(l),s(u)),i&&s(c),16&a){const e=i||!Wn(h);for(let s=0;s<o.length;s++){const i=o[s];r(i,t,n,e,!!i.dynamicChildren)}}},move:Yn,hydrate:function(e,t,n,r,s,i,{o:{nextSibling:a,parentNode:o,querySelector:c,insert:l,createText:u}},d){const h=t.target=Gn(t.props,c);if(h){const c=Wn(t.props),m=h._lpa||h.firstChild;if(16&t.shapeFlag)if(c)t.anchor=d(a(e),t,o(e),n,r,s,i),t.targetStart=m,t.targetAnchor=m&&a(m);else{t.anchor=a(e);let o=m;for(;o;){if(o&&8===o.nodeType)if("teleport start anchor"===o.data)t.targetStart=o;else if("teleport anchor"===o.data){t.targetAnchor=o,h._lpa=t.targetAnchor&&a(t.targetAnchor);break}o=a(o)}t.targetAnchor||Zn(h,t,u,l),d(m&&a(m),t,h,n,r,s,i)}Jn(t,c)}return t.anchor&&a(t.anchor)}};function Yn(e,t,n,{o:{insert:r},m:s},i=2){0===i&&r(e.targetAnchor,t,n);const{el:a,anchor:o,shapeFlag:c,children:l,props:u}=e,d=2===i;if(d&&r(a,t,n),(!d||Wn(u))&&16&c)for(let h=0;h<l.length;h++)s(l[h],t,n,2);d&&r(o,t,n)}const Qn=Kn;function Jn(e,t){const n=e.ctx;if(n&&n.ut){let r,s;for(t?(r=e.el,s=e.anchor):(r=e.targetStart,s=e.targetAnchor);r&&r!==s;)1===r.nodeType&&r.setAttribute("data-v-owner",n.uid),r=r.nextSibling;n.ut()}}function Zn(e,t,n,r){const s=t.targetStart=n(""),i=t.targetAnchor=n("");return s[Vn]=i,e&&(r(s,e),r(i,e)),i}const er=Symbol("_leaveCb"),tr=Symbol("_enterCb");function nr(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return $r(()=>{e.isMounted=!0}),Wr(()=>{e.isUnmounting=!0}),e}const rr=[Function,Array],sr={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:rr,onEnter:rr,onAfterEnter:rr,onEnterCancelled:rr,onBeforeLeave:rr,onLeave:rr,onAfterLeave:rr,onLeaveCancelled:rr,onBeforeAppear:rr,onAppear:rr,onAfterAppear:rr,onAppearCancelled:rr},ir=e=>{const t=e.subTree;return t.component?ir(t.component):t};function ar(e){let t=e[0];if(e.length>1)for(const n of e)if(n.type!==Ai){t=n;break}return t}const or={name:"BaseTransition",props:sr,setup(e,{slots:t}){const n=ia(),r=nr();return()=>{const s=t.default&&mr(t.default(),!0);if(!s||!s.length)return;const i=ar(s),a=Wt(e),{mode:o}=a;if(r.isLeaving)return ur(i);const c=dr(i);if(!c)return ur(i);let l=lr(c,a,r,n,e=>l=e);c.type!==Ai&&hr(c,l);let u=n.subTree&&dr(n.subTree);if(u&&u.type!==Ai&&!$i(c,u)&&ir(n).type!==Ai){let e=lr(u,a,r,n);if(hr(u,e),"out-in"===o&&c.type!==Ai)return r.isLeaving=!0,e.afterLeave=()=>{r.isLeaving=!1,8&n.job.flags||n.update(),delete e.afterLeave,u=void 0},ur(i);"in-out"===o&&c.type!==Ai?e.delayLeave=(e,t,n)=>{cr(r,u)[String(u.key)]=u,e[er]=()=>{t(),e[er]=void 0,delete l.delayedLeave,u=void 0},l.delayedLeave=()=>{n(),delete l.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return i}}};function cr(e,t){const{leavingVNodes:n}=e;let r=n.get(t.type);return r||(r=Object.create(null),n.set(t.type,r)),r}function lr(e,t,n,r,s){const{appear:i,mode:a,persisted:o=!1,onBeforeEnter:c,onEnter:l,onAfterEnter:u,onEnterCancelled:h,onBeforeLeave:m,onLeave:p,onAfterLeave:f,onLeaveCancelled:g,onBeforeAppear:b,onAppear:y,onAfterAppear:w,onAppearCancelled:k}=t,T=String(e.key),_=cr(n,e),v=(e,t)=>{e&&bn(e,r,9,t)},S=(e,t)=>{const n=t[1];v(e,t),d(e)?e.every(e=>e.length<=1)&&n():e.length<=1&&n()},E={mode:a,persisted:o,beforeEnter(t){let r=c;if(!n.isMounted){if(!i)return;r=b||c}t[er]&&t[er](!0);const s=_[T];s&&$i(e,s)&&s.el[er]&&s.el[er](),v(r,[t])},enter(e){let t=l,r=u,s=h;if(!n.isMounted){if(!i)return;t=y||l,r=w||u,s=k||h}let a=!1;const o=e[tr]=t=>{a||(a=!0,v(t?s:r,[e]),E.delayedLeave&&E.delayedLeave(),e[tr]=void 0)};t?S(t,[e,o]):o()},leave(t,r){const s=String(e.key);if(t[tr]&&t[tr](!0),n.isUnmounting)return r();v(m,[t]);let i=!1;const a=t[er]=n=>{i||(i=!0,r(),v(n?g:f,[t]),t[er]=void 0,_[s]===e&&delete _[s])};_[s]=e,p?S(p,[t,a]):a()},clone(e){const i=lr(e,t,n,r,s);return s&&s(i),i}};return E}function ur(e){if(Ar(e))return(e=Xi(e)).children=null,e}function dr(e){if(!Ar(e))return jn(e.type)&&e.children?ar(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:t,children:n}=e;if(n){if(16&t)return n[0];if(32&t&&g(n.default))return n.default()}}function hr(e,t){6&e.shapeFlag&&e.component?(e.transition=t,hr(e.component.subTree,t)):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function mr(e,t=!1,n){let r=[],s=0;for(let i=0;i<e.length;i++){let a=e[i];const o=null==n?a.key:String(n)+String(null!=a.key?a.key:i);a.type===Ii?(128&a.patchFlag&&s++,r=r.concat(mr(a.children,t,o))):(t||a.type!==Ai)&&r.push(null!=o?Xi(a,{key:o}):a)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}function pr(e,t){return g(e)?(()=>o({name:e.name},t,{setup:e}))():e}function fr(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function gr(e,n,r,s,i=!1){if(d(e))return void e.forEach((e,t)=>gr(e,n&&(d(n)?n[t]:n),r,s,i));if(Ir(s)&&!i)return void(512&s.shapeFlag&&s.type.__asyncResolved&&s.component.subTree.component&&gr(e,n,r,s.component.subTree));const a=4&s.shapeFlag?wa(s.component):s.el,o=i?null:a,{i:l,r:h}=e,m=n&&n.r,p=l.refs===t?l.refs={}:l.refs,f=l.setupState,y=Wt(f),w=f===t?()=>!1:e=>u(y,e);if(null!=m&&m!==h&&(b(m)?(p[m]=null,w(m)&&(f[m]=null)):Gt(m)&&(m.value=null)),g(h))gn(h,l,12,[o,p]);else{const t=b(h),n=Gt(h);if(t||n){const s=()=>{if(e.f){const n=t?w(h)?f[h]:p[h]:h.value;i?d(n)&&c(n,a):d(n)?n.includes(a)||n.push(a):t?(p[h]=[a],w(h)&&(f[h]=p[h])):(h.value=[a],e.k&&(p[e.k]=h.value))}else t?(p[h]=o,w(h)&&(f[h]=o)):n&&(h.value=o,e.k&&(p[e.k]=o))};o?(s.id=-1,Xs(s,r)):s()}}}let br=!1;const yr=()=>{br||(br=!0)},wr=e=>{if(1===e.nodeType)return(e=>e.namespaceURI.includes("svg")&&"foreignObject"!==e.tagName)(e)?"svg":(e=>e.namespaceURI.includes("MathML"))(e)?"mathml":void 0},kr=e=>8===e.nodeType;function Tr(e){const{mt:t,p:n,o:{patchProp:r,createText:s,nextSibling:a,parentNode:o,remove:c,insert:l,createComment:u}}=e,d=(n,r,i,c,u,w=!1)=>{w=w||!!r.dynamicChildren;const k=kr(n)&&"["===n.data,T=()=>f(n,r,i,c,u,k),{type:_,ref:v,shapeFlag:S,patchFlag:E}=r;let C=n.nodeType;r.el=n,-2===E&&(w=!1,r.dynamicChildren=null);let I=null;switch(_){case xi:3!==C?""===r.children?(l(r.el=s(""),o(n),n),I=n):I=T():(n.data!==r.children&&(yr(),n.data=r.children),I=a(n));break;case Ai:y(n)?(I=a(n),b(r.el=n.content.firstChild,n,i)):I=8!==C||k?T():a(n);break;case Pi:if(k&&(C=(n=a(n)).nodeType),1===C||3===C){I=n;const e=!r.children.length;for(let t=0;t<r.staticCount;t++)e&&(r.children+=1===I.nodeType?I.outerHTML:I.data),t===r.staticCount-1&&(r.anchor=I),I=a(I);return k?a(I):I}T();break;case Ii:I=k?p(n,r,i,c,u,w):T();break;default:if(1&S)I=1===C&&r.type.toLowerCase()===n.tagName.toLowerCase()||y(n)?h(n,r,i,c,u,w):T();else if(6&S){r.slotScopeIds=u;const e=o(n);if(I=k?g(n):kr(n)&&"teleport start"===n.data?g(n,n.data,"teleport end"):a(n),t(r,e,null,i,c,wr(e),w),Ir(r)&&!r.type.__asyncResolved){let t;k?(t=Hi(Ii),t.anchor=I?I.previousSibling:e.lastChild):t=3===n.nodeType?Gi(""):Hi("div"),t.el=n,r.component.subTree=t}}else 64&S?I=8!==C?T():r.type.hydrate(n,r,i,c,u,w,e,m):128&S&&(I=r.type.hydrate(n,r,i,c,wr(o(n)),u,w,e,d))}return null!=v&&gr(v,null,c,r),I},h=(e,t,n,s,a,o)=>{o=o||!!t.dynamicChildren;const{type:l,props:u,patchFlag:d,shapeFlag:h,dirs:p,transition:f}=t,g="input"===l||"option"===l;if(g||-1!==d){p&&$n(t,null,n,"created");let l,w=!1;if(y(e)){w=Zs(null,f)&&n&&n.vnode.props&&n.vnode.props.appear;const r=e.content.firstChild;if(w){const e=r.getAttribute("class");e&&(r.$cls=e),f.beforeEnter(r)}b(r,e,n),t.el=e=r}if(16&h&&(!u||!u.innerHTML&&!u.textContent)){let r=m(e.firstChild,t,e,n,s,a,o);for(;r;){Sr(e,1)||yr();const t=r;r=r.nextSibling,c(t)}}else if(8&h){let n=t.children;"\n"!==n[0]||"PRE"!==e.tagName&&"TEXTAREA"!==e.tagName||(n=n.slice(1)),e.textContent!==n&&(Sr(e,0)||yr(),e.textContent=t.children)}if(u)if(g||!o||48&d){const t=e.tagName.includes("-");for(const s in u)(g&&(s.endsWith("value")||"indeterminate"===s)||i(s)&&!C(s)||"."===s[0]||t)&&r(e,s,null,u[s],void 0,n)}else if(u.onClick)r(e,"onClick",null,u.onClick,void 0,n);else if(4&d&&Ut(u.style))for(const e in u.style)u.style[e];(l=u&&u.onVnodeBeforeMount)&&ea(l,n,t),p&&$n(t,null,n,"beforeMount"),((l=u&&u.onVnodeMounted)||p||w)&&Ei(()=>{l&&ea(l,n,t),w&&f.enter(e),p&&$n(t,null,n,"mounted")},s)}return e.nextSibling},m=(e,t,r,i,o,c,u)=>{u=u||!!t.dynamicChildren;const h=t.children,m=h.length;for(let p=0;p<m;p++){const t=u?h[p]:h[p]=Yi(h[p]),f=t.type===xi;e?(f&&!u&&p+1<m&&Yi(h[p+1]).type===xi&&(l(s(e.data.slice(t.children.length)),r,a(e)),e.data=t.children),e=d(e,t,i,o,c,u)):f&&!t.children?l(t.el=s(""),r):(Sr(r,1)||yr(),n(null,t,r,null,i,o,wr(r),c))}return e},p=(e,t,n,r,s,i)=>{const{slotScopeIds:c}=t;c&&(s=s?s.concat(c):c);const d=o(e),h=m(a(e),t,d,n,r,s,i);return h&&kr(h)&&"]"===h.data?a(t.anchor=h):(yr(),l(t.anchor=u("]"),d,h),h)},f=(e,t,r,s,i,l)=>{if(Sr(e.parentElement,1)||yr(),t.el=null,l){const t=g(e);for(;;){const n=a(e);if(!n||n===t)break;c(n)}}const u=a(e),d=o(e);return c(e),n(null,t,d,u,r,s,wr(d),i),r&&(r.vnode.el=t.el,yi(r,t.el)),u},g=(e,t="[",n="]")=>{let r=0;for(;e;)if((e=a(e))&&kr(e)&&(e.data===t&&r++,e.data===n)){if(0===r)return a(e);r--}return e},b=(e,t,n)=>{const r=t.parentNode;r&&r.replaceChild(e,t);let s=n;for(;s;)s.vnode.el===t&&(s.vnode.el=s.subTree.el=e),s=s.parent},y=e=>1===e.nodeType&&"TEMPLATE"===e.tagName;return[(e,t)=>{if(!t.hasChildNodes())return n(null,e,t),On(),void(t._vnode=e);d(t.firstChild,e,null,null,null),On(),t._vnode=e},d]}const _r="data-allow-mismatch",vr={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function Sr(e,t){if(0===t||1===t)for(;e&&!e.hasAttribute(_r);)e=e.parentElement;const n=e&&e.getAttribute(_r);if(null==n)return!1;if(""===n)return!0;{const e=n.split(",");return!(0!==t||!e.includes("children"))||e.includes(vr[t])}}const Er=$().requestIdleCallback||(e=>setTimeout(e,1)),Cr=$().cancelIdleCallback||(e=>clearTimeout(e));const Ir=e=>!!e.type.__asyncLoader;function xr(e,t){const{ref:n,props:r,children:s,ce:i}=t.vnode,a=Hi(e,r,s);return a.ref=n,a.ce=i,delete t.vnode.ce,a}const Ar=e=>e.type.__isKeepAlive,Pr={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:t}){const n=ia(),r=n.ctx;if(!r.renderer)return()=>{const e=t.default&&t.default();return e&&1===e.length?e[0]:e};const s=new Map,i=new Set;let a=null;const o=n.suspense,{renderer:{p:c,m:l,um:u,o:{createElement:d}}}=r,h=d("div");function m(e){Fr(e),u(e,n,o,!0)}function p(e){s.forEach((t,n)=>{const r=ka(t.type);r&&!e(r)&&f(n)})}function f(e){const t=s.get(e);!t||a&&$i(t,a)?a&&Fr(a):m(t),s.delete(e),i.delete(e)}r.activate=(e,t,n,r,s)=>{const i=e.component;l(e,t,n,0,o),c(i.vnode,e,t,n,i,o,r,e.slotScopeIds,s),Xs(()=>{i.isDeactivated=!1,i.a&&F(i.a);const t=e.props&&e.props.onVnodeMounted;t&&ea(t,i.parent,e)},o)},r.deactivate=e=>{const t=e.component;ni(t.m),ni(t.a),l(e,h,null,1,o),Xs(()=>{t.da&&F(t.da);const n=e.props&&e.props.onVnodeUnmounted;n&&ea(n,t.parent,e),t.isDeactivated=!0},o)},ai(()=>[e.include,e.exclude],([e,t])=>{e&&p(t=>Or(e,t)),t&&p(e=>!Or(t,e))},{flush:"post",deep:!0});let g=null;const b=()=>{null!=g&&(wi(n.subTree.type)?Xs(()=>{s.set(g,Lr(n.subTree))},n.subTree.suspense):s.set(g,Lr(n.subTree)))};return $r(b),jr(b),Wr(()=>{s.forEach(e=>{const{subTree:t,suspense:r}=n,s=Lr(t);if(e.type===s.type&&e.key===s.key){Fr(s);const e=s.component.da;return void(e&&Xs(e,r))}m(e)})}),()=>{if(g=null,!t.default)return a=null;const n=t.default(),r=n[0];if(n.length>1)return a=null,n;if(!(Ui(r)&&(4&r.shapeFlag||128&r.shapeFlag)))return a=null,r;let o=Lr(r);if(o.type===Ai)return a=null,o;const c=o.type,l=ka(Ir(o)?o.type.__asyncResolved||{}:c),{include:u,exclude:d,max:h}=e;if(u&&(!l||!Or(u,l))||d&&l&&Or(d,l))return o.shapeFlag&=-257,a=o,r;const m=null==o.key?c:o.key,p=s.get(m);return o.el&&(o=Xi(o),128&r.shapeFlag&&(r.ssContent=o)),g=m,p?(o.el=p.el,o.component=p.component,o.transition&&hr(o,o.transition),o.shapeFlag|=512,i.delete(m),i.add(m)):(i.add(m),h&&i.size>parseInt(h,10)&&f(i.values().next().value)),o.shapeFlag|=256,a=o,wi(r.type)?r:o}}};function Or(e,t){return d(e)?e.some(e=>Or(e,t)):b(e)?e.split(",").includes(t):!!f(e)&&(e.lastIndex=0,e.test(t))}function Nr(e,t){Mr(e,"a",t)}function Rr(e,t){Mr(e,"da",t)}function Mr(e,t,n=sa){const r=e.__wdc||(e.__wdc=()=>{let t=n;for(;t;){if(t.isDeactivated)return;t=t.parent}return e()});if(Br(t,r,n),n){let e=n.parent;for(;e&&e.parent;)Ar(e.parent.vnode)&&Dr(r,t,n,e),e=e.parent}}function Dr(e,t,n,r){const s=Br(t,e,r,!0);Hr(()=>{c(r[t],s)},n)}function Fr(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function Lr(e){return 128&e.shapeFlag?e.ssContent:e}function Br(e,t,n=sa,r=!1){if(n){const s=n[e]||(n[e]=[]),i=t.__weh||(t.__weh=(...r)=>{We();const s=ca(n),i=bn(t,n,e,r);return s(),He(),i});return r?s.unshift(i):s.push(i),i}}const zr=e=>(t,n=sa)=>{ma&&"sp"!==e||Br(e,(...e)=>t(...e),n)},Ur=zr("bm"),$r=zr("m"),Vr=zr("bu"),jr=zr("u"),Wr=zr("bum"),Hr=zr("um"),qr=zr("sp"),Xr=zr("rtg"),Gr=zr("rtc");function Kr(e,t=sa){Br("ec",e,t)}const Yr="components";function Qr(e,t){return ts(Yr,e,!0,t)||e}const Jr=Symbol.for("v-ndc");function Zr(e){return b(e)?ts(Yr,e,!1)||e:e||Jr}function es(e){return ts("directives",e)}function ts(e,t,n=!0,r=!1){const s=Fn||sa;if(s){const n=s.type;if(e===Yr){const e=ka(n,!1);if(e&&(e===t||e===P(t)||e===R(P(t))))return n}const i=ns(s[e]||n[e],t)||ns(s.appContext[e],t);return!i&&r?n:i}}function ns(e,t){return e&&(e[t]||e[P(t)]||e[R(P(t))])}function rs(e,t,n,r){let s;const i=n&&n[r],a=d(e);if(a||b(e)){let n=!1,r=!1;a&&Ut(e)&&(n=!Vt(e),r=$t(e),e=st(e)),s=new Array(e.length);for(let a=0,o=e.length;a<o;a++)s[a]=t(n?r?Xt(qt(e[a])):qt(e[a]):e[a],a,void 0,i&&i[a])}else if("number"==typeof e){s=new Array(e);for(let n=0;n<e;n++)s[n]=t(n+1,n,void 0,i&&i[n])}else if(w(e))if(e[Symbol.iterator])s=Array.from(e,(e,n)=>t(e,n,void 0,i&&i[n]));else{const n=Object.keys(e);s=new Array(n.length);for(let r=0,a=n.length;r<a;r++){const a=n[r];s[r]=t(e[a],a,r,i&&i[r])}}else s=[];return n&&(n[r]=s),s}function ss(e,t){for(let n=0;n<t.length;n++){const r=t[n];if(d(r))for(let t=0;t<r.length;t++)e[r[t].name]=r[t].fn;else r&&(e[r.name]=r.key?(...e)=>{const t=r.fn(...e);return t&&(t.key=r.key),t}:r.fn)}return e}function is(e,t,n={},r,s){if(Fn.ce||Fn.parent&&Ir(Fn.parent)&&Fn.parent.ce)return"default"!==t&&(n.name=t),Ri(),zi(Ii,null,[Hi("slot",n,r&&r())],64);let i=e[t];i&&i._c&&(i._d=!1),Ri();const a=i&&as(i(n)),o=n.key||a&&a.key,c=zi(Ii,{key:(o&&!y(o)?o:`_${t}`)+(!a&&r?"_fb":"")},a||(r?r():[]),a&&1===e._?64:-2);return!s&&c.scopeId&&(c.slotScopeIds=[c.scopeId+"-s"]),i&&i._c&&(i._d=!0),c}function as(e){return e.some(e=>!Ui(e)||e.type!==Ai&&!(e.type===Ii&&!as(e.children)))?e:null}function os(e,t){const n={};for(const r in e)n[t&&/[A-Z]/.test(r)?`on:${r}`:M(r)]=e[r];return n}const cs=e=>e?ua(e)?wa(e):cs(e.parent):null,ls=o(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>cs(e.parent),$root:e=>cs(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>ws(e),$forceUpdate:e=>e.f||(e.f=()=>{In(e.update)}),$nextTick:e=>e.n||(e.n=Cn.bind(e.proxy)),$watch:e=>ci.bind(e)}),us=(e,n)=>e!==t&&!e.__isScriptSetup&&u(e,n),ds={get({_:e},n){if("__v_skip"===n)return!0;const{ctx:r,setupState:s,data:i,props:a,accessCache:o,type:c,appContext:l}=e;let d;if("$"!==n[0]){const c=o[n];if(void 0!==c)switch(c){case 1:return s[n];case 2:return i[n];case 4:return r[n];case 3:return a[n]}else{if(us(s,n))return o[n]=1,s[n];if(i!==t&&u(i,n))return o[n]=2,i[n];if((d=e.propsOptions[0])&&u(d,n))return o[n]=3,a[n];if(r!==t&&u(r,n))return o[n]=4,r[n];fs&&(o[n]=0)}}const h=ls[n];let m,p;return h?("$attrs"===n&&tt(e.attrs,0,""),h(e)):(m=c.__cssModules)&&(m=m[n])?m:r!==t&&u(r,n)?(o[n]=4,r[n]):(p=l.config.globalProperties,u(p,n)?p[n]:void 0)},set({_:e},n,r){const{data:s,setupState:i,ctx:a}=e;return us(i,n)?(i[n]=r,!0):s!==t&&u(s,n)?(s[n]=r,!0):!u(e.props,n)&&(("$"!==n[0]||!(n.slice(1)in e))&&(a[n]=r,!0))},has({_:{data:e,setupState:n,accessCache:r,ctx:s,appContext:i,propsOptions:a}},o){let c;return!!r[o]||e!==t&&u(e,o)||us(n,o)||(c=a[0])&&u(c,o)||u(s,o)||u(ls,o)||u(i.config.globalProperties,o)},defineProperty(e,t,n){return null!=n.get?e._.accessCache[t]=0:u(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}},hs=o({},ds,{get(e,t){if(t!==Symbol.unscopables)return ds.get(e,t,e)},has:(e,t)=>"_"!==t[0]&&!H(t)});function ms(){const e=ia();return e.setupContext||(e.setupContext=ya(e))}function ps(e){return d(e)?e.reduce((e,t)=>(e[t]=null,e),{}):e}let fs=!0;function gs(e){const t=ws(e),n=e.proxy,s=e.ctx;fs=!1,t.beforeCreate&&bs(t.beforeCreate,e,"bc");const{data:i,computed:a,methods:o,watch:c,provide:l,inject:u,created:h,beforeMount:m,mounted:p,beforeUpdate:f,updated:b,activated:y,deactivated:k,beforeDestroy:T,beforeUnmount:_,destroyed:v,unmounted:S,render:E,renderTracked:C,renderTriggered:I,errorCaptured:x,serverPrefetch:A,expose:P,inheritAttrs:O,components:N,directives:R,filters:M}=t;if(u&&function(e,t){d(e)&&(e=vs(e));for(const n in e){const r=e[n];let s;s=w(r)?"default"in r?Ns(r.from||n,r.default,!0):Ns(r.from||n):Ns(r),Gt(s)?Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:()=>s.value,set:e=>s.value=e}):t[n]=s}}(u,s,null),o)for(const r in o){const e=o[r];g(e)&&(s[r]=e.bind(n))}if(i){const t=i.call(n,n);w(t)&&(e.data=Dt(t))}if(fs=!0,a)for(const d in a){const e=a[d],t=g(e)?e.bind(n,n):g(e.get)?e.get.bind(n,n):r,i=!g(e)&&g(e.set)?e.set.bind(n):r,o=Ta({get:t,set:i});Object.defineProperty(s,d,{enumerable:!0,configurable:!0,get:()=>o.value,set:e=>o.value=e})}if(c)for(const r in c)ys(c[r],s,n,r);if(l){const e=g(l)?l.call(n):l;Reflect.ownKeys(e).forEach(t=>{Os(t,e[t])})}function D(e,t){d(t)?t.forEach(t=>e(t.bind(n))):t&&e(t.bind(n))}if(h&&bs(h,e,"c"),D(Ur,m),D($r,p),D(Vr,f),D(jr,b),D(Nr,y),D(Rr,k),D(Kr,x),D(Gr,C),D(Xr,I),D(Wr,_),D(Hr,S),D(qr,A),d(P))if(P.length){const t=e.exposed||(e.exposed={});P.forEach(e=>{Object.defineProperty(t,e,{get:()=>n[e],set:t=>n[e]=t})})}else e.exposed||(e.exposed={});E&&e.render===r&&(e.render=E),null!=O&&(e.inheritAttrs=O),N&&(e.components=N),R&&(e.directives=R),A&&fr(e)}function bs(e,t,n){bn(d(e)?e.map(e=>e.bind(t.proxy)):e.bind(t.proxy),t,n)}function ys(e,t,n,r){let s=r.includes(".")?li(n,r):()=>n[r];if(b(e)){const n=t[e];g(n)&&ai(s,n)}else if(g(e))ai(s,e.bind(n));else if(w(e))if(d(e))e.forEach(e=>ys(e,t,n,r));else{const r=g(e.handler)?e.handler.bind(n):t[e.handler];g(r)&&ai(s,r,e)}}function ws(e){const t=e.type,{mixins:n,extends:r}=t,{mixins:s,optionsCache:i,config:{optionMergeStrategies:a}}=e.appContext,o=i.get(t);let c;return o?c=o:s.length||n||r?(c={},s.length&&s.forEach(e=>ks(c,e,a,!0)),ks(c,t,a)):c=t,w(t)&&i.set(t,c),c}function ks(e,t,n,r=!1){const{mixins:s,extends:i}=t;i&&ks(e,i,n,!0),s&&s.forEach(t=>ks(e,t,n,!0));for(const a in t)if(r&&"expose"===a);else{const r=Ts[a]||n&&n[a];e[a]=r?r(e[a],t[a]):t[a]}return e}const Ts={data:_s,props:Cs,emits:Cs,methods:Es,computed:Es,beforeCreate:Ss,created:Ss,beforeMount:Ss,mounted:Ss,beforeUpdate:Ss,updated:Ss,beforeDestroy:Ss,beforeUnmount:Ss,destroyed:Ss,unmounted:Ss,activated:Ss,deactivated:Ss,errorCaptured:Ss,serverPrefetch:Ss,components:Es,directives:Es,watch:function(e,t){if(!e)return t;if(!t)return e;const n=o(Object.create(null),e);for(const r in t)n[r]=Ss(e[r],t[r]);return n},provide:_s,inject:function(e,t){return Es(vs(e),vs(t))}};function _s(e,t){return t?e?function(){return o(g(e)?e.call(this,this):e,g(t)?t.call(this,this):t)}:t:e}function vs(e){if(d(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function Ss(e,t){return e?[...new Set([].concat(e,t))]:t}function Es(e,t){return e?o(Object.create(null),e,t):t}function Cs(e,t){return e?d(e)&&d(t)?[...new Set([...e,...t])]:o(Object.create(null),ps(e),ps(null!=t?t:{})):t}function Is(){return{app:null,config:{isNativeTag:s,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let xs=0;function As(e,t){return function(n,r=null){g(n)||(n=o({},n)),null==r||w(r)||(r=null);const s=Is(),i=new WeakSet,a=[];let c=!1;const l=s.app={_uid:xs++,_component:n,_props:r,_container:null,_context:s,_instance:null,version:Sa,get config(){return s.config},set config(e){},use:(e,...t)=>(i.has(e)||(e&&g(e.install)?(i.add(e),e.install(l,...t)):g(e)&&(i.add(e),e(l,...t))),l),mixin:e=>(s.mixins.includes(e)||s.mixins.push(e),l),component:(e,t)=>t?(s.components[e]=t,l):s.components[e],directive:(e,t)=>t?(s.directives[e]=t,l):s.directives[e],mount(i,a,o){if(!c){const u=l._ceVNode||Hi(n,r);return u.appContext=s,!0===o?o="svg":!1===o&&(o=void 0),a&&t?t(u,i):e(u,i,o),c=!0,l._container=i,i.__vue_app__=l,wa(u.component)}},onUnmount(e){a.push(e)},unmount(){c&&(bn(a,l._instance,16),e(null,l._container),delete l._container.__vue_app__)},provide:(e,t)=>(s.provides[e]=t,l),runWithContext(e){const t=Ps;Ps=l;try{return e()}finally{Ps=t}}};return l}}let Ps=null;function Os(e,t){if(sa){let n=sa.provides;const r=sa.parent&&sa.parent.provides;r===n&&(n=sa.provides=Object.create(r)),n[e]=t}else;}function Ns(e,t,n=!1){const r=sa||Fn;if(r||Ps){let s=Ps?Ps._context.provides:r?null==r.parent||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&e in s)return s[e];if(arguments.length>1)return n&&g(t)?t.call(r&&r.proxy):t}}const Rs={},Ms=()=>Object.create(Rs),Ds=e=>Object.getPrototypeOf(e)===Rs;function Fs(e,n,r,s){const[i,a]=e.propsOptions;let o,c=!1;if(n)for(let t in n){if(C(t))continue;const l=n[t];let d;i&&u(i,d=P(t))?a&&a.includes(d)?(o||(o={}))[d]=l:r[d]=l:mi(e.emitsOptions,t)||t in s&&l===s[t]||(s[t]=l,c=!0)}if(a){const n=Wt(r),s=o||t;for(let t=0;t<a.length;t++){const o=a[t];r[o]=Ls(i,n,o,s[o],e,!u(s,o))}}return c}function Ls(e,t,n,r,s,i){const a=e[n];if(null!=a){const e=u(a,"default");if(e&&void 0===r){const e=a.default;if(a.type!==Function&&!a.skipFactory&&g(e)){const{propsDefaults:i}=s;if(n in i)r=i[n];else{const a=ca(s);r=i[n]=e.call(null,t),a()}}else r=e;s.ce&&s.ce._setProp(n,r)}a[0]&&(i&&!e?r=!1:!a[1]||""!==r&&r!==N(n)||(r=!0))}return r}const Bs=new WeakMap;function zs(e,r,s=!1){const i=s?Bs:r.propsCache,a=i.get(e);if(a)return a;const c=e.props,l={},h=[];let m=!1;if(!g(e)){const t=e=>{m=!0;const[t,n]=zs(e,r,!0);o(l,t),n&&h.push(...n)};!s&&r.mixins.length&&r.mixins.forEach(t),e.extends&&t(e.extends),e.mixins&&e.mixins.forEach(t)}if(!c&&!m)return w(e)&&i.set(e,n),n;if(d(c))for(let n=0;n<c.length;n++){const e=P(c[n]);Us(e)&&(l[e]=t)}else if(c)for(const t in c){const e=P(t);if(Us(e)){const n=c[t],r=l[e]=d(n)||g(n)?{type:n}:o({},n),s=r.type;let i=!1,a=!0;if(d(s))for(let e=0;e<s.length;++e){const t=s[e],n=g(t)&&t.name;if("Boolean"===n){i=!0;break}"String"===n&&(a=!1)}else i=g(s)&&"Boolean"===s.name;r[0]=i,r[1]=a,(i||u(r,"default"))&&h.push(e)}}const p=[l,h];return w(e)&&i.set(e,p),p}function Us(e){return"$"!==e[0]&&!C(e)}const $s=e=>"_"===e[0]||"$stable"===e,Vs=e=>d(e)?e.map(Yi):[Yi(e)],js=(e,t,n)=>{if(t._n)return t;const r=zn((...e)=>Vs(t(...e)),n);return r._c=!1,r},Ws=(e,t,n)=>{const r=e._ctx;for(const s in e){if($s(s))continue;const n=e[s];if(g(n))t[s]=js(0,n,r);else if(null!=n){const e=Vs(n);t[s]=()=>e}}},Hs=(e,t)=>{const n=Vs(t);e.slots.default=()=>n},qs=(e,t,n)=>{for(const r in t)!n&&$s(r)||(e[r]=t[r])},Xs=Ei;function Gs(e){return Ys(e)}function Ks(e){return Ys(e,Tr)}function Ys(e,s){$().__VUE__=!0;const{insert:i,remove:a,patchProp:o,createElement:c,createText:l,createComment:h,setText:m,setElementText:p,parentNode:f,nextSibling:g,setScopeId:b=r,insertStaticContent:y}=e,w=(e,t,n,r=null,s=null,i=null,a=void 0,o=null,c=!!t.dynamicChildren)=>{if(e===t)return;e&&!$i(e,t)&&(r=Y(e),H(e,s,i,!0),e=null),-2===t.patchFlag&&(c=!1,t.dynamicChildren=null);const{type:l,ref:u,shapeFlag:d}=t;switch(l){case xi:k(e,t,n,r);break;case Ai:T(e,t,n,r);break;case Pi:null==e&&_(t,n,r,a);break;case Ii:R(e,t,n,r,s,i,a,o,c);break;default:1&d?v(e,t,n,r,s,i,a,o,c):6&d?M(e,t,n,r,s,i,a,o,c):(64&d||128&d)&&l.process(e,t,n,r,s,i,a,o,c,Z)}null!=u&&s?gr(u,e&&e.ref,i,t||e,!t):null==u&&e&&null!=e.ref&&gr(e.ref,null,i,e,!0)},k=(e,t,n,r)=>{if(null==e)i(t.el=l(t.children),n,r);else{const n=t.el=e.el;t.children!==e.children&&m(n,t.children)}},T=(e,t,n,r)=>{null==e?i(t.el=h(t.children||""),n,r):t.el=e.el},_=(e,t,n,r)=>{[e.el,e.anchor]=y(e.children,t,n,r,e.el,e.anchor)},v=(e,t,n,r,s,i,a,o,c)=>{"svg"===t.type?a="svg":"math"===t.type&&(a="mathml"),null==e?S(t,n,r,s,i,a,o,c):x(e,t,s,i,a,o,c)},S=(e,t,n,r,s,a,l,u)=>{let d,h;const{props:m,shapeFlag:f,transition:g,dirs:b}=e;if(d=e.el=c(e.type,a,m&&m.is,m),8&f?p(d,e.children):16&f&&I(e.children,d,null,r,s,Qs(e,a),l,u),b&&$n(e,null,r,"created"),E(d,e,e.scopeId,l,r),m){for(const e in m)"value"===e||C(e)||o(d,e,null,m[e],a,r);"value"in m&&o(d,"value",null,m.value,a),(h=m.onVnodeBeforeMount)&&ea(h,r,e)}b&&$n(e,null,r,"beforeMount");const y=Zs(s,g);y&&g.beforeEnter(d),i(d,t,n),((h=m&&m.onVnodeMounted)||y||b)&&Xs(()=>{h&&ea(h,r,e),y&&g.enter(d),b&&$n(e,null,r,"mounted")},s)},E=(e,t,n,r,s)=>{if(n&&b(e,n),r)for(let i=0;i<r.length;i++)b(e,r[i]);if(s){let n=s.subTree;if(t===n||wi(n.type)&&(n.ssContent===t||n.ssFallback===t)){const t=s.vnode;E(e,t,t.scopeId,t.slotScopeIds,s.parent)}}},I=(e,t,n,r,s,i,a,o,c=0)=>{for(let l=c;l<e.length;l++){const c=e[l]=o?Qi(e[l]):Yi(e[l]);w(null,c,t,n,r,s,i,a,o)}},x=(e,n,r,s,i,a,c)=>{const l=n.el=e.el;let{patchFlag:u,dynamicChildren:d,dirs:h}=n;u|=16&e.patchFlag;const m=e.props||t,f=n.props||t;let g;if(r&&Js(r,!1),(g=f.onVnodeBeforeUpdate)&&ea(g,r,n,e),h&&$n(n,e,r,"beforeUpdate"),r&&Js(r,!0),(m.innerHTML&&null==f.innerHTML||m.textContent&&null==f.textContent)&&p(l,""),d?A(e.dynamicChildren,d,l,r,s,Qs(n,i),a):c||U(e,n,l,null,r,s,Qs(n,i),a,!1),u>0){if(16&u)O(l,m,f,r,i);else if(2&u&&m.class!==f.class&&o(l,"class",null,f.class,i),4&u&&o(l,"style",m.style,f.style,i),8&u){const e=n.dynamicProps;for(let t=0;t<e.length;t++){const n=e[t],s=m[n],a=f[n];a===s&&"value"!==n||o(l,n,s,a,i,r)}}1&u&&e.children!==n.children&&p(l,n.children)}else c||null!=d||O(l,m,f,r,i);((g=f.onVnodeUpdated)||h)&&Xs(()=>{g&&ea(g,r,n,e),h&&$n(n,e,r,"updated")},s)},A=(e,t,n,r,s,i,a)=>{for(let o=0;o<t.length;o++){const c=e[o],l=t[o],u=c.el&&(c.type===Ii||!$i(c,l)||198&c.shapeFlag)?f(c.el):n;w(c,l,u,null,r,s,i,a,!0)}},O=(e,n,r,s,i)=>{if(n!==r){if(n!==t)for(const t in n)C(t)||t in r||o(e,t,n[t],null,i,s);for(const t in r){if(C(t))continue;const a=r[t],c=n[t];a!==c&&"value"!==t&&o(e,t,c,a,i,s)}"value"in r&&o(e,"value",n.value,r.value,i)}},R=(e,t,n,r,s,a,o,c,u)=>{const d=t.el=e?e.el:l(""),h=t.anchor=e?e.anchor:l("");let{patchFlag:m,dynamicChildren:p,slotScopeIds:f}=t;f&&(c=c?c.concat(f):f),null==e?(i(d,n,r),i(h,n,r),I(t.children||[],n,h,s,a,o,c,u)):m>0&&64&m&&p&&e.dynamicChildren?(A(e.dynamicChildren,p,n,s,a,o,c),(null!=t.key||s&&t===s.subTree)&&ei(e,t,!0)):U(e,t,n,h,s,a,o,c,u)},M=(e,t,n,r,s,i,a,o,c)=>{t.slotScopeIds=o,null==e?512&t.shapeFlag?s.ctx.activate(t,n,r,a,c):D(t,n,r,s,i,a,c):L(e,t,c)},D=(e,t,n,r,s,i,a)=>{const o=e.component=ra(e,r,s);if(Ar(e)&&(o.ctx.renderer=Z),pa(o,!1,a),o.asyncDep){if(s&&s.registerDep(o,B,a),!e.el){const e=o.subTree=Hi(Ai);T(null,e,t,n)}}else B(o,e,t,n,s,i,a)},L=(e,t,n)=>{const r=t.component=e.component;if(function(e,t,n){const{props:r,children:s,component:i}=e,{props:a,children:o,patchFlag:c}=t,l=i.emitsOptions;if(t.dirs||t.transition)return!0;if(!(n&&c>=0))return!(!s&&!o||o&&o.$stable)||r!==a&&(r?!a||bi(r,a,l):!!a);if(1024&c)return!0;if(16&c)return r?bi(r,a,l):!!a;if(8&c){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const n=e[t];if(a[n]!==r[n]&&!mi(l,n))return!0}}return!1}(e,t,n)){if(r.asyncDep&&!r.asyncResolved)return void z(r,t,n);r.next=t,r.update()}else t.el=e.el,r.vnode=t},B=(e,t,n,r,s,i,a)=>{const o=()=>{if(e.isMounted){let{next:t,bu:n,u:r,parent:c,vnode:l}=e;{const n=ti(e);if(n)return t&&(t.el=l.el,z(e,t,a)),void n.asyncDep.then(()=>{e.isUnmounted||o()})}let u,d=t;Js(e,!1),t?(t.el=l.el,z(e,t,a)):t=l,n&&F(n),(u=t.props&&t.props.onVnodeBeforeUpdate)&&ea(u,c,t,l),Js(e,!0);const h=pi(e),m=e.subTree;e.subTree=h,w(m,h,f(m.el),Y(m),e,s,i),t.el=h.el,null===d&&yi(e,h.el),r&&Xs(r,s),(u=t.props&&t.props.onVnodeUpdated)&&Xs(()=>ea(u,c,t,l),s)}else{let a;const{el:o,props:c}=t,{bm:l,m:u,parent:d,root:h,type:m}=e,p=Ir(t);if(Js(e,!1),l&&F(l),!p&&(a=c&&c.onVnodeBeforeMount)&&ea(a,d,t),Js(e,!0),o&&te){const t=()=>{e.subTree=pi(e),te(o,e.subTree,e,s,null)};p&&m.__asyncHydrate?m.__asyncHydrate(o,e,t):t()}else{h.ce&&!1!==h.ce._def.shadowRoot&&h.ce._injectChildStyle(m);const a=e.subTree=pi(e);w(null,a,n,r,e,s,i),t.el=a.el}if(u&&Xs(u,s),!p&&(a=c&&c.onVnodeMounted)){const e=t;Xs(()=>ea(a,d,e),s)}(256&t.shapeFlag||d&&Ir(d.vnode)&&256&d.vnode.shapeFlag)&&e.a&&Xs(e.a,s),e.isMounted=!0,t=n=r=null}};e.scope.on();const c=e.effect=new Ae(o);e.scope.off();const l=e.update=c.run.bind(c),u=e.job=c.runIfDirty.bind(c);u.i=e,u.id=e.uid,c.scheduler=()=>In(u),Js(e,!0),l()},z=(e,n,r)=>{n.component=e;const s=e.vnode.props;e.vnode=n,e.next=null,function(e,t,n,r){const{props:s,attrs:i,vnode:{patchFlag:a}}=e,o=Wt(s),[c]=e.propsOptions;let l=!1;if(!(r||a>0)||16&a){let r;Fs(e,t,s,i)&&(l=!0);for(const i in o)t&&(u(t,i)||(r=N(i))!==i&&u(t,r))||(c?!n||void 0===n[i]&&void 0===n[r]||(s[i]=Ls(c,o,i,void 0,e,!0)):delete s[i]);if(i!==o)for(const e in i)t&&u(t,e)||(delete i[e],l=!0)}else if(8&a){const n=e.vnode.dynamicProps;for(let r=0;r<n.length;r++){let a=n[r];if(mi(e.emitsOptions,a))continue;const d=t[a];if(c)if(u(i,a))d!==i[a]&&(i[a]=d,l=!0);else{const t=P(a);s[t]=Ls(c,o,t,d,e,!1)}else d!==i[a]&&(i[a]=d,l=!0)}}l&&nt(e.attrs,"set","")}(e,n.props,s,r),((e,n,r)=>{const{vnode:s,slots:i}=e;let a=!0,o=t;if(32&s.shapeFlag){const e=n._;e?r&&1===e?a=!1:qs(i,n,r):(a=!n.$stable,Ws(n,i)),o=n}else n&&(Hs(e,n),o={default:1});if(a)for(const t in i)$s(t)||null!=o[t]||delete i[t]})(e,n.children,r),We(),Pn(e),He()},U=(e,t,n,r,s,i,a,o,c=!1)=>{const l=e&&e.children,u=e?e.shapeFlag:0,d=t.children,{patchFlag:h,shapeFlag:m}=t;if(h>0){if(128&h)return void j(l,d,n,r,s,i,a,o,c);if(256&h)return void V(l,d,n,r,s,i,a,o,c)}8&m?(16&u&&K(l,s,i),d!==l&&p(n,d)):16&u?16&m?j(l,d,n,r,s,i,a,o,c):K(l,s,i,!0):(8&u&&p(n,""),16&m&&I(d,n,r,s,i,a,o,c))},V=(e,t,r,s,i,a,o,c,l)=>{t=t||n;const u=(e=e||n).length,d=t.length,h=Math.min(u,d);let m;for(m=0;m<h;m++){const n=t[m]=l?Qi(t[m]):Yi(t[m]);w(e[m],n,r,null,i,a,o,c,l)}u>d?K(e,i,a,!0,!1,h):I(t,r,s,i,a,o,c,l,h)},j=(e,t,r,s,i,a,o,c,l)=>{let u=0;const d=t.length;let h=e.length-1,m=d-1;for(;u<=h&&u<=m;){const n=e[u],s=t[u]=l?Qi(t[u]):Yi(t[u]);if(!$i(n,s))break;w(n,s,r,null,i,a,o,c,l),u++}for(;u<=h&&u<=m;){const n=e[h],s=t[m]=l?Qi(t[m]):Yi(t[m]);if(!$i(n,s))break;w(n,s,r,null,i,a,o,c,l),h--,m--}if(u>h){if(u<=m){const e=m+1,n=e<d?t[e].el:s;for(;u<=m;)w(null,t[u]=l?Qi(t[u]):Yi(t[u]),r,n,i,a,o,c,l),u++}}else if(u>m)for(;u<=h;)H(e[u],i,a,!0),u++;else{const p=u,f=u,g=new Map;for(u=f;u<=m;u++){const e=t[u]=l?Qi(t[u]):Yi(t[u]);null!=e.key&&g.set(e.key,u)}let b,y=0;const k=m-f+1;let T=!1,_=0;const v=new Array(k);for(u=0;u<k;u++)v[u]=0;for(u=p;u<=h;u++){const n=e[u];if(y>=k){H(n,i,a,!0);continue}let s;if(null!=n.key)s=g.get(n.key);else for(b=f;b<=m;b++)if(0===v[b-f]&&$i(n,t[b])){s=b;break}void 0===s?H(n,i,a,!0):(v[s-f]=u+1,s>=_?_=s:T=!0,w(n,t[s],r,null,i,a,o,c,l),y++)}const S=T?function(e){const t=e.slice(),n=[0];let r,s,i,a,o;const c=e.length;for(r=0;r<c;r++){const c=e[r];if(0!==c){if(s=n[n.length-1],e[s]<c){t[r]=s,n.push(r);continue}for(i=0,a=n.length-1;i<a;)o=i+a>>1,e[n[o]]<c?i=o+1:a=o;c<e[n[i]]&&(i>0&&(t[r]=n[i-1]),n[i]=r)}}i=n.length,a=n[i-1];for(;i-- >0;)n[i]=a,a=t[a];return n}(v):n;for(b=S.length-1,u=k-1;u>=0;u--){const e=f+u,n=t[e],h=e+1<d?t[e+1].el:s;0===v[u]?w(null,n,r,h,i,a,o,c,l):T&&(b<0||u!==S[b]?W(n,r,h,2):b--)}}},W=(e,t,n,r,s=null)=>{const{el:o,type:c,transition:l,children:u,shapeFlag:d}=e;if(6&d)return void W(e.component.subTree,t,n,r);if(128&d)return void e.suspense.move(t,n,r);if(64&d)return void c.move(e,t,n,Z);if(c===Ii){i(o,t,n);for(let e=0;e<u.length;e++)W(u[e],t,n,r);return void i(e.anchor,t,n)}if(c===Pi)return void(({el:e,anchor:t},n,r)=>{let s;for(;e&&e!==t;)s=g(e),i(e,n,r),e=s;i(t,n,r)})(e,t,n);if(2!==r&&1&d&&l)if(0===r)l.beforeEnter(o),i(o,t,n),Xs(()=>l.enter(o),s);else{const{leave:r,delayLeave:s,afterLeave:c}=l,u=()=>{e.ctx.isUnmounted?a(o):i(o,t,n)},d=()=>{r(o,()=>{u(),c&&c()})};s?s(o,u,d):d()}else i(o,t,n)},H=(e,t,n,r=!1,s=!1)=>{const{type:i,props:a,ref:o,children:c,dynamicChildren:l,shapeFlag:u,patchFlag:d,dirs:h,cacheIndex:m}=e;if(-2===d&&(s=!1),null!=o&&(We(),gr(o,null,n,e,!0),He()),null!=m&&(t.renderCache[m]=void 0),256&u)return void t.ctx.deactivate(e);const p=1&u&&h,f=!Ir(e);let g;if(f&&(g=a&&a.onVnodeBeforeUnmount)&&ea(g,t,e),6&u)G(e.component,n,r);else{if(128&u)return void e.suspense.unmount(n,r);p&&$n(e,null,t,"beforeUnmount"),64&u?e.type.remove(e,t,n,Z,r):l&&!l.hasOnce&&(i!==Ii||d>0&&64&d)?K(l,t,n,!1,!0):(i===Ii&&384&d||!s&&16&u)&&K(c,t,n),r&&q(e)}(f&&(g=a&&a.onVnodeUnmounted)||p)&&Xs(()=>{g&&ea(g,t,e),p&&$n(e,null,t,"unmounted")},n)},q=e=>{const{type:t,el:n,anchor:r,transition:s}=e;if(t===Ii)return void X(n,r);if(t===Pi)return void(({el:e,anchor:t})=>{let n;for(;e&&e!==t;)n=g(e),a(e),e=n;a(t)})(e);const i=()=>{a(n),s&&!s.persisted&&s.afterLeave&&s.afterLeave()};if(1&e.shapeFlag&&s&&!s.persisted){const{leave:t,delayLeave:r}=s,a=()=>t(n,i);r?r(e.el,i,a):a()}else i()},X=(e,t)=>{let n;for(;e!==t;)n=g(e),a(e),e=n;a(t)},G=(e,t,n)=>{const{bum:r,scope:s,job:i,subTree:a,um:o,m:c,a:l,parent:u,slots:{__:h}}=e;ni(c),ni(l),r&&F(r),u&&d(h)&&h.forEach(e=>{u.renderCache[e]=void 0}),s.stop(),i&&(i.flags|=8,H(a,e,t,n)),o&&Xs(o,t),Xs(()=>{e.isUnmounted=!0},t),t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId&&(t.deps--,0===t.deps&&t.resolve())},K=(e,t,n,r=!1,s=!1,i=0)=>{for(let a=i;a<e.length;a++)H(e[a],t,n,r,s)},Y=e=>{if(6&e.shapeFlag)return Y(e.component.subTree);if(128&e.shapeFlag)return e.suspense.next();const t=g(e.anchor||e.el),n=t&&t[Vn];return n?g(n):t};let Q=!1;const J=(e,t,n)=>{null==e?t._vnode&&H(t._vnode,null,null,!0):w(t._vnode||null,e,t,null,null,null,n),t._vnode=e,Q||(Q=!0,Pn(),On(),Q=!1)},Z={p:w,um:H,m:W,r:q,mt:D,mc:I,pc:U,pbc:A,n:Y,o:e};let ee,te;return s&&([ee,te]=s(Z)),{render:J,hydrate:ee,createApp:As(J,ee)}}function Qs({type:e,props:t},n){return"svg"===n&&"foreignObject"===e||"mathml"===n&&"annotation-xml"===e&&t&&t.encoding&&t.encoding.includes("html")?void 0:n}function Js({effect:e,job:t},n){n?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function Zs(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function ei(e,t,n=!1){const r=e.children,s=t.children;if(d(r)&&d(s))for(let i=0;i<r.length;i++){const e=r[i];let t=s[i];1&t.shapeFlag&&!t.dynamicChildren&&((t.patchFlag<=0||32===t.patchFlag)&&(t=s[i]=Qi(s[i]),t.el=e.el),n||-2===t.patchFlag||ei(e,t)),t.type===xi&&(t.el=e.el),t.type!==Ai||t.el||(t.el=e.el)}}function ti(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:ti(t)}function ni(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const ri=Symbol.for("v-scx"),si=()=>Ns(ri);function ii(e,t){return oi(e,null,{flush:"sync"})}function ai(e,t,n){return oi(e,t,n)}function oi(e,n,s=t){const{immediate:i,deep:a,flush:l,once:u}=s,h=o({},s),m=n&&i||!n&&"post"!==l;let p;if(ma)if("sync"===l){const e=si();p=e.__watcherHandles||(e.__watcherHandles=[])}else if(!m){const e=()=>{};return e.stop=r,e.resume=r,e.pause=r,e}const f=sa;h.call=(e,t,n)=>bn(e,f,t,n);let b=!1;"post"===l?h.scheduler=e=>{Xs(e,f&&f.suspense)}:"sync"!==l&&(b=!0,h.scheduler=(e,t)=>{t?e():In(e)}),h.augmentJob=e=>{n&&(e.flags|=4),b&&(e.flags|=2,f&&(e.id=f.uid,e.i=f))};const y=function(e,n,s=t){const{immediate:i,deep:a,once:o,scheduler:l,augmentJob:u,call:h}=s,m=e=>a?e:Vt(e)||!1===a||0===a?mn(e,1):mn(e);let p,f,b,y,w=!1,k=!1;if(Gt(e)?(f=()=>e.value,w=Vt(e)):Ut(e)?(f=()=>m(e),w=!0):d(e)?(k=!0,w=e.some(e=>Ut(e)||Vt(e)),f=()=>e.map(e=>Gt(e)?e.value:Ut(e)?m(e):g(e)?h?h(e,2):e():void 0)):f=g(e)?n?h?()=>h(e,2):e:()=>{if(b){We();try{b()}finally{He()}}const t=dn;dn=p;try{return h?h(e,3,[y]):e(y)}finally{dn=t}}:r,n&&a){const e=f,t=!0===a?1/0:a;f=()=>mn(e(),t)}const T=Ie(),_=()=>{p.stop(),T&&T.active&&c(T.effects,p)};if(o&&n){const e=n;n=(...t)=>{e(...t),_()}}let v=k?new Array(e.length).fill(ln):ln;const S=e=>{if(1&p.flags&&(p.dirty||e))if(n){const e=p.run();if(a||w||(k?e.some((e,t)=>D(e,v[t])):D(e,v))){b&&b();const t=dn;dn=p;try{const t=[e,v===ln?void 0:k&&v[0]===ln?[]:v,y];v=e,h?h(n,3,t):n(...t)}finally{dn=t}}}else p.run()};return u&&u(S),p=new Ae(f),p.scheduler=l?()=>l(S,!1):S,y=e=>hn(e,!1,p),b=p.onStop=()=>{const e=un.get(p);if(e){if(h)h(e,4);else for(const t of e)t();un.delete(p)}},n?i?S(!0):v=p.run():l?l(S.bind(null,!0),!0):p.run(),_.pause=p.pause.bind(p),_.resume=p.resume.bind(p),_.stop=_,_}(e,n,h);return ma&&(p?p.push(y):m&&y()),y}function ci(e,t,n){const r=this.proxy,s=b(e)?e.includes(".")?li(r,e):()=>r[e]:e.bind(r,r);let i;g(t)?i=t:(i=t.handler,n=t);const a=ca(this),o=oi(s,i.bind(r),n);return a(),o}function li(e,t){const n=t.split(".");return()=>{let t=e;for(let e=0;e<n.length&&t;e++)t=t[n[e]];return t}}const ui=(e,t)=>"modelValue"===t||"model-value"===t?e.modelModifiers:e[`${t}Modifiers`]||e[`${P(t)}Modifiers`]||e[`${N(t)}Modifiers`];function di(e,n,...r){if(e.isUnmounted)return;const s=e.vnode.props||t;let i=r;const a=n.startsWith("update:"),o=a&&ui(s,n.slice(7));let c;o&&(o.trim&&(i=r.map(e=>b(e)?e.trim():e)),o.number&&(i=r.map(B)));let l=s[c=M(n)]||s[c=M(P(n))];!l&&a&&(l=s[c=M(N(n))]),l&&bn(l,e,6,i);const u=s[c+"Once"];if(u){if(e.emitted){if(e.emitted[c])return}else e.emitted={};e.emitted[c]=!0,bn(u,e,6,i)}}function hi(e,t,n=!1){const r=t.emitsCache,s=r.get(e);if(void 0!==s)return s;const i=e.emits;let a={},c=!1;if(!g(e)){const r=e=>{const n=hi(e,t,!0);n&&(c=!0,o(a,n))};!n&&t.mixins.length&&t.mixins.forEach(r),e.extends&&r(e.extends),e.mixins&&e.mixins.forEach(r)}return i||c?(d(i)?i.forEach(e=>a[e]=null):o(a,i),w(e)&&r.set(e,a),a):(w(e)&&r.set(e,null),null)}function mi(e,t){return!(!e||!i(t))&&(t=t.slice(2).replace(/Once$/,""),u(e,t[0].toLowerCase()+t.slice(1))||u(e,N(t))||u(e,t))}function pi(e){const{type:t,vnode:n,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:c,emit:l,render:u,renderCache:d,props:h,data:m,setupState:p,ctx:f,inheritAttrs:g}=e,b=Bn(e);let y,w;try{if(4&n.shapeFlag){const e=s||r,t=e;y=Yi(u.call(t,e,d,h,p,m,f)),w=c}else{const e=t;0,y=Yi(e.length>1?e(h,{attrs:c,slots:o,emit:l}):e(h,null)),w=t.props?c:fi(c)}}catch(T){Oi.length=0,yn(T,e,1),y=Hi(Ai)}let k=y;if(w&&!1!==g){const e=Object.keys(w),{shapeFlag:t}=k;e.length&&7&t&&(i&&e.some(a)&&(w=gi(w,i)),k=Xi(k,w,!1,!0))}return n.dirs&&(k=Xi(k,null,!1,!0),k.dirs=k.dirs?k.dirs.concat(n.dirs):n.dirs),n.transition&&hr(k,n.transition),y=k,Bn(b),y}const fi=e=>{let t;for(const n in e)("class"===n||"style"===n||i(n))&&((t||(t={}))[n]=e[n]);return t},gi=(e,t)=>{const n={};for(const r in e)a(r)&&r.slice(9)in t||(n[r]=e[r]);return n};function bi(e,t,n){const r=Object.keys(t);if(r.length!==Object.keys(e).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(t[i]!==e[i]&&!mi(n,i))return!0}return!1}function yi({vnode:e,parent:t},n){for(;t;){const r=t.subTree;if(r.suspense&&r.suspense.activeBranch===e&&(r.el=e.el),r!==e)break;(e=t.vnode).el=n,t=t.parent}}const wi=e=>e.__isSuspense;let ki=0;const Ti={name:"Suspense",__isSuspense:!0,process(e,t,n,r,s,i,a,o,c,l){if(null==e)!function(e,t,n,r,s,i,a,o,c){const{p:l,o:{createElement:u}}=c,d=u("div"),h=e.suspense=vi(e,s,r,t,d,n,i,a,o,c);l(null,h.pendingBranch=e.ssContent,d,null,r,h,i,a),h.deps>0?(_i(e,"onPending"),_i(e,"onFallback"),l(null,e.ssFallback,t,n,r,null,i,a),Ci(h,e.ssFallback)):h.resolve(!1,!0)}(t,n,r,s,i,a,o,c,l);else{if(i&&i.deps>0&&!e.suspense.isInFallback)return t.suspense=e.suspense,t.suspense.vnode=t,void(t.el=e.el);!function(e,t,n,r,s,i,a,o,{p:c,um:l,o:{createElement:u}}){const d=t.suspense=e.suspense;d.vnode=t,t.el=e.el;const h=t.ssContent,m=t.ssFallback,{activeBranch:p,pendingBranch:f,isInFallback:g,isHydrating:b}=d;if(f)d.pendingBranch=h,$i(h,f)?(c(f,h,d.hiddenContainer,null,s,d,i,a,o),d.deps<=0?d.resolve():g&&(b||(c(p,m,n,r,s,null,i,a,o),Ci(d,m)))):(d.pendingId=ki++,b?(d.isHydrating=!1,d.activeBranch=f):l(f,s,d),d.deps=0,d.effects.length=0,d.hiddenContainer=u("div"),g?(c(null,h,d.hiddenContainer,null,s,d,i,a,o),d.deps<=0?d.resolve():(c(p,m,n,r,s,null,i,a,o),Ci(d,m))):p&&$i(h,p)?(c(p,h,n,r,s,d,i,a,o),d.resolve(!0)):(c(null,h,d.hiddenContainer,null,s,d,i,a,o),d.deps<=0&&d.resolve()));else if(p&&$i(h,p))c(p,h,n,r,s,d,i,a,o),Ci(d,h);else if(_i(t,"onPending"),d.pendingBranch=h,512&h.shapeFlag?d.pendingId=h.component.suspenseId:d.pendingId=ki++,c(null,h,d.hiddenContainer,null,s,d,i,a,o),d.deps<=0)d.resolve();else{const{timeout:e,pendingId:t}=d;e>0?setTimeout(()=>{d.pendingId===t&&d.fallback(m)},e):0===e&&d.fallback(m)}}(e,t,n,r,s,a,o,c,l)}},hydrate:function(e,t,n,r,s,i,a,o,c){const l=t.suspense=vi(t,r,n,e.parentNode,document.createElement("div"),null,s,i,a,o,!0),u=c(e,l.pendingBranch=t.ssContent,n,l,i,a);0===l.deps&&l.resolve(!1,!0);return u},normalize:function(e){const{shapeFlag:t,children:n}=e,r=32&t;e.ssContent=Si(r?n.default:n),e.ssFallback=r?Si(n.fallback):Hi(Ai)}};function _i(e,t){const n=e.props&&e.props[t];g(n)&&n()}function vi(e,t,n,r,s,i,a,o,c,l,u=!1){const{p:d,m:h,um:m,n:p,o:{parentNode:f,remove:g}}=l;let b;const y=function(e){const t=e.props&&e.props.suspensible;return null!=t&&!1!==t}(e);y&&t&&t.pendingBranch&&(b=t.pendingId,t.deps++);const w=e.props?z(e.props.timeout):void 0,k=i,T={vnode:e,parent:t,parentComponent:n,namespace:a,container:r,hiddenContainer:s,deps:0,pendingId:ki++,timeout:"number"==typeof w?w:-1,activeBranch:null,pendingBranch:null,isInFallback:!u,isHydrating:u,isUnmounted:!1,effects:[],resolve(e=!1,n=!1){const{vnode:r,activeBranch:s,pendingBranch:a,pendingId:o,effects:c,parentComponent:l,container:u}=T;let d=!1;T.isHydrating?T.isHydrating=!1:e||(d=s&&a.transition&&"out-in"===a.transition.mode,d&&(s.transition.afterLeave=()=>{o===T.pendingId&&(h(a,u,i===k?p(s):i,0),An(c))}),s&&(f(s.el)===u&&(i=p(s)),m(s,l,T,!0)),d||h(a,u,i,0)),Ci(T,a),T.pendingBranch=null,T.isInFallback=!1;let g=T.parent,w=!1;for(;g;){if(g.pendingBranch){g.effects.push(...c),w=!0;break}g=g.parent}w||d||An(c),T.effects=[],y&&t&&t.pendingBranch&&b===t.pendingId&&(t.deps--,0!==t.deps||n||t.resolve()),_i(r,"onResolve")},fallback(e){if(!T.pendingBranch)return;const{vnode:t,activeBranch:n,parentComponent:r,container:s,namespace:i}=T;_i(t,"onFallback");const a=p(n),l=()=>{T.isInFallback&&(d(null,e,s,a,r,null,i,o,c),Ci(T,e))},u=e.transition&&"out-in"===e.transition.mode;u&&(n.transition.afterLeave=l),T.isInFallback=!0,m(n,r,null,!0),u||l()},move(e,t,n){T.activeBranch&&h(T.activeBranch,e,t,n),T.container=e},next:()=>T.activeBranch&&p(T.activeBranch),registerDep(e,t,n){const r=!!T.pendingBranch;r&&T.deps++;const s=e.vnode.el;e.asyncDep.catch(t=>{yn(t,e,0)}).then(i=>{if(e.isUnmounted||T.isUnmounted||T.pendingId!==e.suspenseId)return;e.asyncResolved=!0;const{vnode:o}=e;fa(e,i,!1),s&&(o.el=s);const c=!s&&e.subTree.el;t(e,o,f(s||e.subTree.el),s?null:p(e.subTree),T,a,n),c&&g(c),yi(e,o.el),r&&0===--T.deps&&T.resolve()})},unmount(e,t){T.isUnmounted=!0,T.activeBranch&&m(T.activeBranch,n,e,t),T.pendingBranch&&m(T.pendingBranch,n,e,t)}};return T}function Si(e){let t;if(g(e)){const n=Di&&e._c;n&&(e._d=!1,Ri()),e=e(),n&&(e._d=!0,t=Ni,Mi())}if(d(e)){const t=function(e){let t;for(let n=0;n<e.length;n++){const r=e[n];if(!Ui(r))return;if(r.type!==Ai||"v-if"===r.children){if(t)return;t=r}}return t}(e);e=t}return e=Yi(e),t&&!e.dynamicChildren&&(e.dynamicChildren=t.filter(t=>t!==e)),e}function Ei(e,t){t&&t.pendingBranch?d(e)?t.effects.push(...e):t.effects.push(e):An(e)}function Ci(e,t){e.activeBranch=t;const{vnode:n,parentComponent:r}=e;let s=t.el;for(;!s&&t.component;)s=(t=t.component.subTree).el;n.el=s,r&&r.subTree===n&&(r.vnode.el=s,yi(r,s))}const Ii=Symbol.for("v-fgt"),xi=Symbol.for("v-txt"),Ai=Symbol.for("v-cmt"),Pi=Symbol.for("v-stc"),Oi=[];let Ni=null;function Ri(e=!1){Oi.push(Ni=e?null:[])}function Mi(){Oi.pop(),Ni=Oi[Oi.length-1]||null}let Di=1;function Fi(e,t=!1){Di+=e,e<0&&Ni&&t&&(Ni.hasOnce=!0)}function Li(e){return e.dynamicChildren=Di>0?Ni||n:null,Mi(),Di>0&&Ni&&Ni.push(e),e}function Bi(e,t,n,r,s,i){return Li(Wi(e,t,n,r,s,i,!0))}function zi(e,t,n,r,s){return Li(Hi(e,t,n,r,s,!0))}function Ui(e){return!!e&&!0===e.__v_isVNode}function $i(e,t){return e.type===t.type&&e.key===t.key}const Vi=({key:e})=>null!=e?e:null,ji=({ref:e,ref_key:t,ref_for:n})=>("number"==typeof e&&(e=""+e),null!=e?b(e)||Gt(e)||g(e)?{i:Fn,r:e,k:t,f:!!n}:e:null);function Wi(e,t=null,n=null,r=0,s=null,i=(e===Ii?0:1),a=!1,o=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Vi(t),ref:t&&ji(t),scopeId:Ln,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Fn};return o?(Ji(c,n),128&i&&e.normalize(c)):n&&(c.shapeFlag|=b(n)?8:16),Di>0&&!a&&Ni&&(c.patchFlag>0||6&i)&&32!==c.patchFlag&&Ni.push(c),c}const Hi=function(e,t=null,n=null,r=0,s=null,i=!1){e&&e!==Jr||(e=Ai);if(Ui(e)){const r=Xi(e,t,!0);return n&&Ji(r,n),Di>0&&!i&&Ni&&(6&r.shapeFlag?Ni[Ni.indexOf(e)]=r:Ni.push(r)),r.patchFlag=-2,r}a=e,g(a)&&"__vccOpts"in a&&(e=e.__vccOpts);var a;if(t){t=qi(t);let{class:e,style:n}=t;e&&!b(e)&&(t.class=Z(e)),w(n)&&(jt(n)&&!d(n)&&(n=o({},n)),t.style=G(n))}const c=b(e)?1:wi(e)?128:jn(e)?64:w(e)?4:g(e)?2:0;return Wi(e,t,n,r,s,c,i,!0)};function qi(e){return e?jt(e)||Ds(e)?o({},e):e:null}function Xi(e,t,n=!1,r=!1){const{props:s,ref:i,patchFlag:a,children:o,transition:c}=e,l=t?Zi(s||{},t):s,u={__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&Vi(l),ref:t&&t.ref?n&&i?d(i)?i.concat(ji(t)):[i,ji(t)]:ji(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:o,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Ii?-1===a?16:16|a:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:c,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Xi(e.ssContent),ssFallback:e.ssFallback&&Xi(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return c&&r&&hr(u,c.clone(u)),u}function Gi(e=" ",t=0){return Hi(xi,null,e,t)}function Ki(e="",t=!1){return t?(Ri(),zi(Ai,null,e)):Hi(Ai,null,e)}function Yi(e){return null==e||"boolean"==typeof e?Hi(Ai):d(e)?Hi(Ii,null,e.slice()):Ui(e)?Qi(e):Hi(xi,null,String(e))}function Qi(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:Xi(e)}function Ji(e,t){let n=0;const{shapeFlag:r}=e;if(null==t)t=null;else if(d(t))n=16;else if("object"==typeof t){if(65&r){const n=t.default;return void(n&&(n._c&&(n._d=!1),Ji(e,n()),n._c&&(n._d=!0)))}{n=32;const r=t._;r||Ds(t)?3===r&&Fn&&(1===Fn.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=Fn}}else g(t)?(t={default:t,_ctx:Fn},n=32):(t=String(t),64&r?(n=16,t=[Gi(t)]):n=8);e.children=t,e.shapeFlag|=n}function Zi(...e){const t={};for(let n=0;n<e.length;n++){const r=e[n];for(const e in r)if("class"===e)t.class!==r.class&&(t.class=Z([t.class,r.class]));else if("style"===e)t.style=G([t.style,r.style]);else if(i(e)){const n=t[e],s=r[e];!s||n===s||d(n)&&n.includes(s)||(t[e]=n?[].concat(n,s):s)}else""!==e&&(t[e]=r[e])}return t}function ea(e,t,n,r=null){bn(e,t,7,[n,r])}const ta=Is();let na=0;function ra(e,n,r){const s=e.type,i=(n?n.appContext:e.appContext)||ta,a={uid:na++,vnode:e,type:s,parent:n,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ce(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:n?n.provides:Object.create(i.provides),ids:n?n.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:zs(s,i),emitsOptions:hi(s,i),emit:null,emitted:null,propsDefaults:t,inheritAttrs:s.inheritAttrs,ctx:t,data:t,props:t,attrs:t,slots:t,refs:t,setupState:t,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=n?n.root:a,a.emit=di.bind(null,a),e.ce&&e.ce(a),a}let sa=null;const ia=()=>sa||Fn;let aa,oa;{const e=$(),t=(t,n)=>{let r;return(r=e[t])||(r=e[t]=[]),r.push(n),e=>{r.length>1?r.forEach(t=>t(e)):r[0](e)}};aa=t("__VUE_INSTANCE_SETTERS__",e=>sa=e),oa=t("__VUE_SSR_SETTERS__",e=>ma=e)}const ca=e=>{const t=sa;return aa(e),e.scope.on(),()=>{e.scope.off(),aa(t)}},la=()=>{sa&&sa.scope.off(),aa(null)};function ua(e){return 4&e.vnode.shapeFlag}let da,ha,ma=!1;function pa(e,t=!1,n=!1){t&&oa(t);const{props:r,children:s}=e.vnode,i=ua(e);!function(e,t,n,r=!1){const s={},i=Ms();e.propsDefaults=Object.create(null),Fs(e,t,s,i);for(const a in e.propsOptions[0])a in s||(s[a]=void 0);n?e.props=r?s:Ft(s):e.type.props?e.props=s:e.props=i,e.attrs=i}(e,r,i,t),((e,t,n)=>{const r=e.slots=Ms();if(32&e.vnode.shapeFlag){const e=t.__;e&&L(r,"__",e,!0);const s=t._;s?(qs(r,t,n),n&&L(r,"_",s,!0)):Ws(t,r)}else t&&Hs(e,t)})(e,s,n||t);const a=i?function(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,ds);const{setup:r}=n;if(r){We();const n=e.setupContext=r.length>1?ya(e):null,s=ca(e),i=gn(r,e,0,[e.props,n]),a=k(i);if(He(),s(),!a&&!e.sp||Ir(e)||fr(e),a){if(i.then(la,la),t)return i.then(n=>{fa(e,n,t)}).catch(t=>{yn(t,e,0)});e.asyncDep=i}else fa(e,i,t)}else ga(e,t)}(e,t):void 0;return t&&oa(!1),a}function fa(e,t,n){g(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:w(t)&&(e.setupState=tn(t)),ga(e,n)}function ga(e,t,n){const s=e.type;if(!e.render){if(!t&&da&&!s.render){const t=s.template||ws(e).template;if(t){const{isCustomElement:n,compilerOptions:r}=e.appContext.config,{delimiters:i,compilerOptions:a}=s,c=o(o({isCustomElement:n,delimiters:i},r),a);s.render=da(t,c)}}e.render=s.render||r,ha&&ha(e)}{const t=ca(e);We();try{gs(e)}finally{He(),t()}}}const ba={get:(e,t)=>(tt(e,0,""),e[t])};function ya(e){const t=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,ba),slots:e.slots,emit:e.emit,expose:t}}function wa(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(tn(Ht(e.exposed)),{get:(t,n)=>n in t?t[n]:n in ls?ls[n](e):void 0,has:(e,t)=>t in e||t in ls})):e.proxy}function ka(e,t=!0){return g(e)?e.displayName||e.name:e.name||t&&e.__name}const Ta=(e,t)=>{const n=function(e,t,n=!1){let r,s;return g(e)?r=e:(r=e.get,s=e.set),new cn(r,s,n)}(e,0,ma);return n};function _a(e,t,n){const r=arguments.length;return 2===r?w(t)&&!d(t)?Ui(t)?Hi(e,null,[t]):Hi(e,t):Hi(e,null,t):(r>3?n=Array.prototype.slice.call(arguments,2):3===r&&Ui(n)&&(n=[n]),Hi(e,t,n))}function va(e,t){const n=e.memo;if(n.length!=t.length)return!1;for(let r=0;r<n.length;r++)if(D(n[r],t[r]))return!1;return Di>0&&Ni&&Ni.push(e),!0}const Sa="3.5.17",Ea=r,Ca=fn,Ia=Mn,xa=function e(t,n){var r,s;if(Mn=t,Mn)Mn.enabled=!0,Dn.forEach(({event:e,args:t})=>Mn.emit(e,...t)),Dn=[];else if("undefined"!=typeof window&&window.HTMLElement&&!(null==(s=null==(r=window.navigator)?void 0:r.userAgent)?void 0:s.includes("jsdom"))){(n.__VUE_DEVTOOLS_HOOK_REPLAY__=n.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(t=>{e(t,n)}),setTimeout(()=>{Mn||(n.__VUE_DEVTOOLS_HOOK_REPLAY__=null,Dn=[])},3e3)}else Dn=[]},Aa={createComponentInstance:ra,setupComponent:pa,renderComponentRoot:pi,setCurrentRenderingInstance:Bn,isVNode:Ui,normalizeVNode:Yi,getComponentPublicInstance:wa,ensureValidVNode:as,pushWarningContext:function(e){pn.push(e)},popWarningContext:function(){pn.pop()}};let Pa;const Oa="undefined"!=typeof window&&window.trustedTypes;if(Oa)try{Pa=Oa.createPolicy("vue",{createHTML:e=>e})}catch(JB){}const Na=Pa?e=>Pa.createHTML(e):e=>e,Ra="undefined"!=typeof document?document:null,Ma=Ra&&Ra.createElement("template"),Da={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,r)=>{const s="svg"===t?Ra.createElementNS("http://www.w3.org/2000/svg",e):"mathml"===t?Ra.createElementNS("http://www.w3.org/1998/Math/MathML",e):n?Ra.createElement(e,{is:n}):Ra.createElement(e);return"select"===e&&r&&null!=r.multiple&&s.setAttribute("multiple",r.multiple),s},createText:e=>Ra.createTextNode(e),createComment:e=>Ra.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Ra.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,r,s,i){const a=n?n.previousSibling:t.lastChild;if(s&&(s===i||s.nextSibling))for(;t.insertBefore(s.cloneNode(!0),n),s!==i&&(s=s.nextSibling););else{Ma.innerHTML=Na("svg"===r?`<svg>${e}</svg>`:"mathml"===r?`<math>${e}</math>`:e);const s=Ma.content;if("svg"===r||"mathml"===r){const e=s.firstChild;for(;e.firstChild;)s.appendChild(e.firstChild);s.removeChild(e)}t.insertBefore(s,n)}return[a?a.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}},Fa="transition",La="animation",Ba=Symbol("_vtc"),za={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Ua=o({},sr,za),$a=(e=>(e.displayName="Transition",e.props=Ua,e))((e,{slots:t})=>_a(or,Wa(e),t)),Va=(e,t=[])=>{d(e)?e.forEach(e=>e(...t)):e&&e(...t)},ja=e=>!!e&&(d(e)?e.some(e=>e.length>1):e.length>1);function Wa(e){const t={};for(const o in e)o in za||(t[o]=e[o]);if(!1===e.css)return t;const{name:n="v",type:r,duration:s,enterFromClass:i=`${n}-enter-from`,enterActiveClass:a=`${n}-enter-active`,enterToClass:c=`${n}-enter-to`,appearFromClass:l=i,appearActiveClass:u=a,appearToClass:d=c,leaveFromClass:h=`${n}-leave-from`,leaveActiveClass:m=`${n}-leave-active`,leaveToClass:p=`${n}-leave-to`}=e,f=function(e){if(null==e)return null;if(w(e))return[Ha(e.enter),Ha(e.leave)];{const t=Ha(e);return[t,t]}}(s),g=f&&f[0],b=f&&f[1],{onBeforeEnter:y,onEnter:k,onEnterCancelled:T,onLeave:_,onLeaveCancelled:v,onBeforeAppear:S=y,onAppear:E=k,onAppearCancelled:C=T}=t,I=(e,t,n,r)=>{e._enterCancelled=r,Xa(e,t?d:c),Xa(e,t?u:a),n&&n()},x=(e,t)=>{e._isLeaving=!1,Xa(e,h),Xa(e,p),Xa(e,m),t&&t()},A=e=>(t,n)=>{const s=e?E:k,a=()=>I(t,e,n);Va(s,[t,a]),Ga(()=>{Xa(t,e?l:i),qa(t,e?d:c),ja(s)||Ya(t,r,g,a)})};return o(t,{onBeforeEnter(e){Va(y,[e]),qa(e,i),qa(e,a)},onBeforeAppear(e){Va(S,[e]),qa(e,l),qa(e,u)},onEnter:A(!1),onAppear:A(!0),onLeave(e,t){e._isLeaving=!0;const n=()=>x(e,t);qa(e,h),e._enterCancelled?(qa(e,m),eo()):(eo(),qa(e,m)),Ga(()=>{e._isLeaving&&(Xa(e,h),qa(e,p),ja(_)||Ya(e,r,b,n))}),Va(_,[e,n])},onEnterCancelled(e){I(e,!1,void 0,!0),Va(T,[e])},onAppearCancelled(e){I(e,!0,void 0,!0),Va(C,[e])},onLeaveCancelled(e){x(e),Va(v,[e])}})}function Ha(e){return z(e)}function qa(e,t){t.split(/\s+/).forEach(t=>t&&e.classList.add(t)),(e[Ba]||(e[Ba]=new Set)).add(t)}function Xa(e,t){t.split(/\s+/).forEach(t=>t&&e.classList.remove(t));const n=e[Ba];n&&(n.delete(t),n.size||(e[Ba]=void 0))}function Ga(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Ka=0;function Ya(e,t,n,r){const s=e._endId=++Ka,i=()=>{s===e._endId&&r()};if(null!=n)return setTimeout(i,n);const{type:a,timeout:o,propCount:c}=Qa(e,t);if(!a)return r();const l=a+"end";let u=0;const d=()=>{e.removeEventListener(l,h),i()},h=t=>{t.target===e&&++u>=c&&d()};setTimeout(()=>{u<c&&d()},o+1),e.addEventListener(l,h)}function Qa(e,t){const n=window.getComputedStyle(e),r=e=>(n[e]||"").split(", "),s=r(`${Fa}Delay`),i=r(`${Fa}Duration`),a=Ja(s,i),o=r(`${La}Delay`),c=r(`${La}Duration`),l=Ja(o,c);let u=null,d=0,h=0;t===Fa?a>0&&(u=Fa,d=a,h=i.length):t===La?l>0&&(u=La,d=l,h=c.length):(d=Math.max(a,l),u=d>0?a>l?Fa:La:null,h=u?u===Fa?i.length:c.length:0);return{type:u,timeout:d,propCount:h,hasTransform:u===Fa&&/\b(transform|all)(,|$)/.test(r(`${Fa}Property`).toString())}}function Ja(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((t,n)=>Za(t)+Za(e[n])))}function Za(e){return"auto"===e?0:1e3*Number(e.slice(0,-1).replace(",","."))}function eo(){return document.body.offsetHeight}const to=Symbol("_vod"),no=Symbol("_vsh"),ro={beforeMount(e,{value:t},{transition:n}){e[to]="none"===e.style.display?"":e.style.display,n&&t?n.beforeEnter(e):so(e,t)},mounted(e,{value:t},{transition:n}){n&&t&&n.enter(e)},updated(e,{value:t,oldValue:n},{transition:r}){!t!=!n&&(r?t?(r.beforeEnter(e),so(e,!0),r.enter(e)):r.leave(e,()=>{so(e,!1)}):so(e,t))},beforeUnmount(e,{value:t}){so(e,t)}};function so(e,t){e.style.display=t?e[to]:"none",e[no]=!t}const io=Symbol("");function ao(e,t){if(128&e.shapeFlag){const n=e.suspense;e=n.activeBranch,n.pendingBranch&&!n.isHydrating&&n.effects.push(()=>{ao(n.activeBranch,t)})}for(;e.component;)e=e.component.subTree;if(1&e.shapeFlag&&e.el)oo(e.el,t);else if(e.type===Ii)e.children.forEach(e=>ao(e,t));else if(e.type===Pi){let{el:n,anchor:r}=e;for(;n&&(oo(n,t),n!==r);)n=n.nextSibling}}function oo(e,t){if(1===e.nodeType){const n=e.style;let r="";for(const e in t)n.setProperty(`--${e}`,t[e]),r+=`--${e}: ${t[e]};`;n[io]=r}}const co=/(^|;)\s*display\s*:/;const lo=/\s*!important$/;function uo(e,t,n){if(d(n))n.forEach(n=>uo(e,t,n));else if(null==n&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const r=function(e,t){const n=mo[t];if(n)return n;let r=P(t);if("filter"!==r&&r in e)return mo[t]=r;r=R(r);for(let s=0;s<ho.length;s++){const n=ho[s]+r;if(n in e)return mo[t]=n}return t}(e,t);lo.test(n)?e.setProperty(N(r),n.replace(lo,""),"important"):e[r]=n}}const ho=["Webkit","Moz","ms"],mo={};const po="http://www.w3.org/1999/xlink";function fo(e,t,n,r,s,i=ae(t)){r&&t.startsWith("xlink:")?null==n?e.removeAttributeNS(po,t.slice(6,t.length)):e.setAttributeNS(po,t,n):null==n||i&&!ce(n)?e.removeAttribute(t):e.setAttribute(t,i?"":y(n)?String(n):n)}function go(e,t,n,r,s){if("innerHTML"===t||"textContent"===t)return void(null!=n&&(e[t]="innerHTML"===t?Na(n):n));const i=e.tagName;if("value"===t&&"PROGRESS"!==i&&!i.includes("-")){const r="OPTION"===i?e.getAttribute("value")||"":e.value,s=null==n?"checkbox"===e.type?"on":"":String(n);return r===s&&"_value"in e||(e.value=s),null==n&&e.removeAttribute(t),void(e._value=n)}let a=!1;if(""===n||null==n){const r=typeof e[t];"boolean"===r?n=ce(n):null==n&&"string"===r?(n="",a=!0):"number"===r&&(n=0,a=!0)}try{e[t]=n}catch(JB){}a&&e.removeAttribute(s||t)}function bo(e,t,n,r){e.addEventListener(t,n,r)}const yo=Symbol("_vei");function wo(e,t,n,r,s=null){const i=e[yo]||(e[yo]={}),a=i[t];if(r&&a)a.value=r;else{const[n,o]=function(e){let t;if(ko.test(e)){let n;for(t={};n=e.match(ko);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}const n=":"===e[2]?e.slice(3):N(e.slice(2));return[n,t]}(t);if(r){const a=i[t]=function(e,t){const n=e=>{if(e._vts){if(e._vts<=n.attached)return}else e._vts=Date.now();bn(function(e,t){if(d(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(e=>t=>!t._stopped&&e&&e(t))}return t}(e,n.value),t,5,[e])};return n.value=e,n.attached=vo(),n}(r,s);bo(e,n,a,o)}else a&&(!function(e,t,n,r){e.removeEventListener(t,n,r)}(e,n,a,o),i[t]=void 0)}}const ko=/(?:Once|Passive|Capture)$/;let To=0;const _o=Promise.resolve(),vo=()=>To||(_o.then(()=>To=0),To=Date.now());const So=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123;const Eo={};function Co(e,t,n){const r=pr(e,t);S(r)&&o(r,t);class s extends xo{constructor(e){super(r,e,n)}}return s.def=r,s}const Io="undefined"!=typeof HTMLElement?HTMLElement:class{};class xo extends Io{constructor(e,t={},n=uc){super(),this._def=e,this._props=t,this._createApp=n,this._isVueCE=!0,this._instance=null,this._app=null,this._nonce=this._def.nonce,this._connected=!1,this._resolved=!1,this._numberProps=null,this._styleChildren=new WeakSet,this._ob=null,this.shadowRoot&&n!==uc?this._root=this.shadowRoot:!1!==e.shadowRoot?(this.attachShadow({mode:"open"}),this._root=this.shadowRoot):this._root=this}connectedCallback(){if(!this.isConnected)return;this.shadowRoot||this._resolved||this._parseSlots(),this._connected=!0;let e=this;for(;e=e&&(e.parentNode||e.host);)if(e instanceof xo){this._parent=e;break}this._instance||(this._resolved?this._mount(this._def):e&&e._pendingResolve?this._pendingResolve=e._pendingResolve.then(()=>{this._pendingResolve=void 0,this._resolveDef()}):this._resolveDef())}_setParent(e=this._parent){e&&(this._instance.parent=e._instance,this._inheritParentContext(e))}_inheritParentContext(e=this._parent){e&&this._app&&Object.setPrototypeOf(this._app._context.provides,e._instance.provides)}disconnectedCallback(){this._connected=!1,Cn(()=>{this._connected||(this._ob&&(this._ob.disconnect(),this._ob=null),this._app&&this._app.unmount(),this._instance&&(this._instance.ce=void 0),this._app=this._instance=null)})}_resolveDef(){if(this._pendingResolve)return;for(let n=0;n<this.attributes.length;n++)this._setAttr(this.attributes[n].name);this._ob=new MutationObserver(e=>{for(const t of e)this._setAttr(t.attributeName)}),this._ob.observe(this,{attributes:!0});const e=(e,t=!1)=>{this._resolved=!0,this._pendingResolve=void 0;const{props:n,styles:r}=e;let s;if(n&&!d(n))for(const i in n){const e=n[i];(e===Number||e&&e.type===Number)&&(i in this._props&&(this._props[i]=z(this._props[i])),(s||(s=Object.create(null)))[P(i)]=!0)}this._numberProps=s,this._resolveProps(e),this.shadowRoot&&this._applyStyles(r),this._mount(e)},t=this._def.__asyncLoader;t?this._pendingResolve=t().then(t=>{t.configureApp=this._def.configureApp,e(this._def=t,!0)}):e(this._def)}_mount(e){this._app=this._createApp(e),this._inheritParentContext(),e.configureApp&&e.configureApp(this._app),this._app._ceVNode=this._createVNode(),this._app.mount(this._root);const t=this._instance&&this._instance.exposed;if(t)for(const n in t)u(this,n)||Object.defineProperty(this,n,{get:()=>Zt(t[n])})}_resolveProps(e){const{props:t}=e,n=d(t)?t:Object.keys(t||{});for(const r of Object.keys(this))"_"!==r[0]&&n.includes(r)&&this._setProp(r,this[r]);for(const r of n.map(P))Object.defineProperty(this,r,{get(){return this._getProp(r)},set(e){this._setProp(r,e,!0,!0)}})}_setAttr(e){if(e.startsWith("data-v-"))return;const t=this.hasAttribute(e);let n=t?this.getAttribute(e):Eo;const r=P(e);t&&this._numberProps&&this._numberProps[r]&&(n=z(n)),this._setProp(r,n,!1,!0)}_getProp(e){return this._props[e]}_setProp(e,t,n=!0,r=!1){if(t!==this._props[e]&&(t===Eo?delete this._props[e]:(this._props[e]=t,"key"===e&&this._app&&(this._app._ceVNode.key=t)),r&&this._instance&&this._update(),n)){const n=this._ob;n&&n.disconnect(),!0===t?this.setAttribute(N(e),""):"string"==typeof t||"number"==typeof t?this.setAttribute(N(e),t+""):t||this.removeAttribute(N(e)),n&&n.observe(this,{attributes:!0})}}_update(){const e=this._createVNode();this._app&&(e.appContext=this._app._context),lc(e,this._root)}_createVNode(){const e={};this.shadowRoot||(e.onVnodeMounted=e.onVnodeUpdated=this._renderSlots.bind(this));const t=Hi(this._def,o(e,this._props));return this._instance||(t.ce=e=>{this._instance=e,e.ce=this,e.isCE=!0;const t=(e,t)=>{this.dispatchEvent(new CustomEvent(e,S(t[0])?o({detail:t},t[0]):{detail:t}))};e.emit=(e,...n)=>{t(e,n),N(e)!==e&&t(N(e),n)},this._setParent()}),t}_applyStyles(e,t){if(!e)return;if(t){if(t===this._def||this._styleChildren.has(t))return;this._styleChildren.add(t)}const n=this._nonce;for(let r=e.length-1;r>=0;r--){const t=document.createElement("style");n&&t.setAttribute("nonce",n),t.textContent=e[r],this.shadowRoot.prepend(t)}}_parseSlots(){const e=this._slots={};let t;for(;t=this.firstChild;){const n=1===t.nodeType&&t.getAttribute("slot")||"default";(e[n]||(e[n]=[])).push(t),this.removeChild(t)}}_renderSlots(){const e=(this._teleportTarget||this).querySelectorAll("slot"),t=this._instance.type.__scopeId;for(let n=0;n<e.length;n++){const r=e[n],s=r.getAttribute("name")||"default",i=this._slots[s],a=r.parentNode;if(i)for(const e of i){if(t&&1===e.nodeType){const n=t+"-s",r=document.createTreeWalker(e,1);let s;for(e.setAttribute(n,"");s=r.nextNode();)s.setAttribute(n,"")}a.insertBefore(e,r)}else for(;r.firstChild;)a.insertBefore(r.firstChild,r);a.removeChild(r)}}_injectChildStyle(e){this._applyStyles(e.styles,e)}_removeChildStyle(e){}}function Ao(e){const t=ia(),n=t&&t.ce;return n||null}const Po=new WeakMap,Oo=new WeakMap,No=Symbol("_moveCb"),Ro=Symbol("_enterCb"),Mo=(e=>(delete e.props.mode,e))({name:"TransitionGroup",props:o({},Ua,{tag:String,moveClass:String}),setup(e,{slots:t}){const n=ia(),r=nr();let s,i;return jr(()=>{if(!s.length)return;const t=e.moveClass||`${e.name||"v"}-move`;if(!function(e,t,n){const r=e.cloneNode(),s=e[Ba];s&&s.forEach(e=>{e.split(/\s+/).forEach(e=>e&&r.classList.remove(e))});n.split(/\s+/).forEach(e=>e&&r.classList.add(e)),r.style.display="none";const i=1===t.nodeType?t:t.parentNode;i.appendChild(r);const{hasTransform:a}=Qa(r);return i.removeChild(r),a}(s[0].el,n.vnode.el,t))return void(s=[]);s.forEach(Fo),s.forEach(Lo);const r=s.filter(Bo);eo(),r.forEach(e=>{const n=e.el,r=n.style;qa(n,t),r.transform=r.webkitTransform=r.transitionDuration="";const s=n[No]=e=>{e&&e.target!==n||e&&!/transform$/.test(e.propertyName)||(n.removeEventListener("transitionend",s),n[No]=null,Xa(n,t))};n.addEventListener("transitionend",s)}),s=[]}),()=>{const a=Wt(e),o=Wa(a);let c=a.tag||Ii;if(s=[],i)for(let e=0;e<i.length;e++){const t=i[e];t.el&&t.el instanceof Element&&(s.push(t),hr(t,lr(t,o,r,n)),Po.set(t,t.el.getBoundingClientRect()))}i=t.default?mr(t.default()):[];for(let e=0;e<i.length;e++){const t=i[e];null!=t.key&&hr(t,lr(t,o,r,n))}return Hi(c,null,i)}}}),Do=Mo;function Fo(e){const t=e.el;t[No]&&t[No](),t[Ro]&&t[Ro]()}function Lo(e){Oo.set(e,e.el.getBoundingClientRect())}function Bo(e){const t=Po.get(e),n=Oo.get(e),r=t.left-n.left,s=t.top-n.top;if(r||s){const t=e.el.style;return t.transform=t.webkitTransform=`translate(${r}px,${s}px)`,t.transitionDuration="0s",e}}const zo=e=>{const t=e.props["onUpdate:modelValue"]||!1;return d(t)?e=>F(t,e):t};function Uo(e){e.target.composing=!0}function $o(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Vo=Symbol("_assign"),jo={created(e,{modifiers:{lazy:t,trim:n,number:r}},s){e[Vo]=zo(s);const i=r||s.props&&"number"===s.props.type;bo(e,t?"change":"input",t=>{if(t.target.composing)return;let r=e.value;n&&(r=r.trim()),i&&(r=B(r)),e[Vo](r)}),n&&bo(e,"change",()=>{e.value=e.value.trim()}),t||(bo(e,"compositionstart",Uo),bo(e,"compositionend",$o),bo(e,"change",$o))},mounted(e,{value:t}){e.value=null==t?"":t},beforeUpdate(e,{value:t,oldValue:n,modifiers:{lazy:r,trim:s,number:i}},a){if(e[Vo]=zo(a),e.composing)return;const o=null==t?"":t;if((!i&&"number"!==e.type||/^0\d/.test(e.value)?e.value:B(e.value))!==o){if(document.activeElement===e&&"range"!==e.type){if(r&&t===n)return;if(s&&e.value.trim()===o)return}e.value=o}}},Wo={deep:!0,created(e,t,n){e[Vo]=zo(n),bo(e,"change",()=>{const t=e._modelValue,n=Ko(e),r=e.checked,s=e[Vo];if(d(t)){const e=ye(t,n),i=-1!==e;if(r&&!i)s(t.concat(n));else if(!r&&i){const n=[...t];n.splice(e,1),s(n)}}else if(m(t)){const e=new Set(t);r?e.add(n):e.delete(n),s(e)}else s(Yo(e,r))})},mounted:Ho,beforeUpdate(e,t,n){e[Vo]=zo(n),Ho(e,t,n)}};function Ho(e,{value:t,oldValue:n},r){let s;if(e._modelValue=t,d(t))s=ye(t,r.props.value)>-1;else if(m(t))s=t.has(r.props.value);else{if(t===n)return;s=be(t,Yo(e,!0))}e.checked!==s&&(e.checked=s)}const qo={created(e,{value:t},n){e.checked=be(t,n.props.value),e[Vo]=zo(n),bo(e,"change",()=>{e[Vo](Ko(e))})},beforeUpdate(e,{value:t,oldValue:n},r){e[Vo]=zo(r),t!==n&&(e.checked=be(t,r.props.value))}},Xo={deep:!0,created(e,{value:t,modifiers:{number:n}},r){const s=m(t);bo(e,"change",()=>{const t=Array.prototype.filter.call(e.options,e=>e.selected).map(e=>n?B(Ko(e)):Ko(e));e[Vo](e.multiple?s?new Set(t):t:t[0]),e._assigning=!0,Cn(()=>{e._assigning=!1})}),e[Vo]=zo(r)},mounted(e,{value:t}){Go(e,t)},beforeUpdate(e,t,n){e[Vo]=zo(n)},updated(e,{value:t}){e._assigning||Go(e,t)}};function Go(e,t){const n=e.multiple,r=d(t);if(!n||r||m(t)){for(let s=0,i=e.options.length;s<i;s++){const i=e.options[s],a=Ko(i);if(n)if(r){const e=typeof a;i.selected="string"===e||"number"===e?t.some(e=>String(e)===String(a)):ye(t,a)>-1}else i.selected=t.has(a);else if(be(Ko(i),t))return void(e.selectedIndex!==s&&(e.selectedIndex=s))}n||-1===e.selectedIndex||(e.selectedIndex=-1)}}function Ko(e){return"_value"in e?e._value:e.value}function Yo(e,t){const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t}const Qo={created(e,t,n){Zo(e,t,n,null,"created")},mounted(e,t,n){Zo(e,t,n,null,"mounted")},beforeUpdate(e,t,n,r){Zo(e,t,n,r,"beforeUpdate")},updated(e,t,n,r){Zo(e,t,n,r,"updated")}};function Jo(e,t){switch(e){case"SELECT":return Xo;case"TEXTAREA":return jo;default:switch(t){case"checkbox":return Wo;case"radio":return qo;default:return jo}}}function Zo(e,t,n,r,s){const i=Jo(e.tagName,n.props&&n.props.type)[s];i&&i(e,t,n,r)}const ec=["ctrl","shift","alt","meta"],tc={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>ec.some(n=>e[`${n}Key`]&&!t.includes(n))},nc=(e,t)=>{const n=e._withMods||(e._withMods={}),r=t.join(".");return n[r]||(n[r]=(n,...r)=>{for(let e=0;e<t.length;e++){const r=tc[t[e]];if(r&&r(n,t))return}return e(n,...r)})},rc={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},sc=o({patchProp:(e,t,n,r,s,o)=>{const c="svg"===s;"class"===t?function(e,t,n){const r=e[Ba];r&&(t=(t?[t,...r]:[...r]).join(" ")),null==t?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}(e,r,c):"style"===t?function(e,t,n){const r=e.style,s=b(n);let i=!1;if(n&&!s){if(t)if(b(t))for(const e of t.split(";")){const t=e.slice(0,e.indexOf(":")).trim();null==n[t]&&uo(r,t,"")}else for(const e in t)null==n[e]&&uo(r,e,"");for(const e in n)"display"===e&&(i=!0),uo(r,e,n[e])}else if(s){if(t!==n){const e=r[io];e&&(n+=";"+e),r.cssText=n,i=co.test(n)}}else t&&e.removeAttribute("style");to in e&&(e[to]=i?r.display:"",e[no]&&(r.display="none"))}(e,n,r):i(t)?a(t)||wo(e,t,0,r,o):("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):function(e,t,n,r){if(r)return"innerHTML"===t||"textContent"===t||!!(t in e&&So(t)&&g(n));if("spellcheck"===t||"draggable"===t||"translate"===t||"autocorrect"===t)return!1;if("form"===t)return!1;if("list"===t&&"INPUT"===e.tagName)return!1;if("type"===t&&"TEXTAREA"===e.tagName)return!1;if("width"===t||"height"===t){const t=e.tagName;if("IMG"===t||"VIDEO"===t||"CANVAS"===t||"SOURCE"===t)return!1}if(So(t)&&b(n))return!1;return t in e}(e,t,r,c))?(go(e,t,r),e.tagName.includes("-")||"value"!==t&&"checked"!==t&&"selected"!==t||fo(e,t,r,c,0,"value"!==t)):!e._isVueCE||!/[A-Z]/.test(t)&&b(r)?("true-value"===t?e._trueValue=r:"false-value"===t&&(e._falseValue=r),fo(e,t,r,c)):go(e,P(t),r,0,t)}},Da);let ic,ac=!1;function oc(){return ic||(ic=Gs(sc))}function cc(){return ic=ac?ic:Ks(sc),ac=!0,ic}const lc=(...e)=>{oc().render(...e)},uc=(...e)=>{const t=oc().createApp(...e),{mount:n}=t;return t.mount=e=>{const r=mc(e);if(!r)return;const s=t._component;g(s)||s.render||s.template||(s.template=r.innerHTML),1===r.nodeType&&(r.textContent="");const i=n(r,!1,hc(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),i},t},dc=(...e)=>{const t=cc().createApp(...e),{mount:n}=t;return t.mount=e=>{const t=mc(e);if(t)return n(t,!0,hc(t))},t};function hc(e){return e instanceof SVGElement?"svg":"function"==typeof MathMLElement&&e instanceof MathMLElement?"mathml":void 0}function mc(e){if(b(e)){return document.querySelector(e)}return e}let pc=!1;const fc=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:or,BaseTransitionPropsValidators:sr,Comment:Ai,DeprecationTypes:null,EffectScope:Ce,ErrorCodes:{SETUP_FUNCTION:0,0:"SETUP_FUNCTION",RENDER_FUNCTION:1,1:"RENDER_FUNCTION",NATIVE_EVENT_HANDLER:5,5:"NATIVE_EVENT_HANDLER",COMPONENT_EVENT_HANDLER:6,6:"COMPONENT_EVENT_HANDLER",VNODE_HOOK:7,7:"VNODE_HOOK",DIRECTIVE_HOOK:8,8:"DIRECTIVE_HOOK",TRANSITION_HOOK:9,9:"TRANSITION_HOOK",APP_ERROR_HANDLER:10,10:"APP_ERROR_HANDLER",APP_WARN_HANDLER:11,11:"APP_WARN_HANDLER",FUNCTION_REF:12,12:"FUNCTION_REF",ASYNC_COMPONENT_LOADER:13,13:"ASYNC_COMPONENT_LOADER",SCHEDULER:14,14:"SCHEDULER",COMPONENT_UPDATE:15,15:"COMPONENT_UPDATE",APP_UNMOUNT_CLEANUP:16,16:"APP_UNMOUNT_CLEANUP"},ErrorTypeStrings:Ca,Fragment:Ii,KeepAlive:Pr,ReactiveEffect:Ae,Static:Pi,Suspense:Ti,Teleport:Qn,Text:xi,TrackOpTypes:{GET:"get",HAS:"has",ITERATE:"iterate"},Transition:$a,TransitionGroup:Do,TriggerOpTypes:{SET:"set",ADD:"add",DELETE:"delete",CLEAR:"clear"},VueElement:xo,assertNumber:function(e,t){},callWithAsyncErrorHandling:bn,callWithErrorHandling:gn,camelize:P,capitalize:R,cloneVNode:Xi,compatUtils:null,computed:Ta,createApp:uc,createBlock:zi,createCommentVNode:Ki,createElementBlock:Bi,createElementVNode:Wi,createHydrationRenderer:Ks,createPropsRestProxy:function(e,t){const n={};for(const r in e)t.includes(r)||Object.defineProperty(n,r,{enumerable:!0,get:()=>e[r]});return n},createRenderer:Gs,createSSRApp:dc,createSlots:ss,createStaticVNode:function(e,t){const n=Hi(Pi,null,e);return n.staticCount=t,n},createTextVNode:Gi,createVNode:Hi,customRef:rn,defineAsyncComponent:function(e){g(e)&&(e={loader:e});const{loader:t,loadingComponent:n,errorComponent:r,delay:s=200,hydrate:i,timeout:a,suspensible:o=!0,onError:c}=e;let l,u=null,d=0;const h=()=>{let e;return u||(e=u=t().catch(e=>{if(e=e instanceof Error?e:new Error(String(e)),c)return new Promise((t,n)=>{c(e,()=>t((d++,u=null,h())),()=>n(e),d+1)});throw e}).then(t=>e!==u&&u?u:(t&&(t.__esModule||"Module"===t[Symbol.toStringTag])&&(t=t.default),l=t,t)))};return pr({name:"AsyncComponentWrapper",__asyncLoader:h,__asyncHydrate(e,t,n){const r=i?()=>{const r=i(()=>{n()},t=>function(e,t){if(kr(e)&&"["===e.data){let n=1,r=e.nextSibling;for(;r;){if(1===r.nodeType){if(!1===t(r))break}else if(kr(r))if("]"===r.data){if(0===--n)break}else"["===r.data&&n++;r=r.nextSibling}}else t(e)}(e,t));r&&(t.bum||(t.bum=[])).push(r),(t.u||(t.u=[])).push(()=>!0)}:n;l?r():h().then(()=>!t.isUnmounted&&r())},get __asyncResolved(){return l},setup(){const e=sa;if(fr(e),l)return()=>xr(l,e);const t=t=>{u=null,yn(t,e,13,!r)};if(o&&e.suspense||ma)return h().then(t=>()=>xr(t,e)).catch(e=>(t(e),()=>r?Hi(r,{error:e}):null));const i=Kt(!1),c=Kt(),d=Kt(!!s);return s&&setTimeout(()=>{d.value=!1},s),null!=a&&setTimeout(()=>{if(!i.value&&!c.value){const e=new Error(`Async component timed out after ${a}ms.`);t(e),c.value=e}},a),h().then(()=>{i.value=!0,e.parent&&Ar(e.parent.vnode)&&e.parent.update()}).catch(e=>{t(e),c.value=e}),()=>i.value&&l?xr(l,e):c.value&&r?Hi(r,{error:c.value}):n&&!d.value?Hi(n):void 0}})},defineComponent:pr,defineCustomElement:Co,defineEmits:function(){return null},defineExpose:function(e){},defineModel:function(){},defineOptions:function(e){},defineProps:function(){return null},defineSSRCustomElement:(e,t)=>Co(e,t,dc),defineSlots:function(){return null},devtools:Ia,effect:function(e,t){e.effect instanceof Ae&&(e=e.effect.fn);const n=new Ae(e);t&&o(n,t);try{n.run()}catch(s){throw n.stop(),s}const r=n.run.bind(n);return r.effect=n,r},effectScope:function(e){return new Ce(e)},getCurrentInstance:ia,getCurrentScope:Ie,getCurrentWatcher:function(){return dn},getTransitionRawChildren:mr,guardReactiveProps:qi,h:_a,handleError:yn,hasInjectionContext:function(){return!!(sa||Fn||Ps)},hydrate:(...e)=>{cc().hydrate(...e)},hydrateOnIdle:(e=1e4)=>t=>{const n=Er(t,{timeout:e});return()=>Cr(n)},hydrateOnInteraction:(e=[])=>(t,n)=>{b(e)&&(e=[e]);let r=!1;const s=e=>{r||(r=!0,i(),t(),e.target.dispatchEvent(new e.constructor(e.type,e)))},i=()=>{n(t=>{for(const n of e)t.removeEventListener(n,s)})};return n(t=>{for(const n of e)t.addEventListener(n,s,{once:!0})}),i},hydrateOnMediaQuery:e=>t=>{if(e){const n=matchMedia(e);if(!n.matches)return n.addEventListener("change",t,{once:!0}),()=>n.removeEventListener("change",t);t()}},hydrateOnVisible:e=>(t,n)=>{const r=new IntersectionObserver(e=>{for(const n of e)if(n.isIntersecting){r.disconnect(),t();break}},e);return n(e=>{if(e instanceof Element)return function(e){const{top:t,left:n,bottom:r,right:s}=e.getBoundingClientRect(),{innerHeight:i,innerWidth:a}=window;return(t>0&&t<i||r>0&&r<i)&&(n>0&&n<a||s>0&&s<a)}(e)?(t(),r.disconnect(),!1):void r.observe(e)}),()=>r.disconnect()},initCustomFormatter:function(){},initDirectivesForSSR:()=>{pc||(pc=!0,jo.getSSRProps=({value:e})=>({value:e}),qo.getSSRProps=({value:e},t)=>{if(t.props&&be(t.props.value,e))return{checked:!0}},Wo.getSSRProps=({value:e},t)=>{if(d(e)){if(t.props&&ye(e,t.props.value)>-1)return{checked:!0}}else if(m(e)){if(t.props&&e.has(t.props.value))return{checked:!0}}else if(e)return{checked:!0}},Qo.getSSRProps=(e,t)=>{if("string"!=typeof t.type)return;const n=Jo(t.type.toUpperCase(),t.props&&t.props.type);return n.getSSRProps?n.getSSRProps(e,t):void 0},ro.getSSRProps=({value:e})=>{if(!e)return{style:{display:"none"}}})},inject:Ns,isMemoSame:va,isProxy:jt,isReactive:Ut,isReadonly:$t,isRef:Gt,isRuntimeOnly:()=>!da,isShallow:Vt,isVNode:Ui,markRaw:Ht,mergeDefaults:function(e,t){const n=ps(e);for(const r in t){if(r.startsWith("__skip"))continue;let e=n[r];e?d(e)||g(e)?e=n[r]={type:e,default:t[r]}:e.default=t[r]:null===e&&(e=n[r]={default:t[r]}),e&&t[`__skip_${r}`]&&(e.skipFactory=!0)}return n},mergeModels:function(e,t){return e&&t?d(e)&&d(t)?e.concat(t):o({},ps(e),ps(t)):e||t},mergeProps:Zi,nextTick:Cn,normalizeClass:Z,normalizeProps:ee,normalizeStyle:G,onActivated:Nr,onBeforeMount:Ur,onBeforeUnmount:Wr,onBeforeUpdate:Vr,onDeactivated:Rr,onErrorCaptured:Kr,onMounted:$r,onRenderTracked:Gr,onRenderTriggered:Xr,onScopeDispose:function(e,t=!1){Se&&Se.cleanups.push(e)},onServerPrefetch:qr,onUnmounted:Hr,onUpdated:jr,onWatcherCleanup:hn,openBlock:Ri,popScopeId:function(){Ln=null},provide:Os,proxyRefs:tn,pushScopeId:function(e){Ln=e},queuePostFlushCb:An,reactive:Dt,readonly:Lt,ref:Kt,registerRuntimeCompiler:function(e){da=e,ha=e=>{e.render._rc&&(e.withProxy=new Proxy(e.ctx,hs))}},render:lc,renderList:rs,renderSlot:is,resolveComponent:Qr,resolveDirective:es,resolveDynamicComponent:Zr,resolveFilter:null,resolveTransitionHooks:lr,setBlockTracking:Fi,setDevtoolsHook:xa,setTransitionHooks:hr,shallowReactive:Ft,shallowReadonly:Bt,shallowRef:Yt,ssrContextKey:ri,ssrUtils:Aa,stop:function(e){e.effect.stop()},toDisplayString:ke,toHandlerKey:M,toHandlers:os,toRaw:Wt,toRef:function(e,t,n){return Gt(e)?e:g(e)?new an(e):w(e)&&arguments.length>1?on(e,t,n):Kt(e)},toRefs:function(e){const t=d(e)?new Array(e.length):{};for(const n in e)t[n]=on(e,n);return t},toValue:function(e){return g(e)?e():Zt(e)},transformVNodeArgs:function(e){},triggerRef:function(e){e.dep&&e.dep.trigger()},unref:Zt,useAttrs:function(){return ms().attrs},useCssModule:function(e="$style"){{const n=ia();if(!n)return t;const r=n.type.__cssModules;if(!r)return t;const s=r[e];return s||t}},useCssVars:function(e){const t=ia();if(!t)return;const n=t.ut=(n=e(t.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${t.uid}"]`)).forEach(e=>oo(e,n))},s=()=>{const r=e(t.proxy);t.ce?oo(t.ce,r):ao(t.subTree,r),n(r)};Vr(()=>{An(s)}),$r(()=>{ai(s,r,{flush:"post"});const e=new MutationObserver(s);e.observe(t.subTree.el.parentNode,{childList:!0}),Hr(()=>e.disconnect())})},useHost:Ao,useId:function(){const e=ia();return e?(e.appContext.config.idPrefix||"v")+"-"+e.ids[0]+e.ids[1]++:""},useModel:function(e,n,r=t){const s=ia(),i=P(n),a=N(n),o=ui(e,i),c=rn((o,c)=>{let l,u,d=t;return ii(()=>{const t=e[i];D(l,t)&&(l=t,c())}),{get:()=>(o(),r.get?r.get(l):l),set(e){const o=r.set?r.set(e):e;if(!(D(o,l)||d!==t&&D(e,d)))return;const h=s.vnode.props;h&&(n in h||i in h||a in h)&&(`onUpdate:${n}`in h||`onUpdate:${i}`in h||`onUpdate:${a}`in h)||(l=e,c()),s.emit(`update:${n}`,o),D(e,o)&&D(e,d)&&!D(o,u)&&c(),d=e,u=o}}});return c[Symbol.iterator]=()=>{let e=0;return{next:()=>e<2?{value:e++?o||t:c,done:!1}:{done:!0}}},c},useSSRContext:si,useShadowRoot:function(){const e=Ao();return e&&e.shadowRoot},useSlots:function(){return ms().slots},useTemplateRef:function(e){const n=ia(),r=Yt(null);if(n){const s=n.refs===t?n.refs={}:n.refs;Object.defineProperty(s,e,{enumerable:!0,get:()=>r.value,set:e=>r.value=e})}return r},useTransitionState:nr,vModelCheckbox:Wo,vModelDynamic:Qo,vModelRadio:qo,vModelSelect:Xo,vModelText:jo,vShow:ro,version:Sa,warn:Ea,watch:ai,watchEffect:function(e,t){return oi(e,null,t)},watchPostEffect:function(e,t){return oi(e,null,{flush:"post"})},watchSyncEffect:ii,withAsyncContext:function(e){const t=ia();let n=e();return la(),k(n)&&(n=n.catch(e=>{throw ca(t),e})),[n,()=>ca(t)]},withCtx:zn,withDefaults:function(e,t){return null},withDirectives:Un,withKeys:(e,t)=>{const n=e._withKeys||(e._withKeys={}),r=t.join(".");return n[r]||(n[r]=n=>{if(!("key"in n))return;const r=N(n.key);return t.some(e=>e===r||rc[e]===r)?e(n):void 0})},withMemo:function(e,t,n,r){const s=n[r];if(s&&va(s,e))return s;const i=t();return i.memo=e.slice(),i.cacheIndex=r,n[r]=i},withModifiers:nc,withScopeId:e=>zn},Symbol.toStringTag,{value:"Module"}));function gc(){var e=["call","apply","26UVrdOf","YhoGk","qKJpO","default","getOwnPropertyDescriptor","pRFQu","get","function","xMDdk","CFxEB","length","pKFip","hasOwnProperty","MBojj","CGLjR","NKTTE","lSdum","prototype","9009ahkUFk","236976MrrBlu","49790EQzbQG","3842OcwCPh","1323396MtItUE","undefined","forEach","795868AKcdhs","constructor","keys","defineProperty","1250641fBHzSS","qSEdv","AdFsd","__esModule","MXfEL","5froiyz","261DRFNaO","QLIud"];return(gc=function(){return e})()}var bc=yc;function yc(e,t){var n=gc();return(yc=function(e,t){return n[e-=483]})(e,t)}function wc(e){var t=bc,n={lSdum:t(484)};return e&&e[t(513)]&&Object[t(498)][t(493)][t(518)](e,n[t(497)])?e[n[t(497)]]:e}function kc(e){var t=bc,n={qKJpO:function(e,t){return e instanceof t},YhoGk:function(e,t){return e!==t},CFxEB:"qliLJ",xMDdk:t(495),QLIud:function(e,t){return e!==t},qSEdv:"ArcYz",pKFip:"default",MBojj:t(513),xcUhS:function(e,t){return e==t},MXfEL:t(488)};if(Object[t(498)][t(493)][t(518)](e,n[t(494)]))return e;var r=e[t(484)];if(n.xcUhS(typeof r,n[t(514)])){var s=function e(){var s=t,i=!1;try{i=n[s(483)](this,e)}catch{}if(i){if(n[s(521)](n[s(490)],n[s(489)]))return Reflect.construct(r,arguments,this[s(507)]);var a=_0x2aab03[s(485)](_0x29b10c,_0x1d338e);_0x1b09c8[s(509)](_0x5d5070,_0x10429f,a[s(487)]?a:{enumerable:!0,get:function(){return _0x3d2c24[_0x4ade4c]}})}return r[s(519)](this,arguments)};s[t(498)]=r[t(498)]}else s={};return Object[t(509)](s,"__esModule",{value:!0}),Object[t(508)](e)[t(505)](function(r){var i=t,a={AdFsd:n[i(492)]},o=Object[i(485)](e,r);Object[i(509)](s,r,o[i(487)]?o:{enumerable:!0,get:function(){var t=i;return n[t(517)]("ArcYz",n[t(511)])?_0x18bd82&&_0x55eea7.prototype[t(493)].call(_0xf3ec76,a.AdFsd)?_0xeccdc5[a[t(512)]]:_0x41e2b5:e[r]}})}),s}!function(){for(var e=yc,t=gc();;)try{if(321326===parseInt(e(502))/1*(-parseInt(e(520))/2)+-parseInt(e(499))/3+parseInt(e(506))/4*(-parseInt(e(515))/5)+parseInt(e(503))/6+parseInt(e(510))/7+parseInt(e(500))/8+-parseInt(e(516))/9*(-parseInt(e(501))/10))break;t.push(t.shift())}catch(n){t.push(t.shift())}}(),typeof globalThis!==bc(504)?globalThis:typeof window!==bc(504)?window:typeof global!==bc(504)?global:typeof self===bc(504)||self;var Tc,_c={},vc={};var Sc,Ec,Cc={},Ic={};function xc(){return Sc||(Sc=1,Object.defineProperty(Ic,"__esModule",{value:!0}),Ic.default=(e,t,n)=>({confidence:n,name:t.name(e),lang:t.language?t.language():void 0})),Ic}var Ac,Pc={};var Oc,Nc={};var Rc,Mc={};var Dc,Fc={};function Lc(){if(Dc)return Fc;Dc=1;var e=Fc&&Fc.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Fc,"__esModule",{value:!0}),Fc.KOI8_R=Fc.windows_1256=Fc.windows_1251=Fc.ISO_8859_9=Fc.ISO_8859_8=Fc.ISO_8859_7=Fc.ISO_8859_6=Fc.ISO_8859_5=Fc.ISO_8859_2=Fc.ISO_8859_1=void 0;const t=e(xc());class n{constructor(e,t){this.byteIndex=0,this.ngram=0,this.ngramCount=0,this.hitCount=0,this.spaceChar=32,this.ngramList=e,this.byteMap=t}search(e,t){let n=0;return e[n+32]<=t&&(n+=32),e[n+16]<=t&&(n+=16),e[n+8]<=t&&(n+=8),e[n+4]<=t&&(n+=4),e[n+2]<=t&&(n+=2),e[n+1]<=t&&(n+=1),e[n]>t&&(n-=1),n<0||e[n]!=t?-1:n}lookup(e){this.ngramCount+=1,this.search(this.ngramList,e)>=0&&(this.hitCount+=1)}addByte(e){this.ngram=(this.ngram<<8)+(255&e)&16777215,this.lookup(this.ngram)}nextByte(e){return this.byteIndex>=e.inputLen?-1:255&e.inputBytes[this.byteIndex++]}parse(e,t){let n,r=!1;for(this.spaceChar=t;(n=this.nextByte(e))>=0;){const e=this.byteMap[n];0!=e&&(e==this.spaceChar&&r||this.addByte(e),r=e==this.spaceChar)}this.addByte(this.spaceChar);const s=this.hitCount/this.ngramCount;return s>.33?98:Math.floor(300*s)}}class r{constructor(e,t){this.fLang=e,this.fNGrams=t}}let s=class{constructor(){this.spaceChar=32,this.nGramLang=void 0}ngrams(){return[]}byteMap(){return[]}name(e){return"sbcs"}language(){return this.nGramLang}match(e){this.nGramLang=void 0;const r=this.ngrams();if(s=r,Array.isArray(s)&&isFinite(s[0])){const s=new n(r,this.byteMap()).parse(e,this.spaceChar);return s<=0?null:(0,t.default)(e,this,s)}var s;let i=-1;for(let t=r.length-1;t>=0;t--){const s=r[t],a=new n(s.fNGrams,this.byteMap()).parse(e,this.spaceChar);a>i&&(i=a,this.nGramLang=s.fLang)}return i<=0?null:(0,t.default)(e,this,i)}};Fc.ISO_8859_1=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,170,32,32,32,32,32,32,32,32,32,32,181,32,32,32,32,186,32,32,32,32,32,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,32,248,249,250,251,252,253,254,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,32,248,249,250,251,252,253,254,255]}ngrams(){return[new r("da",[2122086,2122100,2122853,2123118,2123122,2123375,2123873,2124064,2125157,2125671,2126053,2126697,2126708,2126953,2127465,6383136,6385184,6385252,6386208,6386720,6579488,6579566,6579570,6579572,6627443,6644768,6644837,6647328,6647396,6648352,6648421,6648608,6648864,6713202,6776096,6776174,6776178,6907749,6908960,6909543,7038240,7039845,7103858,7104871,7105637,7169380,7234661,7234848,7235360,7235429,7300896,7302432,7303712,7398688,7479396,7479397,7479411,7496992,7566437,7610483,7628064,7628146,7629164,7759218]),new r("de",[2122094,2122101,2122341,2122849,2122853,2122857,2123113,2123621,2123873,2124142,2125161,2126691,2126693,2127214,2127461,2127471,2127717,2128501,6448498,6514720,6514789,6514804,6578547,6579566,6579570,6580581,6627428,6627443,6646126,6646132,6647328,6648352,6648608,6776174,6841710,6845472,6906728,6907168,6909472,6909541,6911008,7104867,7105637,7217249,7217252,7217267,7234592,7234661,7234848,7235360,7235429,7238757,7479396,7496805,7497065,7562088,7566437,7610468,7628064,7628142,7628146,7695972,7695975,7759218]),new r("en",[2122016,2122094,2122341,2122607,2123375,2123873,2123877,2124142,2125153,2125670,2125938,2126437,2126689,2126708,2126952,2126959,2127720,6383972,6384672,6385184,6385252,6386464,6386720,6386789,6386793,6561889,6561908,6627425,6627443,6627444,6644768,6647412,6648352,6648608,6713202,6840692,6841632,6841714,6906912,6909472,6909543,6909806,6910752,7217249,7217268,7234592,7235360,7238688,7300640,7302688,7303712,7496992,7500576,7544929,7544948,7561577,7566368,7610484,7628146,7628897,7628901,7629167,7630624,7631648]),new r("es",[2122016,2122593,2122607,2122853,2123116,2123118,2123123,2124142,2124897,2124911,2125921,2125935,2125938,2126197,2126437,2126693,2127214,2128160,6365283,6365284,6365285,6365292,6365296,6382441,6382703,6384672,6386208,6386464,6515187,6516590,6579488,6579564,6582048,6627428,6627429,6627436,6646816,6647328,6647412,6648608,6648692,6907246,6943598,7102752,7106419,7217253,7238757,7282788,7282789,7302688,7303712,7303968,7364978,7435621,7495968,7497075,7544932,7544933,7544944,7562528,7628064,7630624,7693600,15953440]),new r("fr",[2122101,2122607,2122849,2122853,2122869,2123118,2123124,2124897,2124901,2125921,2125935,2125938,2126197,2126693,2126703,2127214,2154528,6385268,6386793,6513952,6516590,6579488,6579571,6583584,6627425,6627427,6627428,6627429,6627436,6627440,6627443,6647328,6647412,6648352,6648608,6648864,6649202,6909806,6910752,6911008,7102752,7103776,7103859,7169390,7217252,7234848,7238432,7238688,7302688,7302772,7304562,7435621,7479404,7496992,7544929,7544932,7544933,7544940,7544944,7610468,7628064,7629167,7693600,7696928]),new r("it",[2122092,2122600,2122607,2122853,2122857,2123040,2124140,2124142,2124897,2125925,2125938,2127214,6365283,6365284,6365296,6365299,6386799,6514789,6516590,6579564,6580512,6627425,6627427,6627428,6627433,6627436,6627440,6627443,6646816,6646892,6647412,6648352,6841632,6889569,6889571,6889572,6889587,6906144,6908960,6909472,6909806,7102752,7103776,7104800,7105633,7234848,7235872,7237408,7238757,7282785,7282788,7282793,7282803,7302688,7302757,7366002,7495968,7496992,7563552,7627040,7628064,7629088,7630624,8022383]),new r("nl",[2122092,2122341,2122849,2122853,2122857,2123109,2123118,2123621,2123877,2124142,2125153,2125157,2125680,2126949,2127457,2127461,2127471,2127717,2128489,6381934,6381938,6385184,6385252,6386208,6386720,6514804,6579488,6579566,6579570,6627426,6627446,6645102,6645106,6647328,6648352,6648435,6648864,6776174,6841716,6907168,6909472,6909543,6910752,7217250,7217252,7217253,7217256,7217263,7217270,7234661,7235360,7302756,7303026,7303200,7303712,7562088,7566437,7610468,7628064,7628142,7628146,7758190,7759218,7761775]),new r("no",[2122100,2122102,2122853,2123118,2123122,2123375,2123873,2124064,2125157,2125671,2126053,2126693,2126699,2126703,2126708,2126953,2127465,2155808,6385252,6386208,6386720,6579488,6579566,6579572,6627443,6644768,6647328,6647397,6648352,6648421,6648864,6648948,6713202,6776174,6908779,6908960,6909543,7038240,7039845,7103776,7105637,7169380,7169390,7217267,7234848,7235360,7235429,7237221,7300896,7302432,7303712,7398688,7479411,7496992,7565165,7566437,7610483,7628064,7628142,7628146,7629164,7631904,7631973,7759218]),new r("pt",[2122016,2122607,2122849,2122853,2122863,2123040,2123123,2125153,2125423,2125600,2125921,2125935,2125938,2126197,2126437,2126693,2127213,6365281,6365283,6365284,6365296,6382693,6382703,6384672,6386208,6386273,6386464,6516589,6516590,6578464,6579488,6582048,6582131,6627425,6627428,6647072,6647412,6648608,6648692,6906144,6906721,7169390,7238757,7238767,7282785,7282787,7282788,7282789,7282800,7303968,7364978,7435621,7495968,7497075,7544929,7544932,7544933,7544944,7566433,7628064,7630624,7693600,14905120,15197039]),new r("sv",[2122100,2122102,2122853,2123118,2123510,2123873,2124064,2124142,2124655,2125157,2125667,2126053,2126699,2126703,2126708,2126953,2127457,2127465,2155634,6382693,6385184,6385252,6386208,6386804,6514720,6579488,6579566,6579570,6579572,6644768,6647328,6648352,6648864,6747762,6776174,6909036,6909543,7037216,7105568,7169380,7217267,7233824,7234661,7235360,7235429,7235950,7299944,7302432,7302688,7398688,7479393,7479411,7495968,7564129,7565165,7610483,7627040,7628064,7628146,7629164,7631904,7758194,14971424,16151072])]}name(e){return e&&e.c1Bytes?"windows-1252":"ISO-8859-1"}};Fc.ISO_8859_2=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,177,32,179,32,181,182,32,32,185,186,187,188,32,190,191,32,177,32,179,32,181,182,183,32,185,186,187,188,32,190,191,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,32,248,249,250,251,252,253,254,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,32,248,249,250,251,252,253,254,32]}ngrams(){return[new r("cs",[2122016,2122361,2122863,2124389,2125409,2125413,2125600,2125668,2125935,2125938,2126072,2126447,2126693,2126703,2126708,2126959,2127392,2127481,2128481,6365296,6513952,6514720,6627440,6627443,6627446,6647072,6647533,6844192,6844260,6910836,6972704,7042149,7103776,7104800,7233824,7268640,7269408,7269664,7282800,7300206,7301737,7304052,7304480,7304801,7368548,7368554,7369327,7403621,7562528,7565173,7566433,7566441,7566446,7628146,7630573,7630624,7676016,12477728,14773997,15296623,15540336,15540339,15559968,16278884]),new r("hu",[2122016,2122106,2122341,2123111,2123116,2123365,2123873,2123887,2124147,2124645,2124649,2124790,2124901,2125153,2125157,2125161,2125413,2126714,2126949,2156915,6365281,6365291,6365293,6365299,6384416,6385184,6388256,6447470,6448494,6645625,6646560,6646816,6646885,6647072,6647328,6648421,6648864,6648933,6648948,6781216,6844263,6909556,6910752,7020641,7075450,7169383,7170414,7217249,7233899,7234923,7234925,7238688,7300985,7544929,7567973,7567988,7568097,7596391,7610465,7631904,7659891,8021362,14773792,15299360]),new r("pl",[2122618,2122863,2124064,2124389,2124655,2125153,2125161,2125409,2125417,2125668,2125935,2125938,2126697,2127648,2127721,2127737,2128416,2128481,6365296,6365303,6385257,6514720,6519397,6519417,6582048,6584937,6627440,6627443,6627447,6627450,6645615,6646304,6647072,6647401,6778656,6906144,6907168,6907242,7037216,7039264,7039333,7170405,7233824,7235937,7235941,7282800,7305057,7305065,7368556,7369313,7369327,7369338,7502437,7502457,7563754,7564137,7566433,7825765,7955304,7957792,8021280,8022373,8026400,15955744]),new r("ro",[2122016,2122083,2122593,2122597,2122607,2122613,2122853,2122857,2124897,2125153,2125925,2125938,2126693,2126819,2127214,2144873,2158190,6365283,6365284,6386277,6386720,6386789,6386976,6513010,6516590,6518048,6546208,6579488,6627425,6627427,6627428,6627440,6627443,6644e3,6646048,6646885,6647412,6648692,6889569,6889571,6889572,6889584,6907168,6908192,6909472,7102752,7103776,7106418,7107945,7234848,7238770,7303712,7365998,7496992,7497057,7501088,7594784,7628064,7631477,7660320,7694624,7695392,12216608,15625760])]}name(e){return e&&e.c1Bytes?"windows-1250":"ISO-8859-2"}};Fc.ISO_8859_5=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,241,242,243,244,245,246,247,248,249,250,251,252,32,254,255,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,32,241,242,243,244,245,246,247,248,249,250,251,252,32,254,255]}ngrams(){return[2150944,2151134,2151646,2152400,2152480,2153168,2153182,2153936,2153941,2154193,2154462,2154464,2154704,2154974,2154978,2155230,2156514,2158050,13688280,13689580,13884960,14015468,14015960,14016994,14017056,14164191,14210336,14211104,14216992,14407133,14407712,14413021,14536736,14538016,14538965,14538991,14540320,14540498,14557394,14557407,14557409,14602784,14602960,14603230,14604576,14605292,14605344,14606818,14671579,14672085,14672088,14672094,14733522,14734804,14803664,14803666,14803672,14806816,14865883,14868e3,14868192,14871584,15196894,15459616]}name(){return"ISO-8859-5"}language(){return"ru"}};Fc.ISO_8859_6=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,32,32,32,32,32,224,225,226,227,228,229,230,231,232,233,234,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32]}ngrams(){return[2148324,2148326,2148551,2152932,2154986,2155748,2156006,2156743,13050055,13091104,13093408,13095200,13100064,13100227,13100231,13100232,13100234,13100236,13100237,13100239,13100243,13100249,13100258,13100261,13100264,13100266,13100320,13100576,13100746,13115591,13181127,13181153,13181156,13181157,13181160,13246663,13574343,13617440,13705415,13748512,13836487,14229703,14279913,14805536,14950599,14993696,15001888,15002144,15016135,15058720,15059232,15066656,15081671,15147207,15189792,15255524,15263264,15278279,15343815,15343845,15343848,15386912,15388960,15394336]}name(){return"ISO-8859-6"}language(){return"ar"}};Fc.ISO_8859_7=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,161,162,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,220,32,221,222,223,32,252,32,253,254,192,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,32,243,244,245,246,247,248,249,250,251,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,32]}ngrams(){return[2154989,2154992,2155497,2155753,2156016,2156320,2157281,2157797,2158049,2158368,2158817,2158831,2158833,2159604,2159605,2159847,2159855,14672160,14754017,14754036,14805280,14806304,14807292,14807584,14936545,15067424,15069728,15147252,15199520,15200800,15278324,15327520,15330014,15331872,15393257,15393268,15525152,15540449,15540453,15540464,15589664,15725088,15725856,15790069,15790575,15793184,15868129,15868133,15868138,15868144,15868148,15983904,15984416,15987951,16048416,16048617,16050157,16050162,16050666,16052e3,16052213,16054765,16379168,16706848]}name(e){return e&&e.c1Bytes?"windows-1253":"ISO-8859-7"}language(){return"el"}};Fc.ISO_8859_8=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,181,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,32,32,32,32,32]}ngrams(){return[new r("he",[2154725,2154727,2154729,2154746,2154985,2154990,2155744,2155749,2155753,2155758,2155762,2155769,2155770,2157792,2157796,2158304,2159340,2161132,14744096,14950624,14950625,14950628,14950636,14950638,14950649,15001056,15065120,15068448,15068960,15071264,15071776,15278308,15328288,15328762,15329773,15330592,15331104,15333408,15333920,15474912,15474916,15523872,15524896,15540448,15540449,15540452,15540460,15540462,15540473,15655968,15671524,15787040,15788320,15788525,15920160,16261348,16312813,16378912,16392416,16392417,16392420,16392428,16392430,16392441]),new r("he",[2154725,2154732,2155753,2155756,2155758,2155760,2157040,2157810,2157817,2158053,2158057,2158565,2158569,2160869,2160873,2161376,2161381,2161385,14688484,14688492,14688493,14688506,14738464,14738916,14740512,14741024,14754020,14754029,14754042,14950628,14950633,14950636,14950637,14950639,14950648,14950650,15002656,15065120,15066144,15196192,15327264,15327520,15328288,15474916,15474925,15474938,15528480,15530272,15591913,15591920,15591928,15605988,15605997,15606010,15655200,15655968,15918112,16326884,16326893,16326906,16376864,16441376,16442400,16442857])]}name(e){return e&&e.c1Bytes?"windows-1255":"ISO-8859-8"}language(){return"he"}};Fc.ISO_8859_9=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,170,32,32,32,32,32,32,32,32,32,32,181,32,32,32,32,186,32,32,32,32,32,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,32,248,249,250,251,252,105,254,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,32,248,249,250,251,252,253,254,255]}ngrams(){return[2122337,2122345,2122357,2122849,2122853,2123621,2123873,2124140,2124641,2124655,2125153,2125676,2126689,2126945,2127461,2128225,6365282,6384416,6384737,6384993,6385184,6385405,6386208,6386273,6386429,6386685,6388065,6449522,6578464,6579488,6580512,6627426,6627435,6644841,6647328,6648352,6648425,6648681,6909029,6909472,6909545,6910496,7102830,7102834,7103776,7103858,7217249,7217250,7217259,7234657,7234661,7234848,7235872,7235950,7273760,7498094,7535982,7759136,7954720,7958386,16608800,16608868,16609021,16642301]}name(e){return e&&e.c1Bytes?"windows-1254":"ISO-8859-9"}language(){return"tr"}};Fc.windows_1251=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,144,131,32,131,32,32,32,32,32,32,154,32,156,157,158,159,144,32,32,32,32,32,32,32,32,32,154,32,156,157,158,159,32,162,162,188,32,180,32,32,184,32,186,32,32,32,32,191,32,32,179,179,180,181,32,32,184,32,186,32,188,190,190,191,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]}ngrams(){return[2155040,2155246,2155758,2156512,2156576,2157280,2157294,2158048,2158053,2158305,2158574,2158576,2158816,2159086,2159090,2159342,2160626,2162162,14740968,14742268,14937632,15068156,15068648,15069682,15069728,15212783,15263008,15263776,15269664,15459821,15460384,15465709,15589408,15590688,15591653,15591679,15592992,15593186,15605986,15605999,15606001,15655456,15655648,15655918,15657248,15657980,15658016,15659506,15724267,15724773,15724776,15724782,15786210,15787492,15856352,15856354,15856360,15859488,15918571,15920672,15920880,15924256,16249582,16512288]}name(){return"windows-1251"}language(){return"ru"}};Fc.windows_1256=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,129,32,131,32,32,32,32,136,32,138,32,156,141,142,143,144,32,32,32,32,32,32,32,152,32,154,32,156,32,32,159,32,32,32,32,32,32,32,32,32,32,170,32,32,32,32,32,32,32,32,32,32,181,32,32,32,32,32,32,32,32,32,32,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,32,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,32,32,32,32,244,32,32,32,32,249,32,251,252,32,32,255]}ngrams(){return[2148321,2148324,2148551,2153185,2153965,2154977,2155492,2156231,13050055,13091104,13093408,13095200,13099296,13099459,13099463,13099464,13099466,13099468,13099469,13099471,13099475,13099482,13099486,13099491,13099494,13099501,13099808,13100064,13100234,13115591,13181127,13181149,13181153,13181155,13181158,13246663,13574343,13617440,13705415,13748512,13836487,14295239,14344684,14544160,14753991,14797088,14806048,14806304,14885063,14927648,14928160,14935072,14950599,15016135,15058720,15124449,15131680,15474887,15540423,15540451,15540454,15583520,15585568,15590432]}name(){return"windows-1256"}language(){return"ar"}};return Fc.KOI8_R=class extends s{byteMap(){return[32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,0,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,163,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,163,32,32,32,32,32,32,32,32,32,32,32,32,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223]}ngrams(){return[2147535,2148640,2149313,2149327,2150081,2150085,2150338,2150607,2150610,2151105,2151375,2151380,2151631,2152224,2152399,2153153,2153684,2154196,12701385,12702936,12963032,12963529,12964820,12964896,13094688,13181136,13223200,13224224,13226272,13419982,13420832,13424846,13549856,13550880,13552069,13552081,13553440,13553623,13574352,13574355,13574359,13617103,13617696,13618392,13618464,13620180,13621024,13621185,13684684,13685445,13685449,13685455,13812183,13813188,13881632,13882561,13882569,13882583,13944268,13946656,13946834,13948960,14272544,14603471]}name(){return"KOI8-R"}language(){return"ru"}},Fc}var Bc,zc={};var Uc,$c,Vc={};var jc=($c||($c=1,function(e){var t=_c&&_c.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=_c&&_c.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=_c&&_c.__importStar||function(){var e=function(t){return(e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(t)};return function(r){if(r&&r.__esModule)return r;var s={};if(null!=r)for(var i=e(r),a=0;a<i.length;a++)"default"!==i[a]&&t(s,r,i[a]);return n(s,r),s}}(),s=_c&&_c.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.detectFileSync=e.detectFile=e.analyse=e.detect=void 0;const i=s((Tc||(Tc=1,Object.defineProperty(vc,"__esModule",{value:!0}),vc.default=()=>{throw new Error("File system is not available")}),vc)),a=s(function(){if(Ec)return Cc;Ec=1;var e=Cc&&Cc.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Cc,"__esModule",{value:!0});const t=e(xc());return Cc.default=class{name(){return"ASCII"}match(e){const n=e.rawInput;for(let r=0;r<e.rawLen;r++){const s=n[r];if(s<32||s>126)return(0,t.default)(e,this,0)}return(0,t.default)(e,this,100)}},Cc}()),o=s(function(){if(Ac)return Pc;Ac=1;var e=Pc&&Pc.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Pc,"__esModule",{value:!0});const t=e(xc());return Pc.default=class{name(){return"UTF-8"}match(e){let n,r=!1,s=0,i=0,a=0;const o=e.rawInput;e.rawLen>=3&&239==(255&o[0])&&187==(255&o[1])&&191==(255&o[2])&&(r=!0);for(let t=0;t<e.rawLen;t++){const n=o[t];if(128&n){if(192==(224&n))a=1;else if(224==(240&n))a=2;else if(240==(248&n))a=3;else{if(i++,i>5)break;a=0}for(;t++,!(t>=e.rawLen);){if(128!=(192&o[t])){i++;break}if(0==--a){s++;break}}}}if(n=0,r&&0==i)n=100;else if(r&&s>10*i)n=80;else if(s>3&&0==i)n=100;else if(s>0&&0==i)n=80;else if(0==s&&0==i)n=10;else{if(!(s>10*i))return null;n=25}return(0,t.default)(e,this,n)}},Pc}()),c=r(function(){if(Oc)return Nc;Oc=1;var e=Nc&&Nc.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Nc,"__esModule",{value:!0}),Nc.UTF_32LE=Nc.UTF_32BE=Nc.UTF_16LE=Nc.UTF_16BE=void 0;const t=e(xc());Nc.UTF_16BE=class{name(){return"UTF-16BE"}match(e){const n=e.rawInput;return n.length>=2&&254==(255&n[0])&&!(255&~n[1])?(0,t.default)(e,this,100):null}},Nc.UTF_16LE=class{name(){return"UTF-16LE"}match(e){const n=e.rawInput;return n.length>=2&&!(255&~n[0])&&254==(255&n[1])?n.length>=4&&0==n[2]&&0==n[3]?null:(0,t.default)(e,this,100):null}};class n{name(){return"UTF-32"}getChar(e,t){return-1}match(e){let n=0,r=0,s=!1,i=0;const a=e.rawLen/4*4,o=e.rawInput;if(0==a)return null;65279==this.getChar(o,0)&&(s=!0);for(let t=0;t<a;t+=4){const e=this.getChar(o,t);e<0||e>=1114111||e>=55296&&e<=57343?r+=1:n+=1}return s&&0==r?i=100:s&&n>10*r?i=80:n>3&&0==r?i=100:n>0&&0==r?i=80:n>10*r&&(i=25),0==i?null:(0,t.default)(e,this,i)}}return Nc.UTF_32BE=class extends n{name(){return"UTF-32BE"}getChar(e,t){return(255&e[t+0])<<24|(255&e[t+1])<<16|(255&e[t+2])<<8|255&e[t+3]}},Nc.UTF_32LE=class extends n{name(){return"UTF-32LE"}getChar(e,t){return(255&e[t+3])<<24|(255&e[t+2])<<16|(255&e[t+1])<<8|255&e[t+0]}},Nc}()),l=r(function(){if(Rc)return Mc;Rc=1;var e=Mc&&Mc.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Mc,"__esModule",{value:!0}),Mc.gb_18030=Mc.euc_kr=Mc.euc_jp=Mc.big5=Mc.sjis=void 0;const t=e(xc());function n(e,t){const n=(e,t,r,s)=>{if(s<r)return-1;const i=Math.floor(r+s>>>1);return t>e[i]?n(e,t,i+1,s):t<e[i]?n(e,t,r,i-1):i};return n(e,t,0,e.length-1)}class r{constructor(){this.charValue=0,this.index=0,this.nextIndex=0,this.error=!1,this.done=!1}reset(){this.charValue=0,this.index=-1,this.nextIndex=0,this.error=!1,this.done=!1}nextByte(e){return this.nextIndex>=e.rawLen?(this.done=!0,-1):255&e.rawInput[this.nextIndex++]}}let s=class{constructor(){this.commonChars=[]}name(){return"mbcs"}match(e){let s=0,i=0,a=0,o=0,c=0;const l=new r;e:{for(l.reset();this.nextChar(l,e);){if(o++,l.error)a++;else{const e=4294967295&l.charValue;e>255&&(s++,null!=this.commonChars&&n(this.commonChars,e)>=0&&i++)}if(a>=2&&5*a>=s)break e}if(s<=10&&0==a)c=0==s&&o<10?0:10;else if(s<20*a)c=0;else if(null==this.commonChars)c=30+s-20*a,c>100&&(c=100);else{const e=90/Math.log(s/4);c=Math.floor(Math.log(i+1)*e+10),c=Math.min(c,100)}}return 0==c?null:(0,t.default)(e,this,c)}nextChar(e,t){return!0}};function i(e,t){e.index=e.nextIndex,e.error=!1;let n=0,r=0,s=0;return n=e.charValue=e.nextByte(t),n<0?e.done=!0:n<=141||(r=e.nextByte(t),e.charValue=e.charValue<<8|r,n>=161&&n<=254?r<161&&(e.error=!0):142!=n?143==n&&(s=e.nextByte(t),e.charValue=e.charValue<<8|s,s<161&&(e.error=!0)):r<161&&(e.error=!0)),0==e.done}return Mc.sjis=class extends s{constructor(){super(...arguments),this.commonChars=[33088,33089,33090,33093,33115,33129,33130,33141,33142,33440,33442,33444,33449,33450,33451,33453,33455,33457,33459,33461,33463,33469,33470,33473,33476,33477,33478,33480,33481,33484,33485,33500,33504,33511,33512,33513,33514,33520,33521,33601,33603,33614,33615,33624,33630,33634,33639,33653,33654,33673,33674,33675,33677,33683,36502,37882,38314]}name(){return"Shift_JIS"}language(){return"ja"}nextChar(e,t){e.index=e.nextIndex,e.error=!1;const n=e.charValue=e.nextByte(t);if(n<0)return!1;if(n<=127||n>160&&n<=223)return!0;const r=e.nextByte(t);return!(r<0||(e.charValue=n<<8|r,r>=64&&r<=127||r>=128&&r<=255||(e.error=!0),0))}},Mc.big5=class extends s{constructor(){super(...arguments),this.commonChars=[41280,41281,41282,41283,41287,41289,41333,41334,42048,42054,42055,42056,42065,42068,42071,42084,42090,42092,42103,42147,42148,42151,42177,42190,42193,42207,42216,42237,42304,42312,42328,42345,42445,42471,42583,42593,42594,42600,42608,42664,42675,42681,42707,42715,42726,42738,42816,42833,42841,42970,43171,43173,43181,43217,43219,43236,43260,43456,43474,43507,43627,43706,43710,43724,43772,44103,44111,44208,44242,44377,44745,45024,45290,45423,45747,45764,45935,46156,46158,46412,46501,46525,46544,46552,46705,47085,47207,47428,47832,47940,48033,48593,49860,50105,50240,50271]}name(){return"Big5"}language(){return"zh"}nextChar(e,t){e.index=e.nextIndex,e.error=!1;const n=e.charValue=e.nextByte(t);if(n<0)return!1;if(n<=127||255==n)return!0;const r=e.nextByte(t);return!(r<0||(e.charValue=e.charValue<<8|r,(r<64||127==r||255==r)&&(e.error=!0),0))}},Mc.euc_jp=class extends s{constructor(){super(...arguments),this.commonChars=[41377,41378,41379,41382,41404,41418,41419,41430,41431,42146,42148,42150,42152,42154,42155,42156,42157,42159,42161,42163,42165,42167,42169,42171,42173,42175,42176,42177,42179,42180,42182,42183,42184,42185,42186,42187,42190,42191,42192,42206,42207,42209,42210,42212,42216,42217,42218,42219,42220,42223,42226,42227,42402,42403,42404,42406,42407,42410,42413,42415,42416,42419,42421,42423,42424,42425,42431,42435,42438,42439,42440,42441,42443,42448,42453,42454,42455,42462,42464,42465,42469,42473,42474,42475,42476,42477,42483,47273,47572,47854,48072,48880,49079,50410,50940,51133,51896,51955,52188,52689],this.nextChar=i}name(){return"EUC-JP"}language(){return"ja"}},Mc.euc_kr=class extends s{constructor(){super(...arguments),this.commonChars=[45217,45235,45253,45261,45268,45286,45293,45304,45306,45308,45496,45497,45511,45527,45538,45994,46011,46274,46287,46297,46315,46501,46517,46527,46535,46569,46835,47023,47042,47054,47270,47278,47286,47288,47291,47337,47531,47534,47564,47566,47613,47800,47822,47824,47857,48103,48115,48125,48301,48314,48338,48374,48570,48576,48579,48581,48838,48840,48863,48878,48888,48890,49057,49065,49088,49124,49131,49132,49144,49319,49327,49336,49338,49339,49341,49351,49356,49358,49359,49366,49370,49381,49403,49404,49572,49574,49590,49622,49631,49654,49656,50337,50637,50862,51151,51153,51154,51160,51173,51373],this.nextChar=i}name(){return"EUC-KR"}language(){return"ko"}},Mc.gb_18030=class extends s{constructor(){super(...arguments),this.commonChars=[41377,41378,41379,41380,41392,41393,41457,41459,41889,41900,41914,45480,45496,45502,45755,46025,46070,46323,46525,46532,46563,46767,46804,46816,47010,47016,47037,47062,47069,47284,47327,47350,47531,47561,47576,47610,47613,47821,48039,48086,48097,48122,48316,48347,48382,48588,48845,48861,49076,49094,49097,49332,49389,49611,49883,50119,50396,50410,50636,50935,51192,51371,51403,51413,51431,51663,51706,51889,51893,51911,51920,51926,51957,51965,52460,52728,52906,52932,52946,52965,53173,53186,53206,53442,53445,53456,53460,53671,53930,53938,53941,53947,53972,54211,54224,54269,54466,54490,54754,54992]}name(){return"GB18030"}language(){return"zh"}nextChar(e,t){e.index=e.nextIndex,e.error=!1;let n=0,r=0,s=0,i=0;e:if(n=e.charValue=e.nextByte(t),n<0)e.done=!0;else if(!(n<=128)&&(r=e.nextByte(t),e.charValue=e.charValue<<8|r,n>=129&&n<=254)){if(r>=64&&r<=126||r>=80&&r<=254)break e;if(r>=48&&r<=57&&(s=e.nextByte(t),s>=129&&s<=254&&(i=e.nextByte(t),i>=48&&i<=57))){e.charValue=e.charValue<<16|s<<8|i;break e}e.error=!0}return 0==e.done}},Mc}()),u=r(Lc()),d=r(function(){if(Bc)return zc;Bc=1;var e=zc&&zc.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(zc,"__esModule",{value:!0}),zc.ISO_2022_CN=zc.ISO_2022_KR=zc.ISO_2022_JP=void 0;const t=e(xc());class n{constructor(){this.escapeSequences=[]}name(){return"ISO_2022"}match(e){let n,r,s,i,a=0,o=0,c=0;const l=e.inputBytes,u=e.inputLen;e:for(n=0;n<u;n++){if(27==l[n]){t:for(s=0;s<this.escapeSequences.length;s++){const e=this.escapeSequences[s];if(!(u-n<e.length)){for(r=1;r<e.length;r++)if(e[r]!=l[n+r])continue t;a++,n+=e.length-1;continue e}}o++}14!=l[n]&&15!=l[n]||c++}return 0==a?null:(i=(100*a-100*o)/(a+o),a+c<5&&(i-=10*(5-(a+c))),i<=0?null:(0,t.default)(e,this,i))}}return zc.ISO_2022_JP=class extends n{constructor(){super(...arguments),this.escapeSequences=[[27,36,40,67],[27,36,40,68],[27,36,64],[27,36,65],[27,36,66],[27,38,64],[27,40,66],[27,40,72],[27,40,73],[27,40,74],[27,46,65],[27,46,70]]}name(){return"ISO-2022-JP"}language(){return"ja"}},zc.ISO_2022_KR=class extends n{constructor(){super(...arguments),this.escapeSequences=[[27,36,41,67]]}name(){return"ISO-2022-KR"}language(){return"kr"}},zc.ISO_2022_CN=class extends n{constructor(){super(...arguments),this.escapeSequences=[[27,36,41,65],[27,36,41,71],[27,36,42,72],[27,36,41,69],[27,36,43,73],[27,36,43,74],[27,36,43,75],[27,36,43,76],[27,36,43,77],[27,78],[27,79]]}name(){return"ISO-2022-CN"}language(){return"zh"}},zc}()),h=(Uc||(Uc=1,Object.defineProperty(Vc,"__esModule",{value:!0}),Vc.isByteArray=void 0,Vc.isByteArray=e=>null!=e&&"object"==typeof e&&isFinite(e.length)&&e.length>=0),Vc),m=[new o.default,new c.UTF_16BE,new c.UTF_16LE,new c.UTF_32BE,new c.UTF_32LE,new l.sjis,new l.big5,new l.euc_jp,new l.euc_kr,new l.gb_18030,new d.ISO_2022_JP,new d.ISO_2022_KR,new d.ISO_2022_CN,new u.ISO_8859_1,new u.ISO_8859_2,new u.ISO_8859_5,new u.ISO_8859_6,new u.ISO_8859_7,new u.ISO_8859_8,new u.ISO_8859_9,new u.windows_1251,new u.windows_1256,new u.KOI8_R,new a.default];e.detect=t=>{const n=(0,e.analyse)(t);return n.length>0?n[0].name:null},e.analyse=e=>{if(!(0,h.isByteArray)(e))throw new Error("Input must be a byte array, e.g. Buffer or Uint8Array");const t=[];for(let s=0;s<256;s++)t[s]=0;for(let s=e.length-1;s>=0;s--)t[255&e[s]]++;let n=!1;for(let s=128;s<=159;s+=1)if(0!==t[s]){n=!0;break}const r={byteStats:t,c1Bytes:n,rawInput:e,rawLen:e.length,inputBytes:e,inputLen:e.length};return m.map(e=>e.match(r)).filter(e=>!!e).sort((e,t)=>t.confidence-e.confidence)},e.detectFile=(t,n={})=>new Promise((r,s)=>{let a;const o=(0,i.default)(),c=(t,n)=>{a&&o.closeSync(a),t?s(t):r((0,e.detect)(n))};if(n&&n.sampleSize){a=o.openSync(t,"r");const e=Buffer.allocUnsafe(n.sampleSize);return void o.read(a,e,0,n.sampleSize,n.offset,t=>{c(t,e)})}o.readFile(t,c)}),e.detectFileSync=(t,n={})=>{const r=(0,i.default)();if(n&&n.sampleSize){const s=r.openSync(t,"r"),i=Buffer.allocUnsafe(n.sampleSize);return r.readSync(s,i,0,n.sampleSize,n.offset),r.closeSync(s),(0,e.detect)(i)}return(0,e.detect)(r.readFileSync(t))},e.default={analyse:e.analyse,detect:e.detect,detectFileSync:e.detectFileSync,detectFile:e.detectFile}}(_c)),_c);const Wc=wc(jc);class Hc extends Error{constructor(){super("End-Of-Stream"),this.name="EndOfStreamError"}}let qc=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}};class Xc{constructor(){this.endOfStream=!1,this.interrupted=!1,this.peekQueue=[]}async peek(e,t=!1){const n=await this.read(e,t);return this.peekQueue.push(e.subarray(0,n)),n}async read(e,t=!1){if(0===e.length)return 0;let n=this.readFromPeekBuffer(e);if(this.endOfStream||(n+=await this.readRemainderFromStream(e.subarray(n),t)),0===n&&!t)throw new Hc;return n}readFromPeekBuffer(e){let t=e.length,n=0;for(;this.peekQueue.length>0&&t>0;){const r=this.peekQueue.pop();if(!r)throw new Error("peekData should be defined");const s=Math.min(r.length,t);e.set(r.subarray(0,s),n),n+=s,t-=s,s<r.length&&this.peekQueue.push(r.subarray(s))}return n}async readRemainderFromStream(e,t){let n=0;for(;n<e.length&&!this.endOfStream;){if(this.interrupted)throw new qc;const r=await this.readFromStream(e.subarray(n),t);if(0===r)break;n+=r}if(!t&&n<e.length)throw new Hc;return n}}class Gc extends Xc{constructor(e){super(),this.reader=e}async abort(){return this.close()}async close(){this.reader.releaseLock()}}class Kc extends Gc{async readFromStream(e,t){if(0===e.length)return 0;const n=await this.reader.read(new Uint8Array(e.length),{min:t?void 0:e.length});return n.done&&(this.endOfStream=n.done),n.value?(e.set(n.value),n.value.length):0}}class Yc extends Xc{constructor(e){super(),this.reader=e,this.buffer=null}writeChunk(e,t){const n=Math.min(t.length,e.length);return e.set(t.subarray(0,n)),n<t.length?this.buffer=t.subarray(n):this.buffer=null,n}async readFromStream(e,t){if(0===e.length)return 0;let n=0;for(this.buffer&&(n+=this.writeChunk(e,this.buffer));n<e.length&&!this.endOfStream;){const t=await this.reader.read();if(t.done){this.endOfStream=!0;break}t.value&&(n+=this.writeChunk(e.subarray(n),t.value))}if(!t&&0===n&&this.endOfStream)throw new Hc;return n}abort(){return this.interrupted=!0,this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}class Qc{constructor(e){this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=e?.onClose,e?.abortSignal&&e.abortSignal.addEventListener("abort",()=>{this.abort()})}async readToken(e,t=this.position){const n=new Uint8Array(e.len);if(await this.readBuffer(n,{position:t})<e.len)throw new Hc;return e.get(n,0)}async peekToken(e,t=this.position){const n=new Uint8Array(e.len);if(await this.peekBuffer(n,{position:t})<e.len)throw new Hc;return e.get(n,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new Hc;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new Hc;return e.get(this.numBuffer,0)}async ignore(e){if(void 0!==this.fileInfo.size){const t=this.fileInfo.size-this.position;if(e>t)return this.position+=t,t}return this.position+=e,e}async close(){await this.abort(),await(this.onClose?.())}normalizeOptions(e,t){if(!this.supportsRandomAccess()&&t&&void 0!==t.position&&t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return{mayBeLess:!1,offset:0,length:e.length,position:this.position,...t}}abort(){return Promise.resolve()}}class Jc extends Qc{constructor(e,t){super(t),this.streamReader=e,this.fileInfo=t?.fileInfo??{}}async readBuffer(e,t){const n=this.normalizeOptions(e,t),r=n.position-this.position;if(r>0)return await this.ignore(r),this.readBuffer(e,t);if(r<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(0===n.length)return 0;const s=await this.streamReader.read(e.subarray(0,n.length),n.mayBeLess);if(this.position+=s,(!t||!t.mayBeLess)&&s<n.length)throw new Hc;return s}async peekBuffer(e,t){const n=this.normalizeOptions(e,t);let r=0;if(n.position){const t=n.position-this.position;if(t>0){const s=new Uint8Array(n.length+t);return r=await this.peekBuffer(s,{mayBeLess:n.mayBeLess}),e.set(s.subarray(t)),r-t}if(t<0)throw new Error("Cannot peek from a negative offset in a stream")}if(n.length>0){try{r=await this.streamReader.peek(e.subarray(0,n.length),n.mayBeLess)}catch(s){if(t?.mayBeLess&&s instanceof Hc)return 0;throw s}if(!n.mayBeLess&&r<n.length)throw new Hc}return r}async ignore(e){const t=Math.min(256e3,e),n=new Uint8Array(t);let r=0;for(;r<e;){const s=e-r,i=await this.readBuffer(n,{length:Math.min(t,s)});if(i<0)return i;r+=i}return r}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return!1}}class Zc extends Qc{constructor(e,t){super(t),this.uint8Array=e,this.fileInfo={...t?.fileInfo??{},size:e.length}}async readBuffer(e,t){t?.position&&(this.position=t.position);const n=await this.peekBuffer(e,t);return this.position+=n,n}async peekBuffer(e,t){const n=this.normalizeOptions(e,t),r=Math.min(this.uint8Array.length-n.position,n.length);if(!n.mayBeLess&&r<n.length)throw new Hc;return e.set(this.uint8Array.subarray(n.position,n.position+r)),r}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(e){this.position=e}}function el(e,t){const n=function(e){try{const t=e.getReader({mode:"byob"});return t instanceof ReadableStreamDefaultReader?new Yc(t):new Kc(t)}catch(t){if(t instanceof TypeError)return new Yc(e.getReader());throw t}}(e),r=t??{},s=r.onClose;return r.onClose=async()=>{if(await n.close(),s)return s()},new Jc(n,r)}function tl(e,t){return new Zc(e,t)}var nl,rl={};var sl=(nl||(nl=1,rl.read=function(e,t,n,r,s){var i,a,o=8*s-r-1,c=(1<<o)-1,l=c>>1,u=-7,d=n?s-1:0,h=n?-1:1,m=e[t+d];for(d+=h,i=m&(1<<-u)-1,m>>=-u,u+=o;u>0;i=256*i+e[t+d],d+=h,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=r;u>0;a=256*a+e[t+d],d+=h,u-=8);if(0===i)i=1-l;else{if(i===c)return a?NaN:1/0*(m?-1:1);a+=Math.pow(2,r),i-=l}return(m?-1:1)*a*Math.pow(2,i-r)},rl.write=function(e,t,n,r,s,i){var a,o,c,l=8*i-s-1,u=(1<<l)-1,d=u>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:i-1,p=r?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=u?(o=0,a=u):a+d>=1?(o=(t*c-1)*Math.pow(2,s),a+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,s),a=0));s>=8;e[n+m]=255&o,m+=p,o/=256,s-=8);for(a=a<<s|o,l+=s;l>0;e[n+m]=255&a,m+=p,a/=256,l-=8);e[n+m-p]|=128*f}),rl);function il(e){return new DataView(e.buffer,e.byteOffset)}const al={len:1,get:(e,t)=>il(e).getUint8(t),put:(e,t,n)=>(il(e).setUint8(t,n),t+1)},ol={len:2,get:(e,t)=>il(e).getUint16(t,!0),put:(e,t,n)=>(il(e).setUint16(t,n,!0),t+2)},cl={len:2,get:(e,t)=>il(e).getUint16(t),put:(e,t,n)=>(il(e).setUint16(t,n),t+2)},ll={len:3,get(e,t){const n=il(e);return n.getUint8(t)+(n.getUint16(t+1,!0)<<8)},put(e,t,n){const r=il(e);return r.setUint8(t,255&n),r.setUint16(t+1,n>>8,!0),t+3}},ul={len:3,get(e,t){const n=il(e);return(n.getUint16(t)<<8)+n.getUint8(t+2)},put(e,t,n){const r=il(e);return r.setUint16(t,n>>8),r.setUint8(t+2,255&n),t+3}},dl={len:4,get:(e,t)=>il(e).getUint32(t,!0),put:(e,t,n)=>(il(e).setUint32(t,n,!0),t+4)},hl={len:4,get:(e,t)=>il(e).getUint32(t),put:(e,t,n)=>(il(e).setUint32(t,n),t+4)},ml={len:1,get:(e,t)=>il(e).getInt8(t),put:(e,t,n)=>(il(e).setInt8(t,n),t+1)},pl={len:2,get:(e,t)=>il(e).getInt16(t),put:(e,t,n)=>(il(e).setInt16(t,n),t+2)},fl={len:2,get:(e,t)=>il(e).getInt16(t,!0),put:(e,t,n)=>(il(e).setInt16(t,n,!0),t+2)},gl={len:3,get(e,t){const n=ll.get(e,t);return n>8388607?n-16777216:n},put(e,t,n){const r=il(e);return r.setUint8(t,255&n),r.setUint16(t+1,n>>8,!0),t+3}},bl={len:3,get(e,t){const n=ul.get(e,t);return n>8388607?n-16777216:n},put(e,t,n){const r=il(e);return r.setUint16(t,n>>8),r.setUint8(t+2,255&n),t+3}},yl={len:4,get:(e,t)=>il(e).getInt32(t),put:(e,t,n)=>(il(e).setInt32(t,n),t+4)},wl={len:4,get:(e,t)=>il(e).getInt32(t,!0),put:(e,t,n)=>(il(e).setInt32(t,n,!0),t+4)},kl={len:8,get:(e,t)=>il(e).getBigUint64(t,!0),put:(e,t,n)=>(il(e).setBigUint64(t,n,!0),t+8)},Tl={len:8,get:(e,t)=>il(e).getBigInt64(t,!0),put:(e,t,n)=>(il(e).setBigInt64(t,n,!0),t+8)},_l={len:8,get:(e,t)=>il(e).getBigUint64(t),put:(e,t,n)=>(il(e).setBigUint64(t,n),t+8)},vl={len:8,get:(e,t)=>il(e).getBigInt64(t),put:(e,t,n)=>(il(e).setBigInt64(t,n),t+8)},Sl={len:2,get(e,t){return sl.read(e,t,!1,10,this.len)},put(e,t,n){return sl.write(e,n,t,!1,10,this.len),t+this.len}},El={len:2,get(e,t){return sl.read(e,t,!0,10,this.len)},put(e,t,n){return sl.write(e,n,t,!0,10,this.len),t+this.len}},Cl={len:4,get:(e,t)=>il(e).getFloat32(t),put:(e,t,n)=>(il(e).setFloat32(t,n),t+4)},Il={len:4,get:(e,t)=>il(e).getFloat32(t,!0),put:(e,t,n)=>(il(e).setFloat32(t,n,!0),t+4)},xl={len:8,get:(e,t)=>il(e).getFloat64(t),put:(e,t,n)=>(il(e).setFloat64(t,n),t+8)},Al={len:8,get:(e,t)=>il(e).getFloat64(t,!0),put:(e,t,n)=>(il(e).setFloat64(t,n,!0),t+8)},Pl={len:10,get(e,t){return sl.read(e,t,!1,63,this.len)},put(e,t,n){return sl.write(e,n,t,!1,63,this.len),t+this.len}},Ol={len:10,get(e,t){return sl.read(e,t,!0,63,this.len)},put(e,t,n){return sl.write(e,n,t,!0,63,this.len),t+this.len}};class Nl{constructor(e){this.len=e}get(e,t){return e.subarray(t,t+this.len)}}class Rl{constructor(e,t){if(this.len=e,t&&"windows-1252"===t.toLowerCase())this.decoder=Rl.decodeWindows1252;else{const e=new TextDecoder(t);this.decoder=t=>e.decode(t)}}get(e,t=0){const n=e.subarray(t,t+this.len);return this.decoder(n)}static decodeWindows1252(e){let t="";for(let n=0;n<e.length;n++){const r=e[n];t+=r<128||r>=160?String.fromCharCode(r):Rl.win1252Map[r-128]}return t}}Rl.win1252Map="€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ";const Ml=Object.freeze(Object.defineProperty({__proto__:null,AnsiStringType:class extends Rl{constructor(e){super(e,"windows-1252")}},Float16_BE:Sl,Float16_LE:El,Float32_BE:Cl,Float32_LE:Il,Float64_BE:xl,Float64_LE:Al,Float80_BE:Pl,Float80_LE:Ol,INT16_BE:pl,INT16_LE:fl,INT24_BE:bl,INT24_LE:gl,INT32_BE:yl,INT32_LE:wl,INT64_BE:vl,INT64_LE:Tl,INT8:ml,IgnoreType:class{constructor(e){this.len=e}get(e,t){}},StringType:Rl,UINT16_BE:cl,UINT16_LE:ol,UINT24_BE:ul,UINT24_LE:ll,UINT32_BE:hl,UINT32_LE:dl,UINT64_BE:_l,UINT64_LE:kl,UINT8:al,Uint8ArrayType:Nl},Symbol.toStringTag,{value:"Module"}));var Dl=Uint8Array,Fl=Uint16Array,Ll=Int32Array,Bl=new Dl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zl=new Dl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ul=new Dl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$l=function(e,t){for(var n=new Fl(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var s=new Ll(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)s[i]=i-n[r]<<5|r;return{b:n,r:s}},Vl=$l(Bl,2),jl=Vl.b,Wl=Vl.r;jl[28]=258,Wl[258]=28;for(var Hl=$l(zl,0).b,ql=new Fl(32768),Xl=0;Xl<32768;++Xl){var Gl=(43690&Xl)>>1|(21845&Xl)<<1;Gl=(61680&(Gl=(52428&Gl)>>2|(13107&Gl)<<2))>>4|(3855&Gl)<<4,ql[Xl]=((65280&Gl)>>8|(255&Gl)<<8)>>1}var Kl=function(e,t,n){for(var r=e.length,s=0,i=new Fl(t);s<r;++s)e[s]&&++i[e[s]-1];var a,o=new Fl(t);for(s=1;s<t;++s)o[s]=o[s-1]+i[s-1]<<1;if(n){a=new Fl(1<<t);var c=15-t;for(s=0;s<r;++s)if(e[s])for(var l=s<<4|e[s],u=t-e[s],d=o[e[s]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)a[ql[d]>>c]=l}else for(a=new Fl(r),s=0;s<r;++s)e[s]&&(a[s]=ql[o[e[s]-1]++]>>15-e[s]);return a},Yl=new Dl(288);for(Xl=0;Xl<144;++Xl)Yl[Xl]=8;for(Xl=144;Xl<256;++Xl)Yl[Xl]=9;for(Xl=256;Xl<280;++Xl)Yl[Xl]=7;for(Xl=280;Xl<288;++Xl)Yl[Xl]=8;var Ql=new Dl(32);for(Xl=0;Xl<32;++Xl)Ql[Xl]=5;var Jl=Kl(Yl,9,1),Zl=Kl(Ql,5,1),eu=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},tu=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},nu=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},ru=function(e){return(e+7)/8|0},su=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],iu=function(e,t,n){var r=new Error(t||su[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,iu),!n)throw r;return r},au=function(e,t,n,r){var s=e.length;if(!s||t.f&&!t.l)return n||new Dl(0);var i=!n,a=i||2!=t.i,o=t.i;i&&(n=new Dl(3*s));var c=function(e){var t=n.length;if(e>t){var r=new Dl(Math.max(2*t,e));r.set(n),n=r}},l=t.f||0,u=t.p||0,d=t.b||0,h=t.l,m=t.d,p=t.m,f=t.n,g=8*s;do{if(!h){l=tu(e,u,1);var b=tu(e,u+1,3);if(u+=3,!b){var y=e[(A=ru(u)+4)-4]|e[A-3]<<8,w=A+y;if(w>s){o&&iu(0);break}a&&c(d+y),n.set(e.subarray(A,w),d),t.b=d+=y,t.p=u=8*w,t.f=l;continue}if(1==b)h=Jl,m=Zl,p=9,f=5;else if(2==b){var k=tu(e,u,31)+257,T=tu(e,u+10,15)+4,_=k+tu(e,u+5,31)+1;u+=14;for(var v=new Dl(_),S=new Dl(19),E=0;E<T;++E)S[Ul[E]]=tu(e,u+3*E,7);u+=3*T;var C=eu(S),I=(1<<C)-1,x=Kl(S,C,1);for(E=0;E<_;){var A,P=x[tu(e,u,I)];if(u+=15&P,(A=P>>4)<16)v[E++]=A;else{var O=0,N=0;for(16==A?(N=3+tu(e,u,3),u+=2,O=v[E-1]):17==A?(N=3+tu(e,u,7),u+=3):18==A&&(N=11+tu(e,u,127),u+=7);N--;)v[E++]=O}}var R=v.subarray(0,k),M=v.subarray(k);p=eu(R),f=eu(M),h=Kl(R,p,1),m=Kl(M,f,1)}else iu(1);if(u>g){o&&iu(0);break}}a&&c(d+131072);for(var D=(1<<p)-1,F=(1<<f)-1,L=u;;L=u){var B=(O=h[nu(e,u)&D])>>4;if((u+=15&O)>g){o&&iu(0);break}if(O||iu(2),B<256)n[d++]=B;else{if(256==B){L=u,h=null;break}var z=B-254;if(B>264){var U=Bl[E=B-257];z=tu(e,u,(1<<U)-1)+jl[E],u+=U}var $=m[nu(e,u)&F],V=$>>4;$||iu(3),u+=15&$;M=Hl[V];if(V>3){U=zl[V];M+=nu(e,u)&(1<<U)-1,u+=U}if(u>g){o&&iu(0);break}a&&c(d+131072);var j=d+z;if(d<M){var W=0-M,H=Math.min(M,j);for(W+d<0&&iu(3);d<H;++d)n[d]=r[W+d]}for(;d<j;++d)n[d]=n[d-M]}}t.l=h,t.p=L,t.b=d,t.f=l,h&&(l=1,t.m=p,t.d=m,t.n=f)}while(!l);return d!=n.length&&i?function(e,t,n){return(null==n||n>e.length)&&(n=e.length),new Dl(e.subarray(t,n))}(n,0,d):n.subarray(0,d)},ou=new Dl(0);function cu(e,t){var n,r,s=function(e){31==e[0]&&139==e[1]&&8==e[2]||iu(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)}(e);return s+8>e.length&&iu(6,"invalid gzip data"),au(e.subarray(s,-8),{i:2},new Dl((r=(n=e).length,(n[r-4]|n[r-3]<<8|n[r-2]<<16|n[r-1]<<24)>>>0)),t)}function lu(e,t){return au(e.subarray(((8!=(15&(n=e)[0])||n[0]>>4>7||(n[0]<<8|n[1])%31)&&iu(6,"invalid zlib data"),1==(n[1]>>5&1)&&iu(6,"invalid zlib data: "+(32&n[1]?"need":"unexpected")+" dictionary"),2+(n[1]>>3&4)),-4),{i:2},t,t);var n}function uu(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?cu(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?function(e,t){return au(e,{i:2},t,t)}(e,t):lu(e,t)}var du="undefined"!=typeof TextDecoder&&new TextDecoder;try{du.decode(ou,{stream:!0})}catch(JB){}var hu,mu,pu,fu,gu,bu={exports:{}};function yu(){if(mu)return hu;mu=1;var e=1e3,t=60*e,n=60*t,r=24*n,s=7*r,i=365.25*r;function a(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}return hu=function(o,c){c=c||{};var l=typeof o;if("string"===l&&o.length>0)return function(a){if((a=String(a)).length>100)return;var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(!o)return;var c=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*i;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(o);if("number"===l&&isFinite(o))return c.long?function(s){var i=Math.abs(s);if(i>=r)return a(s,i,r,"day");if(i>=n)return a(s,i,n,"hour");if(i>=t)return a(s,i,t,"minute");if(i>=e)return a(s,i,e,"second");return s+" ms"}(o):function(s){var i=Math.abs(s);if(i>=r)return Math.round(s/r)+"d";if(i>=n)return Math.round(s/n)+"h";if(i>=t)return Math.round(s/t)+"m";if(i>=e)return Math.round(s/e)+"s";return s+"ms"}(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))}}var wu=(gu||(gu=1,function(e,t){var n={};t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))}),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(n){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(r){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=n.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0)}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=(fu||(fu=1,pu=function(e){function t(e){let r,s,i,a=null;function o(...e){if(!o.enabled)return;const n=o,s=Number(new Date),i=s-(r||s);n.diff=i,n.prev=r,n.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,s)=>{if("%%"===r)return"%";a++;const i=t.formatters[s];if("function"==typeof i){const t=e[a];r=i.call(n,t),e.splice(a,1),a--}return r}),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==t.namespaces&&(s=t.namespaces,i=t.enabled(e)),i),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e,t){let n=0,r=0,s=-1,i=0;for(;n<e.length;)if(r<t.length&&(t[r]===e[n]||"*"===t[r]))"*"===t[r]?(s=r,i=n,r++):(n++,r++);else{if(-1===s)return!1;r=s+1,i++,n=i}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const r of n)"-"===r[0]?t.skips.push(r.slice(1)):t.names.push(r)},t.enabled=function(e){for(const n of t.skips)if(r(e,n))return!1;for(const n of t.names)if(r(e,n))return!0;return!1},t.humanize=yu(),t.destroy=function(){},Object.keys(e).forEach(n=>{t[n]=e[n]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}),pu)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}(bu,bu.exports)),bu.exports);const ku=wc(wu),Tu=67324752,_u=134695760,vu=33639248,Su=101010256,Eu={get:e=>(ol.get(e,6),{signature:dl.get(e,0),compressedSize:dl.get(e,8),uncompressedSize:dl.get(e,12)}),len:16},Cu={get(e){const t=ol.get(e,6);return{signature:dl.get(e,0),minVersion:ol.get(e,4),dataDescriptor:!!(8&t),compressedMethod:ol.get(e,8),compressedSize:dl.get(e,18),uncompressedSize:dl.get(e,22),filenameLength:ol.get(e,26),extraFieldLength:ol.get(e,28),filename:null}},len:30},Iu={get:e=>({signature:dl.get(e,0),nrOfThisDisk:ol.get(e,4),nrOfThisDiskWithTheStart:ol.get(e,6),nrOfEntriesOnThisDisk:ol.get(e,8),nrOfEntriesOfSize:ol.get(e,10),sizeOfCd:dl.get(e,12),offsetOfStartOfCd:dl.get(e,16),zipFileCommentLength:ol.get(e,20)}),len:22},xu={get(e){const t=ol.get(e,8);return{signature:dl.get(e,0),minVersion:ol.get(e,6),dataDescriptor:!!(8&t),compressedMethod:ol.get(e,10),compressedSize:dl.get(e,20),uncompressedSize:dl.get(e,24),filenameLength:ol.get(e,28),extraFieldLength:ol.get(e,30),fileCommentLength:ol.get(e,32),relativeOffsetOfLocalHeader:dl.get(e,42),filename:null}},len:46};function Au(e){const t=new Uint8Array(dl.len);return dl.put(t,0,e),t}const Pu=ku("tokenizer:inflate"),Ou=262144,Nu=Au(_u),Ru=Au(Su);class Mu{constructor(e){this.tokenizer=e,this.syncBuffer=new Uint8Array(Ou)}async isZip(){return await this.peekSignature()===Tu}peekSignature(){return this.tokenizer.peekToken(dl)}async findEndOfCentralDirectoryLocator(){const e=this.tokenizer,t=Math.min(16384,e.fileInfo.size),n=this.syncBuffer.subarray(0,t);await this.tokenizer.readBuffer(n,{position:e.fileInfo.size-t});for(let r=n.length-4;r>=0;r--)if(n[r]===Ru[0]&&n[r+1]===Ru[1]&&n[r+2]===Ru[2]&&n[r+3]===Ru[3])return e.fileInfo.size-t+r;return-1}async readCentralDirectory(){if(!this.tokenizer.supportsRandomAccess())return void Pu("Cannot reading central-directory without random-read support");Pu("Reading central-directory...");const e=this.tokenizer.position,t=await this.findEndOfCentralDirectoryLocator();if(t>0){Pu("Central-directory 32-bit signature found");const n=await this.tokenizer.readToken(Iu,t),r=[];this.tokenizer.setPosition(n.offsetOfStartOfCd);for(let e=0;e<n.nrOfEntriesOfSize;++e){const t=await this.tokenizer.readToken(xu);if(t.signature!==vu)throw new Error("Expected Central-File-Header signature");t.filename=await this.tokenizer.readToken(new Rl(t.filenameLength,"utf-8")),await this.tokenizer.ignore(t.extraFieldLength),await this.tokenizer.ignore(t.fileCommentLength),r.push(t),Pu(`Add central-directory file-entry: n=${e+1}/${r.length}: filename=${r[e].filename}`)}return this.tokenizer.setPosition(e),r}this.tokenizer.setPosition(e)}async unzip(e){const t=await this.readCentralDirectory();if(t)return this.iterateOverCentralDirectory(t,e);let n=!1;do{const t=await this.readLocalFileHeader();if(!t)break;const r=e(t);let s;if(n=!!r.stop,await this.tokenizer.ignore(t.extraFieldLength),t.dataDescriptor&&0===t.compressedSize){const e=[];let n=Ou;Pu("Compressed-file-size unknown, scanning for next data-descriptor-signature....");let s=-1;for(;s<0&&n===Ou;){n=await this.tokenizer.peekBuffer(this.syncBuffer,{mayBeLess:!0}),s=Du(this.syncBuffer.subarray(0,n),Nu);const t=s>=0?s:n;if(r.handler){const n=new Uint8Array(t);await this.tokenizer.readBuffer(n),e.push(n)}else await this.tokenizer.ignore(t)}Pu(`Found data-descriptor-signature at pos=${this.tokenizer.position}`),r.handler&&await this.inflate(t,Fu(e),r.handler)}else r.handler?(Pu(`Reading compressed-file-data: ${t.compressedSize} bytes`),s=new Uint8Array(t.compressedSize),await this.tokenizer.readBuffer(s),await this.inflate(t,s,r.handler)):(Pu(`Ignoring compressed-file-data: ${t.compressedSize} bytes`),await this.tokenizer.ignore(t.compressedSize));if(Pu(`Reading data-descriptor at pos=${this.tokenizer.position}`),t.dataDescriptor){if(134695760!==(await this.tokenizer.readToken(Eu)).signature)throw new Error("Expected data-descriptor-signature at position "+(this.tokenizer.position-Eu.len))}}while(!n)}async iterateOverCentralDirectory(e,t){for(const n of e){const e=t(n);if(e.handler){this.tokenizer.setPosition(n.relativeOffsetOfLocalHeader);const t=await this.readLocalFileHeader();if(t){await this.tokenizer.ignore(t.extraFieldLength);const r=new Uint8Array(n.compressedSize);await this.tokenizer.readBuffer(r),await this.inflate(t,r,e.handler)}}if(e.stop)break}}inflate(e,t,n){if(0===e.compressedMethod)return n(t);Pu(`Decompress filename=${e.filename}, compressed-size=${t.length}`);return n(uu(t))}async readLocalFileHeader(){const e=await this.tokenizer.peekToken(dl);if(e===Tu){const e=await this.tokenizer.readToken(Cu);return e.filename=await this.tokenizer.readToken(new Rl(e.filenameLength,"utf-8")),e}if(e===vu)return!1;if(3759263696===e)throw new Error("Encrypted ZIP");throw new Error("Unexpected signature")}}function Du(e,t){const n=e.length,r=t.length;if(r>n)return-1;for(let s=0;s<=n-r;s++){let n=!0;for(let i=0;i<r;i++)if(e[s+i]!==t[i]){n=!1;break}if(n)return s}return-1}function Fu(e){const t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);let r=0;for(const s of e)n.set(s,r),r+=s.length;return n}const Lu=Object.prototype.toString;function Bu(e,t,n){return!!e&&(e.constructor===t||Lu.call(e)===n)}function zu(e){return Bu(e,Uint8Array,"[object Uint8Array]")}function Uu(e){return zu(e)||function(e){return Bu(e,ArrayBuffer,"[object ArrayBuffer]")}(e)}const $u={utf8:new globalThis.TextDecoder("utf8")};function Vu(e,t="utf8"){return function(e){if(!Uu(e))throw new TypeError(`Expected \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof e}\``)}(e),$u[t]??=new globalThis.TextDecoder(t),$u[t].decode(e)}function ju(e){if("string"!=typeof e)throw new TypeError(`Expected \`string\`, got \`${typeof e}\``)}const Wu=new globalThis.TextEncoder;const Hu=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function qu(e){!function(e){if(!zu(e))throw new TypeError(`Expected \`Uint8Array\`, got \`${typeof e}\``)}(e);let t="";for(let n=0;n<e.length;n++)t+=Hu[e[n]];return t}const Xu={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function Gu(e){if(ju(e),e.length%2!=0)throw new Error("Invalid Hex string length.");const t=e.length/2,n=new Uint8Array(t);for(let r=0;r<t;r++){const t=Xu[e[2*r]],s=Xu[e[2*r+1]];if(void 0===t||void 0===s)throw new Error("Invalid Hex character encountered at position "+2*r);n[r]=t<<4|s}return n}function Ku(e){const{byteLength:t}=e;return 6===t?e.getUint16(0)*2**32+e.getUint32(2):5===t?e.getUint8(0)*2**32+e.getUint32(1):4===t?e.getUint32(0):3===t?65536*e.getUint8(0)+e.getUint16(1):2===t?e.getUint16(0):1===t?e.getUint8(0):void 0}const Yu={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4},Qu=4100;async function Ju(e,t){return new td(t).fromBuffer(e)}function Zu(e){switch(e=e.toLowerCase()){case"application/epub+zip":return{ext:"epub",mime:e};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:e};case"application/vnd.oasis.opendocument.text-template":return{ext:"ott",mime:e};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:e};case"application/vnd.oasis.opendocument.spreadsheet-template":return{ext:"ots",mime:e};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:e};case"application/vnd.oasis.opendocument.presentation-template":return{ext:"otp",mime:e};case"application/vnd.oasis.opendocument.graphics":return{ext:"odg",mime:e};case"application/vnd.oasis.opendocument.graphics-template":return{ext:"otg",mime:e};case"application/vnd.openxmlformats-officedocument.presentationml.slideshow":return{ext:"ppsx",mime:e};case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return{ext:"xlsx",mime:e};case"application/vnd.ms-excel.sheet.macroenabled":return{ext:"xlsm",mime:"application/vnd.ms-excel.sheet.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.spreadsheetml.template":return{ext:"xltx",mime:e};case"application/vnd.ms-excel.template.macroenabled":return{ext:"xltm",mime:"application/vnd.ms-excel.template.macroenabled.12"};case"application/vnd.ms-powerpoint.slideshow.macroenabled":return{ext:"ppsm",mime:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return{ext:"docx",mime:e};case"application/vnd.ms-word.document.macroenabled":return{ext:"docm",mime:"application/vnd.ms-word.document.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.template":return{ext:"dotx",mime:e};case"application/vnd.ms-word.template.macroenabledtemplate":return{ext:"dotm",mime:"application/vnd.ms-word.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.template":return{ext:"potx",mime:e};case"application/vnd.ms-powerpoint.template.macroenabled":return{ext:"potm",mime:"application/vnd.ms-powerpoint.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return{ext:"pptx",mime:e};case"application/vnd.ms-powerpoint.presentation.macroenabled":return{ext:"pptm",mime:"application/vnd.ms-powerpoint.presentation.macroenabled.12"};case"application/vnd.ms-visio.drawing":return{ext:"vsdx",mime:"application/vnd.visio"};case"application/vnd.ms-package.3dmanufacturing-3dmodel+xml":return{ext:"3mf",mime:"model/3mf"}}}function ed(e,t,n){n={offset:0,...n};for(const[r,s]of t.entries())if(n.mask){if(s!==(n.mask[r]&e[r+n.offset]))return!1}else if(s!==e[r+n.offset])return!1;return!0}class td{constructor(e){this.options={mpegOffsetTolerance:0,...e},this.detectors=[...e?.customDetectors??[],{id:"core",detect:this.detectConfident},{id:"core.imprecise",detect:this.detectImprecise}],this.tokenizerOptions={abortSignal:e?.signal}}async fromTokenizer(e){const t=e.position;for(const n of this.detectors){const r=await n.detect(e);if(r)return r;if(t!==e.position)return}}async fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(t?.length>1)return this.fromTokenizer(tl(t,this.tokenizerOptions))}async fromBlob(e){return this.fromStream(e.stream())}async fromStream(e){const t=await el(e,this.tokenizerOptions);try{return await this.fromTokenizer(t)}finally{await t.close()}}async toDetectionStream(e,t){const{sampleSize:n=Qu}=t;let r,s;const i=e.getReader({mode:"byob"});try{const{value:e,done:t}=await i.read(new Uint8Array(n));if(s=e,!t&&e)try{r=await this.fromBuffer(e.subarray(0,n))}catch(c){if(!(c instanceof Hc))throw c;r=void 0}s=e}finally{i.releaseLock()}const a=new TransformStream({async start(e){e.enqueue(s)},transform(e,t){t.enqueue(e)}}),o=e.pipeThrough(a);return o.fileType=r,o}check(e,t){return ed(this.buffer,e,t)}checkString(e,t){return this.check((n=e,[...n].map(e=>e.charCodeAt(0))),t);var n}detectConfident=async e=>{if(this.buffer=new Uint8Array(Qu),void 0===e.fileInfo.size&&(e.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=e,await e.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await e.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.detectConfident(e);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await e.ignore(6);const t=await e.readToken(Yu);return e.position+t>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(t),this.fromTokenizer(e))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===this.buffer[0]||70===this.buffer[0])&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){let n;return await new Mu(e).unzip(e=>{switch(e.filename){case"META-INF/mozilla.rsa":return n={ext:"xpi",mime:"application/x-xpinstall"},{stop:!0};case"META-INF/MANIFEST.MF":return n={ext:"jar",mime:"application/java-archive"},{stop:!0};case"mimetype":return{async handler(e){const t=new TextDecoder("utf-8").decode(e).trim();n=Zu(t)},stop:!0};case"[Content_Types].xml":return{async handler(e){let t=new TextDecoder("utf-8").decode(e);const r=t.indexOf('.main+xml"');if(-1===r){const e="application/vnd.ms-package.3dmanufacturing-3dmodel+xml";t.includes(`ContentType="${e}"`)&&(n=Zu(e))}else{t=t.slice(0,Math.max(0,r));const e=t.lastIndexOf('"'),s=t.slice(Math.max(0,e+1));n=Zu(s)}},stop:!0};default:return/classes\d*\.dex/.test(e.filename)?(n={ext:"apk",mime:"application/vnd.android.package-archive"},{stop:!0}):{}}}),n??{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await e.ignore(28);const r=new Uint8Array(8);return await e.readBuffer(r),ed(r,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/ogg; codecs=opus"}:ed(r,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:ed(r,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:ed(r,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:ed(r,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:ed(r,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(3===this.buffer[2]||5===this.buffer[2]||7===this.buffer[2])&&(4===this.buffer[3]||6===this.buffer[3]||8===this.buffer[3]))return{ext:"zip",mime:"application/zip"};if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF"))return{ext:"pdf",mime:"application/pdf"};if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const s=await this.readTiffHeader(!1);if(s)return s}if(this.check([77,77])){const i=await this.readTiffHeader(!0);if(i)return i}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function a(){const t=await e.peekNumber(al);let n=128,r=0;for(;0===(t&n)&&0!==n;)++r,n>>=1;const s=new Uint8Array(r+1);return await e.readBuffer(s),s}async function o(){const e=await a(),t=await a();t[0]^=128>>t.length-1;const n=Math.min(6,t.length),r=new DataView(e.buffer),s=new DataView(t.buffer,t.length-n,n);return{id:Ku(r),len:Ku(s)}}async function c(t){for(;t>0;){const n=await o();if(17026===n.id){return(await e.readToken(new Rl(n.len))).replaceAll(/\00.*$/g,"")}await e.ignore(n.len),--t}}const l=await o();switch(await c(l.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/matroska"};default:return}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1")||this.checkString("PARE"))return{ext:"parquet",mime:"application/vnd.apache.parquet"};if(this.checkString("ttcf"))return{ext:"ttc",mime:"font/collection"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([4,34,77,24]))return{ext:"lz4",mime:"application/x-lz4"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.checkString(".RMF"))return{ext:"rm",mime:"application/vnd.rn-realmedia"};if(this.checkString("DRACO"))return{ext:"drc",mime:"application/vnd.google.draco"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(0===this.buffer[6]||1===this.buffer[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const u=new Rl(4,"latin1").get(this.buffer,2);if(u.match("^d*")&&u>=1e3&&u<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>")){await e.ignore(8);return"debian-binary"===await e.readToken(new Rl(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"}}if(this.checkString("WEBVTT")&&["\n","\r","\t"," ","\0"].some(e=>this.checkString(e,{offset:6})))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){async function d(){return{length:await e.readToken(yl),type:await e.readToken(new Rl(4,"latin1"))}}await e.ignore(8);do{const h=await d();if(h.length<0)return;switch(h.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(h.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/vnd.apache.arrow.file"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.checkString("ftyp",{offset:4})&&96&this.buffer[8]){const m=new Rl(4,"latin1").get(this.buffer,8).replace("\0"," ").trim();switch(m){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return m.startsWith("3g")?m.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.check([82,73,70,70])){if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function p(){const t=new Uint8Array(16);return await e.readBuffer(t),{id:t,size:Number(await e.readToken(kl))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const f=await p();let g=f.size-24;if(ed(f.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const b=new Uint8Array(16);if(g-=await e.readBuffer(b),ed(b,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(ed(b,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(g)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10])){await e.ignore(20);switch(await e.readToken(new Rl(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const y=new DataView(this.buffer.buffer).getUint32(12,!0);if(y>12&&this.buffer.length>=y+16)try{const w=(new TextDecoder).decode(this.buffer.subarray(16,y+16));if(JSON.parse(w).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}return this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2])?{ext:"mxf",mime:"application/mxf"}:this.checkString("SCRM",{offset:44})?{ext:"s3m",mime:"audio/x-s3m"}:this.check([71])&&this.check([71],{offset:188})||this.check([71],{offset:4})&&this.check([71],{offset:196})?{ext:"mts",mime:"video/mp2t"}:this.check([66,79,79,75,77,79,66,73],{offset:60})?{ext:"mobi",mime:"application/x-mobipocket-ebook"}:this.check([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70])?{ext:"lnk",mime:"application/x.ms.shortcut"}:this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0])?{ext:"alias",mime:"application/x.apple.alias"}:this.checkString("Kaydara FBX Binary  \0")?{ext:"fbx",mime:"application/x.autodesk.fbx"}:this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8}))?{ext:"eot",mime:"application/vnd.ms-fontobject"}:this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29])?{ext:"indd",mime:"application/x-indesign"}:(await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),this.checkString("ustar",{offset:257})&&(this.checkString("\0",{offset:262})||this.checkString(" ",{offset:262}))||this.check([0,0,0,0,0,0],{offset:257})&&function(e,t=0){const n=Number.parseInt(new Rl(6).get(e,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(n))return!1;let r=256;for(let s=t;s<t+148;s++)r+=e[s];for(let s=t+156;s<t+512;s++)r+=e[s];return n===r}(this.buffer)?{ext:"tar",mime:"application/x-tar"}:this.check([255,254])?this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0:this.checkString("-----BEGIN PGP MESSAGE-----")?{ext:"pgp",mime:"application/pgp-encrypted"}:void 0)};detectImprecise=async e=>{if(this.buffer=new Uint8Array(Qu),await e.peekBuffer(this.buffer,{length:Math.min(8,e.fileInfo.size),mayBeLess:!0}),this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(await e.peekBuffer(this.buffer,{length:Math.min(2+this.options.mpegOffsetTolerance,e.fileInfo.size),mayBeLess:!0}),this.buffer.length>=2+this.options.mpegOffsetTolerance)for(let t=0;t<=this.options.mpegOffsetTolerance;++t){const e=this.scanMpeg(t);if(e)return e}};async readTiffTag(e){const t=await this.tokenizer.readToken(e?cl:ol);switch(this.tokenizer.ignore(10),t){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(e){const t=await this.tokenizer.readToken(e?cl:ol);for(let n=0;n<t;++n){const t=await this.readTiffTag(e);if(t)return t}}async readTiffHeader(e){const t=(e?cl:ol).get(this.buffer,2),n=(e?hl:dl).get(this.buffer,4);if(42===t){if(n>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(n>=8){const t=(e?cl:ol).get(this.buffer,8),n=(e?cl:ol).get(this.buffer,10);if(28===t&&254===n||31===t&&11===n)return{ext:"nef",mime:"image/x-nikon-nef"}}}await this.tokenizer.ignore(n);return await this.readTiffIFD(e)??{ext:"tif",mime:"image/tiff"}}if(43===t)return{ext:"tif",mime:"image/tiff"}}scanMpeg(e){if(this.check([255,224],{offset:e,mask:[255,224]})){if(this.check([16],{offset:e+1,mask:[22]}))return this.check([8],{offset:e+1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:e+1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:e+1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:e+1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}}new Set(["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ttc","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk","drc","lz4","potx","xltx","dotx","xltm","ott","ots","otp","odg","otg","xlsm","docm","dotm","potm","pptm","jar","rm","ppsm","ppsx"]),new Set(["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.ms-powerpoint.slideshow.macroenabled.12","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/vnd.apache.arrow.file","video/mp4","audio/midi","video/matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","font/collection","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/vnd.apache.parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive","application/vnd.google.draco","application/x-lz4","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-excel.template.macroenabled.12","application/vnd.oasis.opendocument.text-template","application/vnd.oasis.opendocument.spreadsheet-template","application/vnd.oasis.opendocument.presentation-template","application/vnd.oasis.opendocument.graphics","application/vnd.oasis.opendocument.graphics-template","application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.ms-word.document.macroenabled.12","application/vnd.ms-word.template.macroenabled.12","application/vnd.ms-powerpoint.template.macroenabled.12","application/vnd.ms-powerpoint.presentation.macroenabled.12","application/java-archive","application/vnd.rn-realmedia"]);var nd,rd={};var sd=function(){if(nd)return rd;nd=1;var e=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,t=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,n=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,r=/\\([\u000b\u0020-\u00ff])/g,s=/([\\"])/g,i=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function a(e){var r=String(e);if(n.test(r))return r;if(r.length>0&&!t.test(r))throw new TypeError("invalid parameter value");return'"'+r.replace(s,"\\$1")+'"'}function o(e){this.parameters=Object.create(null),this.type=e}return rd.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,r=e.type;if(!r||!i.test(r))throw new TypeError("invalid type");var s=r;if(t&&"object"==typeof t)for(var o,c=Object.keys(t).sort(),l=0;l<c.length;l++){if(o=c[l],!n.test(o))throw new TypeError("invalid parameter name");s+="; "+o+"="+a(t[o])}return s},rd.parse=function(t){if(!t)throw new TypeError("argument string is required");var n="object"==typeof t?function(e){var t;"function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]);if("string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(t):t;if("string"!=typeof n)throw new TypeError("argument string is required to be a string");var s=n.indexOf(";"),a=-1!==s?n.slice(0,s).trim():n.trim();if(!i.test(a))throw new TypeError("invalid media type");var c=new o(a.toLowerCase());if(-1!==s){var l,u,d;for(e.lastIndex=s;u=e.exec(n);){if(u.index!==s)throw new TypeError("invalid parameter format");s+=u[0].length,l=u[1].toLowerCase(),34===(d=u[2]).charCodeAt(0)&&-1!==(d=d.slice(1,-1)).indexOf("\\")&&(d=d.replace(r,"$1")),c.parameters[l]=d}if(s!==n.length)throw new TypeError("invalid parameter format")}return c},rd}();const id=wc(sd);var ad,od={};var cd=function(){if(ad)return od;ad=1;var e=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,t=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,n=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;function r(e,t,n){this.type=e,this.subtype=t,this.suffix=n}return od.format=function(n){if(!n||"object"!=typeof n)throw new TypeError("argument obj is required");var r=n.subtype,s=n.suffix,i=n.type;if(!i||!t.test(i))throw new TypeError("invalid type");if(!r||!e.test(r))throw new TypeError("invalid subtype");var a=i+"/"+r;if(s){if(!t.test(s))throw new TypeError("invalid suffix");a+="+"+s}return a},od.parse=function(e){if(!e)throw new TypeError("argument string is required");if("string"!=typeof e)throw new TypeError("argument string is required to be a string");var t=n.exec(e.toLowerCase());if(!t)throw new TypeError("invalid media type");var s,i=t[1],a=t[2],o=a.lastIndexOf("+");-1!==o&&(s=a.substr(o+1),a=a.substr(0,o));return new r(i,a,s)},od.test=function(e){if(!e)throw new TypeError("argument string is required");if("string"!=typeof e)throw new TypeError("argument string is required to be a string");return n.test(e.toLowerCase())},od}();const ld={10:"shot",20:"scene",30:"track",40:"part",50:"album",60:"edition",70:"collection"},ud=1,dd=2,hd=3,md=4,pd=17,fd=18,gd=32,bd={[ud]:"video",[dd]:"audio",[hd]:"complex",[md]:"logo",[pd]:"subtitle",[fd]:"button",[gd]:"control"},yd=e=>class extends Error{constructor(t){super(t),this.name=e}};class wd extends(yd("CouldNotDetermineFileTypeError")){}class kd extends(yd("UnsupportedFileTypeError")){}class Td extends(yd("UnexpectedFileContentError")){constructor(e,t){super(t),this.fileType=e}toString(){return`${this.name} (FileType: ${this.fileType}): ${this.message}`}}class _d extends(yd("FieldDecodingError")){}class vd extends(yd("InternalParserError")){}const Sd=e=>class extends Td{constructor(t){super(e,t)}};function Ed(e,t,n){return!!(e[t]&1<<n)}function Cd(e,t,n,r){let s=t;if("utf-16le"===r){for(;0!==e[s]||0!==e[s+1];){if(s>=n)return n;s+=2}return s}for(;0!==e[s];){if(s>=n)return n;s++}return s}function Id(e){const t=e.indexOf("\0");return-1===t?e:e.substr(0,t)}function xd(e,t){if(255===e[0]&&254===e[1])return xd(e.subarray(2),t);if("utf-16le"===t&&254===e[0]&&255===e[1]){if(1&e.length)throw new _d("Expected even number of octets for 16-bit unicode string");return xd(function(e){const t=e.length;if(1&t)throw new _d("Buffer length must be even");for(let n=0;n<t;n+=2){const t=e[n];e[n]=e[n+1],e[n+1]=t}return e}(e),t)}return new Rl(e.length,t).get(e,0)}function Ad(e){return e=(e=e.replace(/^\x00+/g,"")).replace(/\x00+$/g,"")}function Pd(e,t,n,r){const s=n%8;let i=e[t+~~(n/8)];i&=255>>s;const a=8-s,o=r-a;return o<0?i>>=8-s-r:o>0&&(i<<=o,i|=Pd(e,t,n+a,o)),i}function Od(e,t,n){return 1===Pd(e,t,n,1)}const Nd={0:"Other",1:"32x32 pixels 'file icon' (PNG only)",2:"Other file icon",3:"Cover (front)",4:"Cover (back)",5:"Leaflet page",6:"Media (e.g. label side of CD)",7:"Lead artist/lead performer/soloist",8:"Artist/performer",9:"Conductor",10:"Band/Orchestra",11:"Composer",12:"Lyricist/text writer",13:"Recording Location",14:"During recording",15:"During performance",16:"Movie/video screen capture",17:"A bright coloured fish",18:"Illustration",19:"Band/artist logotype",20:"Publisher/Studio logotype"},Rd=1,Md=2,Dd={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4},Fd={len:10,get:(e,t)=>({fileIdentifier:new Rl(3,"ascii").get(e,t),version:{major:ml.get(e,t+3),revision:ml.get(e,t+4)},flags:{unsynchronisation:Ed(e,t+5,7),isExtendedHeader:Ed(e,t+5,6),expIndicator:Ed(e,t+5,5),footer:Ed(e,t+5,4)},size:Dd.get(e,t+6)})},Ld={len:10,get:(e,t)=>({size:hl.get(e,t),extendedFlags:cl.get(e,t+4),sizeOfPadding:hl.get(e,t+6),crcDataPresent:Ed(e,t+4,31)})},Bd=(e,t)=>{switch(e[t]){case 0:return{encoding:"latin1"};case 1:return{encoding:"utf-16le",bom:!0};case 2:return{encoding:"utf-16le",bom:!1};default:return{encoding:"utf8",bom:!1}}},zd=4,Ud=(e,t)=>({encoding:Bd(e,t),language:new Rl(3,"latin1").get(e,t+1)}),$d=6,Vd=(e,t)=>{const n=Ud(e,t);return{encoding:n.encoding,language:n.language,timeStampFormat:al.get(e,t+4),contentType:al.get(e,t+5)}},jd={multiple:!1},Wd={year:jd,track:jd,disk:jd,title:jd,artist:jd,artists:{multiple:!0,unique:!0},albumartist:jd,album:jd,date:jd,originaldate:jd,originalyear:jd,releasedate:jd,comment:{multiple:!0,unique:!1},genre:{multiple:!0,unique:!0},picture:{multiple:!0,unique:!0},composer:{multiple:!0,unique:!0},lyrics:{multiple:!0,unique:!1},albumsort:{multiple:!1,unique:!0},titlesort:{multiple:!1,unique:!0},work:{multiple:!1,unique:!0},artistsort:{multiple:!1,unique:!0},albumartistsort:{multiple:!1,unique:!0},composersort:{multiple:!1,unique:!0},lyricist:{multiple:!0,unique:!0},writer:{multiple:!0,unique:!0},conductor:{multiple:!0,unique:!0},remixer:{multiple:!0,unique:!0},arranger:{multiple:!0,unique:!0},engineer:{multiple:!0,unique:!0},producer:{multiple:!0,unique:!0},technician:{multiple:!0,unique:!0},djmixer:{multiple:!0,unique:!0},mixer:{multiple:!0,unique:!0},label:{multiple:!0,unique:!0},grouping:jd,subtitle:{multiple:!0},discsubtitle:jd,totaltracks:jd,totaldiscs:jd,compilation:jd,rating:{multiple:!0},bpm:jd,mood:jd,media:jd,catalognumber:{multiple:!0,unique:!0},tvShow:jd,tvShowSort:jd,tvSeason:jd,tvEpisode:jd,tvEpisodeId:jd,tvNetwork:jd,podcast:jd,podcasturl:jd,releasestatus:jd,releasetype:{multiple:!0},releasecountry:jd,script:jd,language:jd,copyright:jd,license:jd,encodedby:jd,encodersettings:jd,gapless:jd,barcode:jd,isrc:{multiple:!0},asin:jd,musicbrainz_recordingid:jd,musicbrainz_trackid:jd,musicbrainz_albumid:jd,musicbrainz_artistid:{multiple:!0},musicbrainz_albumartistid:{multiple:!0},musicbrainz_releasegroupid:jd,musicbrainz_workid:jd,musicbrainz_trmid:jd,musicbrainz_discid:jd,acoustid_id:jd,acoustid_fingerprint:jd,musicip_puid:jd,musicip_fingerprint:jd,website:jd,"performer:instrument":{multiple:!0,unique:!0},averageLevel:jd,peakLevel:jd,notes:{multiple:!0,unique:!1},key:jd,originalalbum:jd,originalartist:jd,discogs_artist_id:{multiple:!0,unique:!0},discogs_release_id:jd,discogs_label_id:jd,discogs_master_release_id:jd,discogs_votes:jd,discogs_rating:jd,replaygain_track_peak:jd,replaygain_track_gain:jd,replaygain_album_peak:jd,replaygain_album_gain:jd,replaygain_track_minmax:jd,replaygain_album_minmax:jd,replaygain_undo:jd,description:{multiple:!0},longDescription:jd,category:{multiple:!0},hdVideo:jd,keywords:{multiple:!0},movement:jd,movementIndex:jd,movementTotal:jd,podcastId:jd,showMovement:jd,stik:jd};class Hd{static toIntOrNull(e){const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t}static normalizeTrack(e){const t=e.toString().split("/");return{no:Number.parseInt(t[0],10)||null,of:Number.parseInt(t[1],10)||null}}constructor(e,t){this.tagTypes=e,this.tagMap=t}mapGenericTag(e,t){e={id:e.id,value:e.value},this.postMap(e,t);const n=this.getCommonName(e.id);return n?{id:n,value:e.value}:null}getCommonName(e){return this.tagMap[e]}postMap(e,t){}}Hd.maxRatingScore=1;const qd={title:"title",artist:"artist",album:"album",year:"year",comment:"comment",track:"track",genre:"genre"};class Xd extends Hd{constructor(){super(["ID3v1"],qd)}}class Gd extends Hd{constructor(e,t){const n={};for(const r of Object.keys(t))n[r.toUpperCase()]=t[r];super(e,n)}getCommonName(e){return this.tagMap[e.toUpperCase()]}}const Kd={TIT2:"title",TPE1:"artist","TXXX:Artists":"artists",TPE2:"albumartist",TALB:"album",TDRV:"date",TORY:"originalyear",TPOS:"disk",TCON:"genre",APIC:"picture",TCOM:"composer",USLT:"lyrics",TSOA:"albumsort",TSOT:"titlesort",TOAL:"originalalbum",TSOP:"artistsort",TSO2:"albumartistsort",TSOC:"composersort",TEXT:"lyricist","TXXX:Writer":"writer",TPE3:"conductor",TPE4:"remixer","IPLS:arranger":"arranger","IPLS:engineer":"engineer","IPLS:producer":"producer","IPLS:DJ-mix":"djmixer","IPLS:mix":"mixer",TPUB:"label",TIT1:"grouping",TIT3:"subtitle",TRCK:"track",TCMP:"compilation",POPM:"rating",TBPM:"bpm",TMED:"media","TXXX:CATALOGNUMBER":"catalognumber","TXXX:MusicBrainz Album Status":"releasestatus","TXXX:MusicBrainz Album Type":"releasetype","TXXX:MusicBrainz Album Release Country":"releasecountry","TXXX:RELEASECOUNTRY":"releasecountry","TXXX:SCRIPT":"script",TLAN:"language",TCOP:"copyright",WCOP:"license",TENC:"encodedby",TSSE:"encodersettings","TXXX:BARCODE":"barcode","TXXX:ISRC":"isrc",TSRC:"isrc","TXXX:ASIN":"asin","TXXX:originalyear":"originalyear","UFID:http://musicbrainz.org":"musicbrainz_recordingid","TXXX:MusicBrainz Release Track Id":"musicbrainz_trackid","TXXX:MusicBrainz Album Id":"musicbrainz_albumid","TXXX:MusicBrainz Artist Id":"musicbrainz_artistid","TXXX:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","TXXX:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","TXXX:MusicBrainz Work Id":"musicbrainz_workid","TXXX:MusicBrainz TRM Id":"musicbrainz_trmid","TXXX:MusicBrainz Disc Id":"musicbrainz_discid","TXXX:ACOUSTID_ID":"acoustid_id","TXXX:Acoustid Id":"acoustid_id","TXXX:Acoustid Fingerprint":"acoustid_fingerprint","TXXX:MusicIP PUID":"musicip_puid","TXXX:MusicMagic Fingerprint":"musicip_fingerprint",WOAR:"website",TDRC:"date",TYER:"year",TDOR:"originaldate","TIPL:arranger":"arranger","TIPL:engineer":"engineer","TIPL:producer":"producer","TIPL:DJ-mix":"djmixer","TIPL:mix":"mixer",TMOO:"mood",SYLT:"lyrics",TSST:"discsubtitle",TKEY:"key",COMM:"comment",TOPE:"originalartist","PRIV:AverageLevel":"averageLevel","PRIV:PeakLevel":"peakLevel","TXXX:DISCOGS_ARTIST_ID":"discogs_artist_id","TXXX:DISCOGS_ARTISTS":"artists","TXXX:DISCOGS_ARTIST_NAME":"artists","TXXX:DISCOGS_ALBUM_ARTISTS":"albumartist","TXXX:DISCOGS_CATALOG":"catalognumber","TXXX:DISCOGS_COUNTRY":"releasecountry","TXXX:DISCOGS_DATE":"originaldate","TXXX:DISCOGS_LABEL":"label","TXXX:DISCOGS_LABEL_ID":"discogs_label_id","TXXX:DISCOGS_MASTER_RELEASE_ID":"discogs_master_release_id","TXXX:DISCOGS_RATING":"discogs_rating","TXXX:DISCOGS_RELEASED":"date","TXXX:DISCOGS_RELEASE_ID":"discogs_release_id","TXXX:DISCOGS_VOTES":"discogs_votes","TXXX:CATALOGID":"catalognumber","TXXX:STYLE":"genre","TXXX:REPLAYGAIN_TRACK_PEAK":"replaygain_track_peak","TXXX:REPLAYGAIN_TRACK_GAIN":"replaygain_track_gain","TXXX:REPLAYGAIN_ALBUM_PEAK":"replaygain_album_peak","TXXX:REPLAYGAIN_ALBUM_GAIN":"replaygain_album_gain","TXXX:MP3GAIN_MINMAX":"replaygain_track_minmax","TXXX:MP3GAIN_ALBUM_MINMAX":"replaygain_album_minmax","TXXX:MP3GAIN_UNDO":"replaygain_undo",MVNM:"movement",MVIN:"movementIndex",PCST:"podcast",TCAT:"category",TDES:"description",TDRL:"releasedate",TGID:"podcastId",TKWD:"keywords",WFED:"podcasturl",GRP1:"grouping"};class Yd extends Gd{static toRating(e){return{source:e.email,rating:e.rating>0?(e.rating-1)/254*Hd.maxRatingScore:void 0}}constructor(){super(["ID3v2.3","ID3v2.4"],Kd)}postMap(e,t){switch(e.id){case"UFID":{const t=e.value;"http://musicbrainz.org"===t.owner_identifier&&(e.id+=`:${t.owner_identifier}`,e.value=xd(t.identifier,"latin1"))}break;case"PRIV":{const n=e.value;switch(n.owner_identifier){case"AverageLevel":case"PeakValue":e.id+=`:${n.owner_identifier}`,e.value=4===n.data.length?dl.get(n.data,0):null,null===e.value&&t.addWarning("Failed to parse PRIV:PeakValue");break;default:t.addWarning(`Unknown PRIV owner-identifier: ${n.data}`)}}break;case"POPM":e.value=Yd.toRating(e.value)}}}const Qd={Title:"title",Author:"artist","WM/AlbumArtist":"albumartist","WM/AlbumTitle":"album","WM/Year":"date","WM/OriginalReleaseTime":"originaldate","WM/OriginalReleaseYear":"originalyear",Description:"comment","WM/TrackNumber":"track","WM/PartOfSet":"disk","WM/Genre":"genre","WM/Composer":"composer","WM/Lyrics":"lyrics","WM/AlbumSortOrder":"albumsort","WM/TitleSortOrder":"titlesort","WM/ArtistSortOrder":"artistsort","WM/AlbumArtistSortOrder":"albumartistsort","WM/ComposerSortOrder":"composersort","WM/Writer":"lyricist","WM/Conductor":"conductor","WM/ModifiedBy":"remixer","WM/Engineer":"engineer","WM/Producer":"producer","WM/DJMixer":"djmixer","WM/Mixer":"mixer","WM/Publisher":"label","WM/ContentGroupDescription":"grouping","WM/SubTitle":"subtitle","WM/SetSubTitle":"discsubtitle","WM/IsCompilation":"compilation","WM/SharedUserRating":"rating","WM/BeatsPerMinute":"bpm","WM/Mood":"mood","WM/Media":"media","WM/CatalogNo":"catalognumber","MusicBrainz/Album Status":"releasestatus","MusicBrainz/Album Type":"releasetype","MusicBrainz/Album Release Country":"releasecountry","WM/Script":"script","WM/Language":"language",Copyright:"copyright",LICENSE:"license","WM/EncodedBy":"encodedby","WM/EncodingSettings":"encodersettings","WM/Barcode":"barcode","WM/ISRC":"isrc","MusicBrainz/Track Id":"musicbrainz_recordingid","MusicBrainz/Release Track Id":"musicbrainz_trackid","MusicBrainz/Album Id":"musicbrainz_albumid","MusicBrainz/Artist Id":"musicbrainz_artistid","MusicBrainz/Album Artist Id":"musicbrainz_albumartistid","MusicBrainz/Release Group Id":"musicbrainz_releasegroupid","MusicBrainz/Work Id":"musicbrainz_workid","MusicBrainz/TRM Id":"musicbrainz_trmid","MusicBrainz/Disc Id":"musicbrainz_discid","Acoustid/Id":"acoustid_id","Acoustid/Fingerprint":"acoustid_fingerprint","MusicIP/PUID":"musicip_puid","WM/ARTISTS":"artists","WM/InitialKey":"key",ASIN:"asin","WM/Work":"work","WM/AuthorURL":"website","WM/Picture":"picture"};class Jd extends Hd{static toRating(e){return{rating:Number.parseFloat(e+1)/5}}constructor(){super(["asf"],Qd)}postMap(e){switch(e.id){case"WM/SharedUserRating":{const t=e.id.split(":");e.value=Jd.toRating(e.value),e.id=t[0];break}}}}const Zd={TT2:"title",TP1:"artist",TP2:"albumartist",TAL:"album",TYE:"year",COM:"comment",TRK:"track",TPA:"disk",TCO:"genre",PIC:"picture",TCM:"composer",TOR:"originaldate",TOT:"originalalbum",TXT:"lyricist",TP3:"conductor",TPB:"label",TT1:"grouping",TT3:"subtitle",TLA:"language",TCR:"copyright",WCP:"license",TEN:"encodedby",TSS:"encodersettings",WAR:"website",PCS:"podcast",TCP:"compilation",TDR:"date",TS2:"albumartistsort",TSA:"albumsort",TSC:"composersort",TSP:"artistsort",TST:"titlesort",WFD:"podcasturl",TBP:"bpm"};class eh extends Gd{constructor(){super(["ID3v2.2"],Zd)}}const th={Title:"title",Artist:"artist",Artists:"artists","Album Artist":"albumartist",Album:"album",Year:"date",Originalyear:"originalyear",Originaldate:"originaldate",Releasedate:"releasedate",Comment:"comment",Track:"track",Disc:"disk",DISCNUMBER:"disk",Genre:"genre","Cover Art (Front)":"picture","Cover Art (Back)":"picture",Composer:"composer",Lyrics:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",Lyricist:"lyricist",Writer:"writer",Conductor:"conductor",MixArtist:"remixer",Arranger:"arranger",Engineer:"engineer",Producer:"producer",DJMixer:"djmixer",Mixer:"mixer",Label:"label",Grouping:"grouping",Subtitle:"subtitle",DiscSubtitle:"discsubtitle",Compilation:"compilation",BPM:"bpm",Mood:"mood",Media:"media",CatalogNumber:"catalognumber",MUSICBRAINZ_ALBUMSTATUS:"releasestatus",MUSICBRAINZ_ALBUMTYPE:"releasetype",RELEASECOUNTRY:"releasecountry",Script:"script",Language:"language",Copyright:"copyright",LICENSE:"license",EncodedBy:"encodedby",EncoderSettings:"encodersettings",Barcode:"barcode",ISRC:"isrc",ASIN:"asin",musicbrainz_trackid:"musicbrainz_recordingid",musicbrainz_releasetrackid:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",Acoustid_Id:"acoustid_id",ACOUSTID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",Weblink:"website",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",MP3GAIN_MINMAX:"replaygain_track_minmax",MP3GAIN_UNDO:"replaygain_undo"};class nh extends Gd{constructor(){super(["APEv2"],th)}}const rh={"©nam":"title","©ART":"artist",aART:"albumartist","----:com.apple.iTunes:Band":"albumartist","©alb":"album","©day":"date","©cmt":"comment","©com":"comment",trkn:"track",disk:"disk","©gen":"genre",covr:"picture","©wrt":"composer","©lyr":"lyrics",soal:"albumsort",sonm:"titlesort",soar:"artistsort",soaa:"albumartistsort",soco:"composersort","----:com.apple.iTunes:LYRICIST":"lyricist","----:com.apple.iTunes:CONDUCTOR":"conductor","----:com.apple.iTunes:REMIXER":"remixer","----:com.apple.iTunes:ENGINEER":"engineer","----:com.apple.iTunes:PRODUCER":"producer","----:com.apple.iTunes:DJMIXER":"djmixer","----:com.apple.iTunes:MIXER":"mixer","----:com.apple.iTunes:LABEL":"label","©grp":"grouping","----:com.apple.iTunes:SUBTITLE":"subtitle","----:com.apple.iTunes:DISCSUBTITLE":"discsubtitle",cpil:"compilation",tmpo:"bpm","----:com.apple.iTunes:MOOD":"mood","----:com.apple.iTunes:MEDIA":"media","----:com.apple.iTunes:CATALOGNUMBER":"catalognumber",tvsh:"tvShow",tvsn:"tvSeason",tves:"tvEpisode",sosn:"tvShowSort",tven:"tvEpisodeId",tvnn:"tvNetwork",pcst:"podcast",purl:"podcasturl","----:com.apple.iTunes:MusicBrainz Album Status":"releasestatus","----:com.apple.iTunes:MusicBrainz Album Type":"releasetype","----:com.apple.iTunes:MusicBrainz Album Release Country":"releasecountry","----:com.apple.iTunes:SCRIPT":"script","----:com.apple.iTunes:LANGUAGE":"language",cprt:"copyright","©cpy":"copyright","----:com.apple.iTunes:LICENSE":"license","©too":"encodedby",pgap:"gapless","----:com.apple.iTunes:BARCODE":"barcode","----:com.apple.iTunes:ISRC":"isrc","----:com.apple.iTunes:ASIN":"asin","----:com.apple.iTunes:NOTES":"comment","----:com.apple.iTunes:MusicBrainz Track Id":"musicbrainz_recordingid","----:com.apple.iTunes:MusicBrainz Release Track Id":"musicbrainz_trackid","----:com.apple.iTunes:MusicBrainz Album Id":"musicbrainz_albumid","----:com.apple.iTunes:MusicBrainz Artist Id":"musicbrainz_artistid","----:com.apple.iTunes:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","----:com.apple.iTunes:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","----:com.apple.iTunes:MusicBrainz Work Id":"musicbrainz_workid","----:com.apple.iTunes:MusicBrainz TRM Id":"musicbrainz_trmid","----:com.apple.iTunes:MusicBrainz Disc Id":"musicbrainz_discid","----:com.apple.iTunes:Acoustid Id":"acoustid_id","----:com.apple.iTunes:Acoustid Fingerprint":"acoustid_fingerprint","----:com.apple.iTunes:MusicIP PUID":"musicip_puid","----:com.apple.iTunes:fingerprint":"musicip_fingerprint","----:com.apple.iTunes:replaygain_track_gain":"replaygain_track_gain","----:com.apple.iTunes:replaygain_track_peak":"replaygain_track_peak","----:com.apple.iTunes:replaygain_album_gain":"replaygain_album_gain","----:com.apple.iTunes:replaygain_album_peak":"replaygain_album_peak","----:com.apple.iTunes:replaygain_track_minmax":"replaygain_track_minmax","----:com.apple.iTunes:replaygain_album_minmax":"replaygain_album_minmax","----:com.apple.iTunes:replaygain_undo":"replaygain_undo",gnre:"genre","----:com.apple.iTunes:ALBUMARTISTSORT":"albumartistsort","----:com.apple.iTunes:ARTISTS":"artists","----:com.apple.iTunes:ORIGINALDATE":"originaldate","----:com.apple.iTunes:ORIGINALYEAR":"originalyear","----:com.apple.iTunes:RELEASEDATE":"releasedate",desc:"description",ldes:"longDescription","©mvn":"movement","©mvi":"movementIndex","©mvc":"movementTotal","©wrk":"work",catg:"category",egid:"podcastId",hdvd:"hdVideo",keyw:"keywords",shwm:"showMovement",stik:"stik",rate:"rating"};class sh extends Gd{constructor(){super(["iTunes"],rh)}postMap(e,t){if("rate"===e.id)e.value={source:void 0,rating:Number.parseFloat(e.value)/100}}}const ih={TITLE:"title",ARTIST:"artist",ARTISTS:"artists",ALBUMARTIST:"albumartist","ALBUM ARTIST":"albumartist",ALBUM:"album",DATE:"date",ORIGINALDATE:"originaldate",ORIGINALYEAR:"originalyear",RELEASEDATE:"releasedate",COMMENT:"comment",TRACKNUMBER:"track",DISCNUMBER:"disk",GENRE:"genre",METADATA_BLOCK_PICTURE:"picture",COMPOSER:"composer",LYRICS:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",LYRICIST:"lyricist",WRITER:"writer",CONDUCTOR:"conductor",REMIXER:"remixer",ARRANGER:"arranger",ENGINEER:"engineer",PRODUCER:"producer",DJMIXER:"djmixer",MIXER:"mixer",LABEL:"label",GROUPING:"grouping",SUBTITLE:"subtitle",DISCSUBTITLE:"discsubtitle",TRACKTOTAL:"totaltracks",DISCTOTAL:"totaldiscs",COMPILATION:"compilation",RATING:"rating",BPM:"bpm",KEY:"key",MOOD:"mood",MEDIA:"media",CATALOGNUMBER:"catalognumber",RELEASESTATUS:"releasestatus",RELEASETYPE:"releasetype",RELEASECOUNTRY:"releasecountry",SCRIPT:"script",LANGUAGE:"language",COPYRIGHT:"copyright",LICENSE:"license",ENCODEDBY:"encodedby",ENCODERSETTINGS:"encodersettings",BARCODE:"barcode",ISRC:"isrc",ASIN:"asin",MUSICBRAINZ_TRACKID:"musicbrainz_recordingid",MUSICBRAINZ_RELEASETRACKID:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",ACOUSTID_ID:"acoustid_id",ACOUSTID_ID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",WEBSITE:"website",NOTES:"notes",TOTALTRACKS:"totaltracks",TOTALDISCS:"totaldiscs",DISCOGS_ARTIST_ID:"discogs_artist_id",DISCOGS_ARTISTS:"artists",DISCOGS_ARTIST_NAME:"artists",DISCOGS_ALBUM_ARTISTS:"albumartist",DISCOGS_CATALOG:"catalognumber",DISCOGS_COUNTRY:"releasecountry",DISCOGS_DATE:"originaldate",DISCOGS_LABEL:"label",DISCOGS_LABEL_ID:"discogs_label_id",DISCOGS_MASTER_RELEASE_ID:"discogs_master_release_id",DISCOGS_RATING:"discogs_rating",DISCOGS_RELEASED:"date",DISCOGS_RELEASE_ID:"discogs_release_id",DISCOGS_VOTES:"discogs_votes",CATALOGID:"catalognumber",STYLE:"genre",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",REPLAYGAIN_ALBUM_GAIN:"replaygain_album_gain",REPLAYGAIN_ALBUM_PEAK:"replaygain_album_peak",REPLAYGAIN_MINMAX:"replaygain_track_minmax",REPLAYGAIN_ALBUM_MINMAX:"replaygain_album_minmax",REPLAYGAIN_UNDO:"replaygain_undo"};class ah extends Hd{static toRating(e,t,n){return{source:e?e.toLowerCase():void 0,rating:Number.parseFloat(t)/n*Hd.maxRatingScore}}constructor(){super(["vorbis"],ih)}postMap(e){if("RATING"===e.id)e.value=ah.toRating(void 0,e.value,100);else if(0===e.id.indexOf("RATING:")){const t=e.id.split(":");e.value=ah.toRating(t[1],e.value,1),e.id=t[0]}}}const oh={IART:"artist",ICRD:"date",INAM:"title",TITL:"title",IPRD:"album",ITRK:"track",IPRT:"track",COMM:"comment",ICMT:"comment",ICNT:"releasecountry",GNRE:"genre",IWRI:"writer",RATE:"rating",YEAR:"year",ISFT:"encodedby",CODE:"encodedby",TURL:"website",IGNR:"genre",IENG:"engineer",ITCH:"technician",IMED:"media",IRPD:"album"};class ch extends Hd{constructor(){super(["exif"],oh)}}const lh={"segment:title":"title","album:ARTIST":"albumartist","album:ARTISTSORT":"albumartistsort","album:TITLE":"album","album:DATE_RECORDED":"originaldate","album:DATE_RELEASED":"releasedate","album:PART_NUMBER":"disk","album:TOTAL_PARTS":"totaltracks","track:ARTIST":"artist","track:ARTISTSORT":"artistsort","track:TITLE":"title","track:PART_NUMBER":"track","track:MUSICBRAINZ_TRACKID":"musicbrainz_recordingid","track:MUSICBRAINZ_ALBUMID":"musicbrainz_albumid","track:MUSICBRAINZ_ARTISTID":"musicbrainz_artistid","track:PUBLISHER":"label","track:GENRE":"genre","track:ENCODER":"encodedby","track:ENCODER_OPTIONS":"encodersettings","edition:TOTAL_PARTS":"totaldiscs",picture:"picture"};class uh extends Gd{constructor(){super(["matroska"],lh)}}const dh={NAME:"title",AUTH:"artist","(c) ":"copyright",ANNO:"comment"};class hh extends Hd{constructor(){super(["AIFF"],dh)}}class mh{constructor(){this.tagMappers={},[new Xd,new eh,new Yd,new sh,new sh,new ah,new nh,new Jd,new ch,new uh,new hh].forEach(e=>{this.registerTagMapper(e)})}mapTag(e,t,n){if(this.tagMappers[e])return this.tagMappers[e].mapGenericTag(t,n);throw new vd(`No generic tag mapper defined for tag-format: ${e}`)}registerTagMapper(e){for(const t of e.tagTypes)this.tagMappers[t]=e}}const ph=ku("music-metadata:collector"),fh=["matroska","APEv2","vorbis","ID3v2.4","ID3v2.3","ID3v2.2","exif","asf","iTunes","AIFF","ID3v1"];class gh{constructor(e){this.format={tagTypes:[],trackInfo:[]},this.native={},this.common={track:{no:null,of:null},disk:{no:null,of:null},movementIndex:{no:null,of:null}},this.quality={warnings:[]},this.commonOrigin={},this.originPriority={},this.tagMapper=new mh,this.opts=e;let t=1;for(const n of fh)this.originPriority[n]=t++;this.originPriority.artificial=500,this.originPriority.id3v1=600}hasAny(){return Object.keys(this.native).length>0}addStreamInfo(e){ph(`streamInfo: type=${e.type?bd[e.type]:"?"}, codec=${e.codecName}`),this.format.trackInfo.push(e)}setFormat(e,t){ph(`format: ${e} = ${t}`),this.format[e]=t,this.opts?.observer&&this.opts.observer({metadata:this,tag:{type:"format",id:e,value:t}})}setAudioOnly(){this.setFormat("hasAudio",!0),this.setFormat("hasVideo",!1)}async addTag(e,t,n){ph(`tag ${e}.${t} = ${n}`),this.native[e]||(this.format.tagTypes.push(e),this.native[e]=[]),this.native[e].push({id:t,value:n}),await this.toCommon(e,t,n)}addWarning(e){this.quality.warnings.push({message:e})}async postMap(e,t){switch(t.id){case"artist":if(this.commonOrigin.artist===this.originPriority[e])return this.postMap("artificial",{id:"artists",value:t.value});this.common.artists||this.setGenericTag("artificial",{id:"artists",value:t.value});break;case"artists":if(!(this.common.artist&&this.commonOrigin.artist!==this.originPriority.artificial||this.common.artists&&-1!==this.common.artists.indexOf(t.value))){const e=function(e){if(e.length>2)return`${e.slice(0,e.length-1).join(", ")} & ${e[e.length-1]}`;return e.join(" & ")}((this.common.artists||[]).concat([t.value])),n={id:"artist",value:e};this.setGenericTag("artificial",n)}break;case"picture":return this.postFixPicture(t.value).then(n=>{null!==n&&(t.value=n,this.setGenericTag(e,t))});case"totaltracks":return void(this.common.track.of=Hd.toIntOrNull(t.value));case"totaldiscs":return void(this.common.disk.of=Hd.toIntOrNull(t.value));case"movementTotal":return void(this.common.movementIndex.of=Hd.toIntOrNull(t.value));case"track":case"disk":case"movementIndex":{const e=this.common[t.id].of;return this.common[t.id]=Hd.normalizeTrack(t.value),void(this.common[t.id].of=null!=e?e:this.common[t.id].of)}case"bpm":case"year":case"originalyear":t.value=Number.parseInt(t.value,10);break;case"date":{const e=Number.parseInt(t.value.substr(0,4),10);Number.isNaN(e)||(this.common.year=e);break}case"discogs_label_id":case"discogs_release_id":case"discogs_master_release_id":case"discogs_artist_id":case"discogs_votes":t.value="string"==typeof t.value?Number.parseInt(t.value,10):t.value;break;case"replaygain_track_gain":case"replaygain_track_peak":case"replaygain_album_gain":case"replaygain_album_peak":t.value=function(e){const t=e.split(" ").map(e=>e.trim().toLowerCase());if(t.length>=1){const e=Number.parseFloat(t[0]);return 2===t.length&&"db"===t[1]?{dB:e,ratio:(r=e,10**(r/10))}:{dB:(n=e,10*Math.log10(n)),ratio:e}}var n,r}(t.value);break;case"replaygain_track_minmax":t.value=t.value.split(",").map(e=>Number.parseInt(e,10));break;case"replaygain_undo":{const e=t.value.split(",").map(e=>Number.parseInt(e,10));t.value={leftChannel:e[0],rightChannel:e[1]};break}case"gapless":case"compilation":case"podcast":case"showMovement":t.value="1"===t.value||1===t.value;break;case"isrc":{const e=this.common[t.id];if(e&&-1!==e.indexOf(t.value))return;break}case"comment":"string"==typeof t.value&&(t.value={text:t.value}),"iTunPGAP"===t.value.descriptor&&this.setGenericTag(e,{id:"gapless",value:"1"===t.value.text});break;case"lyrics":"string"==typeof t.value&&(t.value=function(e){const t=e.split("\n"),n=[],r=/\[(\d{2}):(\d{2})\.(\d{2,3})\]/;for(const s of t){const e=s.match(r);if(e){const t=Number.parseInt(e[1],10),i=Number.parseInt(e[2],10),a=e[3];let o;o=3===a.length?Number.parseInt(a,10):10*Number.parseInt(a,10);const c=1e3*(60*t+i)+o,l=s.replace(r,"").trim();n.push({timestamp:c,text:l})}}return{contentType:Rd,timeStampFormat:Md,syncText:n}}(t.value))}null!==t.value&&this.setGenericTag(e,t)}toCommonMetadata(){return{format:this.format,native:this.native,quality:this.quality,common:this.common}}async postFixPicture(e){if(e.data&&e.data.length>0){if(!e.format){const t=await Ju(Uint8Array.from(e.data));if(!t)return null;e.format=t.mime}if(e.format=e.format.toLocaleLowerCase(),"image/jpg"===e.format)e.format="image/jpeg";return e}return this.addWarning("Empty picture tag found"),null}async toCommon(e,t,n){const r={id:t,value:n},s=this.tagMapper.mapTag(e,r,this);s&&await this.postMap(e,s)}setGenericTag(e,t){ph(`common.${t.id} = ${t.value}`);const n=this.commonOrigin[t.id]||1e3,r=this.originPriority[e];if(s=t.id,Wd[s]&&!Wd[s].multiple){if(!(r<=n))return ph(`Ignore native tag (singleton): ${e}.${t.id} = ${t.value}`);this.common[t.id]=t.value,this.commonOrigin[t.id]=r}else if(r===n)!function(e){return!Wd[e].multiple||Wd[e].unique||!1}(t.id)||-1===this.common[t.id].indexOf(t.value)?this.common[t.id].push(t.value):ph(`Ignore duplicate value: ${e}.${t.id} = ${t.value}`);else{if(!(r<n))return ph(`Ignore native tag (list): ${e}.${t.id} = ${t.value}`);this.common[t.id]=[t.value],this.commonOrigin[t.id]=r}var s;this.opts?.observer&&this.opts.observer({metadata:this,tag:{type:"common",id:t.id,value:t.value}})}}const bh=yh;function yh(e,t){const n=_h();return(yh=function(e,t){return n[e-=276]})(e,t)}!function(){const e=yh,t=_h();for(;;)try{if(343880===-parseInt(e(285))/1*(-parseInt(e(279))/2)+parseInt(e(288))/3*(-parseInt(e(306))/4)+parseInt(e(282))/5+-parseInt(e(327))/6*(-parseInt(e(300))/7)+parseInt(e(295))/8+parseInt(e(321))/9*(parseInt(e(278))/10)+parseInt(e(328))/11*(-parseInt(e(287))/12))break;t.push(t.shift())}catch(n){t.push(t.shift())}}();const wh=bh(314),kh=function(e,t){const n=bh;return new URL(e,t)[n(283)]},Th={};function _h(){const e=["vite:preloadError","load","hgrwK","cxdga","querySelector","27kOqeCp","HTfvJ","resolve",'[rel="stylesheet"]',"then","rel","6FVWkaH","858DgZgPX","Kmplm","rJObg","length","appendChild","jGLzw","all","1923910eoJcUw","8gcIsBq","payload","dispatchEvent","1266430xrltIc","href","map","127496zcSFVK","nonce","245148cLSdTO","90MJpPkx","dXgZR","getElementsByTagName","endsWith","TpTsA","TvvCu","addEventListener","3714784VggePW","Yqqeh","eYeAM","script","kekRA","2571947eYZfUU","stylesheet","VjUvV","reason","defaultPrevented","link","31316vCyQHO","error",'link[href="',"lfeqw",".css","catch","Unable to preload CSS for ","bjMYK","modulepreload","status"];return(_h=function(){return e})()}const vh=function(e,t,n){const r=bh,s={VjUvV:r(330),DWIha:function(e,t,n){return e(t,n)},GUZAK:r(310),TpTsA:r(324),dXgZR:function(e,t){return e>=t},yDhKr:function(e,t){return e===t},TvvCu:r(301),cxdga:r(305),vbyfm:r(286),ddwry:"vite:preloadError",bjMYK:function(e,t){return e!==t},hgrwK:"rejected",Kmplm:function(e,t){return e(t)},kekRA:function(e){return e()},jGLzw:function(e,t){return e&&t},HTfvJ:function(e,t){return e(t)}};let i=Promise[r(323)]();if(s[r(276)](!0,t)&&t[r(331)]>0){let e=function(e){const t=r;return Promise[t(277)](e[t(284)](e=>Promise[t(323)](e)[t(325)](e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};const a=document[r(290)](s[r(319)]),o=document[r(320)]("meta[property=csp-nonce]"),c=o?.[r(286)]||o?.getAttribute(r(286));i=s[r(322)](e,t[r(284)](e=>{const t=r,i={eYeAM:t(316),lfeqw:s[t(302)],Yqqeh:t(317)};if((e=s.DWIha(kh,e,n))in Th)return;Th[e]=!0;const o=e[t(291)](s.GUZAK),l=o?s[t(292)]:"";if(!!n)for(let n=a[t(331)]-1;s[t(289)](n,0);n--){const r=a[n];if(r[t(283)]===e&&(!o||s.yDhKr(r[t(326)],s[t(293)])))return}else if(document.querySelector(t(308)+e+'"]'+l))return;const u=document.createElement(s.cxdga);return u[t(326)]=o?"stylesheet":wh,o||(u.as=t(298)),u.crossOrigin="",u[t(283)]=e,c&&u.setAttribute(s.vbyfm,c),document.head[t(332)](u),o?new Promise((n,r)=>{const s=t;if(i[s(309)]==i[s(309)])u[s(294)](i[s(296)],n),u[s(294)](s(307),()=>r(new Error(s(312)+e)));else{const e=new _0x5b48a5(i[s(297)],{cancelable:!0});if(e.payload=_0x236d8c,_0x24594a[s(281)](e),!e[s(304)])throw _0x1ceb09}}):void 0}))}function a(e){const t=r,n=new Event(s.ddwry,{cancelable:!0});if(n[t(280)]=e,window.dispatchEvent(n),!n[t(304)])throw e}return i[r(325)](t=>{const n=r;for(const e of t||[])s[n(313)](e[n(315)],s[n(318)])||s[n(329)](a,e[n(303)]);return s[n(299)](e)[n(311)](a)})},Sh={parserType:"mpeg",extensions:[".mp2",".mp3",".m2a",".aac","aacp"],mimeTypes:["audio/mpeg","audio/mp3","audio/aacs","audio/aacp"],load:async()=>(await vh(async()=>{const{MpegParser:e}=await Promise.resolve().then(()=>OD);return{MpegParser:e}},void 0,import.meta.url)).MpegParser},Eh={parserType:"apev2",extensions:[".ape"],mimeTypes:["audio/ape","audio/monkeys-audio"],load:async()=>(await vh(async()=>{const{APEv2Parser:e}=await Promise.resolve().then(()=>sm);return{APEv2Parser:e}},void 0,import.meta.url)).APEv2Parser},Ch={parserType:"asf",extensions:[".asf"],mimeTypes:["audio/ms-wma","video/ms-wmv","audio/ms-asf","video/ms-asf","application/vnd.ms-asf"],load:async()=>(await vh(async()=>{const{AsfParser:e}=await Promise.resolve().then(()=>rF);return{AsfParser:e}},void 0,import.meta.url)).AsfParser},Ih={parserType:"dsdiff",extensions:[".dff"],mimeTypes:["audio/dsf","audio/dsd"],load:async()=>(await vh(async()=>{const{DsdiffParser:e}=await Promise.resolve().then(()=>oF);return{DsdiffParser:e}},void 0,import.meta.url)).DsdiffParser},xh={parserType:"aiff",extensions:[".aif","aiff","aifc"],mimeTypes:["audio/aiff","audio/aif","audio/aifc","application/aiff"],load:async()=>(await vh(async()=>{const{AIFFParser:e}=await Promise.resolve().then(()=>mF);return{AIFFParser:e}},void 0,import.meta.url)).AIFFParser},Ah={parserType:"dsf",extensions:[".dsf"],mimeTypes:["audio/dsf"],load:async()=>(await vh(async()=>{const{DsfParser:e}=await Promise.resolve().then(()=>wF);return{DsfParser:e}},void 0,import.meta.url)).DsfParser},Ph={parserType:"flac",extensions:[".flac"],mimeTypes:["audio/flac"],load:async()=>(await vh(async()=>{const{FlacParser:e}=await Promise.resolve().then(()=>UF);return{FlacParser:e}},void 0,import.meta.url)).FlacParser},Oh={parserType:"matroska",extensions:[".mka",".mkv",".mk3d",".mks","webm"],mimeTypes:["audio/matroska","video/matroska","audio/webm","video/webm"],load:async()=>(await vh(async()=>{const{MatroskaParser:e}=await Promise.resolve().then(()=>aL);return{MatroskaParser:e}},void 0,import.meta.url)).MatroskaParser},Nh={parserType:"mp4",extensions:[".mp4",".m4a",".m4b",".m4pa","m4v","m4r","3gp"],mimeTypes:["audio/mp4","audio/m4a","video/m4v","video/mp4"],load:async()=>(await vh(async()=>{const{MP4Parser:e}=await Promise.resolve().then(()=>WL);return{MP4Parser:e}},void 0,import.meta.url)).MP4Parser},Rh={parserType:"musepack",extensions:[".mpc"],mimeTypes:["audio/musepack"],load:async()=>(await vh(async()=>{const{MusepackParser:e}=await Promise.resolve().then(()=>sB);return{MusepackParser:e}},void 0,import.meta.url)).MusepackParser},Mh={parserType:"ogg",extensions:[".ogg",".ogv",".oga",".ogm",".ogx",".opus",".spx"],mimeTypes:["audio/ogg","audio/opus","audio/speex","video/ogg"],load:async()=>(await vh(async()=>{const{OggParser:e}=await Promise.resolve().then(()=>TB);return{OggParser:e}},void 0,import.meta.url)).OggParser},Dh={parserType:"wavpack",extensions:[".wv",".wvp"],mimeTypes:["audio/wavpack"],load:async()=>(await vh(async()=>{const{WavPackParser:e}=await Promise.resolve().then(()=>AB);return{WavPackParser:e}},void 0,import.meta.url)).WavPackParser},Fh={parserType:"riff",extensions:[".wav","wave",".bwf"],mimeTypes:["audio/vnd.wave","audio/wav","audio/wave"],load:async()=>(await vh(async()=>{const{WaveParser:e}=await Promise.resolve().then(()=>QB);return{WaveParser:e}},void 0,import.meta.url)).WaveParser},Lh=ku("music-metadata:parser:factory");class Bh{constructor(){this.parsers=[],[Ph,Sh,Eh,Nh,Oh,Fh,Mh,Ch,xh,Dh,Rh,Ah,Ih].forEach(e=>this.registerParser(e))}registerParser(e){this.parsers.push(e)}async parse(e,t,n){if(e.supportsRandomAccess()?(Lh("tokenizer supports random-access, scanning for appending headers"),await async function(e,t={}){let n=e.fileInfo.size;if(await async function(e){if(e.fileInfo.size>=128){const t=new Uint8Array(3),n=e.position;return await e.readBuffer(t,{position:e.fileInfo.size-128}),e.setPosition(n),"TAG"===new TextDecoder("latin1").decode(t)}return!1}(e)){n-=128;const t=await async function(e){const t=e.fileInfo.size;if(t>=143){const n=new Uint8Array(15),r=e.position;await e.readBuffer(n,{position:t-143}),e.setPosition(r);const s=new TextDecoder("latin1").decode(n);if(s.slice(6)===um)return Number.parseInt(s.slice(0,6),10)+15}return 0}(e);n-=t}t.apeHeader=await rm.findApeFooterOffset(e,n)}(e,n)):Lh("tokenizer does not support random-access, cannot scan for appending headers"),!t){const n=new Uint8Array(4100);if(e.fileInfo.mimeType&&(t=this.findLoaderForContentType(e.fileInfo.mimeType)),!t&&e.fileInfo.path&&(t=this.findLoaderForExtension(e.fileInfo.path)),!t){Lh("Guess parser on content..."),await e.peekBuffer(n,{mayBeLess:!0});const r=await Ju(n,{mpegOffsetTolerance:10});if(!r||!r.mime)throw new wd("Failed to determine audio format");if(Lh(`Guessed file type is mime=${r.mime}, extension=${r.ext}`),!(t=this.findLoaderForContentType(r.mime)))throw new kd(`Guessed MIME-type not supported: ${r.mime}`)}}Lh(`Loading ${t.parserType} parser...`);const r=new gh(n),s=new(await t.load())(r,e,n??{});return Lh(`Parser ${t.parserType} loaded`),await s.parse(),r.format.trackInfo&&(void 0===r.format.hasAudio&&r.setFormat("hasAudio",!!r.format.trackInfo.find(e=>e.type===dd)),void 0===r.format.hasVideo&&r.setFormat("hasVideo",!!r.format.trackInfo.find(e=>e.type===ud))),r.toCommonMetadata()}findLoaderForExtension(e){if(!e)return;const t=function(e){const t=e.lastIndexOf(".");return-1===t?"":e.slice(t)}(e).toLocaleLowerCase()||e;return this.parsers.find(e=>-1!==e.extensions.indexOf(t))}findLoaderForContentType(e){let t;if(!e)return;try{t=function(e){const t=id.parse(e),n=cd.parse(t.type);return{type:n.type,subtype:n.subtype,suffix:n.suffix,parameters:t.parameters}}(e)}catch(r){return void Lh(`Invalid HTTP Content-Type header value: ${e}`)}const n=0===t.subtype.indexOf("x-")?t.subtype.substring(2):t.subtype;return this.parsers.find(e=>e.mimeTypes.find(e=>-1!==e.indexOf(`${t.type}/${n}`)))}getSupportedMimeTypes(){const e=new Set;return this.parsers.forEach(t=>{t.mimeTypes.forEach(t=>{e.add(t),e.add(t.replace("/","/x-"))})}),Array.from(e)}}class zh{constructor(e,t,n){this.metadata=e,this.tokenizer=t,this.options=n}}const Uh=/^[\x21-\x7e©][\x20-\x7e\x00()]{3}/,$h={len:4,get:(e,t)=>{const n=Vu(e.slice(t,t+$h.len),"latin1");if(!n.match(Uh))throw new _d(`FourCC contains invalid characters: ${function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=Number(e.charCodeAt(n)).toString(16);t.push(1===r.length?`0${r}`:r)}return t.join(" ")}(n)} "${n}"`);return n},put:(e,t,n)=>{const r=(ju(s=n),Wu.encode(s));var s;if(4!==r.length)throw new vd("Invalid length");return e.set(r,t),t+4}},Vh=0,jh=1,Wh=2,Hh=3,qh={len:52,get:(e,t)=>({ID:$h.get(e,t),version:dl.get(e,t+4)/1e3,descriptorBytes:dl.get(e,t+8),headerBytes:dl.get(e,t+12),seekTableBytes:dl.get(e,t+16),headerDataBytes:dl.get(e,t+20),apeFrameDataBytes:dl.get(e,t+24),apeFrameDataBytesHigh:dl.get(e,t+28),terminatingDataBytes:dl.get(e,t+32),fileMD5:new Nl(16).get(e,t+36)})},Xh={len:24,get:(e,t)=>({compressionLevel:ol.get(e,t),formatFlags:ol.get(e,t+2),blocksPerFrame:dl.get(e,t+4),finalFrameBlocks:dl.get(e,t+8),totalFrames:dl.get(e,t+12),bitsPerSample:ol.get(e,t+16),channel:ol.get(e,t+18),sampleRate:dl.get(e,t+20)})},Gh={len:32,get:(e,t)=>({ID:new Rl(8,"ascii").get(e,t),version:dl.get(e,t+8),size:dl.get(e,t+12),fields:dl.get(e,t+16),flags:Yh(dl.get(e,t+20))})},Kh={len:8,get:(e,t)=>({size:dl.get(e,t),flags:Yh(dl.get(e,t+4))})};function Yh(e){return{containsHeader:Qh(e,31),containsFooter:Qh(e,30),isHeader:Qh(e,29),readOnly:Qh(e,0),dataType:(6&e)>>1}}function Qh(e,t){return!!(e&1<<t)}const Jh=ku("music-metadata:parser:APEv2"),Zh="APEv2",em="APETAGEX";class tm extends(Sd("APEv2")){}function nm(e,t,n){return new rm(e,t,n).tryParseApeHeader()}class rm extends zh{constructor(){super(...arguments),this.ape={}}static calculateDuration(e){let t=e.totalFrames>1?e.blocksPerFrame*(e.totalFrames-1):0;return t+=e.finalFrameBlocks,t/e.sampleRate}static async findApeFooterOffset(e,t){const n=new Uint8Array(Gh.len),r=e.position;if(t<=Gh.len)Jh(`Offset is too small to read APE footer: offset=${t}`);else if(t>Gh.len){await e.readBuffer(n,{position:t-Gh.len}),e.setPosition(r);const s=Gh.get(n,0);if("APETAGEX"===s.ID)return s.flags.isHeader?Jh("APE Header found at offset="+(t-Gh.len)):(Jh("APE Footer found at offset="+(t-Gh.len)),t-=s.size),{footer:s,offset:t}}}static parseTagFooter(e,t,n){const r=Gh.get(t,t.length-Gh.len);if(r.ID!==em)throw new tm("Unexpected APEv2 Footer ID preamble value");tl(t);return new rm(e,tl(t),n).parseTags(r)}async tryParseApeHeader(){if(this.tokenizer.fileInfo.size&&this.tokenizer.fileInfo.size-this.tokenizer.position<Gh.len)return void Jh("No APEv2 header found, end-of-file reached");const e=await this.tokenizer.peekToken(Gh);if(e.ID===em)return await this.tokenizer.ignore(Gh.len),this.parseTags(e);if(Jh(`APEv2 header not found at offset=${this.tokenizer.position}`),this.tokenizer.fileInfo.size){const e=this.tokenizer.fileInfo.size-this.tokenizer.position,t=new Uint8Array(e);return await this.tokenizer.readBuffer(t),rm.parseTagFooter(this.metadata,t,this.options)}}async parse(){const e=await this.tokenizer.readToken(qh);if("MAC "!==e.ID)throw new tm("Unexpected descriptor ID");this.ape.descriptor=e;const t=e.descriptorBytes-qh.len,n=await(t>0?this.parseDescriptorExpansion(t):this.parseHeader());return this.metadata.setAudioOnly(),await this.tokenizer.ignore(n.forwardBytes),this.tryParseApeHeader()}async parseTags(e){const t=new Uint8Array(256);let n=e.size-Gh.len;Jh(`Parse APE tags at offset=${this.tokenizer.position}, size=${n}`);for(let r=0;r<e.fields;r++){if(n<Kh.len){this.metadata.addWarning(`APEv2 Tag-header: ${e.fields-r} items remaining, but no more tag data to read.`);break}const s=await this.tokenizer.readToken(Kh);n-=Kh.len+s.size,await this.tokenizer.peekBuffer(t,{length:Math.min(t.length,n)});let i=Cd(t,0,t.length);const a=await this.tokenizer.readToken(new Rl(i,"ascii"));switch(await this.tokenizer.ignore(1),n-=a.length+1,s.flags.dataType){case Vh:{const e=(await this.tokenizer.readToken(new Rl(s.size,"utf8"))).split(/\x00/g);await Promise.all(e.map(e=>this.metadata.addTag(Zh,a,e)));break}case jh:if(this.options.skipCovers)await this.tokenizer.ignore(s.size);else{const e=new Uint8Array(s.size);await this.tokenizer.readBuffer(e),i=Cd(e,0,e.length);const t=Vu(e.slice(0,i)),n=e.slice(i+1);await this.metadata.addTag(Zh,a,{description:t,data:n})}break;case Wh:Jh(`Ignore external info ${a}`),await this.tokenizer.ignore(s.size);break;case Hh:Jh(`Ignore external info ${a}`),this.metadata.addWarning(`APEv2 header declares a reserved datatype for "${a}"`),await this.tokenizer.ignore(s.size)}}}async parseDescriptorExpansion(e){return await this.tokenizer.ignore(e),this.parseHeader()}async parseHeader(){const e=await this.tokenizer.readToken(Xh);if(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("container","Monkey's Audio"),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("numberOfChannels",e.channel),this.metadata.setFormat("duration",rm.calculateDuration(e)),!this.ape.descriptor)throw new tm("Missing APE descriptor");return{forwardBytes:this.ape.descriptor.seekTableBytes+this.ape.descriptor.headerDataBytes+this.ape.descriptor.apeFrameDataBytes+this.ape.descriptor.terminatingDataBytes}}}const sm=Object.freeze(Object.defineProperty({__proto__:null,APEv2Parser:rm,ApeContentError:tm,tryParseApeHeader:nm},Symbol.toStringTag,{value:"Module"})),im=ku("music-metadata:parser:ID3v1"),am=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alt. Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast-Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"],om={len:128,get:(e,t)=>{const n=new cm(3).get(e,t);return"TAG"===n?{header:n,title:new cm(30).get(e,t+3),artist:new cm(30).get(e,t+33),album:new cm(30).get(e,t+63),year:new cm(4).get(e,t+93),comment:new cm(28).get(e,t+97),zeroByte:al.get(e,t+127),track:al.get(e,t+126),genre:al.get(e,t+127)}:null}};class cm{constructor(e){this.len=e,this.stringType=new Rl(e,"latin1")}get(e,t){let n=this.stringType.get(e,t);return n=Id(n),n=n.trim(),n.length>0?n:void 0}}class lm extends zh{constructor(e,t,n){super(e,t,n),this.apeHeader=n.apeHeader}static getGenre(e){if(e<am.length)return am[e]}async parse(){if(!this.tokenizer.fileInfo.size)return void im("Skip checking for ID3v1 because the file-size is unknown");if(this.apeHeader){this.tokenizer.ignore(this.apeHeader.offset-this.tokenizer.position);const e=new rm(this.metadata,this.tokenizer,this.options);await e.parseTags(this.apeHeader.footer)}const e=this.tokenizer.fileInfo.size-om.len;if(this.tokenizer.position>e)return void im("Already consumed the last 128 bytes");const t=await this.tokenizer.readToken(om,e);if(t){im("ID3v1 header found at: pos=%s",this.tokenizer.fileInfo.size-om.len);const e=["title","artist","album","comment","track","year"];for(const r of e)t[r]&&""!==t[r]&&await this.addTag(r,t[r]);const n=lm.getGenre(t.genre);n&&await this.addTag("genre",n)}else im("ID3v1 header not found at: pos=%s",this.tokenizer.fileInfo.size-om.len)}async addTag(e,t){await this.metadata.addTag("ID3v1",e,t)}}const um="LYRICS200";async function dm(e,t,n={}){return function(e,t){return(new Bh).parse(e,void 0,t)}(tl(e,{fileInfo:"string"==typeof t?{mimeType:t}:t}),n)}function hm(e){return e?e.reduce((e,t)=>t.name&&t.name.toLowerCase()in["front","cover","cover (front)"]?t:e):null}var mm,pm,fm,gm,bm,ym;(pm=mm||(mm={})).STRING="string",pm.NUMBER="number",pm.INTEGER="integer",pm.BOOLEAN="boolean",pm.ARRAY="array",pm.OBJECT="object",(gm=fm||(fm={})).LANGUAGE_UNSPECIFIED="language_unspecified",gm.PYTHON="python",(ym=bm||(bm={})).OUTCOME_UNSPECIFIED="outcome_unspecified",ym.OUTCOME_OK="outcome_ok",ym.OUTCOME_FAILED="outcome_failed",ym.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";const wm=["user","model","function","system"];var km,Tm,_m,vm,Sm,Em,Cm,Im,xm,Am,Pm,Om,Nm,Rm,Mm,Dm;(Tm=km||(km={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",Tm.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",Tm.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",Tm.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",Tm.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",Tm.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(vm=_m||(_m={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",vm.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",vm.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",vm.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",vm.BLOCK_NONE="BLOCK_NONE",(Em=Sm||(Sm={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",Em.NEGLIGIBLE="NEGLIGIBLE",Em.LOW="LOW",Em.MEDIUM="MEDIUM",Em.HIGH="HIGH",(Im=Cm||(Cm={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",Im.SAFETY="SAFETY",Im.OTHER="OTHER",(Am=xm||(xm={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",Am.STOP="STOP",Am.MAX_TOKENS="MAX_TOKENS",Am.SAFETY="SAFETY",Am.RECITATION="RECITATION",Am.LANGUAGE="LANGUAGE",Am.BLOCKLIST="BLOCKLIST",Am.PROHIBITED_CONTENT="PROHIBITED_CONTENT",Am.SPII="SPII",Am.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",Am.OTHER="OTHER",(Om=Pm||(Pm={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",Om.RETRIEVAL_QUERY="RETRIEVAL_QUERY",Om.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",Om.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",Om.CLASSIFICATION="CLASSIFICATION",Om.CLUSTERING="CLUSTERING",(Rm=Nm||(Nm={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",Rm.AUTO="AUTO",Rm.ANY="ANY",Rm.NONE="NONE",(Dm=Mm||(Mm={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",Dm.MODE_DYNAMIC="MODE_DYNAMIC";class Fm extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Lm extends Fm{constructor(e,t){super(e),this.response=t}}class Bm extends Fm{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class zm extends Fm{}class Um extends Fm{}var $m,Vm;(Vm=$m||($m={})).GENERATE_CONTENT="generateContent",Vm.STREAM_GENERATE_CONTENT="streamGenerateContent",Vm.COUNT_TOKENS="countTokens",Vm.EMBED_CONTENT="embedContent",Vm.BATCH_EMBED_CONTENTS="batchEmbedContents";class jm{constructor(e,t,n,r,s){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=s}toString(){var e,t;const n=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta";let r=`${(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com"}/${n}/${this.model}:${this.task}`;return this.stream&&(r+="?alt=sse"),r}}async function Wm(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",function(e){const t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.24.1"),t.join(" ")}(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let r=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(JB){throw new zm(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${JB.message}`)}for(const[e,t]of r.entries()){if("x-goog-api-key"===e)throw new zm(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new zm(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function Hm(e,t,n,r,s,i={},a=fetch){const{url:o,fetchOptions:c}=await async function(e,t,n,r,s,i){const a=new jm(e,t,n,r,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},qm(i)),{method:"POST",headers:await Wm(a),body:s})}}(e,t,n,r,s,i);return async function(e,t,n=fetch){let r;try{r=await n(e,t)}catch(JB){!function(e,t){let n=e;"AbortError"===n.name?(n=new Um(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof Bm||e instanceof zm||(n=new Fm(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack);throw n}(JB,e)}r.ok||await async function(e,t){let n,r="";try{const t=await e.json();r=t.error.message,t.error.details&&(r+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(JB){}throw new Bm(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${r}`,e.status,e.statusText,n)}(r,e);return r}(o,c,a)}function qm(e){const t={};if(void 0!==(null==e?void 0:e.signal)||(null==e?void 0:e.timeout)>=0){const n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}function Xm(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length,Ym(e.candidates[0]))throw new Lm(`${Qm(e)}`,e);return function(e){var t,n,r,s;const i=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(const a of null===(s=null===(r=e.candidates)||void 0===r?void 0:r[0].content)||void 0===s?void 0:s.parts)a.text&&i.push(a.text),a.executableCode&&i.push("\n```"+a.executableCode.language+"\n"+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&i.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}(e)}if(e.promptFeedback)throw new Lm(`Text not available. ${Qm(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length,Ym(e.candidates[0]))throw new Lm(`${Qm(e)}`,e);return Gm(e)[0]}if(e.promptFeedback)throw new Lm(`Function call not available. ${Qm(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length,Ym(e.candidates[0]))throw new Lm(`${Qm(e)}`,e);return Gm(e)}if(e.promptFeedback)throw new Lm(`Function call not available. ${Qm(e)}`,e)},e}function Gm(e){var t,n,r,s;const i=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(const a of null===(s=null===(r=e.candidates)||void 0===r?void 0:r[0].content)||void 0===s?void 0:s.parts)a.functionCall&&i.push(a.functionCall);return i.length>0?i:void 0}const Km=[xm.RECITATION,xm.SAFETY,xm.LANGUAGE];function Ym(e){return!!e.finishReason&&Km.includes(e.finishReason)}function Qm(e){var t,n,r;let s="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(r=e.candidates)||void 0===r?void 0:r[0]){const t=e.candidates[0];Ym(t)&&(s+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(s+=`: ${t.finishMessage}`))}}else s+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(s+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(s+=`: ${e.promptFeedback.blockReasonMessage}`);return s}function Jm(e){return this instanceof Jm?(this.v=e,this):new Jm(e)}function Zm(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,s=n.apply(e,t||[]),i=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){s[e]&&(r[e]=function(t){return new Promise(function(n,r){i.push([e,t,n,r])>1||o(e,t)})})}function o(e,t){try{(n=s[e](t)).value instanceof Jm?Promise.resolve(n.value.v).then(c,l):u(i[0][2],n)}catch(JB){u(i[0][3],JB)}var n}function c(e){o("next",e)}function l(e){o("throw",e)}function u(e,t){e(t),i.shift(),i.length&&o(i[0][0],i[0][1])}}"function"==typeof SuppressedError&&SuppressedError;const ep=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function tp(e){const t=function(e){const t=e.getReader();return new ReadableStream({start(e){let n="";return r();function r(){return t.read().then(({value:t,done:s})=>{if(s)return n.trim()?void e.error(new Fm("Failed to parse stream")):void e.close();n+=t;let i,a=n.match(ep);for(;a;){try{i=JSON.parse(a[1])}catch(JB){return void e.error(new Fm(`Error parsing JSON response: "${a[1]}"`))}e.enqueue(i),n=n.substring(a[0].length),a=n.match(ep)}return r()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new Um("Request aborted when reading from the stream"):new Fm("Error reading from the stream"),t})}}})}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[n,r]=t.tee();return{stream:rp(n),response:np(r)}}async function np(e){const t=[],n=e.getReader();for(;;){const{done:e,value:r}=await n.read();if(e)return Xm(sp(t));t.push(r)}}function rp(e){return Zm(this,arguments,function*(){const t=e.getReader();for(;;){const{value:e,done:n}=yield Jm(t.read());if(n)break;yield yield Jm(Xm(e))}})}function sp(e){const t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(const r of e){if(r.candidates){let e=0;for(const t of r.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=t.citationMetadata,n.candidates[e].groundingMetadata=t.groundingMetadata,n.candidates[e].finishReason=t.finishReason,n.candidates[e].finishMessage=t.finishMessage,n.candidates[e].safetyRatings=t.safetyRatings,t.content&&t.content.parts){n.candidates[e].content||(n.candidates[e].content={role:t.content.role||"user",parts:[]});const r={};for(const s of t.content.parts)s.text&&(r.text=s.text),s.functionCall&&(r.functionCall=s.functionCall),s.executableCode&&(r.executableCode=s.executableCode),s.codeExecutionResult&&(r.codeExecutionResult=s.codeExecutionResult),0===Object.keys(r).length&&(r.text=""),n.candidates[e].content.parts.push(r)}e++}r.usageMetadata&&(n.usageMetadata=r.usageMetadata)}return n}async function ip(e,t,n,r){return tp(await Hm(t,$m.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),r))}async function ap(e,t,n,r){const s=await Hm(t,$m.GENERATE_CONTENT,e,!1,JSON.stringify(n),r);return{response:Xm(await s.json())}}function op(e){if(null!=e)return"string"==typeof e?{role:"system",parts:[{text:e}]}:e.text?{role:"system",parts:[e]}:e.parts?e.role?e:{role:"system",parts:e.parts}:void 0}function cp(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(const n of e)"string"==typeof n?t.push({text:n}):t.push(n);return function(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,s=!1;for(const i of e)"functionResponse"in i?(n.parts.push(i),s=!0):(t.parts.push(i),r=!0);if(r&&s)throw new Fm("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new Fm("No content is provided for sending chat message.");if(r)return t;return n}(t)}function lp(e){let t;if(e.contents)t=e;else{t={contents:[cp(e)]}}return e.systemInstruction&&(t.systemInstruction=op(e.systemInstruction)),t}const up=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],dp={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function hp(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;const n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;if(void 0===n)return!1;if(void 0===n.parts||0===n.parts.length)return!1;for(const r of n.parts){if(void 0===r||0===Object.keys(r).length)return!1;if(void 0!==r.text&&""===r.text)return!1}return!0}const mp="SILENT_ERROR";class pp{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(!function(e){let t=!1;for(const n of e){const{role:e,parts:r}=n;if(!t&&"user"!==e)throw new Fm(`First content should be with role 'user', got ${e}`);if(!wm.includes(e))throw new Fm(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(wm)}`);if(!Array.isArray(r))throw new Fm("Content should have 'parts' property with an array of Parts");if(0===r.length)throw new Fm("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const t of r)for(const e of up)e in t&&(s[e]+=1);const i=dp[e];for(const t of up)if(!i.includes(t)&&s[t]>0)throw new Fm(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,s,i,a,o;await this._sendPromise;const c=cp(e),l={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(r=this.params)||void 0===r?void 0:r.generationConfig,tools:null===(s=this.params)||void 0===s?void 0:s.tools,toolConfig:null===(i=this.params)||void 0===i?void 0:i.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(o=this.params)||void 0===o?void 0:o.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t);let d;return this._sendPromise=this._sendPromise.then(()=>ap(this._apiKey,this.model,l,u)).then(e=>{var t;if(hp(e.response)){this._history.push(c);const n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{Qm(e.response)}d=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,d}async sendMessageStream(e,t={}){var n,r,s,i,a,o;await this._sendPromise;const c=cp(e),l={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(r=this.params)||void 0===r?void 0:r.generationConfig,tools:null===(s=this.params)||void 0===s?void 0:s.tools,toolConfig:null===(i=this.params)||void 0===i?void 0:i.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(o=this.params)||void 0===o?void 0:o.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t),d=ip(this._apiKey,this.model,l,u);return this._sendPromise=this._sendPromise.then(()=>d).catch(e=>{throw new Error(mp)}).then(e=>e.response).then(e=>{if(hp(e)){this._history.push(c);const t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{Qm(e)}}).catch(e=>{e.message}),d}}class fp{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=op(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=lp(e),s=Object.assign(Object.assign({},this._requestOptions),t);return ap(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},r),s)}async generateContentStream(e,t={}){var n;const r=lp(e),s=Object.assign(Object.assign({},this._requestOptions),t);return ip(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},r),s)}startChat(e){var t;return new pp(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=function(e,t){var n;let r={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(n=null==t?void 0:t.cachedContent)||void 0===n?void 0:n.name,contents:[]};const s=null!=e.generateContentRequest;if(e.contents){if(s)throw new zm("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=e.contents}else if(s)r=Object.assign(Object.assign({},r),e.generateContentRequest);else{const t=cp(e);r.contents=[t]}return{generateContentRequest:r}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,r){return(await Hm(t,$m.COUNT_TOKENS,e,!1,JSON.stringify(n),r)).json()}(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=function(e){if("string"==typeof e||Array.isArray(e))return{content:cp(e)};return e}(e),r=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,r){return(await Hm(t,$m.EMBED_CONTENT,e,!1,JSON.stringify(n),r)).json()}(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,r){const s=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await Hm(t,$m.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:s}),r)).json()}(this.apiKey,this.model,e,n)}}class gp{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new Fm("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new fp(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new zm("Cached content must contain a `name` field.");if(!e.model)throw new zm("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const i of r)if((null==t?void 0:t[i])&&e[i]&&(null==t?void 0:t[i])!==e[i]){if("model"===i){if((t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue}throw new zm(`Different value for "${i}" specified in modelParams (${t[i]}) and cachedContent (${e[i]})`)}const s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new fp(this.apiKey,s,n)}}var bp={};function yp(e,t){}const wp={};const kp="undefined"!=typeof window;let Tp,_p;{const e=kp&&window.performance;e&&e.mark&&e.measure&&e.clearMarks&&e.clearMeasures&&(Tp=t=>{e.mark(t)},_p=(t,n,r)=>{e.measure(t,n,r),e.clearMarks(n),e.clearMarks(r)})}const vp=/\{([0-9a-zA-Z]+)\}/g;function Sp(e,...t){return 1===t.length&&Up(t[0])&&(t=t[0]),t&&t.hasOwnProperty||(t={}),e.replace(vp,(e,n)=>t.hasOwnProperty(n)?t[n]:"")}const Ep=e=>JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),Cp=e=>"number"==typeof e&&isFinite(e),Ip=e=>"[object RegExp]"===Vp(e),xp=e=>jp(e)&&0===Object.keys(e).length,Ap=Object.assign,Pp=Object.create,Op=(e=null)=>Pp(e);function Np(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;").replace(/=/g,"&#x3D;")}function Rp(e){return e.replace(/&(?![a-zA-Z0-9#]{2,6};)/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}const Mp=Object.prototype.hasOwnProperty;function Dp(e,t){return Mp.call(e,t)}const Fp=Array.isArray,Lp=e=>"function"==typeof e,Bp=e=>"string"==typeof e,zp=e=>"boolean"==typeof e,Up=e=>null!==e&&"object"==typeof e,$p=Object.prototype.toString,Vp=e=>$p.call(e),jp=e=>"[object Object]"===Vp(e);function Wp(e,t=""){return e.reduce((e,n,r)=>0===r?e+n:e+t+n,"")}function Hp(e,t,n){return{start:e,end:t}}const qp={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14,UNHANDLED_CODEGEN_NODE_TYPE:15,UNHANDLED_MINIFIER_NODE_TYPE:16},Xp={[qp.EXPECTED_TOKEN]:"Expected token: '{0}'",[qp.INVALID_TOKEN_IN_PLACEHOLDER]:"Invalid token in placeholder: '{0}'",[qp.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER]:"Unterminated single quote in placeholder",[qp.UNKNOWN_ESCAPE_SEQUENCE]:"Unknown escape sequence: \\{0}",[qp.INVALID_UNICODE_ESCAPE_SEQUENCE]:"Invalid unicode escape sequence: {0}",[qp.UNBALANCED_CLOSING_BRACE]:"Unbalanced closing brace",[qp.UNTERMINATED_CLOSING_BRACE]:"Unterminated closing brace",[qp.EMPTY_PLACEHOLDER]:"Empty placeholder",[qp.NOT_ALLOW_NEST_PLACEHOLDER]:"Not allowed nest placeholder",[qp.INVALID_LINKED_FORMAT]:"Invalid linked format",[qp.MUST_HAVE_MESSAGES_IN_PLURAL]:"Plural must have messages",[qp.UNEXPECTED_EMPTY_LINKED_MODIFIER]:"Unexpected empty linked modifier",[qp.UNEXPECTED_EMPTY_LINKED_KEY]:"Unexpected empty linked key",[qp.UNEXPECTED_LEXICAL_ANALYSIS]:"Unexpected lexical analysis in token: '{0}'",[qp.UNHANDLED_CODEGEN_NODE_TYPE]:"unhandled codegen node type: '{0}'",[qp.UNHANDLED_MINIFIER_NODE_TYPE]:"unhandled mimifier node type: '{0}'"};function Gp(e,t,n={}){const{domain:r,messages:s,args:i}=n,a=Sp((s||Xp)[e]||"",...i||[]),o=new SyntaxError(String(a));return o.code=e,t&&(o.location=t),o.domain=r,o}function Kp(e){throw e}const Yp=/<\/?[\w\s="/.':;#-\/]+>/,Qp=" ",Jp="\n",Zp=String.fromCharCode(8232),ef=String.fromCharCode(8233);function tf(e){const t=e;let n=0,r=1,s=1,i=0;const a=e=>"\r"===t[e]&&t[e+1]===Jp,o=e=>t[e]===ef,c=e=>t[e]===Zp,l=e=>a(e)||(e=>t[e]===Jp)(e)||o(e)||c(e),u=e=>a(e)||o(e)||c(e)?Jp:t[e];function d(){return i=0,l(n)&&(r++,s=0),a(n)&&n++,n++,s++,t[n]}return{index:()=>n,line:()=>r,column:()=>s,peekOffset:()=>i,charAt:u,currentChar:()=>u(n),currentPeek:()=>u(n+i),next:d,peek:function(){return a(n+i)&&i++,i++,t[n+i]},reset:function(){n=0,r=1,s=1,i=0},resetPeek:function(e=0){i=e},skipToPeek:function(){const e=n+i;for(;e!==n;)d();i=0}}}const nf=void 0;function rf(e,t={}){const n=!1!==t.location,r=tf(e),s=()=>r.index(),i=()=>{return e=r.line(),t=r.column(),n=r.index(),{line:e,column:t,offset:n};var e,t,n},a=i(),o=s(),c={currentType:13,offset:o,startLoc:a,endLoc:a,lastType:13,lastOffset:o,lastStartLoc:a,lastEndLoc:a,braceNest:0,inLinked:!1,text:""},l=()=>c,{onError:u}=t;function d(e,t,r,...s){const i=l();if(t.column+=r,t.offset+=r,u){const r=Gp(e,n?Hp(i.startLoc,t):null,{domain:"tokenizer",args:s});u(r)}}function h(e,t,r){e.endLoc=i(),e.currentType=t;const s={type:t};return n&&(s.loc=Hp(e.startLoc,e.endLoc)),null!=r&&(s.value=r),s}const m=e=>h(e,13);function p(e,t){return e.currentChar()===t?(e.next(),t):(d(qp.EXPECTED_TOKEN,i(),0,t),"")}function f(e){let t="";for(;e.currentPeek()===Qp||e.currentPeek()===Jp;)t+=e.currentPeek(),e.peek();return t}function g(e){const t=f(e);return e.skipToPeek(),t}function b(e){if(e===nf)return!1;const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||95===t}function y(e,t){const{currentType:n}=t;if(2!==n)return!1;f(e);const r=function(e){if(e===nf)return!1;const t=e.charCodeAt(0);return t>=48&&t<=57}("-"===e.currentPeek()?e.peek():e.currentPeek());return e.resetPeek(),r}function w(e){f(e);const t="|"===e.currentPeek();return e.resetPeek(),t}function k(e,t=!0){const n=(t=!1,r="")=>{const s=e.currentPeek();return"{"===s?t:"@"!==s&&s?"|"===s?!(r===Qp||r===Jp):s===Qp?(e.peek(),n(!0,Qp)):s!==Jp||(e.peek(),n(!0,Jp)):t},r=n();return t&&e.resetPeek(),r}function T(e,t){const n=e.currentChar();return n===nf?nf:t(n)?(e.next(),n):null}function _(e){const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||95===t||36===t}function v(e){return T(e,_)}function S(e){const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||95===t||36===t||45===t}function E(e){return T(e,S)}function C(e){const t=e.charCodeAt(0);return t>=48&&t<=57}function I(e){return T(e,C)}function x(e){const t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function A(e){return T(e,x)}function P(e){let t="",n="";for(;t=I(e);)n+=t;return n}function O(e){return"'"!==e&&e!==Jp}function N(e){const t=e.currentChar();switch(t){case"\\":case"'":return e.next(),`\\${t}`;case"u":return R(e,t,4);case"U":return R(e,t,6);default:return d(qp.UNKNOWN_ESCAPE_SEQUENCE,i(),0,t),""}}function R(e,t,n){p(e,t);let r="";for(let s=0;s<n;s++){const n=A(e);if(!n){d(qp.INVALID_UNICODE_ESCAPE_SEQUENCE,i(),0,`\\${t}${r}${e.currentChar()}`);break}r+=n}return`\\${t}${r}`}function M(e){return"{"!==e&&"}"!==e&&e!==Qp&&e!==Jp}function D(e){g(e);const t=p(e,"|");return g(e),t}function F(e,t){let n=null;switch(e.currentChar()){case"{":return t.braceNest>=1&&d(qp.NOT_ALLOW_NEST_PLACEHOLDER,i(),0),e.next(),n=h(t,2,"{"),g(e),t.braceNest++,n;case"}":return t.braceNest>0&&2===t.currentType&&d(qp.EMPTY_PLACEHOLDER,i(),0),e.next(),n=h(t,3,"}"),t.braceNest--,t.braceNest>0&&g(e),t.inLinked&&0===t.braceNest&&(t.inLinked=!1),n;case"@":return t.braceNest>0&&d(qp.UNTERMINATED_CLOSING_BRACE,i(),0),n=L(e,t)||m(t),t.braceNest=0,n;default:{let r=!0,s=!0,a=!0;if(w(e))return t.braceNest>0&&d(qp.UNTERMINATED_CLOSING_BRACE,i(),0),n=h(t,1,D(e)),t.braceNest=0,t.inLinked=!1,n;if(t.braceNest>0&&(4===t.currentType||5===t.currentType||6===t.currentType))return d(qp.UNTERMINATED_CLOSING_BRACE,i(),0),t.braceNest=0,B(e,t);if(r=function(e,t){const{currentType:n}=t;if(2!==n)return!1;f(e);const r=b(e.currentPeek());return e.resetPeek(),r}(e,t))return n=h(t,4,function(e){g(e);let t="",n="";for(;t=E(e);)n+=t;return e.currentChar()===nf&&d(qp.UNTERMINATED_CLOSING_BRACE,i(),0),n}(e)),g(e),n;if(s=y(e,t))return n=h(t,5,function(e){g(e);let t="";return"-"===e.currentChar()?(e.next(),t+=`-${P(e)}`):t+=P(e),e.currentChar()===nf&&d(qp.UNTERMINATED_CLOSING_BRACE,i(),0),t}(e)),g(e),n;if(a=function(e,t){const{currentType:n}=t;if(2!==n)return!1;f(e);const r="'"===e.currentPeek();return e.resetPeek(),r}(e,t))return n=h(t,6,function(e){g(e),p(e,"'");let t="",n="";for(;t=T(e,O);)n+="\\"===t?N(e):t;const r=e.currentChar();return r===Jp||r===nf?(d(qp.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER,i(),0),r===Jp&&(e.next(),p(e,"'")),n):(p(e,"'"),n)}(e)),g(e),n;if(!r&&!s&&!a)return n=h(t,12,function(e){g(e);let t="",n="";for(;t=T(e,M);)n+=t;return n}(e)),d(qp.INVALID_TOKEN_IN_PLACEHOLDER,i(),0,n.value),g(e),n;break}}return n}function L(e,t){const{currentType:n}=t;let r=null;const s=e.currentChar();switch(7!==n&&8!==n&&11!==n&&9!==n||s!==Jp&&s!==Qp||d(qp.INVALID_LINKED_FORMAT,i(),0),s){case"@":return e.next(),r=h(t,7,"@"),t.inLinked=!0,r;case".":return g(e),e.next(),h(t,8,".");case":":return g(e),e.next(),h(t,9,":");default:return w(e)?(r=h(t,1,D(e)),t.braceNest=0,t.inLinked=!1,r):function(e,t){const{currentType:n}=t;if(7!==n)return!1;f(e);const r="."===e.currentPeek();return e.resetPeek(),r}(e,t)||function(e,t){const{currentType:n}=t;if(7!==n&&11!==n)return!1;f(e);const r=":"===e.currentPeek();return e.resetPeek(),r}(e,t)?(g(e),L(e,t)):function(e,t){const{currentType:n}=t;if(8!==n)return!1;f(e);const r=b(e.currentPeek());return e.resetPeek(),r}(e,t)?(g(e),h(t,11,function(e){let t="",n="";for(;t=v(e);)n+=t;return n}(e))):function(e,t){const{currentType:n}=t;if(9!==n)return!1;const r=()=>{const t=e.currentPeek();return"{"===t?b(e.peek()):!("@"===t||"|"===t||":"===t||"."===t||t===Qp||!t)&&(t===Jp?(e.peek(),r()):k(e,!1))},s=r();return e.resetPeek(),s}(e,t)?(g(e),"{"===s?F(e,t)||r:h(t,10,function(e){const t=n=>{const r=e.currentChar();return"{"!==r&&"@"!==r&&"|"!==r&&"("!==r&&")"!==r&&r?r===Qp?n:(n+=r,e.next(),t(n)):n};return t("")}(e))):(7===n&&d(qp.INVALID_LINKED_FORMAT,i(),0),t.braceNest=0,t.inLinked=!1,B(e,t))}}function B(e,t){let n={type:13};if(t.braceNest>0)return F(e,t)||m(t);if(t.inLinked)return L(e,t)||m(t);switch(e.currentChar()){case"{":return F(e,t)||m(t);case"}":return d(qp.UNBALANCED_CLOSING_BRACE,i(),0),e.next(),h(t,3,"}");case"@":return L(e,t)||m(t);default:if(w(e))return n=h(t,1,D(e)),t.braceNest=0,t.inLinked=!1,n;if(k(e))return h(t,0,function(e){let t="";for(;;){const n=e.currentChar();if("{"===n||"}"===n||"@"===n||"|"===n||!n)break;if(n===Qp||n===Jp)if(k(e))t+=n,e.next();else{if(w(e))break;t+=n,e.next()}else t+=n,e.next()}return t}(e))}return n}return{nextToken:function(){const{currentType:e,offset:t,startLoc:n,endLoc:a}=c;return c.lastType=e,c.lastOffset=t,c.lastStartLoc=n,c.lastEndLoc=a,c.offset=s(),c.startLoc=i(),r.currentChar()===nf?h(c,13):B(r,c)},currentOffset:s,currentPosition:i,context:l}}const sf=/(?:\\\\|\\'|\\u([0-9a-fA-F]{4})|\\U([0-9a-fA-F]{6}))/g;function af(e,t,n){switch(e){case"\\\\":return"\\";case"\\'":return"'";default:{const e=parseInt(t||n,16);return e<=55295||e>=57344?String.fromCodePoint(e):"�"}}}function of(e={}){const t=!1!==e.location,{onError:n}=e;function r(e,r,s,i,...a){const o=e.currentPosition();if(o.offset+=i,o.column+=i,n){const e=Gp(r,t?Hp(s,o):null,{domain:"parser",args:a});n(e)}}function s(e,n,r){const s={type:e};return t&&(s.start=n,s.end=n,s.loc={start:r,end:r}),s}function i(e,n,r,s){t&&(e.end=n,e.loc&&(e.loc.end=r))}function a(e,t){const n=e.context(),r=s(3,n.offset,n.startLoc);return r.value=t,i(r,e.currentOffset(),e.currentPosition()),r}function o(e,t){const n=e.context(),{lastOffset:r,lastStartLoc:a}=n,o=s(5,r,a);return o.index=parseInt(t,10),e.nextToken(),i(o,e.currentOffset(),e.currentPosition()),o}function c(e,t){const n=e.context(),{lastOffset:r,lastStartLoc:a}=n,o=s(4,r,a);return o.key=t,e.nextToken(),i(o,e.currentOffset(),e.currentPosition()),o}function l(e,t){const n=e.context(),{lastOffset:r,lastStartLoc:a}=n,o=s(9,r,a);return o.value=t.replace(sf,af),e.nextToken(),i(o,e.currentOffset(),e.currentPosition()),o}function u(e){const t=e.context(),n=s(6,t.offset,t.startLoc);let a=e.nextToken();if(8===a.type){const t=function(e){const t=e.nextToken(),n=e.context(),{lastOffset:a,lastStartLoc:o}=n,c=s(8,a,o);return 11!==t.type?(r(e,qp.UNEXPECTED_EMPTY_LINKED_MODIFIER,n.lastStartLoc,0),c.value="",i(c,a,o),{nextConsumeToken:t,node:c}):(null==t.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,n.lastStartLoc,0,cf(t)),c.value=t.value||"",i(c,e.currentOffset(),e.currentPosition()),{node:c})}(e);n.modifier=t.node,a=t.nextConsumeToken||e.nextToken()}switch(9!==a.type&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(a)),a=e.nextToken(),2===a.type&&(a=e.nextToken()),a.type){case 10:null==a.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(a)),n.key=function(e,t){const n=e.context(),r=s(7,n.offset,n.startLoc);return r.value=t,i(r,e.currentOffset(),e.currentPosition()),r}(e,a.value||"");break;case 4:null==a.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(a)),n.key=c(e,a.value||"");break;case 5:null==a.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(a)),n.key=o(e,a.value||"");break;case 6:null==a.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(a)),n.key=l(e,a.value||"");break;default:{r(e,qp.UNEXPECTED_EMPTY_LINKED_KEY,t.lastStartLoc,0);const o=e.context(),c=s(7,o.offset,o.startLoc);return c.value="",i(c,o.offset,o.startLoc),n.key=c,i(n,o.offset,o.startLoc),{nextConsumeToken:a,node:n}}}return i(n,e.currentOffset(),e.currentPosition()),{node:n}}function d(e){const t=e.context(),n=s(2,1===t.currentType?e.currentOffset():t.offset,1===t.currentType?t.endLoc:t.startLoc);n.items=[];let d=null;do{const s=d||e.nextToken();switch(d=null,s.type){case 0:null==s.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(s)),n.items.push(a(e,s.value||""));break;case 5:null==s.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(s)),n.items.push(o(e,s.value||""));break;case 4:null==s.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(s)),n.items.push(c(e,s.value||""));break;case 6:null==s.value&&r(e,qp.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,cf(s)),n.items.push(l(e,s.value||""));break;case 7:{const t=u(e);n.items.push(t.node),d=t.nextConsumeToken||null;break}}}while(13!==t.currentType&&1!==t.currentType);return i(n,1===t.currentType?t.lastOffset:e.currentOffset(),1===t.currentType?t.lastEndLoc:e.currentPosition()),n}function h(e){const t=e.context(),{offset:n,startLoc:a}=t,o=d(e);return 13===t.currentType?o:function(e,t,n,a){const o=e.context();let c=0===a.items.length;const l=s(1,t,n);l.cases=[],l.cases.push(a);do{const t=d(e);c||(c=0===t.items.length),l.cases.push(t)}while(13!==o.currentType);return c&&r(e,qp.MUST_HAVE_MESSAGES_IN_PLURAL,n,0),i(l,e.currentOffset(),e.currentPosition()),l}(e,n,a,o)}return{parse:function(n){const a=rf(n,Ap({},e)),o=a.context(),c=s(0,o.offset,o.startLoc);return t&&c.loc&&(c.loc.source=n),c.body=h(a),e.onCacheKey&&(c.cacheKey=e.onCacheKey(n)),13!==o.currentType&&r(a,qp.UNEXPECTED_LEXICAL_ANALYSIS,o.lastStartLoc,0,n[o.offset]||""),i(c,a.currentOffset(),a.currentPosition()),c}}}function cf(e){if(13===e.type)return"EOF";const t=(e.value||"").replace(/\r?\n/gu,"\\n");return t.length>10?t.slice(0,9)+"…":t}function lf(e,t){for(let n=0;n<e.length;n++)uf(e[n],t)}function uf(e,t){switch(e.type){case 1:lf(e.cases,t),t.helper("plural");break;case 2:lf(e.items,t);break;case 6:uf(e.key,t),t.helper("linked"),t.helper("type");break;case 5:t.helper("interpolate"),t.helper("list");break;case 4:t.helper("interpolate"),t.helper("named")}}function df(e,t={}){const n=function(e){const t={ast:e,helpers:new Set};return{context:()=>t,helper:e=>(t.helpers.add(e),e)}}(e);n.helper("normalize"),e.body&&uf(e.body,n);const r=n.context();e.helpers=Array.from(r.helpers)}function hf(e){if(1===e.items.length){const t=e.items[0];3!==t.type&&9!==t.type||(e.static=t.value,delete t.value)}else{const t=[];for(let n=0;n<e.items.length;n++){const r=e.items[n];if(3!==r.type&&9!==r.type)break;if(null==r.value)break;t.push(r.value)}if(t.length===e.items.length){e.static=Wp(t);for(let t=0;t<e.items.length;t++){const n=e.items[t];3!==n.type&&9!==n.type||delete n.value}}}}function mf(e){switch(e.t=e.type,e.type){case 0:{const t=e;mf(t.body),t.b=t.body,delete t.body;break}case 1:{const t=e,n=t.cases;for(let e=0;e<n.length;e++)mf(n[e]);t.c=n,delete t.cases;break}case 2:{const t=e,n=t.items;for(let e=0;e<n.length;e++)mf(n[e]);t.i=n,delete t.items,t.static&&(t.s=t.static,delete t.static);break}case 3:case 9:case 8:case 7:{const t=e;t.value&&(t.v=t.value,delete t.value);break}case 6:{const t=e;mf(t.key),t.k=t.key,delete t.key,t.modifier&&(mf(t.modifier),t.m=t.modifier,delete t.modifier);break}case 5:{const t=e;t.i=t.index,delete t.index;break}case 4:{const t=e;t.k=t.key,delete t.key;break}default:throw Gp(qp.UNHANDLED_MINIFIER_NODE_TYPE,null,{domain:"minifier",args:[e.type]})}delete e.type}function pf(e,t){const{helper:n}=e;switch(t.type){case 0:!function(e,t){t.body?pf(e,t.body):e.push("null")}(e,t);break;case 1:!function(e,t){const{helper:n,needIndent:r}=e;if(t.cases.length>1){e.push(`${n("plural")}([`),e.indent(r());const s=t.cases.length;for(let n=0;n<s&&(pf(e,t.cases[n]),n!==s-1);n++)e.push(", ");e.deindent(r()),e.push("])")}}(e,t);break;case 2:!function(e,t){const{helper:n,needIndent:r}=e;e.push(`${n("normalize")}([`),e.indent(r());const s=t.items.length;for(let i=0;i<s&&(pf(e,t.items[i]),i!==s-1);i++)e.push(", ");e.deindent(r()),e.push("])")}(e,t);break;case 6:!function(e,t){const{helper:n}=e;e.push(`${n("linked")}(`),pf(e,t.key),t.modifier?(e.push(", "),pf(e,t.modifier),e.push(", _type")):e.push(", undefined, _type"),e.push(")")}(e,t);break;case 8:case 7:case 9:case 3:e.push(JSON.stringify(t.value),t);break;case 5:e.push(`${n("interpolate")}(${n("list")}(${t.index}))`,t);break;case 4:e.push(`${n("interpolate")}(${n("named")}(${JSON.stringify(t.key)}))`,t);break;default:throw Gp(qp.UNHANDLED_CODEGEN_NODE_TYPE,null,{domain:"parser",args:[t.type]})}}function ff(e,t={}){const n=Ap({},t),r=!!n.jit,s=!!n.minify,i=null==n.optimize||n.optimize,a=of(n).parse(e);return r?(i&&function(e){const t=e.body;2===t.type?hf(t):t.cases.forEach(e=>hf(e))}(a),s&&mf(a),{ast:a,code:""}):(df(a,n),((e,t={})=>{const n=Bp(t.mode)?t.mode:"normal",r=Bp(t.filename)?t.filename:"message.intl";t.sourceMap;const s=null!=t.breakLineCode?t.breakLineCode:"arrow"===n?";":"\n",i=t.needIndent?t.needIndent:"arrow"!==n,a=e.helpers||[],o=function(e,t){const{filename:n,breakLineCode:r,needIndent:s}=t,i=!1!==t.location,a={filename:n,code:"",column:1,line:1,offset:0,map:void 0,breakLineCode:r,needIndent:s,indentLevel:0};function o(e,t){a.code+=e}function c(e,t=!0){const n=t?r:"";o(s?n+"  ".repeat(e):n)}return i&&e.loc&&(a.source=e.loc.source),{context:()=>a,push:o,indent:function(e=!0){const t=++a.indentLevel;e&&c(t)},deindent:function(e=!0){const t=--a.indentLevel;e&&c(t)},newline:function(){c(a.indentLevel)},helper:e=>`_${e}`,needIndent:()=>a.needIndent}}(e,{filename:r,breakLineCode:s,needIndent:i});o.push("normal"===n?"function __msg__ (ctx) {":"(ctx) => {"),o.indent(i),a.length>0&&(o.push(`const { ${Wp(a.map(e=>`${e}: _${e}`),", ")} } = ctx`),o.newline()),o.push("return "),pf(o,e),o.deindent(i),o.push("}"),delete e.helpers;const{code:c,map:l}=o.context();return{ast:e,code:c,map:l?l.toJSON():void 0}})(a,n))}function gf(e){return Up(e)&&0===_f(e)&&(Dp(e,"b")||Dp(e,"body"))}const bf=["b","body"];const yf=["c","cases"];const wf=["s","static"];const kf=["i","items"];const Tf=["t","type"];function _f(e){return If(e,Tf)}const vf=["v","value"];function Sf(e,t){const n=If(e,vf);if(null!=n)return n;throw Af(t)}const Ef=["m","modifier"];const Cf=["k","key"];function If(e,t,n){for(let r=0;r<t.length;r++){const n=t[r];if(Dp(e,n)&&null!=e[n])return e[n]}return n}const xf=[...bf,...yf,...wf,...kf,...Cf,...Ef,...vf,...Tf];function Af(e){return new Error(`unhandled node type: ${e}`)}function Pf(e){return t=>function(e,t){const n=(r=t,If(r,bf));var r;if(null==n)throw Af(0);if(1===_f(n)){const t=function(e){return If(e,yf,[])}(n);return e.plural(t.reduce((t,n)=>[...t,Of(e,n)],[]))}return Of(e,n)}(t,e)}function Of(e,t){const n=function(e){return If(e,wf)}(t);if(null!=n)return"text"===e.type?n:e.normalize([n]);{const n=function(e){return If(e,kf,[])}(t).reduce((t,n)=>[...t,Nf(e,n)],[]);return e.normalize(n)}}function Nf(e,t){const n=_f(t);switch(n){case 3:case 9:case 7:case 8:return Sf(t,n);case 4:{const r=t;if(Dp(r,"k")&&r.k)return e.interpolate(e.named(r.k));if(Dp(r,"key")&&r.key)return e.interpolate(e.named(r.key));throw Af(n)}case 5:{const r=t;if(Dp(r,"i")&&Cp(r.i))return e.interpolate(e.list(r.i));if(Dp(r,"index")&&Cp(r.index))return e.interpolate(e.list(r.index));throw Af(n)}case 6:{const n=t,r=function(e){return If(e,Ef)}(n),s=function(e){const t=If(e,Cf);if(t)return t;throw Af(6)}(n);return e.linked(Nf(e,s),r?Nf(e,r):void 0,e.type)}default:throw new Error(`unhandled node on format message part: ${n}`)}}function Rf(e,t){t&&(e=>Yp.test(e))(e)&&Sp("Detected HTML in '{source}' message. Recommend not using HTML messages to avoid XSS.",{source:e})}const Mf=e=>e;let Df=Op();let Ff=null;function Lf(e,t,n){Ff&&Ff.emit("i18n:init",{timestamp:Date.now(),i18n:e,version:t,meta:n})}const Bf=zf("function:translate");function zf(e){return t=>Ff&&Ff.emit(e,t)}const Uf={INVALID_ARGUMENT:17,INVALID_DATE_ARGUMENT:18,INVALID_ISO_DATE_ARGUMENT:19,NOT_SUPPORT_NON_STRING_MESSAGE:20,NOT_SUPPORT_LOCALE_PROMISE_VALUE:21,NOT_SUPPORT_LOCALE_ASYNC_FUNCTION:22,NOT_SUPPORT_LOCALE_TYPE:23};function $f(e){return Gp(e,null,{messages:Vf})}const Vf={[Uf.INVALID_ARGUMENT]:"Invalid arguments",[Uf.INVALID_DATE_ARGUMENT]:"The date provided is an invalid Date object.Make sure your Date represents a valid date.",[Uf.INVALID_ISO_DATE_ARGUMENT]:"The argument provided is not a valid ISO date string",[Uf.NOT_SUPPORT_NON_STRING_MESSAGE]:"Not support non-string message",[Uf.NOT_SUPPORT_LOCALE_PROMISE_VALUE]:"cannot support promise value",[Uf.NOT_SUPPORT_LOCALE_ASYNC_FUNCTION]:"cannot support async function",[Uf.NOT_SUPPORT_LOCALE_TYPE]:"cannot support locale type"};function jf(e,t){return null!=t.locale?Hf(t.locale):Hf(e.locale)}let Wf;function Hf(e){if(Bp(e))return e;if(Lp(e)){if(e.resolvedOnce&&null!=Wf)return Wf;if("Function"===e.constructor.name){const n=e();if(Up(t=n)&&Lp(t.then)&&Lp(t.catch))throw $f(Uf.NOT_SUPPORT_LOCALE_PROMISE_VALUE);return Wf=n}throw $f(Uf.NOT_SUPPORT_LOCALE_ASYNC_FUNCTION)}throw $f(Uf.NOT_SUPPORT_LOCALE_TYPE);var t}function qf(e,t,n){return[...new Set([n,...Fp(t)?t:Up(t)?Object.keys(t):Bp(t)?[t]:[n]])]}function Xf(e,t,n){let r=!0;for(let s=0;s<t.length&&zp(r);s++){const i=t[s];Bp(i)&&(r=Gf(e,t[s],n))}return r}function Gf(e,t,n){let r;const s=t.split("-");do{r=Kf(e,s.join("-"),n),s.splice(-1,1)}while(s.length&&!0===r);return r}function Kf(e,t,n){let r=!1;if(!e.includes(t)&&(r=!0,t)){r="!"!==t[t.length-1];const s=t.replace(/!/g,"");e.push(s),(Fp(n)||jp(n))&&n[s]&&(r=n[s])}return r}const Yf=[];Yf[0]={w:[0],i:[3,0],"[":[4],o:[7]},Yf[1]={w:[1],".":[2],"[":[4],o:[7]},Yf[2]={w:[2],i:[3,0],0:[3,0]},Yf[3]={i:[3,0],0:[3,0],w:[1,1],".":[2,1],"[":[4,1],o:[7,1]},Yf[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],o:8,l:[4,0]},Yf[5]={"'":[4,0],o:8,l:[5,0]},Yf[6]={'"':[4,0],o:8,l:[6,0]};const Qf=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function Jf(e){if(null==e)return"o";switch(e.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return e;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function Zf(e){const t=e.trim();return("0"!==e.charAt(0)||!isNaN(parseInt(e)))&&(n=t,Qf.test(n)?function(e){const t=e.charCodeAt(0);return t!==e.charCodeAt(e.length-1)||34!==t&&39!==t?e:e.slice(1,-1)}(t):"*"+t);var n}function eg(e){const t=[];let n,r,s,i,a,o,c,l=-1,u=0,d=0;const h=[];function m(){const t=e[l+1];if(5===u&&"'"===t||6===u&&'"'===t)return l++,s="\\"+t,h[0](),!0}for(h[0]=()=>{void 0===r?r=s:r+=s},h[1]=()=>{void 0!==r&&(t.push(r),r=void 0)},h[2]=()=>{h[0](),d++},h[3]=()=>{if(d>0)d--,u=4,h[0]();else{if(d=0,void 0===r)return!1;if(r=Zf(r),!1===r)return!1;h[1]()}};null!==u;)if(l++,n=e[l],"\\"!==n||!m()){if(i=Jf(n),c=Yf[u],a=c[i]||c.l||8,8===a)return;if(u=a[0],void 0!==a[1]&&(o=h[a[1]],o&&(s=n,!1===o())))return;if(7===u)return t}}const tg=new Map;function ng(e,t){return Up(e)?e[t]:null}const rg={NOT_FOUND_KEY:1,FALLBACK_TO_TRANSLATE:2,CANNOT_FORMAT_NUMBER:3,FALLBACK_TO_NUMBER_FORMAT:4,CANNOT_FORMAT_DATE:5,FALLBACK_TO_DATE_FORMAT:6,EXPERIMENTAL_CUSTOM_MESSAGE_COMPILER:7},sg={[rg.NOT_FOUND_KEY]:"Not found '{key}' key in '{locale}' locale messages.",[rg.FALLBACK_TO_TRANSLATE]:"Fall back to translate '{key}' key with '{target}' locale.",[rg.CANNOT_FORMAT_NUMBER]:"Cannot format a number value due to not supported Intl.NumberFormat.",[rg.FALLBACK_TO_NUMBER_FORMAT]:"Fall back to number format '{key}' key with '{target}' locale.",[rg.CANNOT_FORMAT_DATE]:"Cannot format a date value due to not supported Intl.DateTimeFormat.",[rg.FALLBACK_TO_DATE_FORMAT]:"Fall back to datetime format '{key}' key with '{target}' locale.",[rg.EXPERIMENTAL_CUSTOM_MESSAGE_COMPILER]:"This project is using Custom Message Compiler, which is an experimental feature. It may receive breaking changes or be removed in the future."};function ig(e,...t){return Sp(sg[e],...t)}const ag="11.1.11",og="en-US",cg=e=>`${e.charAt(0).toLocaleUpperCase()}${e.substr(1)}`;let lg,ug,dg;let hg=null;const mg=()=>hg;let pg=null;let fg=0;const gg=e=>({[e]:Op()});function bg(e,t){return e instanceof RegExp?e.test(t):e}function yg(e,t){return e instanceof RegExp?e.test(t):e}function wg(e,t,n,r,s){const{missing:i,onWarn:a}=e;{const r=e.__v_emitter;r&&r.emit("missing",{locale:n,key:t,type:s,groupId:`${s}:${t}`})}if(null!==i){const r=i(e,n,t,s);return Bp(r)?r:t}return yg(r,t)&&a(ig(rg.NOT_FOUND_KEY,{key:t,locale:n})),t}function kg(e,t){return e!==t&&e.split("-")[0]===t.split("-")[0]}function Tg(e,t){const n=t.indexOf(e);if(-1===n)return!1;for(let r=n+1;r<t.length;r++)if(kg(e,t[r]))return!0;return!1}const _g="undefined"!=typeof Intl,vg=_g&&void 0!==Intl.DateTimeFormat,Sg=_g&&void 0!==Intl.NumberFormat;const Eg=["localeMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName","formatMatcher","hour12","timeZone","dateStyle","timeStyle","calendar","dayPeriod","numberingSystem","hourCycle","fractionalSecondDigits"];function Cg(...e){const[t,n,r,s]=e,i=Op();let a,o=Op();if(Bp(t)){const e=t.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!e)throw $f(Uf.INVALID_ISO_DATE_ARGUMENT);const n=e[3]?e[3].trim().startsWith("T")?`${e[1].trim()}${e[3].trim()}`:`${e[1].trim()}T${e[3].trim()}`:e[1].trim();a=new Date(n);try{a.toISOString()}catch{throw $f(Uf.INVALID_ISO_DATE_ARGUMENT)}}else if("[object Date]"===Vp(t)){if(isNaN(t.getTime()))throw $f(Uf.INVALID_DATE_ARGUMENT);a=t}else{if(!Cp(t))throw $f(Uf.INVALID_ARGUMENT);a=t}return Bp(n)?i.key=n:jp(n)&&Object.keys(n).forEach(e=>{Eg.includes(e)?o[e]=n[e]:i[e]=n[e]}),Bp(r)?i.locale=r:jp(r)&&(o=r),jp(s)&&(o=s),[i.key||"",a,i,o]}const Ig=["localeMatcher","style","currency","currencyDisplay","currencySign","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","compactDisplay","notation","signDisplay","unit","unitDisplay","roundingMode","roundingPriority","roundingIncrement","trailingZeroDisplay"];function xg(...e){const[t,n,r,s]=e,i=Op();let a=Op();if(!Cp(t))throw $f(Uf.INVALID_ARGUMENT);const o=t;return Bp(n)?i.key=n:jp(n)&&Object.keys(n).forEach(e=>{Ig.includes(e)?a[e]=n[e]:i[e]=n[e]}),Bp(r)?i.locale=r:jp(r)&&(a=r),jp(s)&&(a=s),[i.key||"",o,i,a]}const Ag=e=>e,Pg=e=>"",Og="text",Ng=e=>0===e.length?"":Wp(e),Rg=e=>null==e?"":Fp(e)||jp(e)&&e.toString===$p?JSON.stringify(e,null,2):String(e);function Mg(e,t){return e=Math.abs(e),2===t?e?e>1?1:0:1:e?Math.min(e,2):0}function Dg(e={}){const t=e.locale,n=function(e){const t=Cp(e.pluralIndex)?e.pluralIndex:-1;return e.named&&(Cp(e.named.count)||Cp(e.named.n))?Cp(e.named.count)?e.named.count:Cp(e.named.n)?e.named.n:t:t}(e),r=Up(e.pluralRules)&&Bp(t)&&Lp(e.pluralRules[t])?e.pluralRules[t]:Mg,s=Up(e.pluralRules)&&Bp(t)&&Lp(e.pluralRules[t])?Mg:void 0,i=e.list||[],a=e.named||Op();Cp(e.pluralIndex)&&function(e,t){t.count||(t.count=e),t.n||(t.n=e)}(n,a);function o(t,n){const r=Lp(e.messages)?e.messages(t,!!n):!!Up(e.messages)&&e.messages[t];return r||(e.parent?e.parent.message(t):Pg)}const c=jp(e.processor)&&Lp(e.processor.normalize)?e.processor.normalize:Ng,l=jp(e.processor)&&Lp(e.processor.interpolate)?e.processor.interpolate:Rg,u={list:e=>i[e],named:e=>a[e],plural:e=>e[r(n,e.length,s)],linked:(t,...n)=>{const[r,s]=n;let i="text",a="";1===n.length?Up(r)?(a=r.modifier||a,i=r.type||i):Bp(r)&&(a=r||a):2===n.length&&(Bp(r)&&(a=r||a),Bp(s)&&(i=s||i));const c=o(t,!0)(u),l="vnode"===i&&Fp(c)&&a?c[0]:c;return a?(d=a,e.modifiers?e.modifiers[d]:Ag)(l,i):l;var d},message:o,type:jp(e.processor)&&Bp(e.processor.type)?e.processor.type:Og,interpolate:l,normalize:c,values:Ap(Op(),i,a)};return u}const Fg=()=>"",Lg=e=>Lp(e);function Bg(e,t,n,r,s,i){const{messages:a,onWarn:o,messageResolver:c,localeFallbacker:l}=e,u=l(e,r,n);let d,h=Op(),m=null,p=n,f=null;const g="translate";for(let b=0;b<u.length;b++){if(d=f=u[b],n!==d&&!kg(n,d)&&bg(s,t)&&o(ig(rg.FALLBACK_TO_TRANSLATE,{key:t,target:d})),n!==d){const n=e.__v_emitter;n&&n.emit("fallback",{type:g,key:t,from:p,to:f,groupId:`${g}:${t}`})}h=a[d]||Op();let r,l,y=null;if(kp&&(y=window.performance.now(),r="intlify-message-resolve-start",l="intlify-message-resolve-end",Tp&&Tp(r)),null===(m=c(h,t))&&(m=h[t]),kp){const n=window.performance.now(),s=e.__v_emitter;s&&y&&m&&s.emit("message-resolve",{type:"message-resolve",key:t,message:m,time:n-y,groupId:`${g}:${t}`}),r&&l&&Tp&&_p&&(Tp(l),_p("intlify message resolve",r,l))}if(Bp(m)||gf(m)||Lg(m))break;if(!Tg(d,u)){const n=wg(e,t,d,i,g);n!==t&&(m=n)}p=f}return[m,d,h]}function zg(e,t,n,r,s,i){const{messageCompiler:a,warnHtmlMessage:o}=e;if(Lg(r)){const e=r;return e.locale=e.locale||n,e.key=e.key||t,e}if(null==a){const e=()=>r;return e.locale=n,e.key=t,e}let c,l,u=null;kp&&(u=window.performance.now(),c="intlify-message-compilation-start",l="intlify-message-compilation-end",Tp&&Tp(c));const d=a(r,function(e,t,n,r,s,i){return{locale:t,key:n,warnHtmlMessage:s,onError:t=>{i&&i(t);{const s=function(e){if(Bp(e))return e;if(e.loc&&e.loc.source)return e.loc.source}(r),i=(t.message,t.location&&s&&function(e,t=0,n=e.length){const r=e.split(/\r?\n/);let s=0;const i=[];for(let a=0;a<r.length;a++)if(s+=r[a].length+1,s>=t){for(let e=a-2;e<=a+2||n>s;e++){if(e<0||e>=r.length)continue;const o=e+1;i.push(`${o}${" ".repeat(3-String(o).length)}|  ${r[e]}`);const c=r[e].length;if(e===a){const e=t-(s-c)+1,r=Math.max(1,n>s?c-e:n-t);i.push("   |  "+" ".repeat(e)+"^".repeat(r))}else if(e>a){if(n>s){const e=Math.max(Math.min(n-s,c),1);i.push("   |  "+"^".repeat(e))}s+=c+1}}break}i.join("\n")}(s,t.location.start.offset,t.location.end.offset),e.__v_emitter);i&&s&&i.emit("compile-error",{message:s,error:t.message,start:t.location&&t.location.start.offset,end:t.location&&t.location.end.offset,groupId:`translate:${n}`})}},onCacheKey:e=>((e,t,n)=>Ep({l:e,k:t,s:n}))(t,n,e)}}(e,n,s,r,o,i));if(kp){const n=window.performance.now(),s=e.__v_emitter;s&&u&&s.emit("message-compilation",{type:"message-compilation",message:r,time:n-u,groupId:`translate:${t}`}),c&&l&&Tp&&_p&&(Tp(l),_p("intlify message compilation",c,l))}return d.locale=n,d.key=t,d.source=r,d}function Ug(...e){const[t,n,r]=e,s=Op();if(!(Bp(t)||Cp(t)||Lg(t)||gf(t)))throw $f(Uf.INVALID_ARGUMENT);const i=Cp(t)?String(t):(Lg(t),t);return Cp(n)?s.plural=n:Bp(n)?s.default=n:jp(n)&&!xp(n)?s.named=n:Fp(n)&&(s.list=n),Cp(r)?s.plural=r:Bp(r)?s.default=r:jp(r)&&Ap(s,r),[i,s]}const $g=Object.freeze(Object.defineProperty({__proto__:null,AST_NODE_PROPS_KEYS:xf,CORE_ERROR_CODES_EXTEND_POINT:24,CORE_WARN_CODES_EXTEND_POINT:8,CompileErrorCodes:qp,CoreErrorCodes:Uf,CoreWarnCodes:rg,DATETIME_FORMAT_OPTIONS_KEYS:Eg,DEFAULT_LOCALE:og,DEFAULT_MESSAGE_DATA_TYPE:Og,MISSING_RESOLVE_VALUE:"",NOT_REOSLVED:-1,NUMBER_FORMAT_OPTIONS_KEYS:Ig,VERSION:ag,clearCompileCache:function(){Df=Op()},clearDateTimeFormat:function(e,t,n){const r=e;for(const s in n){const e=`${t}__${s}`;r.__datetimeFormatters.has(e)&&r.__datetimeFormatters.delete(e)}},clearNumberFormat:function(e,t,n){const r=e;for(const s in n){const e=`${t}__${s}`;r.__numberFormatters.has(e)&&r.__numberFormatters.delete(e)}},compile:function(e,t){if(Bp(e)){const n=!zp(t.warnHtmlMessage)||t.warnHtmlMessage;Rf(e,n);const r=(t.onCacheKey||Mf)(e),s=Df[r];if(s)return s;const{ast:i,detectError:a}=function(e,t={}){let n=!1;const r=t.onError||Kp;return t.onError=e=>{n=!0,r(e)},{...ff(e,t),detectError:n}}(e,{...t,location:!0,jit:!0}),o=Pf(i);return a?o:Df[r]=o}{if(!gf(e))return t.key,()=>e;const n=e.cacheKey;if(n){const t=Df[n];return t||(Df[n]=Pf(e))}return Pf(e)}},createCompileError:Gp,createCoreContext:function(e={}){const t=Lp(e.onWarn)?e.onWarn:yp,n=Bp(e.version)?e.version:ag,r=Bp(e.locale)||Lp(e.locale)?e.locale:og,s=Lp(r)?og:r,i=Fp(e.fallbackLocale)||jp(e.fallbackLocale)||Bp(e.fallbackLocale)||!1===e.fallbackLocale?e.fallbackLocale:s,a=jp(e.messages)?e.messages:gg(s),o=jp(e.datetimeFormats)?e.datetimeFormats:gg(s),c=jp(e.numberFormats)?e.numberFormats:gg(s),l=Ap(Op(),e.modifiers,{upper:(e,t)=>"text"===t&&Bp(e)?e.toUpperCase():"vnode"===t&&Up(e)&&"__v_isVNode"in e?e.children.toUpperCase():e,lower:(e,t)=>"text"===t&&Bp(e)?e.toLowerCase():"vnode"===t&&Up(e)&&"__v_isVNode"in e?e.children.toLowerCase():e,capitalize:(e,t)=>"text"===t&&Bp(e)?cg(e):"vnode"===t&&Up(e)&&"__v_isVNode"in e?cg(e.children):e}),u=e.pluralRules||Op(),d=Lp(e.missing)?e.missing:null,h=!zp(e.missingWarn)&&!Ip(e.missingWarn)||e.missingWarn,m=!zp(e.fallbackWarn)&&!Ip(e.fallbackWarn)||e.fallbackWarn,p=!!e.fallbackFormat,f=!!e.unresolving,g=Lp(e.postTranslation)?e.postTranslation:null,b=jp(e.processor)?e.processor:null,y=!zp(e.warnHtmlMessage)||e.warnHtmlMessage,w=!!e.escapeParameter,k=Lp(e.messageCompiler)?e.messageCompiler:lg;var T;Lp(e.messageCompiler)&&(T=ig(rg.EXPERIMENTAL_CUSTOM_MESSAGE_COMPILER),wp[T]||(wp[T]=!0));const _=Lp(e.messageResolver)?e.messageResolver:ug||ng,v=Lp(e.localeFallbacker)?e.localeFallbacker:dg||qf,S=Up(e.fallbackContext)?e.fallbackContext:void 0,E=e,C=Up(E.__datetimeFormatters)?E.__datetimeFormatters:new Map,I=Up(E.__numberFormatters)?E.__numberFormatters:new Map,x=Up(E.__meta)?E.__meta:{};fg++;const A={version:n,cid:fg,locale:r,fallbackLocale:i,messages:a,modifiers:l,pluralRules:u,missing:d,missingWarn:h,fallbackWarn:m,fallbackFormat:p,unresolving:f,postTranslation:g,processor:b,warnHtmlMessage:y,escapeParameter:w,messageCompiler:k,messageResolver:_,localeFallbacker:v,fallbackContext:S,onWarn:t,__meta:x};return A.datetimeFormats=o,A.numberFormats=c,A.__datetimeFormatters=C,A.__numberFormatters=I,A.__v_emitter=null!=E.__v_emitter?E.__v_emitter:void 0,Lf(A,n,x),A},createCoreError:$f,createMessageContext:Dg,datetime:function(e,...t){const{datetimeFormats:n,unresolving:r,fallbackLocale:s,onWarn:i,localeFallbacker:a}=e,{__datetimeFormatters:o}=e;if(!vg)return i(ig(rg.CANNOT_FORMAT_DATE)),"";const[c,l,u,d]=Cg(...t),h=zp(u.missingWarn)?u.missingWarn:e.missingWarn,m=zp(u.fallbackWarn)?u.fallbackWarn:e.fallbackWarn,p=!!u.part,f=jf(e,u),g=a(e,s,f);if(!Bp(c)||""===c)return new Intl.DateTimeFormat(f,d).format(l);let b,y={},w=null,k=f,T=null;const _="datetime format";for(let E=0;E<g.length;E++){if(b=T=g[E],f!==b&&bg(m,c)&&i(ig(rg.FALLBACK_TO_DATE_FORMAT,{key:c,target:b})),f!==b){const t=e.__v_emitter;t&&t.emit("fallback",{type:_,key:c,from:k,to:T,groupId:`${_}:${c}`})}if(y=n[b]||{},w=y[c],jp(w))break;wg(e,c,b,h,_),k=T}if(!jp(w)||!Bp(b))return r?-1:c;let v=`${b}__${c}`;xp(d)||(v=`${v}__${JSON.stringify(d)}`);let S=o.get(v);return S||(S=new Intl.DateTimeFormat(b,Ap({},w,d)),o.set(v,S)),p?S.formatToParts(l):S.format(l)},fallbackWithLocaleChain:function(e,t,n){const r=Bp(n)?n:og,s=e;s.__localeChainCache||(s.__localeChainCache=new Map);let i=s.__localeChainCache.get(r);if(!i){i=[];let e=[n];for(;Fp(e);)e=Xf(i,e,t);const a=Fp(t)||!jp(t)?t:t.default?t.default:null;e=Bp(a)?[a]:a,Fp(e)&&Xf(i,e,!1),s.__localeChainCache.set(r,i)}return i},fallbackWithSimple:qf,getAdditionalMeta:mg,getDevToolsHook:function(){return Ff},getFallbackContext:()=>pg,getLocale:jf,getWarnMessage:ig,handleMissing:wg,initI18nDevTools:Lf,isAlmostSameLocale:kg,isImplicitFallback:Tg,isMessageAST:gf,isMessageFunction:Lg,isTranslateFallbackWarn:bg,isTranslateMissingWarn:yg,number:function(e,...t){const{numberFormats:n,unresolving:r,fallbackLocale:s,onWarn:i,localeFallbacker:a}=e,{__numberFormatters:o}=e;if(!Sg)return i(ig(rg.CANNOT_FORMAT_NUMBER)),"";const[c,l,u,d]=xg(...t),h=zp(u.missingWarn)?u.missingWarn:e.missingWarn,m=zp(u.fallbackWarn)?u.fallbackWarn:e.fallbackWarn,p=!!u.part,f=jf(e,u),g=a(e,s,f);if(!Bp(c)||""===c)return new Intl.NumberFormat(f,d).format(l);let b,y={},w=null,k=f,T=null;const _="number format";for(let E=0;E<g.length;E++){if(b=T=g[E],f!==b&&bg(m,c)&&i(ig(rg.FALLBACK_TO_NUMBER_FORMAT,{key:c,target:b})),f!==b){const t=e.__v_emitter;t&&t.emit("fallback",{type:_,key:c,from:k,to:T,groupId:`${_}:${c}`})}if(y=n[b]||{},w=y[c],jp(w))break;wg(e,c,b,h,_),k=T}if(!jp(w)||!Bp(b))return r?-1:c;let v=`${b}__${c}`;xp(d)||(v=`${v}__${JSON.stringify(d)}`);let S=o.get(v);return S||(S=new Intl.NumberFormat(b,Ap({},w,d)),o.set(v,S)),p?S.formatToParts(l):S.format(l)},parse:eg,parseDateTimeArgs:Cg,parseNumberArgs:xg,parseTranslateArgs:Ug,registerLocaleFallbacker:function(e){dg=e},registerMessageCompiler:function(e){lg=e},registerMessageResolver:function(e){ug=e},resolveLocale:Hf,resolveValue:function(e,t){if(!Up(e))return null;let n=tg.get(t);if(n||(n=eg(t),n&&tg.set(t,n)),!n)return null;const r=n.length;let s=e,i=0;for(;i<r;){const e=n[i];if(xf.includes(e)&&gf(s))return null;const t=s[e];if(void 0===t)return null;if(Lp(s))return null;s=t,i++}return s},resolveWithKeyValue:ng,setAdditionalMeta:e=>{hg=e},setDevToolsHook:function(e){Ff=e},setFallbackContext:e=>{pg=e},translate:function(e,...t){const{fallbackFormat:n,postTranslation:r,unresolving:s,messageCompiler:i,fallbackLocale:a,messages:o}=e,[c,l]=Ug(...t),u=zp(l.missingWarn)?l.missingWarn:e.missingWarn,d=zp(l.fallbackWarn)?l.fallbackWarn:e.fallbackWarn,h=zp(l.escapeParameter)?l.escapeParameter:e.escapeParameter,m=!!l.resolvedMessage,p=Bp(l.default)||zp(l.default)?zp(l.default)?i?c:()=>c:l.default:n?i?c:()=>c:null,f=n||null!=p&&(Bp(p)||Lp(p)),g=jf(e,l);h&&function(e){Fp(e.list)?e.list=e.list.map(e=>Bp(e)?Np(e):e):Up(e.named)&&Object.keys(e.named).forEach(t=>{Bp(e.named[t])&&(e.named[t]=Np(e.named[t]))})}(l);let[b,y,w]=m?[c,g,o[g]||Op()]:Bg(e,c,g,a,d,u),k=b,T=c;if(m||Bp(k)||gf(k)||Lg(k)||f&&(k=p,T=k),!(m||(Bp(k)||gf(k)||Lg(k))&&Bp(y)))return s?-1:c;if(Bp(k)&&null==e.messageCompiler)return c;let _=!1;const v=Lg(k)?k:zg(e,c,y,k,T,()=>{_=!0});if(_)return k;const S=function(e,t,n,r){const{modifiers:s,pluralRules:i,messageResolver:a,fallbackLocale:o,fallbackWarn:c,missingWarn:l,fallbackContext:u}=e,d=(r,s)=>{let i=a(n,r);if(null==i&&(u||s)){const[,,n]=Bg(u||e,r,t,o,c,l);i=a(n,r)}if(Bp(i)||gf(i)){let n=!1;const s=zg(e,r,t,i,r,()=>{n=!0});return n?Fg:s}return Lg(i)?i:Fg},h={locale:t,modifiers:s,pluralRules:i,messages:d};e.processor&&(h.processor=e.processor);r.list&&(h.list=r.list);r.named&&(h.named=r.named);Cp(r.plural)&&(h.pluralIndex=r.plural);return h}(e,y,w,l),E=function(e,t,n){let r,s,i=null;kp&&(i=window.performance.now(),r="intlify-message-evaluation-start",s="intlify-message-evaluation-end",Tp&&Tp(r));const a=t(n);if(kp){const n=window.performance.now(),o=e.__v_emitter;o&&i&&o.emit("message-evaluation",{type:"message-evaluation",value:a,time:n-i,groupId:`translate:${t.key}`}),r&&s&&Tp&&_p&&(Tp(s),_p("intlify message evaluation",r,s))}return a}(e,v,Dg(S));let C=r?r(E,c):E;var I;h&&Bp(C)&&(I=(I=(I=C).replace(/(\w+)\s*=\s*"([^"]*)"/g,(e,t,n)=>`${t}="${Rp(n)}"`)).replace(/(\w+)\s*=\s*'([^']*)'/g,(e,t,n)=>`${t}='${Rp(n)}'`),/\s*on\w+\s*=\s*["']?[^"'>]+["']?/gi.test(I)&&(I=I.replace(/(\s+)(on)(\w+\s*=)/gi,"$1&#111;n$3")),[/(\s+(?:href|src|action|formaction)\s*=\s*["']?)\s*javascript:/gi,/(style\s*=\s*["'][^"']*url\s*\(\s*)javascript:/gi].forEach(e=>{I=I.replace(e,"$1javascript&#58;")}),C=I);{const t={timestamp:Date.now(),key:Bp(c)?c:Lg(k)?k.key:"",locale:y||(Lg(k)?k.locale:""),format:Bp(k)?k:Lg(k)?k.source:"",message:C};t.meta=Ap({},e.__meta,mg()||{}),Bf(t)}return C},translateDevTools:Bf,updateFallbackLocale:function(e,t,n){e.__localeChainCache=new Map,e.localeFallbacker(e,n,t)}},Symbol.toStringTag,{value:"Module"})),Vg=kc($g);function jg(e,t){}const Wg={};const Hg="undefined"!=typeof window;let qg,Xg;{const e=Hg&&window.performance;e&&e.mark&&e.measure&&e.clearMarks&&e.clearMeasures&&(qg=t=>{e.mark(t)},Xg=(t,n,r)=>{e.measure(t,n,r),e.clearMarks(n),e.clearMarks(r)})}const Gg=/\{([0-9a-zA-Z]+)\}/g;const Kg=e=>JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),Yg=Object.assign,Qg=Object.create,Jg=(e=null)=>Qg(e);let Zg;function eb(e){return e.replace(/&(?![a-zA-Z0-9#]{2,6};)/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}const tb=Object.prototype.hasOwnProperty;const nb=Array.isArray,rb=e=>"function"==typeof e,sb=e=>null!==e&&"object"==typeof e,ib=Object.prototype.toString,ab=e=>ib.call(e),ob=e=>"[object Object]"===ab(e);const cb=e=>!sb(e)||nb(e);const lb=Object.freeze(Object.defineProperty({__proto__:null,assign:Yg,create:Jg,createEmitter:function(){const e=new Map;return{events:e,on(t,n){const r=e.get(t);r&&r.push(n)||e.set(t,[n])},off(t,n){const r=e.get(t);r&&r.splice(r.indexOf(n)>>>0,1)},emit(t,n){(e.get(t)||[]).slice().map(e=>e(n)),(e.get("*")||[]).slice().map(e=>e(t,n))}}},deepCopy:function(e,t){if(cb(e)||cb(t))throw new Error("Invalid value");const n=[{src:e,des:t}];for(;n.length;){const{src:e,des:t}=n.pop();Object.keys(e).forEach(r=>{"__proto__"!==r&&(sb(e[r])&&!sb(t[r])&&(t[r]=Array.isArray(e[r])?[]:Jg()),cb(t[r])||cb(e[r])?t[r]=e[r]:n.push({src:e[r],des:t[r]}))})}},escapeHtml:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;").replace(/=/g,"&#x3D;")},format:function(e,...t){return 1===t.length&&sb(t[0])&&(t=t[0]),t&&t.hasOwnProperty||(t={}),e.replace(Gg,(e,n)=>t.hasOwnProperty(n)?t[n]:"")},friendlyJSONstringify:Kg,generateCodeFrame:function(e,t=0,n=e.length){const r=e.split(/\r?\n/);let s=0;const i=[];for(let a=0;a<r.length;a++)if(s+=r[a].length+1,s>=t){for(let e=a-2;e<=a+2||n>s;e++){if(e<0||e>=r.length)continue;const o=e+1;i.push(`${o}${" ".repeat(3-String(o).length)}|  ${r[e]}`);const c=r[e].length;if(e===a){const e=t-(s-c)+1,r=Math.max(1,n>s?c-e:n-t);i.push("   |  "+" ".repeat(e)+"^".repeat(r))}else if(e>a){if(n>s){const e=Math.max(Math.min(n-s,c),1);i.push("   |  "+"^".repeat(e))}s+=c+1}}break}return i.join("\n")},generateFormatCacheKey:(e,t,n)=>Kg({l:e,k:t,s:n}),getGlobalThis:()=>Zg||(Zg="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:Jg()),hasOwn:function(e,t){return tb.call(e,t)},inBrowser:Hg,isArray:nb,isBoolean:e=>"boolean"==typeof e,isDate:e=>"[object Date]"===ab(e),isEmptyObject:e=>ob(e)&&0===Object.keys(e).length,isFunction:rb,isNumber:e=>"number"==typeof e&&isFinite(e),isObject:sb,isPlainObject:ob,isPromise:e=>sb(e)&&rb(e.then)&&rb(e.catch),isRegExp:e=>"[object RegExp]"===ab(e),isString:e=>"string"==typeof e,isSymbol:e=>"symbol"==typeof e,join:function(e,t=""){return e.reduce((e,n,r)=>0===r?e+n:e+t+n,"")},makeSymbol:(e,t=!1)=>t?Symbol.for(e):Symbol(e),get mark(){return qg},get measure(){return Xg},objectToString:ib,sanitizeTranslatedHtml:function(e){return e=(e=e.replace(/(\w+)\s*=\s*"([^"]*)"/g,(e,t,n)=>`${t}="${eb(n)}"`)).replace(/(\w+)\s*=\s*'([^']*)'/g,(e,t,n)=>`${t}='${eb(n)}'`),/\s*on\w+\s*=\s*["']?[^"'>]+["']?/gi.test(e)&&(e=e.replace(/(\s+)(on)(\w+\s*=)/gi,"$1&#111;n$3")),[/(\s+(?:href|src|action|formaction)\s*=\s*["']?)\s*javascript:/gi,/(style\s*=\s*["'][^"']*url\s*\(\s*)javascript:/gi].forEach(t=>{e=e.replace(t,"$1javascript&#58;")}),e},toDisplayString:e=>null==e?"":nb(e)||ob(e)&&e.toString===ib?JSON.stringify(e,null,2):String(e),toTypeString:ab,warn:jg,warnOnce:function(e){Wg[e]||(Wg[e]=!0)}},Symbol.toStringTag,{value:"Module"})),ub=kc(lb);var db={exports:{}},hb={};const mb=Symbol(""),pb=Symbol(""),fb=Symbol(""),gb=Symbol(""),bb=Symbol(""),yb=Symbol(""),wb=Symbol(""),kb=Symbol(""),Tb=Symbol(""),_b=Symbol(""),vb=Symbol(""),Sb=Symbol(""),Eb=Symbol(""),Cb=Symbol(""),Ib=Symbol(""),xb=Symbol(""),Ab=Symbol(""),Pb=Symbol(""),Ob=Symbol(""),Nb=Symbol(""),Rb=Symbol(""),Mb=Symbol(""),Db=Symbol(""),Fb=Symbol(""),Lb=Symbol(""),Bb=Symbol(""),zb=Symbol(""),Ub=Symbol(""),$b=Symbol(""),Vb=Symbol(""),jb=Symbol(""),Wb=Symbol(""),Hb=Symbol(""),qb=Symbol(""),Xb=Symbol(""),Gb=Symbol(""),Kb=Symbol(""),Yb=Symbol(""),Qb=Symbol(""),Jb={[mb]:"Fragment",[pb]:"Teleport",[fb]:"Suspense",[gb]:"KeepAlive",[bb]:"BaseTransition",[yb]:"openBlock",[wb]:"createBlock",[kb]:"createElementBlock",[Tb]:"createVNode",[_b]:"createElementVNode",[vb]:"createCommentVNode",[Sb]:"createTextVNode",[Eb]:"createStaticVNode",[Cb]:"resolveComponent",[Ib]:"resolveDynamicComponent",[xb]:"resolveDirective",[Ab]:"resolveFilter",[Pb]:"withDirectives",[Ob]:"renderList",[Nb]:"renderSlot",[Rb]:"createSlots",[Mb]:"toDisplayString",[Db]:"mergeProps",[Fb]:"normalizeClass",[Lb]:"normalizeStyle",[Bb]:"normalizeProps",[zb]:"guardReactiveProps",[Ub]:"toHandlers",[$b]:"camelize",[Vb]:"capitalize",[jb]:"toHandlerKey",[Wb]:"setBlockTracking",[Hb]:"pushScopeId",[qb]:"popScopeId",[Xb]:"withCtx",[Gb]:"unref",[Kb]:"isRef",[Yb]:"withMemo",[Qb]:"isMemoSame"};function Zb(e){Object.getOwnPropertySymbols(e).forEach(t=>{Jb[t]=e[t]})}const ey={start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0},source:""};function ty(e,t=""){return{type:0,source:t,children:e,helpers:new Set,components:[],directives:[],hoists:[],imports:[],cached:[],temps:0,codegenNode:void 0,loc:ey}}function ny(e,t,n,r,s,i,a,o=!1,c=!1,l=!1,u=ey){return e&&(o?(e.helper(yb),e.helper(py(e.inSSR,l))):e.helper(my(e.inSSR,l)),a&&e.helper(Pb)),{type:13,tag:t,props:n,children:r,patchFlag:s,dynamicProps:i,directives:a,isBlock:o,disableTracking:c,isComponent:l,loc:u}}function ry(e,t=ey){return{type:17,loc:t,elements:e}}function sy(e,t=ey){return{type:15,loc:t,properties:e}}function iy(e,t){return{type:16,loc:ey,key:b(e)?ay(e,!0):e,value:t}}function ay(e,t=!1,n=ey,r=0){return{type:4,loc:n,content:e,isStatic:t,constType:t?3:r}}function oy(e,t=ey){return{type:8,loc:t,children:e}}function cy(e,t=[],n=ey){return{type:14,loc:n,callee:e,arguments:t}}function ly(e,t=void 0,n=!1,r=!1,s=ey){return{type:18,params:e,returns:t,newline:n,isSlot:r,loc:s}}function uy(e,t,n,r=!0){return{type:19,test:e,consequent:t,alternate:n,newline:r,loc:ey}}function dy(e,t,n=!1,r=!1){return{type:20,index:e,value:t,needPauseTracking:n,inVOnce:r,needArraySpread:!1,loc:ey}}function hy(e){return{type:21,body:e,loc:ey}}function my(e,t){return e||t?Tb:_b}function py(e,t){return e||t?wb:kb}function fy(e,{helper:t,removeHelper:n,inSSR:r}){e.isBlock||(e.isBlock=!0,n(my(r,e.isComponent)),t(yb),t(py(r,e.isComponent)))}const gy=new Uint8Array([123,123]),by=new Uint8Array([125,125]);function yy(e){return e>=97&&e<=122||e>=65&&e<=90}function wy(e){return 32===e||10===e||9===e||12===e||13===e}function ky(e){return 47===e||62===e||wy(e)}function Ty(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}const _y={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};const vy={COMPILER_IS_ON_ELEMENT:{message:'Platform-native elements with "is" prop will no longer be treated as components in Vue 3 unless the "is" value is explicitly prefixed with "vue:".',link:"https://v3-migration.vuejs.org/breaking-changes/custom-elements-interop.html"},COMPILER_V_BIND_SYNC:{message:e=>`.sync modifier for v-bind has been removed. Use v-model with argument instead. \`v-bind:${e}.sync\` should be changed to \`v-model:${e}\`.`,link:"https://v3-migration.vuejs.org/breaking-changes/v-model.html"},COMPILER_V_BIND_OBJECT_ORDER:{message:'v-bind="obj" usage is now order sensitive and behaves like JavaScript object spread: it will now overwrite an existing non-mergeable attribute that appears before v-bind in the case of conflict. To retain 2.x behavior, move v-bind to make it the first attribute. You can also suppress this warning if the usage is intended.',link:"https://v3-migration.vuejs.org/breaking-changes/v-bind.html"},COMPILER_V_ON_NATIVE:{message:".native modifier for v-on has been removed as is no longer necessary.",link:"https://v3-migration.vuejs.org/breaking-changes/v-on-native-modifier-removed.html"},COMPILER_V_IF_V_FOR_PRECEDENCE:{message:"v-if / v-for precedence when used on the same element has changed in Vue 3: v-if now takes higher precedence and will no longer have access to v-for scope variables. It is best to avoid the ambiguity with <template> tags or use a computed property that filters v-for data source.",link:"https://v3-migration.vuejs.org/breaking-changes/v-if-v-for.html"},COMPILER_NATIVE_TEMPLATE:{message:"<template> with no special directives will render as a native template element instead of its inner content in Vue 3."},COMPILER_INLINE_TEMPLATE:{message:'"inline-template" has been removed in Vue 3.',link:"https://v3-migration.vuejs.org/breaking-changes/inline-template-attribute.html"},COMPILER_FILTERS:{message:'filters have been removed in Vue 3. The "|" symbol will be treated as native JavaScript bitwise OR operator. Use method calls or computed properties instead.',link:"https://v3-migration.vuejs.org/breaking-changes/filters.html"}};function Sy(e,{compatConfig:t}){const n=t&&t[e];return"MODE"===e?n||3:n}function Ey(e,t){const n=Sy("MODE",t),r=Sy(e,t);return 3===n?!0===r:!1!==r}function Cy(e,t,n,...r){return Ey(e,t)}function Iy(e){throw e}function xy(e){}function Ay(e,t,n,r){const s=new SyntaxError(String(`https://vuejs.org/error-reference/#compiler-${e}`));return s.code=e,s.loc=t,s}const Py={0:"Illegal comment.",1:"CDATA section is allowed only in XML context.",2:"Duplicate attribute.",3:"End tag cannot have attributes.",4:"Illegal '/' in tags.",5:"Unexpected EOF in tag.",6:"Unexpected EOF in CDATA section.",7:"Unexpected EOF in comment.",8:"Unexpected EOF in script.",9:"Unexpected EOF in tag.",10:"Incorrectly closed comment.",11:"Incorrectly opened comment.",12:"Illegal tag name. Use '&lt;' to print '<'.",13:"Attribute value was expected.",14:"End tag name was expected.",15:"Whitespace was expected.",16:"Unexpected '\x3c!--' in comment.",17:"Attribute name cannot contain U+0022 (\"), U+0027 ('), and U+003C (<).",18:"Unquoted attribute value cannot contain U+0022 (\"), U+0027 ('), U+003C (<), U+003D (=), and U+0060 (`).",19:"Attribute name cannot start with '='.",21:"'<?' is allowed only in XML context.",20:"Unexpected null character.",22:"Illegal '/' in tags.",23:"Invalid end tag.",24:"Element is missing end tag.",25:"Interpolation end sign was not found.",27:"End bracket for dynamic directive argument was not found. Note that dynamic directive argument cannot contain spaces.",26:"Legal directive name was expected.",28:"v-if/v-else-if is missing expression.",29:"v-if/else branches must use unique keys.",30:"v-else/v-else-if has no adjacent v-if or v-else-if.",31:"v-for is missing expression.",32:"v-for has invalid expression.",33:"<template v-for> key should be placed on the <template> tag.",34:"v-bind is missing expression.",52:"v-bind with same-name shorthand only allows static argument.",35:"v-on is missing expression.",36:"Unexpected custom directive on <slot> outlet.",37:"Mixed v-slot usage on both the component and nested <template>. When there are multiple named slots, all slots should use <template> syntax to avoid scope ambiguity.",38:"Duplicate slot names found. ",39:"Extraneous children found when component already has explicitly named default slot. These children will be ignored.",40:"v-slot can only be used on components or <template> tags.",41:"v-model is missing expression.",42:"v-model value must be a valid JavaScript member expression.",43:"v-model cannot be used on v-for or v-slot scope variables because they are not writable.",44:"v-model cannot be used on a prop, because local prop bindings are not writable.\nUse a v-bind binding combined with a v-on listener that emits update:x event instead.",45:"Error parsing JavaScript expression: ",46:"<KeepAlive> expects exactly one child component.",51:"@vnode-* hooks in templates are no longer supported. Use the vue: prefix instead. For example, @vnode-mounted should be changed to @vue:mounted. @vnode-* hooks support has been removed in 3.4.",47:'"prefixIdentifiers" option is not supported in this build of compiler.',48:"ES module mode is not supported in this build of compiler.",49:'"cacheHandlers" option is only supported when the "prefixIdentifiers" option is enabled.',50:'"scopeId" option is only supported in module mode.',53:""};function Oy(e){return"ForOfStatement"===e.type||"ForInStatement"===e.type||"ForStatement"===e.type}function Ny(e,t,n){const r="ForStatement"===e.type?e.init:e.left;if(r&&"VariableDeclaration"===r.type&&("var"===r.kind?t:!t))for(const s of r.declarations)for(const e of Ry(s.id))n(e)}function Ry(e,t=[]){switch(e.type){case"Identifier":t.push(e);break;case"MemberExpression":let n=e;for(;"MemberExpression"===n.type;)n=n.object;t.push(n);break;case"ObjectPattern":for(const r of e.properties)"RestElement"===r.type?Ry(r.argument,t):Ry(r.value,t);break;case"ArrayPattern":e.elements.forEach(e=>{e&&Ry(e,t)});break;case"RestElement":Ry(e.argument,t);break;case"AssignmentPattern":Ry(e.left,t)}return t}const My=e=>e&&("ObjectProperty"===e.type||"ObjectMethod"===e.type)&&!e.computed,Dy=["TSAsExpression","TSTypeAssertion","TSNonNullExpression","TSInstantiationExpression","TSSatisfiesExpression"];const Fy=e=>4===e.type&&e.isStatic;function Ly(e){switch(e){case"Teleport":case"teleport":return pb;case"Suspense":case"suspense":return fb;case"KeepAlive":case"keep-alive":return gb;case"BaseTransition":case"base-transition":return bb}}const By=/^\d|[^\$\w\xA0-\uFFFF]/,zy=e=>!By.test(e),Uy=/[A-Za-z_$\xA0-\uFFFF]/,$y=/[\.\?\w$\xA0-\uFFFF]/,Vy=/\s+[.[]\s*|\s*[.[]\s+/g,jy=e=>4===e.type?e.content:e.loc.source,Wy=e=>{const t=jy(e).trim().replace(Vy,e=>e.trim());let n=0,r=[],s=0,i=0,a=null;for(let o=0;o<t.length;o++){const e=t.charAt(o);switch(n){case 0:if("["===e)r.push(n),n=1,s++;else if("("===e)r.push(n),n=2,i++;else if(!(0===o?Uy:$y).test(e))return!1;break;case 1:"'"===e||'"'===e||"`"===e?(r.push(n),n=3,a=e):"["===e?s++:"]"===e&&(--s||(n=r.pop()));break;case 2:if("'"===e||'"'===e||"`"===e)r.push(n),n=3,a=e;else if("("===e)i++;else if(")"===e){if(o===t.length-1)return!1;--i||(n=r.pop())}break;case 3:e===a&&(n=r.pop(),a=null)}}return!s&&!i},Hy=r,qy=Wy,Xy=/^\s*(async\s*)?(\([^)]*?\)|[\w$_]+)\s*(:[^=]+)?=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,Gy=e=>Xy.test(jy(e)),Ky=r,Yy=Gy;function Qy(e,t,n=t.length){let r=0,s=-1;for(let i=0;i<n;i++)10===t.charCodeAt(i)&&(r++,s=i);return e.offset+=n,e.line+=r,e.column=-1===s?e.column+n:n-s,e}function Jy(e,t,n=!1){for(let r=0;r<e.props.length;r++){const s=e.props[r];if(7===s.type&&(n||s.exp)&&(b(t)?s.name===t:t.test(s.name)))return s}}function Zy(e,t,n=!1,r=!1){for(let s=0;s<e.props.length;s++){const i=e.props[s];if(6===i.type){if(n)continue;if(i.name===t&&(i.value||r))return i}else if("bind"===i.name&&(i.exp||r)&&ew(i.arg,t))return i}}function ew(e,t){return!(!e||!Fy(e)||e.content!==t)}function tw(e){return e.props.some(e=>!(7!==e.type||"bind"!==e.name||e.arg&&4===e.arg.type&&e.arg.isStatic))}function nw(e){return 5===e.type||2===e.type}function rw(e){return 7===e.type&&"slot"===e.name}function sw(e){return 1===e.type&&3===e.tagType}function iw(e){return 1===e.type&&2===e.tagType}const aw=new Set([Bb,zb]);function ow(e,t=[]){if(e&&!b(e)&&14===e.type){const n=e.callee;if(!b(n)&&aw.has(n))return ow(e.arguments[0],t.concat(e))}return[e,t]}function cw(e,t,n){let r,s,i=13===e.type?e.props:e.arguments[2],a=[];if(i&&!b(i)&&14===i.type){const e=ow(i);i=e[0],a=e[1],s=a[a.length-1]}if(null==i||b(i))r=sy([t]);else if(14===i.type){const e=i.arguments[0];b(e)||15!==e.type?i.callee===Ub?r=cy(n.helper(Db),[sy([t]),i]):i.arguments.unshift(sy([t])):lw(t,e)||e.properties.unshift(t),!r&&(r=i)}else 15===i.type?(lw(t,i)||i.properties.unshift(t),r=i):(r=cy(n.helper(Db),[sy([t]),i]),s&&s.callee===zb&&(s=a[a.length-2]));13===e.type?s?s.arguments[0]=r:e.props=r:s?s.arguments[0]=r:e.arguments[2]=r}function lw(e,t){let n=!1;if(4===e.key.type){const r=e.key.content;n=t.properties.some(e=>4===e.key.type&&e.key.content===r)}return n}function uw(e,t){return`_${t}_${e.replace(/[^\w]/g,(t,n)=>"-"===t?"_":e.charCodeAt(n).toString())}`}function dw(e){return 14===e.type&&e.callee===Yb?e.arguments[1].returns:e}const hw=/([\s\S]*?)\s+(?:in|of)\s+(\S[\s\S]*)/,mw={parseMode:"base",ns:0,delimiters:["{{","}}"],getNamespace:()=>0,isVoidTag:s,isPreTag:s,isIgnoreNewlineTag:s,isCustomElement:s,onError:Iy,onWarn:xy,comments:!1,prefixIdentifiers:!1};let pw=mw,fw=null,gw="",bw=null,yw=null,ww="",kw=-1,Tw=-1,_w=0,vw=!1,Sw=null;const Ew=[],Cw=new class{constructor(e,t){this.stack=e,this.cbs=t,this.state=1,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=1,this.inRCDATA=!1,this.inXML=!1,this.inVPre=!1,this.newlines=[],this.mode=0,this.delimiterOpen=gy,this.delimiterClose=by,this.delimiterIndex=-1,this.currentSequence=void 0,this.sequenceIndex=0}get inSFCRoot(){return 2===this.mode&&0===this.stack.length}reset(){this.state=1,this.mode=0,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=1,this.inRCDATA=!1,this.currentSequence=void 0,this.newlines.length=0,this.delimiterOpen=gy,this.delimiterClose=by}getPos(e){let t=1,n=e+1;for(let r=this.newlines.length-1;r>=0;r--){const s=this.newlines[r];if(e>s){t=r+2,n=e-s;break}}return{column:n,line:t,offset:e}}peek(){return this.buffer.charCodeAt(this.index+1)}stateText(e){60===e?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=5,this.sectionStart=this.index):this.inVPre||e!==this.delimiterOpen[0]||(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(e))}stateInterpolationOpen(e){if(e===this.delimiterOpen[this.delimiterIndex])if(this.delimiterIndex===this.delimiterOpen.length-1){const e=this.index+1-this.delimiterOpen.length;e>this.sectionStart&&this.cbs.ontext(this.sectionStart,e),this.state=3,this.sectionStart=e}else this.delimiterIndex++;else this.inRCDATA?(this.state=32,this.stateInRCDATA(e)):(this.state=1,this.stateText(e))}stateInterpolation(e){e===this.delimiterClose[0]&&(this.state=4,this.delimiterIndex=0,this.stateInterpolationClose(e))}stateInterpolationClose(e){e===this.delimiterClose[this.delimiterIndex]?this.delimiterIndex===this.delimiterClose.length-1?(this.cbs.oninterpolation(this.sectionStart,this.index+1),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):this.delimiterIndex++:(this.state=3,this.stateInterpolation(e))}stateSpecialStartSequence(e){const t=this.sequenceIndex===this.currentSequence.length;if(t?ky(e):(32|e)===this.currentSequence[this.sequenceIndex]){if(!t)return void this.sequenceIndex++}else this.inRCDATA=!1;this.sequenceIndex=0,this.state=6,this.stateInTagName(e)}stateInRCDATA(e){if(this.sequenceIndex===this.currentSequence.length){if(62===e||wy(e)){const t=this.index-this.currentSequence.length;if(this.sectionStart<t){const e=this.index;this.index=t,this.cbs.ontext(this.sectionStart,t),this.index=e}return this.sectionStart=t+2,this.stateInClosingTagName(e),void(this.inRCDATA=!1)}this.sequenceIndex=0}(32|e)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:0===this.sequenceIndex?this.currentSequence===_y.TitleEnd||this.currentSequence===_y.TextareaEnd&&!this.inSFCRoot?this.inVPre||e!==this.delimiterOpen[0]||(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(e)):this.fastForwardTo(60)&&(this.sequenceIndex=1):this.sequenceIndex=Number(60===e)}stateCDATASequence(e){e===_y.Cdata[this.sequenceIndex]?++this.sequenceIndex===_y.Cdata.length&&(this.state=28,this.currentSequence=_y.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=23,this.stateInDeclaration(e))}fastForwardTo(e){for(;++this.index<this.buffer.length;){const t=this.buffer.charCodeAt(this.index);if(10===t&&this.newlines.push(this.index),t===e)return!0}return this.index=this.buffer.length-1,!1}stateInCommentLike(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===_y.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index-2):this.cbs.oncomment(this.sectionStart,this.index-2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=1):0===this.sequenceIndex?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}startSpecial(e,t){this.enterRCDATA(e,t),this.state=31}enterRCDATA(e,t){this.inRCDATA=!0,this.currentSequence=e,this.sequenceIndex=t}stateBeforeTagName(e){33===e?(this.state=22,this.sectionStart=this.index+1):63===e?(this.state=24,this.sectionStart=this.index+1):yy(e)?(this.sectionStart=this.index,0===this.mode?this.state=6:this.inSFCRoot?this.state=34:this.inXML?this.state=6:this.state=116===e?30:115===e?29:6):47===e?this.state=8:(this.state=1,this.stateText(e))}stateInTagName(e){ky(e)&&this.handleTagName(e)}stateInSFCRootTagName(e){if(ky(e)){const t=this.buffer.slice(this.sectionStart,this.index);"template"!==t&&this.enterRCDATA(Ty("</"+t),0),this.handleTagName(e)}}handleTagName(e){this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(e)}stateBeforeClosingTagName(e){wy(e)||(62===e?(this.state=1,this.sectionStart=this.index+1):(this.state=yy(e)?9:27,this.sectionStart=this.index))}stateInClosingTagName(e){(62===e||wy(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=10,this.stateAfterClosingTagName(e))}stateAfterClosingTagName(e){62===e&&(this.state=1,this.sectionStart=this.index+1)}stateBeforeAttrName(e){62===e?(this.cbs.onopentagend(this.index),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):47===e?this.state=7:60===e&&47===this.peek()?(this.cbs.onopentagend(this.index),this.state=5,this.sectionStart=this.index):wy(e)||this.handleAttrStart(e)}handleAttrStart(e){118===e&&45===this.peek()?(this.state=13,this.sectionStart=this.index):46===e||58===e||64===e||35===e?(this.cbs.ondirname(this.index,this.index+1),this.state=14,this.sectionStart=this.index+1):(this.state=12,this.sectionStart=this.index)}stateInSelfClosingTag(e){62===e?(this.cbs.onselfclosingtag(this.index),this.state=1,this.sectionStart=this.index+1,this.inRCDATA=!1):wy(e)||(this.state=11,this.stateBeforeAttrName(e))}stateInAttrName(e){(61===e||ky(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.handleAttrNameEnd(e))}stateInDirName(e){61===e||ky(e)?(this.cbs.ondirname(this.sectionStart,this.index),this.handleAttrNameEnd(e)):58===e?(this.cbs.ondirname(this.sectionStart,this.index),this.state=14,this.sectionStart=this.index+1):46===e&&(this.cbs.ondirname(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDirArg(e){61===e||ky(e)?(this.cbs.ondirarg(this.sectionStart,this.index),this.handleAttrNameEnd(e)):91===e?this.state=15:46===e&&(this.cbs.ondirarg(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDynamicDirArg(e){93===e?this.state=14:(61===e||ky(e))&&(this.cbs.ondirarg(this.sectionStart,this.index+1),this.handleAttrNameEnd(e))}stateInDirModifier(e){61===e||ky(e)?(this.cbs.ondirmodifier(this.sectionStart,this.index),this.handleAttrNameEnd(e)):46===e&&(this.cbs.ondirmodifier(this.sectionStart,this.index),this.sectionStart=this.index+1)}handleAttrNameEnd(e){this.sectionStart=this.index,this.state=17,this.cbs.onattribnameend(this.index),this.stateAfterAttrName(e)}stateAfterAttrName(e){61===e?this.state=18:47===e||62===e?(this.cbs.onattribend(0,this.sectionStart),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(e)):wy(e)||(this.cbs.onattribend(0,this.sectionStart),this.handleAttrStart(e))}stateBeforeAttrValue(e){34===e?(this.state=19,this.sectionStart=this.index+1):39===e?(this.state=20,this.sectionStart=this.index+1):wy(e)||(this.sectionStart=this.index,this.state=21,this.stateInAttrValueNoQuotes(e))}handleInAttrValue(e,t){(e===t||this.fastForwardTo(t))&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(34===t?3:2,this.index+1),this.state=11)}stateInAttrValueDoubleQuotes(e){this.handleInAttrValue(e,34)}stateInAttrValueSingleQuotes(e){this.handleInAttrValue(e,39)}stateInAttrValueNoQuotes(e){wy(e)||62===e?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(1,this.index),this.state=11,this.stateBeforeAttrName(e)):39!==e&&60!==e&&61!==e&&96!==e||this.cbs.onerr(18,this.index)}stateBeforeDeclaration(e){91===e?(this.state=26,this.sequenceIndex=0):this.state=45===e?25:23}stateInDeclaration(e){(62===e||this.fastForwardTo(62))&&(this.state=1,this.sectionStart=this.index+1)}stateInProcessingInstruction(e){(62===e||this.fastForwardTo(62))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeComment(e){45===e?(this.state=28,this.currentSequence=_y.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=23}stateInSpecialComment(e){(62===e||this.fastForwardTo(62))&&(this.cbs.oncomment(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeSpecialS(e){e===_y.ScriptEnd[3]?this.startSpecial(_y.ScriptEnd,4):e===_y.StyleEnd[3]?this.startSpecial(_y.StyleEnd,4):(this.state=6,this.stateInTagName(e))}stateBeforeSpecialT(e){e===_y.TitleEnd[3]?this.startSpecial(_y.TitleEnd,4):e===_y.TextareaEnd[3]?this.startSpecial(_y.TextareaEnd,4):(this.state=6,this.stateInTagName(e))}startEntity(){}stateInEntity(){}parse(e){for(this.buffer=e;this.index<this.buffer.length;){const e=this.buffer.charCodeAt(this.index);switch(10===e&&33!==this.state&&this.newlines.push(this.index),this.state){case 1:this.stateText(e);break;case 2:this.stateInterpolationOpen(e);break;case 3:this.stateInterpolation(e);break;case 4:this.stateInterpolationClose(e);break;case 31:this.stateSpecialStartSequence(e);break;case 32:this.stateInRCDATA(e);break;case 26:this.stateCDATASequence(e);break;case 19:this.stateInAttrValueDoubleQuotes(e);break;case 12:this.stateInAttrName(e);break;case 13:this.stateInDirName(e);break;case 14:this.stateInDirArg(e);break;case 15:this.stateInDynamicDirArg(e);break;case 16:this.stateInDirModifier(e);break;case 28:this.stateInCommentLike(e);break;case 27:this.stateInSpecialComment(e);break;case 11:this.stateBeforeAttrName(e);break;case 6:this.stateInTagName(e);break;case 34:this.stateInSFCRootTagName(e);break;case 9:this.stateInClosingTagName(e);break;case 5:this.stateBeforeTagName(e);break;case 17:this.stateAfterAttrName(e);break;case 20:this.stateInAttrValueSingleQuotes(e);break;case 18:this.stateBeforeAttrValue(e);break;case 8:this.stateBeforeClosingTagName(e);break;case 10:this.stateAfterClosingTagName(e);break;case 29:this.stateBeforeSpecialS(e);break;case 30:this.stateBeforeSpecialT(e);break;case 21:this.stateInAttrValueNoQuotes(e);break;case 7:this.stateInSelfClosingTag(e);break;case 23:this.stateInDeclaration(e);break;case 22:this.stateBeforeDeclaration(e);break;case 25:this.stateBeforeComment(e);break;case 24:this.stateInProcessingInstruction(e);break;case 33:this.stateInEntity()}this.index++}this.cleanup(),this.finish()}cleanup(){this.sectionStart!==this.index&&(1===this.state||32===this.state&&0===this.sequenceIndex?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):19!==this.state&&20!==this.state&&21!==this.state||(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}finish(){this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const e=this.buffer.length;this.sectionStart>=e||(28===this.state?this.currentSequence===_y.CdataEnd?this.cbs.oncdata(this.sectionStart,e):this.cbs.oncomment(this.sectionStart,e):6===this.state||11===this.state||18===this.state||17===this.state||12===this.state||13===this.state||14===this.state||15===this.state||16===this.state||20===this.state||19===this.state||21===this.state||9===this.state||this.cbs.ontext(this.sectionStart,e))}emitCodePoint(e,t){}}(Ew,{onerr:qw,ontext(e,t){Ow(Aw(e,t),e,t)},ontextentity(e,t,n){Ow(e,t,n)},oninterpolation(e,t){if(vw)return Ow(Aw(e,t),e,t);let n=e+Cw.delimiterOpen.length,r=t-Cw.delimiterClose.length;for(;wy(gw.charCodeAt(n));)n++;for(;wy(gw.charCodeAt(r-1));)r--;let s=Aw(n,r);s.includes("&")&&(s=pw.decodeEntities(s,!1)),$w({type:5,content:Hw(s,!1,Vw(n,r)),loc:Vw(e,t)})},onopentagname(e,t){const n=Aw(e,t);bw={type:1,tag:n,ns:pw.getNamespace(n,Ew[0],pw.ns),tagType:0,props:[],children:[],loc:Vw(e-1,t),codegenNode:void 0}},onopentagend(e){Pw(e)},onclosetag(e,t){const n=Aw(e,t);if(!pw.isVoidTag(n)){let r=!1;for(let e=0;e<Ew.length;e++){if(Ew[e].tag.toLowerCase()===n.toLowerCase()){r=!0,e>0&&qw(24,Ew[0].loc.start.offset);for(let n=0;n<=e;n++){Nw(Ew.shift(),t,n<e)}break}}r||qw(23,Rw(e,60))}},onselfclosingtag(e){const t=bw.tag;bw.isSelfClosing=!0,Pw(e),Ew[0]&&Ew[0].tag===t&&Nw(Ew.shift(),e)},onattribname(e,t){yw={type:6,name:Aw(e,t),nameLoc:Vw(e,t),value:void 0,loc:Vw(e)}},ondirname(e,t){const n=Aw(e,t),r="."===n||":"===n?"bind":"@"===n?"on":"#"===n?"slot":n.slice(2);if(vw||""!==r||qw(26,e),vw||""===r)yw={type:6,name:n,nameLoc:Vw(e,t),value:void 0,loc:Vw(e)};else if(yw={type:7,name:r,rawName:n,exp:void 0,arg:void 0,modifiers:"."===n?[ay("prop")]:[],loc:Vw(e)},"pre"===r){vw=Cw.inVPre=!0,Sw=bw;const e=bw.props;for(let t=0;t<e.length;t++)7===e[t].type&&(e[t]=Ww(e[t]))}},ondirarg(e,t){if(e===t)return;const n=Aw(e,t);if(vw)yw.name+=n,jw(yw.nameLoc,t);else{const r="["!==n[0];yw.arg=Hw(r?n:n.slice(1,-1),r,Vw(e,t),r?3:0)}},ondirmodifier(e,t){const n=Aw(e,t);if(vw)yw.name+="."+n,jw(yw.nameLoc,t);else if("slot"===yw.name){const e=yw.arg;e&&(e.content+="."+n,jw(e.loc,t))}else{const r=ay(n,!0,Vw(e,t));yw.modifiers.push(r)}},onattribdata(e,t){ww+=Aw(e,t),kw<0&&(kw=e),Tw=t},onattribentity(e,t,n){ww+=e,kw<0&&(kw=t),Tw=n},onattribnameend(e){const t=yw.loc.start.offset,n=Aw(t,e);7===yw.type&&(yw.rawName=n),bw.props.some(e=>(7===e.type?e.rawName:e.name)===n)&&qw(2,t)},onattribend(e,t){if(bw&&yw){if(jw(yw.loc,t),0!==e)if(ww.includes("&")&&(ww=pw.decodeEntities(ww,!0)),6===yw.type)"class"===yw.name&&(ww=Uw(ww).trim()),1!==e||ww||qw(13,t),yw.value={type:2,content:ww,loc:1===e?Vw(kw,Tw):Vw(kw-1,Tw+1)},Cw.inSFCRoot&&"template"===bw.tag&&"lang"===yw.name&&ww&&"html"!==ww&&Cw.enterRCDATA(Ty("</template"),0);else{let e=0;yw.exp=Hw(ww,!1,Vw(kw,Tw),0,e),"for"===yw.name&&(yw.forParseResult=function(e){const t=e.loc,n=e.content,r=n.match(hw);if(!r)return;const[,s,i]=r,a=(e,n,r=!1)=>{const s=t.start.offset+n;return Hw(e,!1,Vw(s,s+e.length),0,r?1:0)},o={source:a(i.trim(),n.indexOf(i,s.length)),value:void 0,key:void 0,index:void 0,finalized:!1};let c=s.trim().replace(xw,"").trim();const l=s.indexOf(c),u=c.match(Iw);if(u){c=c.replace(Iw,"").trim();const e=u[1].trim();let t;if(e&&(t=n.indexOf(e,l+c.length),o.key=a(e,t,!0)),u[2]){const r=u[2].trim();r&&(o.index=a(r,n.indexOf(r,o.key?t+e.length:l+c.length),!0))}}c&&(o.value=a(c,l,!0));return o}(yw.exp));let t=-1;"bind"===yw.name&&(t=yw.modifiers.findIndex(e=>"sync"===e.content))>-1&&Cy("COMPILER_V_BIND_SYNC",pw,yw.loc,yw.arg.loc.source)&&(yw.name="model",yw.modifiers.splice(t,1))}7===yw.type&&"pre"===yw.name||bw.props.push(yw)}ww="",kw=Tw=-1},oncomment(e,t){pw.comments&&$w({type:3,content:Aw(e,t),loc:Vw(e-4,t+3)})},onend(){const e=gw.length;for(let t=0;t<Ew.length;t++)Nw(Ew[t],e-1),qw(24,Ew[t].loc.start.offset)},oncdata(e,t){0!==Ew[0].ns?Ow(Aw(e,t),e,t):qw(1,e-9)},onprocessinginstruction(e){0===(Ew[0]?Ew[0].ns:pw.ns)&&qw(21,e-1)}}),Iw=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,xw=/^\(|\)$/g;function Aw(e,t){return gw.slice(e,t)}function Pw(e){Cw.inSFCRoot&&(bw.innerLoc=Vw(e+1,e+1)),$w(bw);const{tag:t,ns:n}=bw;0===n&&pw.isPreTag(t)&&_w++,pw.isVoidTag(t)?Nw(bw,e):(Ew.unshift(bw),1!==n&&2!==n||(Cw.inXML=!0)),bw=null}function Ow(e,t,n){{const t=Ew[0]&&Ew[0].tag;"script"!==t&&"style"!==t&&e.includes("&")&&(e=pw.decodeEntities(e,!1))}const r=Ew[0]||fw,s=r.children[r.children.length-1];s&&2===s.type?(s.content+=e,jw(s.loc,n)):r.children.push({type:2,content:e,loc:Vw(t,n)})}function Nw(e,t,n=!1){jw(e.loc,n?Rw(t,60):function(e,t){let n=e;for(;gw.charCodeAt(n)!==t&&n<gw.length-1;)n++;return n}(t,62)+1),Cw.inSFCRoot&&(e.children.length?e.innerLoc.end=o({},e.children[e.children.length-1].loc.end):e.innerLoc.end=o({},e.innerLoc.start),e.innerLoc.source=Aw(e.innerLoc.start.offset,e.innerLoc.end.offset));const{tag:r,ns:s,children:i}=e;if(vw||("slot"===r?e.tagType=2:Dw(e)?e.tagType=3:function({tag:e,props:t}){if(pw.isCustomElement(e))return!1;if("component"===e||(n=e.charCodeAt(0),n>64&&n<91)||Ly(e)||pw.isBuiltInComponent&&pw.isBuiltInComponent(e)||pw.isNativeTag&&!pw.isNativeTag(e))return!0;var n;for(let r=0;r<t.length;r++){const e=t[r];if(6===e.type){if("is"===e.name&&e.value){if(e.value.content.startsWith("vue:"))return!0;if(Cy("COMPILER_IS_ON_ELEMENT",pw,e.loc))return!0}}else if("bind"===e.name&&ew(e.arg,"is")&&Cy("COMPILER_IS_ON_ELEMENT",pw,e.loc))return!0}return!1}(e)&&(e.tagType=1)),Cw.inRCDATA||(e.children=Lw(i)),0===s&&pw.isIgnoreNewlineTag(r)){const e=i[0];e&&2===e.type&&(e.content=e.content.replace(/^\r?\n/,""))}0===s&&pw.isPreTag(r)&&_w--,Sw===e&&(vw=Cw.inVPre=!1,Sw=null),Cw.inXML&&0===(Ew[0]?Ew[0].ns:pw.ns)&&(Cw.inXML=!1);{const t=e.props;if(!Cw.inSFCRoot&&Ey("COMPILER_NATIVE_TEMPLATE",pw)&&"template"===e.tag&&!Dw(e)){const t=Ew[0]||fw,n=t.children.indexOf(e);t.children.splice(n,1,...e.children)}const n=t.find(e=>6===e.type&&"inline-template"===e.name);n&&Cy("COMPILER_INLINE_TEMPLATE",pw,n.loc)&&e.children.length&&(n.value={type:2,content:Aw(e.children[0].loc.start.offset,e.children[e.children.length-1].loc.end.offset),loc:n.loc})}}function Rw(e,t){let n=e;for(;gw.charCodeAt(n)!==t&&n>=0;)n--;return n}const Mw=new Set(["if","else","else-if","for","slot"]);function Dw({tag:e,props:t}){if("template"===e)for(let n=0;n<t.length;n++)if(7===t[n].type&&Mw.has(t[n].name))return!0;return!1}const Fw=/\r\n/g;function Lw(e){const t="preserve"!==pw.whitespace;let n=!1;for(let r=0;r<e.length;r++){const s=e[r];if(2===s.type)if(_w)s.content=s.content.replace(Fw,"\n");else if(Bw(s.content)){const i=e[r-1]&&e[r-1].type,a=e[r+1]&&e[r+1].type;!i||!a||t&&(3===i&&(3===a||1===a)||1===i&&(3===a||1===a&&zw(s.content)))?(n=!0,e[r]=null):s.content=" "}else t&&(s.content=Uw(s.content))}return n?e.filter(Boolean):e}function Bw(e){for(let t=0;t<e.length;t++)if(!wy(e.charCodeAt(t)))return!1;return!0}function zw(e){for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);if(10===n||13===n)return!0}return!1}function Uw(e){let t="",n=!1;for(let r=0;r<e.length;r++)wy(e.charCodeAt(r))?n||(t+=" ",n=!0):(t+=e[r],n=!1);return t}function $w(e){(Ew[0]||fw).children.push(e)}function Vw(e,t){return{start:Cw.getPos(e),end:null==t?t:Cw.getPos(t),source:null==t?t:Aw(e,t)}}function jw(e,t){e.end=Cw.getPos(t),e.source=Aw(e.start.offset,t)}function Ww(e){const t={type:6,name:e.rawName,nameLoc:Vw(e.loc.start.offset,e.loc.start.offset+e.rawName.length),value:void 0,loc:e.loc};if(e.exp){const n=e.exp.loc;n.end.offset<e.loc.end.offset&&(n.start.offset--,n.start.column--,n.end.offset++,n.end.column++),t.value={type:2,content:e.exp.content,loc:n}}return t}function Hw(e,t=!1,n,r=0,s=0){return ay(e,t,n,r)}function qw(e,t,n){pw.onError(Ay(e,Vw(t,t)))}function Xw(e,t){if(Cw.reset(),bw=null,yw=null,ww="",kw=-1,Tw=-1,Ew.length=0,gw=e,pw=o({},mw),t){let e;for(e in t)null!=t[e]&&(pw[e]=t[e])}Cw.mode="html"===pw.parseMode?1:"sfc"===pw.parseMode?2:0,Cw.inXML=1===pw.ns||2===pw.ns;const n=t&&t.delimiters;n&&(Cw.delimiterOpen=Ty(n[0]),Cw.delimiterClose=Ty(n[1]));const r=fw=ty([],e);return Cw.parse(gw),r.loc=Vw(0,e.length),r.children=Lw(r.children),fw=null,r}function Gw(e,t){Yw(e,void 0,t,!!Kw(e))}function Kw(e){const t=e.children.filter(e=>3!==e.type);return 1!==t.length||1!==t[0].type||iw(t[0])?null:t[0]}function Yw(e,t,n,r=!1,s=!1){const{children:i}=e,a=[];for(let d=0;d<i.length;d++){const t=i[d];if(1===t.type&&0===t.tagType){const e=r?0:Qw(t,n);if(e>0){if(e>=2){t.codegenNode.patchFlag=-1,a.push(t);continue}}else{const e=t.codegenNode;if(13===e.type){const r=e.patchFlag;if((void 0===r||512===r||1===r)&&ek(t,n)>=2){const r=tk(t);r&&(e.props=n.hoist(r))}e.dynamicProps&&(e.dynamicProps=n.hoist(e.dynamicProps))}}}else if(12===t.type){if((r?0:Qw(t,n))>=2){a.push(t);continue}}if(1===t.type){const r=1===t.tagType;r&&n.scopes.vSlot++,Yw(t,e,n,!1,s),r&&n.scopes.vSlot--}else if(11===t.type)Yw(t,e,n,1===t.children.length,!0);else if(9===t.type)for(let r=0;r<t.branches.length;r++)Yw(t.branches[r],e,n,1===t.branches[r].children.length,s)}let o=!1;const c=[];if(a.length===i.length&&1===e.type)if(0===e.tagType&&e.codegenNode&&13===e.codegenNode.type&&d(e.codegenNode.children))e.codegenNode.children=l(ry(e.codegenNode.children)),o=!0;else if(1===e.tagType&&e.codegenNode&&13===e.codegenNode.type&&e.codegenNode.children&&!d(e.codegenNode.children)&&15===e.codegenNode.children.type){const t=u(e.codegenNode,"default");t&&(c.push(n.cached.length),t.returns=l(ry(t.returns)),o=!0)}else if(3===e.tagType&&t&&1===t.type&&1===t.tagType&&t.codegenNode&&13===t.codegenNode.type&&t.codegenNode.children&&!d(t.codegenNode.children)&&15===t.codegenNode.children.type){const r=Jy(e,"slot",!0),s=r&&r.arg&&u(t.codegenNode,r.arg);s&&(c.push(n.cached.length),s.returns=l(ry(s.returns)),o=!0)}if(!o)for(const d of a)c.push(n.cached.length),d.codegenNode=n.cache(d.codegenNode);function l(e){const t=n.cache(e);return s&&n.hmr&&(t.needArraySpread=!0),t}function u(e,t){if(e.children&&!d(e.children)&&15===e.children.type){const n=e.children.properties.find(e=>e.key===t||e.key.content===t);return n&&n.value}}c.length&&1===e.type&&1===e.tagType&&e.codegenNode&&13===e.codegenNode.type&&e.codegenNode.children&&!d(e.codegenNode.children)&&15===e.codegenNode.children.type&&e.codegenNode.children.properties.push(iy("__",ay(JSON.stringify(c),!1))),a.length&&n.transformHoist&&n.transformHoist(i,n,e)}function Qw(e,t){const{constantCache:n}=t;switch(e.type){case 1:if(0!==e.tagType)return 0;const r=n.get(e);if(void 0!==r)return r;const s=e.codegenNode;if(13!==s.type)return 0;if(s.isBlock&&"svg"!==e.tag&&"foreignObject"!==e.tag&&"math"!==e.tag)return 0;if(void 0===s.patchFlag){let r=3;const i=ek(e,t);if(0===i)return n.set(e,0),0;i<r&&(r=i);for(let s=0;s<e.children.length;s++){const i=Qw(e.children[s],t);if(0===i)return n.set(e,0),0;i<r&&(r=i)}if(r>1)for(let s=0;s<e.props.length;s++){const i=e.props[s];if(7===i.type&&"bind"===i.name&&i.exp){const s=Qw(i.exp,t);if(0===s)return n.set(e,0),0;s<r&&(r=s)}}if(s.isBlock){for(let t=0;t<e.props.length;t++){if(7===e.props[t].type)return n.set(e,0),0}t.removeHelper(yb),t.removeHelper(py(t.inSSR,s.isComponent)),s.isBlock=!1,t.helper(my(t.inSSR,s.isComponent))}return n.set(e,r),r}return n.set(e,0),0;case 2:case 3:return 3;case 9:case 11:case 10:default:return 0;case 5:case 12:return Qw(e.content,t);case 4:return e.constType;case 8:let i=3;for(let n=0;n<e.children.length;n++){const r=e.children[n];if(b(r)||y(r))continue;const s=Qw(r,t);if(0===s)return 0;s<i&&(i=s)}return i;case 20:return 2}}const Jw=new Set([Fb,Lb,Bb,zb]);function Zw(e,t){if(14===e.type&&!b(e.callee)&&Jw.has(e.callee)){const n=e.arguments[0];if(4===n.type)return Qw(n,t);if(14===n.type)return Zw(n,t)}return 0}function ek(e,t){let n=3;const r=tk(e);if(r&&15===r.type){const{properties:e}=r;for(let r=0;r<e.length;r++){const{key:s,value:i}=e[r],a=Qw(s,t);if(0===a)return a;let o;if(a<n&&(n=a),o=4===i.type?Qw(i,t):14===i.type?Zw(i,t):0,0===o)return o;o<n&&(n=o)}}return n}function tk(e){const t=e.codegenNode;if(13===t.type)return t.props}function nk(e,{filename:n="",prefixIdentifiers:s=!1,hoistStatic:i=!1,hmr:a=!1,cacheHandlers:o=!1,nodeTransforms:c=[],directiveTransforms:l={},transformHoist:u=null,isBuiltInComponent:d=r,isCustomElement:h=r,expressionPlugins:m=[],scopeId:p=null,slotted:f=!0,ssr:g=!1,inSSR:y=!1,ssrCssVars:w="",bindingMetadata:k=t,inline:T=!1,isTS:_=!1,onError:v=Iy,onWarn:S=xy,compatConfig:E}){const C=n.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),I={filename:n,selfName:C&&R(P(C[1])),prefixIdentifiers:s,hoistStatic:i,hmr:a,cacheHandlers:o,nodeTransforms:c,directiveTransforms:l,transformHoist:u,isBuiltInComponent:d,isCustomElement:h,expressionPlugins:m,scopeId:p,slotted:f,ssr:g,inSSR:y,ssrCssVars:w,bindingMetadata:k,inline:T,isTS:_,onError:v,onWarn:S,compatConfig:E,root:e,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],cached:[],constantCache:new WeakMap,temps:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,grandParent:null,currentNode:e,childIndex:0,inVOnce:!1,helper(e){const t=I.helpers.get(e)||0;return I.helpers.set(e,t+1),e},removeHelper(e){const t=I.helpers.get(e);if(t){const n=t-1;n?I.helpers.set(e,n):I.helpers.delete(e)}},helperString:e=>`_${Jb[I.helper(e)]}`,replaceNode(e){I.parent.children[I.childIndex]=I.currentNode=e},removeNode(e){const t=I.parent.children,n=e?t.indexOf(e):I.currentNode?I.childIndex:-1;e&&e!==I.currentNode?I.childIndex>n&&(I.childIndex--,I.onNodeRemoved()):(I.currentNode=null,I.onNodeRemoved()),I.parent.children.splice(n,1)},onNodeRemoved:r,addIdentifiers(e){},removeIdentifiers(e){},hoist(e){b(e)&&(e=ay(e)),I.hoists.push(e);const t=ay(`_hoisted_${I.hoists.length}`,!1,e.loc,2);return t.hoisted=e,t},cache(e,t=!1,n=!1){const r=dy(I.cached.length,e,t,n);return I.cached.push(r),r}};return I.filters=new Set,I}function rk(e,t){const n=nk(e,t);sk(e,n),t.hoistStatic&&Gw(e,n),t.ssr||function(e,t){const{helper:n}=t,{children:r}=e;if(1===r.length){const n=Kw(e);if(n&&n.codegenNode){const r=n.codegenNode;13===r.type&&fy(r,t),e.codegenNode=r}else e.codegenNode=r[0]}else if(r.length>1){let r=64;e.codegenNode=ny(t,n(mb),void 0,e.children,r,void 0,void 0,!0,void 0,!1)}}(e,n),e.helpers=new Set([...n.helpers.keys()]),e.components=[...n.components],e.directives=[...n.directives],e.imports=n.imports,e.hoists=n.hoists,e.temps=n.temps,e.cached=n.cached,e.transformed=!0,e.filters=[...n.filters]}function sk(e,t){t.currentNode=e;const{nodeTransforms:n}=t,r=[];for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s&&(d(s)?r.push(...s):r.push(s)),!t.currentNode)return;e=t.currentNode}switch(e.type){case 3:t.ssr||t.helper(vb);break;case 5:t.ssr||t.helper(Mb);break;case 9:for(let n=0;n<e.branches.length;n++)sk(e.branches[n],t);break;case 10:case 11:case 1:case 0:!function(e,t){let n=0;const r=()=>{n--};for(;n<e.children.length;n++){const s=e.children[n];b(s)||(t.grandParent=t.parent,t.parent=e,t.childIndex=n,t.onNodeRemoved=r,sk(s,t))}}(e,t)}t.currentNode=e;let s=r.length;for(;s--;)r[s]()}function ik(e,t){const n=b(e)?t=>t===e:t=>e.test(t);return(e,r)=>{if(1===e.type){const{props:s}=e;if(3===e.tagType&&s.some(rw))return;const i=[];for(let a=0;a<s.length;a++){const o=s[a];if(7===o.type&&n(o.name)){s.splice(a,1),a--;const n=t(e,o,r);n&&i.push(n)}}return i}}}const ak="/*@__PURE__*/",ok=e=>`${Jb[e]}: _${Jb[e]}`;function ck(e,t={}){const n=function(e,{mode:t="function",prefixIdentifiers:n="module"===t,sourceMap:r=!1,filename:s="template.vue.html",scopeId:i=null,optimizeImports:a=!1,runtimeGlobalName:o="Vue",runtimeModuleName:c="vue",ssrRuntimeModuleName:l="vue/server-renderer",ssr:u=!1,isTS:d=!1,inSSR:h=!1}){const m={mode:t,prefixIdentifiers:n,sourceMap:r,filename:s,scopeId:i,optimizeImports:a,runtimeGlobalName:o,runtimeModuleName:c,ssrRuntimeModuleName:l,ssr:u,isTS:d,inSSR:h,source:e.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper:e=>`_${Jb[e]}`,push(e,t=-2,n){m.code+=e},indent(){p(++m.indentLevel)},deindent(e=!1){e?--m.indentLevel:p(--m.indentLevel)},newline(){p(m.indentLevel)}};function p(e){m.push("\n"+"  ".repeat(e),0)}return m}(e,t);t.onContextCreated&&t.onContextCreated(n);const{mode:r,push:s,prefixIdentifiers:i,indent:a,deindent:o,newline:c,scopeId:l,ssr:u}=n,d=Array.from(e.helpers),h=d.length>0,m=!i&&"module"!==r;!function(e,t){const{ssr:n,prefixIdentifiers:r,push:s,newline:i,runtimeModuleName:a,runtimeGlobalName:o,ssrRuntimeModuleName:c}=t,l=o,u=Array.from(e.helpers);if(u.length>0&&(s(`const _Vue = ${l}\n`,-1),e.hoists.length)){s(`const { ${[Tb,_b,vb,Sb,Eb].filter(e=>u.includes(e)).map(ok).join(", ")} } = _Vue\n`,-1)}(function(e,t){if(!e.length)return;t.pure=!0;const{push:n,newline:r}=t;r();for(let s=0;s<e.length;s++){const i=e[s];i&&(n(`const _hoisted_${s+1} = `),hk(i,t),r())}t.pure=!1})(e.hoists,t),i(),s("return ")}(e,n);if(s(`function ${u?"ssrRender":"render"}(${(u?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ")}) {`),a(),m&&(s("with (_ctx) {"),a(),h&&(s(`const { ${d.map(ok).join(", ")} } = _Vue\n`,-1),c())),e.components.length&&(lk(e.components,"component",n),(e.directives.length||e.temps>0)&&c()),e.directives.length&&(lk(e.directives,"directive",n),e.temps>0&&c()),e.filters&&e.filters.length&&(c(),lk(e.filters,"filter",n),c()),e.temps>0){s("let ");for(let t=0;t<e.temps;t++)s(`${t>0?", ":""}_temp${t}`)}return(e.components.length||e.directives.length||e.temps)&&(s("\n",0),c()),u||s("return "),e.codegenNode?hk(e.codegenNode,n):s("null"),m&&(o(),s("}")),o(),s("}"),{ast:e,code:n.code,preamble:"",map:n.map?n.map.toJSON():void 0}}function lk(e,t,{helper:n,push:r,newline:s,isTS:i}){const a=n("filter"===t?Ab:"component"===t?Cb:xb);for(let o=0;o<e.length;o++){let n=e[o];const c=n.endsWith("__self");c&&(n=n.slice(0,-6)),r(`const ${uw(n,t)} = ${a}(${JSON.stringify(n)}${c?", true":""})${i?"!":""}`),o<e.length-1&&s()}}function uk(e,t){const n=e.length>3||!1;t.push("["),n&&t.indent(),dk(e,t,n),n&&t.deindent(),t.push("]")}function dk(e,t,n=!1,r=!0){const{push:s,newline:i}=t;for(let a=0;a<e.length;a++){const o=e[a];b(o)?s(o,-3):d(o)?uk(o,t):hk(o,t),a<e.length-1&&(n?(r&&s(","),i()):r&&s(", "))}}function hk(e,t){if(b(e))t.push(e,-3);else if(y(e))t.push(t.helper(e));else switch(e.type){case 1:case 9:case 11:case 12:hk(e.codegenNode,t);break;case 2:!function(e,t){t.push(JSON.stringify(e.content),-3,e)}(e,t);break;case 4:mk(e,t);break;case 5:!function(e,t){const{push:n,helper:r,pure:s}=t;s&&n(ak);n(`${r(Mb)}(`),hk(e.content,t),n(")")}(e,t);break;case 8:pk(e,t);break;case 3:!function(e,t){const{push:n,helper:r,pure:s}=t;s&&n(ak);n(`${r(vb)}(${JSON.stringify(e.content)})`,-3,e)}(e,t);break;case 13:!function(e,t){const{push:n,helper:r,pure:s}=t,{tag:i,props:a,children:o,patchFlag:c,dynamicProps:l,directives:u,isBlock:d,disableTracking:h,isComponent:m}=e;let p;c&&(p=String(c));u&&n(r(Pb)+"(");d&&n(`(${r(yb)}(${h?"true":""}), `);s&&n(ak);const f=d?py(t.inSSR,m):my(t.inSSR,m);n(r(f)+"(",-2,e),dk(function(e){let t=e.length;for(;t--&&null==e[t];);return e.slice(0,t+1).map(e=>e||"null")}([i,a,o,p,l]),t),n(")"),d&&n(")");u&&(n(", "),hk(u,t),n(")"))}(e,t);break;case 14:!function(e,t){const{push:n,helper:r,pure:s}=t,i=b(e.callee)?e.callee:r(e.callee);s&&n(ak);n(i+"(",-2,e),dk(e.arguments,t),n(")")}(e,t);break;case 15:!function(e,t){const{push:n,indent:r,deindent:s,newline:i}=t,{properties:a}=e;if(!a.length)return void n("{}",-2,e);const o=a.length>1||!1;n(o?"{":"{ "),o&&r();for(let c=0;c<a.length;c++){const{key:e,value:r}=a[c];fk(e,t),n(": "),hk(r,t),c<a.length-1&&(n(","),i())}o&&s(),n(o?"}":" }")}(e,t);break;case 17:!function(e,t){uk(e.elements,t)}(e,t);break;case 18:!function(e,t){const{push:n,indent:r,deindent:s}=t,{params:i,returns:a,body:o,newline:c,isSlot:l}=e;l&&n(`_${Jb[Xb]}(`);n("(",-2,e),d(i)?dk(i,t):i&&hk(i,t);n(") => "),(c||o)&&(n("{"),r());a?(c&&n("return "),d(a)?uk(a,t):hk(a,t)):o&&hk(o,t);(c||o)&&(s(),n("}"));l&&(e.isNonScopedSlot&&n(", undefined, true"),n(")"))}(e,t);break;case 19:!function(e,t){const{test:n,consequent:r,alternate:s,newline:i}=e,{push:a,indent:o,deindent:c,newline:l}=t;if(4===n.type){const e=!zy(n.content);e&&a("("),mk(n,t),e&&a(")")}else a("("),hk(n,t),a(")");i&&o(),t.indentLevel++,i||a(" "),a("? "),hk(r,t),t.indentLevel--,i&&l(),i||a(" "),a(": ");const u=19===s.type;u||t.indentLevel++;hk(s,t),u||t.indentLevel--;i&&c(!0)}(e,t);break;case 20:!function(e,t){const{push:n,helper:r,indent:s,deindent:i,newline:a}=t,{needPauseTracking:o,needArraySpread:c}=e;c&&n("[...(");n(`_cache[${e.index}] || (`),o&&(s(),n(`${r(Wb)}(-1`),e.inVOnce&&n(", true"),n("),"),a(),n("("));n(`_cache[${e.index}] = `),hk(e.value,t),o&&(n(`).cacheIndex = ${e.index},`),a(),n(`${r(Wb)}(1),`),a(),n(`_cache[${e.index}]`),i());n(")"),c&&n(")]")}(e,t);break;case 21:dk(e.body,t,!0,!1)}}function mk(e,t){const{content:n,isStatic:r}=e;t.push(r?JSON.stringify(n):n,-3,e)}function pk(e,t){for(let n=0;n<e.children.length;n++){const r=e.children[n];b(r)?t.push(r,-3):hk(r,t)}}function fk(e,t){const{push:n}=t;if(8===e.type)n("["),pk(e,t),n("]");else if(e.isStatic){n(zy(e.content)?e.content:JSON.stringify(e.content),-2,e)}else n(`[${e.content}]`,-3,e)}new RegExp("\\b"+"arguments,await,break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,let,new,return,super,switch,throw,try,var,void,while,with,yield".split(",").join("\\b|\\b")+"\\b");function gk(e,t,n=!1,r=!1,s=Object.create(t.identifiers)){return e}const bk=ik(/^(if|else|else-if)$/,(e,t,n)=>yk(e,t,n,(e,t,r)=>{const s=n.parent.children;let i=s.indexOf(e),a=0;for(;i-- >=0;){const e=s[i];e&&9===e.type&&(a+=e.branches.length)}return()=>{if(r)e.codegenNode=kk(t,a,n);else{const r=function(e){for(;;)if(19===e.type){if(19!==e.alternate.type)return e;e=e.alternate}else 20===e.type&&(e=e.value)}(e.codegenNode);r.alternate=kk(t,a+e.branches.length-1,n)}}}));function yk(e,t,n,r){if(!("else"===t.name||t.exp&&t.exp.content.trim())){const r=t.exp?t.exp.loc:e.loc;n.onError(Ay(28,t.loc)),t.exp=ay("true",!1,r)}if("if"===t.name){const i=wk(e,t),a={type:9,loc:(s=e.loc,Vw(s.start.offset,s.end.offset)),branches:[i]};if(n.replaceNode(a),r)return r(a,i,!0)}else{const s=n.parent.children;let i=s.indexOf(e);for(;i-- >=-1;){const a=s[i];if(a&&3===a.type)n.removeNode(a);else{if(!a||2!==a.type||a.content.trim().length){if(a&&9===a.type){"else-if"===t.name&&void 0===a.branches[a.branches.length-1].condition&&n.onError(Ay(30,e.loc)),n.removeNode();const s=wk(e,t);a.branches.push(s);const i=r&&r(a,s,!1);sk(s,n),i&&i(),n.currentNode=null}else n.onError(Ay(30,e.loc));break}n.removeNode(a)}}}var s}function wk(e,t){const n=3===e.tagType;return{type:10,loc:e.loc,condition:"else"===t.name?void 0:t.exp,children:n&&!Jy(e,"for")?e.children:[e],userKey:Zy(e,"key"),isTemplateIf:n}}function kk(e,t,n){return e.condition?uy(e.condition,Tk(e,t,n),cy(n.helper(vb),['""',"true"])):Tk(e,t,n)}function Tk(e,t,n){const{helper:r}=n,s=iy("key",ay(`${t}`,!1,ey,2)),{children:i}=e,a=i[0];if(1!==i.length||1!==a.type){if(1===i.length&&11===a.type){const e=a.codegenNode;return cw(e,s,n),e}{let t=64;return ny(n,r(mb),sy([s]),i,t,void 0,void 0,!0,!1,!1,e.loc)}}{const e=a.codegenNode,t=dw(e);return 13===t.type&&fy(t,n),cw(t,s,n),e}}const _k=(e,t,n)=>{const{modifiers:r,loc:s}=e,i=e.arg;let{exp:a}=e;if(a&&4===a.type&&!a.content.trim()&&(a=void 0),!a){if(4!==i.type||!i.isStatic)return n.onError(Ay(52,i.loc)),{props:[iy(i,ay("",!0,s))]};vk(e),a=e.exp}return 4!==i.type?(i.children.unshift("("),i.children.push(') || ""')):i.isStatic||(i.content=`${i.content} || ""`),r.some(e=>"camel"===e.content)&&(4===i.type?i.isStatic?i.content=P(i.content):i.content=`${n.helperString($b)}(${i.content})`:(i.children.unshift(`${n.helperString($b)}(`),i.children.push(")"))),n.inSSR||(r.some(e=>"prop"===e.content)&&Sk(i,"."),r.some(e=>"attr"===e.content)&&Sk(i,"^")),{props:[iy(i,a)]}},vk=(e,t)=>{const n=e.arg,r=P(n.content);e.exp=ay(r,!1,n.loc)},Sk=(e,t)=>{4===e.type?e.isStatic?e.content=t+e.content:e.content=`\`${t}\${${e.content}}\``:(e.children.unshift(`'${t}' + (`),e.children.push(")"))},Ek=ik("for",(e,t,n)=>{const{helper:r,removeHelper:s}=n;return Ck(e,t,n,t=>{const i=cy(r(Ob),[t.source]),a=sw(e),o=Jy(e,"memo"),c=Zy(e,"key",!1,!0);c&&7===c.type&&!c.exp&&vk(c);let l=c&&(6===c.type?c.value?ay(c.value.content,!0):void 0:c.exp);const u=c&&l?iy("key",l):null,d=4===t.source.type&&t.source.constType>0,h=d?64:c?128:256;return t.codegenNode=ny(n,r(mb),void 0,i,h,void 0,void 0,!0,!d,!1,e.loc),()=>{let c;const{children:h}=t,m=1!==h.length||1!==h[0].type,p=iw(e)?e:a&&1===e.children.length&&iw(e.children[0])?e.children[0]:null;if(p?(c=p.codegenNode,a&&u&&cw(c,u,n)):m?c=ny(n,r(mb),u?sy([u]):void 0,e.children,64,void 0,void 0,!0,void 0,!1):(c=h[0].codegenNode,a&&u&&cw(c,u,n),c.isBlock!==!d&&(c.isBlock?(s(yb),s(py(n.inSSR,c.isComponent))):s(my(n.inSSR,c.isComponent))),c.isBlock=!d,c.isBlock?(r(yb),r(py(n.inSSR,c.isComponent))):r(my(n.inSSR,c.isComponent))),o){const e=ly(xk(t.parseResult,[ay("_cached")]));e.body=hy([oy(["const _memo = (",o.exp,")"]),oy(["if (_cached",...l?[" && _cached.key === ",l]:[],` && ${n.helperString(Qb)}(_cached, _memo)) return _cached`]),oy(["const _item = ",c]),ay("_item.memo = _memo"),ay("return _item")]),i.arguments.push(e,ay("_cache"),ay(String(n.cached.length))),n.cached.push(null)}else i.arguments.push(ly(xk(t.parseResult),c,!0))}})});function Ck(e,t,n,r){if(!t.exp)return void n.onError(Ay(31,t.loc));const s=t.forParseResult;if(!s)return void n.onError(Ay(32,t.loc));Ik(s);const{addIdentifiers:i,removeIdentifiers:a,scopes:o}=n,{source:c,value:l,key:u,index:d}=s,h={type:11,loc:t.loc,source:c,valueAlias:l,keyAlias:u,objectIndexAlias:d,parseResult:s,children:sw(e)?e.children:[e]};n.replaceNode(h),o.vFor++;const m=r&&r(h);return()=>{o.vFor--,m&&m()}}function Ik(e,t){e.finalized||(e.finalized=!0)}function xk({value:e,key:t,index:n},r=[]){return function(e){let t=e.length;for(;t--&&!e[t];);return e.slice(0,t+1).map((e,t)=>e||ay("_".repeat(t+1),!1))}([e,t,n,...r])}const Ak=ay("undefined",!1),Pk=(e,t)=>{if(1===e.type&&(1===e.tagType||3===e.tagType)){const n=Jy(e,"slot");if(n)return n.exp,t.scopes.vSlot++,()=>{t.scopes.vSlot--}}},Ok=(e,t,n,r)=>ly(e,n,!1,!0,n.length?n[0].loc:r);function Nk(e,t,n=Ok){t.helper(Xb);const{children:r,loc:s}=e,i=[],a=[];let o=t.scopes.vSlot>0||t.scopes.vFor>0;const c=Jy(e,"slot",!0);if(c){const{arg:e,exp:t}=c;e&&!Fy(e)&&(o=!0),i.push(iy(e||ay("default",!0),n(t,void 0,r,s)))}let l=!1,u=!1;const d=[],h=new Set;let m=0;for(let g=0;g<r.length;g++){const e=r[g];let s;if(!sw(e)||!(s=Jy(e,"slot",!0))){3!==e.type&&d.push(e);continue}if(c){t.onError(Ay(37,s.loc));break}l=!0;const{children:p,loc:f}=e,{arg:b=ay("default",!0),exp:y,loc:w}=s;let k;Fy(b)?k=b?b.content:"default":o=!0;const T=Jy(e,"for"),_=n(y,T,p,f);let v,S;if(v=Jy(e,"if"))o=!0,a.push(uy(v.exp,Rk(b,_,m++),Ak));else if(S=Jy(e,/^else(-if)?$/,!0)){let e,n=g;for(;n--&&(e=r[n],3===e.type||!Dk(e)););if(e&&sw(e)&&Jy(e,/^(else-)?if$/)){let e=a[a.length-1];for(;19===e.alternate.type;)e=e.alternate;e.alternate=S.exp?uy(S.exp,Rk(b,_,m++),Ak):Rk(b,_,m++)}else t.onError(Ay(30,S.loc))}else if(T){o=!0;const e=T.forParseResult;e?(Ik(e),a.push(cy(t.helper(Ob),[e.source,ly(xk(e),Rk(b,_),!0)]))):t.onError(Ay(32,T.loc))}else{if(k){if(h.has(k)){t.onError(Ay(38,w));continue}h.add(k),"default"===k&&(u=!0)}i.push(iy(b,_))}}if(!c){const e=(e,r)=>{const i=n(e,void 0,r,s);return t.compatConfig&&(i.isNonScopedSlot=!0),iy("default",i)};l?d.length&&d.some(e=>Dk(e))&&(u?t.onError(Ay(39,d[0].loc)):i.push(e(void 0,d))):i.push(e(void 0,r))}const p=o?2:Mk(e.children)?3:1;let f=sy(i.concat(iy("_",ay(p+"",!1))),s);return a.length&&(f=cy(t.helper(Rb),[f,ry(a)])),{slots:f,hasDynamicSlots:o}}function Rk(e,t,n){const r=[iy("name",e),iy("fn",t)];return null!=n&&r.push(iy("key",ay(String(n),!0))),sy(r)}function Mk(e){for(let t=0;t<e.length;t++){const n=e[t];switch(n.type){case 1:if(2===n.tagType||Mk(n.children))return!0;break;case 9:if(Mk(n.branches))return!0;break;case 10:case 11:if(Mk(n.children))return!0}}return!1}function Dk(e){return 2!==e.type&&12!==e.type||(2===e.type?!!e.content.trim():Dk(e.content))}const Fk=new WeakMap,Lk=(e,t)=>function(){if(1!==(e=t.currentNode).type||0!==e.tagType&&1!==e.tagType)return;const{tag:n,props:r}=e,s=1===e.tagType;let i=s?Bk(e,t):`"${n}"`;const a=w(i)&&i.callee===Ib;let o,c,l,u,d,h=0,m=a||i===pb||i===fb||!s&&("svg"===n||"foreignObject"===n||"math"===n);if(r.length>0){const n=zk(e,t,void 0,s,a);o=n.props,h=n.patchFlag,u=n.dynamicPropNames;const r=n.directives;d=r&&r.length?ry(r.map(e=>Vk(e,t))):void 0,n.shouldUseBlock&&(m=!0)}if(e.children.length>0){i===gb&&(m=!0,h|=1024);if(s&&i!==pb&&i!==gb){const{slots:n,hasDynamicSlots:r}=Nk(e,t);c=n,r&&(h|=1024)}else if(1===e.children.length&&i!==pb){const n=e.children[0],r=n.type,s=5===r||8===r;s&&0===Qw(n,t)&&(h|=1),c=s||2===r?n:e.children}else c=e.children}u&&u.length&&(l=function(e){let t="[";for(let n=0,r=e.length;n<r;n++)t+=JSON.stringify(e[n]),n<r-1&&(t+=", ");return t+"]"}(u)),e.codegenNode=ny(t,i,o,c,0===h?void 0:h,l,d,!!m,!1,s,e.loc)};function Bk(e,t,n=!1){let{tag:r}=e;const s=jk(r),i=Zy(e,"is",!1,!0);if(i)if(s||Ey("COMPILER_IS_ON_ELEMENT",t)){let e;if(6===i.type?e=i.value&&ay(i.value.content,!0):(e=i.exp,e||(e=ay("is",!1,i.arg.loc))),e)return cy(t.helper(Ib),[e])}else 6===i.type&&i.value.content.startsWith("vue:")&&(r=i.value.content.slice(4));const a=Ly(r)||t.isBuiltInComponent(r);return a?(n||t.helper(a),a):(t.helper(Cb),t.components.add(r),uw(r,"component"))}function zk(e,t,n=e.props,r,s,a=!1){const{tag:o,loc:c,children:l}=e;let u=[];const d=[],h=[],m=l.length>0;let p=!1,f=0,g=!1,b=!1,w=!1,k=!1,T=!1,_=!1;const v=[],S=e=>{u.length&&(d.push(sy(Uk(u),c)),u=[]),e&&d.push(e)},E=()=>{t.scopes.vFor>0&&u.push(iy(ay("ref_for",!0),ay("true")))},x=({key:e,value:n})=>{if(Fy(e)){const a=e.content,o=i(a);if(!o||r&&!s||"onclick"===a.toLowerCase()||"onUpdate:modelValue"===a||C(a)||(k=!0),o&&C(a)&&(_=!0),o&&14===n.type&&(n=n.arguments[0]),20===n.type||(4===n.type||8===n.type)&&Qw(n,t)>0)return;"ref"===a?g=!0:"class"===a?b=!0:"style"===a?w=!0:"key"===a||v.includes(a)||v.push(a),!r||"class"!==a&&"style"!==a||v.includes(a)||v.push(a)}else T=!0};for(let i=0;i<n.length;i++){const s=n[i];if(6===s.type){const{loc:e,name:n,nameLoc:r,value:i}=s;let a=!0;if("ref"===n&&(g=!0,E()),"is"===n&&(jk(o)||i&&i.content.startsWith("vue:")||Ey("COMPILER_IS_ON_ELEMENT",t)))continue;u.push(iy(ay(n,!0,r),ay(i?i.content:"",a,i?i.loc:e)))}else{const{name:n,arg:i,exp:l,loc:g,modifiers:b}=s,w="bind"===n,k="on"===n;if("slot"===n){r||t.onError(Ay(40,g));continue}if("once"===n||"memo"===n)continue;if("is"===n||w&&ew(i,"is")&&(jk(o)||Ey("COMPILER_IS_ON_ELEMENT",t)))continue;if(k&&a)continue;if((w&&ew(i,"key")||k&&m&&ew(i,"vue:before-update"))&&(p=!0),w&&ew(i,"ref")&&E(),!i&&(w||k)){if(T=!0,l)if(w){if(S(),Ey("COMPILER_V_BIND_OBJECT_ORDER",t)){d.unshift(l);continue}E(),S(),d.push(l)}else S({type:14,loc:g,callee:t.helper(Ub),arguments:r?[l]:[l,"true"]});else t.onError(Ay(w?34:35,g));continue}w&&b.some(e=>"prop"===e.content)&&(f|=32);const _=t.directiveTransforms[n];if(_){const{props:n,needRuntime:r}=_(s,e,t);!a&&n.forEach(x),k&&i&&!Fy(i)?S(sy(n,c)):u.push(...n),r&&(h.push(s),y(r)&&Fk.set(s,r))}else I(n)||(h.push(s),m&&(p=!0))}}let A;if(d.length?(S(),A=d.length>1?cy(t.helper(Db),d,c):d[0]):u.length&&(A=sy(Uk(u),c)),T?f|=16:(b&&!r&&(f|=2),w&&!r&&(f|=4),v.length&&(f|=8),k&&(f|=32)),p||0!==f&&32!==f||!(g||_||h.length>0)||(f|=512),!t.inSSR&&A)switch(A.type){case 15:let e=-1,n=-1,r=!1;for(let t=0;t<A.properties.length;t++){const s=A.properties[t].key;Fy(s)?"class"===s.content?e=t:"style"===s.content&&(n=t):s.isHandlerKey||(r=!0)}const s=A.properties[e],i=A.properties[n];r?A=cy(t.helper(Bb),[A]):(s&&!Fy(s.value)&&(s.value=cy(t.helper(Fb),[s.value])),i&&(w||4===i.value.type&&"["===i.value.content.trim()[0]||17===i.value.type)&&(i.value=cy(t.helper(Lb),[i.value])));break;case 14:break;default:A=cy(t.helper(Bb),[cy(t.helper(zb),[A])])}return{props:A,directives:h,patchFlag:f,dynamicPropNames:v,shouldUseBlock:p}}function Uk(e){const t=new Map,n=[];for(let r=0;r<e.length;r++){const s=e[r];if(8===s.key.type||!s.key.isStatic){n.push(s);continue}const a=s.key.content,o=t.get(a);o?("style"===a||"class"===a||i(a))&&$k(o,s):(t.set(a,s),n.push(s))}return n}function $k(e,t){17===e.value.type?e.value.elements.push(t.value):e.value=ry([e.value,t.value],e.loc)}function Vk(e,t){const n=[],r=Fk.get(e);r?n.push(t.helperString(r)):(t.helper(xb),t.directives.add(e.name),n.push(uw(e.name,"directive")));const{loc:s}=e;if(e.exp&&n.push(e.exp),e.arg&&(e.exp||n.push("void 0"),n.push(e.arg)),Object.keys(e.modifiers).length){e.arg||(e.exp||n.push("void 0"),n.push("void 0"));const t=ay("true",!1,s);n.push(sy(e.modifiers.map(e=>iy(e,t)),s))}return ry(n,e.loc)}function jk(e){return"component"===e||"Component"===e}const Wk=(e,t)=>{if(iw(e)){const{children:n,loc:r}=e,{slotName:s,slotProps:i}=Hk(e,t),a=[t.prefixIdentifiers?"_ctx.$slots":"$slots",s,"{}","undefined","true"];let o=2;i&&(a[2]=i,o=3),n.length&&(a[3]=ly([],n,!1,!1,r),o=4),t.scopeId&&!t.slotted&&(o=5),a.splice(o),e.codegenNode=cy(t.helper(Nb),a,r)}};function Hk(e,t){let n,r='"default"';const s=[];for(let i=0;i<e.props.length;i++){const t=e.props[i];if(6===t.type)t.value&&("name"===t.name?r=JSON.stringify(t.value.content):(t.name=P(t.name),s.push(t)));else if("bind"===t.name&&ew(t.arg,"name")){if(t.exp)r=t.exp;else if(t.arg&&4===t.arg.type){const e=P(t.arg.content);r=t.exp=ay(e,!1,t.arg.loc)}}else"bind"===t.name&&t.arg&&Fy(t.arg)&&(t.arg.content=P(t.arg.content)),s.push(t)}if(s.length>0){const{props:r,directives:i}=zk(e,t,s,!1,!1);n=r,i.length&&t.onError(Ay(36,i[0].loc))}return{slotName:r,slotProps:n}}const qk=(e,t,n,r)=>{const{loc:s,modifiers:i,arg:a}=e;let o;if(e.exp||i.length||n.onError(Ay(35,s)),4===a.type)if(a.isStatic){let e=a.content;e.startsWith("vue:")&&(e=`vnode-${e.slice(4)}`);o=ay(0!==t.tagType||e.startsWith("vnode")||!/[A-Z]/.test(e)?M(P(e)):`on:${e}`,!0,a.loc)}else o=oy([`${n.helperString(jb)}(`,a,")"]);else o=a,o.children.unshift(`${n.helperString(jb)}(`),o.children.push(")");let c=e.exp;c&&!c.content.trim()&&(c=void 0);let l=n.cacheHandlers&&!c&&!n.inVOnce;if(c){const e=qy(c),t=!(e||Yy(c)),n=c.content.includes(";");(t||l&&e)&&(c=oy([`${t?"$event":"(...args)"} => ${n?"{":"("}`,c,n?"}":")"]))}let u={props:[iy(o,c||ay("() => {}",!1,s))]};return r&&(u=r(u)),l&&(u.props[0].value=n.cache(u.props[0].value)),u.props.forEach(e=>e.key.isHandlerKey=!0),u},Xk=(e,t)=>{if(0===e.type||1===e.type||11===e.type||10===e.type)return()=>{const n=e.children;let r,s=!1;for(let e=0;e<n.length;e++){const t=n[e];if(nw(t)){s=!0;for(let s=e+1;s<n.length;s++){const i=n[s];if(!nw(i)){r=void 0;break}r||(r=n[e]=oy([t],t.loc)),r.children.push(" + ",i),n.splice(s,1),s--}}}if(s&&(1!==n.length||0!==e.type&&(1!==e.type||0!==e.tagType||e.props.find(e=>7===e.type&&!t.directiveTransforms[e.name])||"template"===e.tag)))for(let e=0;e<n.length;e++){const r=n[e];if(nw(r)||8===r.type){const s=[];2===r.type&&" "===r.content||s.push(r),t.ssr||0!==Qw(r,t)||s.push("1"),n[e]={type:12,content:r,loc:r.loc,codegenNode:cy(t.helper(Sb),s)}}}}},Gk=new WeakSet,Kk=(e,t)=>{if(1===e.type&&Jy(e,"once",!0)){if(Gk.has(e)||t.inVOnce||t.inSSR)return;return Gk.add(e),t.inVOnce=!0,t.helper(Wb),()=>{t.inVOnce=!1;const e=t.currentNode;e.codegenNode&&(e.codegenNode=t.cache(e.codegenNode,!0,!0))}}},Yk=(e,t,n)=>{const{exp:r,arg:s}=e;if(!r)return n.onError(Ay(41,e.loc)),Qk();const i=r.loc.source.trim(),a=4===r.type?r.content:i,o=n.bindingMetadata[i];if("props"===o||"props-aliased"===o)return n.onError(Ay(44,r.loc)),Qk();if(!a.trim()||!qy(r))return n.onError(Ay(42,r.loc)),Qk();const c=s||ay("modelValue",!0),l=s?Fy(s)?`onUpdate:${P(s.content)}`:oy(['"onUpdate:" + ',s]):"onUpdate:modelValue";let u;u=oy([`${n.isTS?"($event: any)":"$event"} => ((`,r,") = $event)"]);const d=[iy(c,e.exp),iy(l,u)];if(e.modifiers.length&&1===t.tagType){const t=e.modifiers.map(e=>e.content).map(e=>(zy(e)?e:JSON.stringify(e))+": true").join(", "),n=s?Fy(s)?`${s.content}Modifiers`:oy([s,' + "Modifiers"']):"modelModifiers";d.push(iy(n,ay(`{ ${t} }`,!1,e.loc,2)))}return Qk(d)};function Qk(e=[]){return{props:e}}const Jk=/[\w).+\-_$\]]/,Zk=(e,t)=>{Ey("COMPILER_FILTERS",t)&&(5===e.type?eT(e.content,t):1===e.type&&e.props.forEach(e=>{7===e.type&&"for"!==e.name&&e.exp&&eT(e.exp,t)}))};function eT(e,t){if(4===e.type)tT(e,t);else for(let n=0;n<e.children.length;n++){const r=e.children[n];"object"==typeof r&&(4===r.type?tT(r,t):8===r.type?eT(e,t):5===r.type&&eT(r.content,t))}}function tT(e,t){const n=e.content;let r,s,i,a,o=!1,c=!1,l=!1,u=!1,d=0,h=0,m=0,p=0,f=[];for(i=0;i<n.length;i++)if(s=r,r=n.charCodeAt(i),o)39===r&&92!==s&&(o=!1);else if(c)34===r&&92!==s&&(c=!1);else if(l)96===r&&92!==s&&(l=!1);else if(u)47===r&&92!==s&&(u=!1);else if(124!==r||124===n.charCodeAt(i+1)||124===n.charCodeAt(i-1)||d||h||m){switch(r){case 34:c=!0;break;case 39:o=!0;break;case 96:l=!0;break;case 40:m++;break;case 41:m--;break;case 91:h++;break;case 93:h--;break;case 123:d++;break;case 125:d--}if(47===r){let e,t=i-1;for(;t>=0&&(e=n.charAt(t)," "===e);t--);e&&Jk.test(e)||(u=!0)}}else void 0===a?(p=i+1,a=n.slice(0,i).trim()):g();function g(){f.push(n.slice(p,i).trim()),p=i+1}if(void 0===a?a=n.slice(0,i).trim():0!==p&&g(),f.length){for(i=0;i<f.length;i++)a=nT(a,f[i],t);e.content=a,e.ast=void 0}}function nT(e,t,n){n.helper(Ab);const r=t.indexOf("(");if(r<0)return n.filters.add(t),`${uw(t,"filter")}(${e})`;{const s=t.slice(0,r),i=t.slice(r+1);return n.filters.add(s),`${uw(s,"filter")}(${e}${")"!==i?","+i:i}`}}const rT=new WeakSet,sT=(e,t)=>{if(1===e.type){const n=Jy(e,"memo");if(!n||rT.has(e))return;return rT.add(e),()=>{const r=e.codegenNode||t.currentNode.codegenNode;r&&13===r.type&&(1!==e.tagType&&fy(r,t),e.codegenNode=cy(t.helper(Yb),[n.exp,ly(void 0,r),"_cache",String(t.cached.length)]),t.cached.push(null))}}};function iT(e){return[[Kk,bk,sT,Ek,Zk,Wk,Lk,Pk,Xk],{on:qk,bind:_k,model:Yk}]}function aT(e,t={}){const n=t.onError||Iy,r="module"===t.mode;!0===t.prefixIdentifiers?n(Ay(47)):r&&n(Ay(48));t.cacheHandlers&&n(Ay(49)),t.scopeId&&!r&&n(Ay(50));const s=o({},t,{prefixIdentifiers:!1}),i=b(e)?Xw(e,s):e,[a,c]=iT();return rk(i,o({},s,{nodeTransforms:[...a,...t.nodeTransforms||[]],directiveTransforms:o({},c,t.directiveTransforms||{})})),ck(i,s)}const oT=()=>({props:[]}),cT=Symbol(""),lT=Symbol(""),uT=Symbol(""),dT=Symbol(""),hT=Symbol(""),mT=Symbol(""),pT=Symbol(""),fT=Symbol(""),gT=Symbol(""),bT=Symbol("");let yT;Zb({[cT]:"vModelRadio",[lT]:"vModelCheckbox",[uT]:"vModelText",[dT]:"vModelSelect",[hT]:"vModelDynamic",[mT]:"withModifiers",[pT]:"withKeys",[fT]:"vShow",[gT]:"Transition",[bT]:"TransitionGroup"});const wT={parseMode:"html",isVoidTag:se,isNativeTag:e=>te(e)||ne(e)||re(e),isPreTag:e=>"pre"===e,isIgnoreNewlineTag:e=>"pre"===e||"textarea"===e,decodeEntities:function(e,t=!1){return yT||(yT=document.createElement("div")),t?(yT.innerHTML=`<div foo="${e.replace(/"/g,"&quot;")}">`,yT.children[0].getAttribute("foo")):(yT.innerHTML=e,yT.textContent)},isBuiltInComponent:e=>"Transition"===e||"transition"===e?gT:"TransitionGroup"===e||"transition-group"===e?bT:void 0,getNamespace(e,t,n){let r=t?t.ns:n;if(t&&2===r)if("annotation-xml"===t.tag){if("svg"===e)return 1;t.props.some(e=>6===e.type&&"encoding"===e.name&&null!=e.value&&("text/html"===e.value.content||"application/xhtml+xml"===e.value.content))&&(r=0)}else/^m(?:[ions]|text)$/.test(t.tag)&&"mglyph"!==e&&"malignmark"!==e&&(r=0);else t&&1===r&&("foreignObject"!==t.tag&&"desc"!==t.tag&&"title"!==t.tag||(r=0));if(0===r){if("svg"===e)return 1;if("math"===e)return 2}return r}},kT=e=>{1===e.type&&e.props.forEach((t,n)=>{6===t.type&&"style"===t.name&&t.value&&(e.props[n]={type:7,name:"bind",arg:ay("style",!0,t.loc),exp:TT(t.value.content,t.loc),modifiers:[],loc:t.loc})})},TT=(e,t)=>{const n=J(e);return ay(JSON.stringify(n),!1,t,3)};function _T(e,t){return Ay(e,t)}const vT={53:"v-html is missing expression.",54:"v-html will override element children.",55:"v-text is missing expression.",56:"v-text will override element children.",57:"v-model can only be used on <input>, <textarea> and <select> elements.",58:"v-model argument is not supported on plain elements.",59:"v-model cannot be used on file inputs since they are read-only. Use a v-on:change listener instead.",60:"Unnecessary value binding used alongside v-model. It will interfere with v-model's behavior.",61:"v-show is missing expression.",62:"<Transition> expects exactly one child element or component.",63:"Tags with side effect (<script> and <style>) are ignored in client component templates."},ST=e("passive,once,capture"),ET=e("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),CT=e("left,right"),IT=e("onkeyup,onkeydown,onkeypress"),xT=(e,t)=>Fy(e)&&"onclick"===e.content.toLowerCase()?ay(t,!0):4!==e.type?oy(["(",e,`) === "onClick" ? "${t}" : (`,e,")"]):e,AT=(e,t)=>{1!==e.type||0!==e.tagType||"script"!==e.tag&&"style"!==e.tag||t.removeNode()},PT=[kT],OT={cloak:oT,html:(e,t,n)=>{const{exp:r,loc:s}=e;return r||n.onError(_T(53,s)),t.children.length&&(n.onError(_T(54,s)),t.children.length=0),{props:[iy(ay("innerHTML",!0,s),r||ay("",!0))]}},text:(e,t,n)=>{const{exp:r,loc:s}=e;return r||n.onError(_T(55,s)),t.children.length&&(n.onError(_T(56,s)),t.children.length=0),{props:[iy(ay("textContent",!0),r?Qw(r,n)>0?r:cy(n.helperString(Mb),[r],s):ay("",!0))]}},model:(e,t,n)=>{const r=Yk(e,t,n);if(!r.props.length||1===t.tagType)return r;e.arg&&n.onError(_T(58,e.arg.loc));const{tag:s}=t,i=n.isCustomElement(s);if("input"===s||"textarea"===s||"select"===s||i){let a=uT,o=!1;if("input"===s||i){const r=Zy(t,"type");if(r){if(7===r.type)a=hT;else if(r.value)switch(r.value.content){case"radio":a=cT;break;case"checkbox":a=lT;break;case"file":o=!0,n.onError(_T(59,e.loc))}}else tw(t)&&(a=hT)}else"select"===s&&(a=dT);o||(r.needRuntime=n.helper(a))}else n.onError(_T(57,e.loc));return r.props=r.props.filter(e=>!(4===e.key.type&&"modelValue"===e.key.content)),r},on:(e,t,n)=>qk(e,t,n,t=>{const{modifiers:r}=e;if(!r.length)return t;let{key:s,value:i}=t.props[0];const{keyModifiers:a,nonKeyModifiers:o,eventOptionModifiers:c}=((e,t,n)=>{const r=[],s=[],i=[];for(let a=0;a<t.length;a++){const o=t[a].content;"native"===o&&Cy("COMPILER_V_ON_NATIVE",n)||ST(o)?i.push(o):CT(o)?Fy(e)?IT(e.content.toLowerCase())?r.push(o):s.push(o):(r.push(o),s.push(o)):ET(o)?s.push(o):r.push(o)}return{keyModifiers:r,nonKeyModifiers:s,eventOptionModifiers:i}})(s,r,n,e.loc);if(o.includes("right")&&(s=xT(s,"onContextmenu")),o.includes("middle")&&(s=xT(s,"onMouseup")),o.length&&(i=cy(n.helper(mT),[i,JSON.stringify(o)])),!a.length||Fy(s)&&!IT(s.content.toLowerCase())||(i=cy(n.helper(pT),[i,JSON.stringify(a)])),c.length){const e=c.map(R).join("");s=Fy(s)?ay(`${s.content}${e}`,!0):oy(["(",s,`) + "${e}"`])}return{props:[iy(s,i)]}}),show:(e,t,n)=>{const{exp:r,loc:s}=e;return r||n.onError(_T(61,s)),{props:[],needRuntime:n.helper(fT)}}};const NT=Object.freeze(Object.defineProperty({__proto__:null,BASE_TRANSITION:bb,BindingTypes:{DATA:"data",PROPS:"props",PROPS_ALIASED:"props-aliased",SETUP_LET:"setup-let",SETUP_CONST:"setup-const",SETUP_REACTIVE_CONST:"setup-reactive-const",SETUP_MAYBE_REF:"setup-maybe-ref",SETUP_REF:"setup-ref",OPTIONS:"options",LITERAL_CONST:"literal-const"},CAMELIZE:$b,CAPITALIZE:Vb,CREATE_BLOCK:wb,CREATE_COMMENT:vb,CREATE_ELEMENT_BLOCK:kb,CREATE_ELEMENT_VNODE:_b,CREATE_SLOTS:Rb,CREATE_STATIC:Eb,CREATE_TEXT:Sb,CREATE_VNODE:Tb,CompilerDeprecationTypes:{COMPILER_IS_ON_ELEMENT:"COMPILER_IS_ON_ELEMENT",COMPILER_V_BIND_SYNC:"COMPILER_V_BIND_SYNC",COMPILER_V_BIND_OBJECT_ORDER:"COMPILER_V_BIND_OBJECT_ORDER",COMPILER_V_ON_NATIVE:"COMPILER_V_ON_NATIVE",COMPILER_V_IF_V_FOR_PRECEDENCE:"COMPILER_V_IF_V_FOR_PRECEDENCE",COMPILER_NATIVE_TEMPLATE:"COMPILER_NATIVE_TEMPLATE",COMPILER_INLINE_TEMPLATE:"COMPILER_INLINE_TEMPLATE",COMPILER_FILTERS:"COMPILER_FILTERS"},ConstantTypes:{NOT_CONSTANT:0,0:"NOT_CONSTANT",CAN_SKIP_PATCH:1,1:"CAN_SKIP_PATCH",CAN_CACHE:2,2:"CAN_CACHE",CAN_STRINGIFY:3,3:"CAN_STRINGIFY"},DOMDirectiveTransforms:OT,DOMErrorCodes:{X_V_HTML_NO_EXPRESSION:53,53:"X_V_HTML_NO_EXPRESSION",X_V_HTML_WITH_CHILDREN:54,54:"X_V_HTML_WITH_CHILDREN",X_V_TEXT_NO_EXPRESSION:55,55:"X_V_TEXT_NO_EXPRESSION",X_V_TEXT_WITH_CHILDREN:56,56:"X_V_TEXT_WITH_CHILDREN",X_V_MODEL_ON_INVALID_ELEMENT:57,57:"X_V_MODEL_ON_INVALID_ELEMENT",X_V_MODEL_ARG_ON_ELEMENT:58,58:"X_V_MODEL_ARG_ON_ELEMENT",X_V_MODEL_ON_FILE_INPUT_ELEMENT:59,59:"X_V_MODEL_ON_FILE_INPUT_ELEMENT",X_V_MODEL_UNNECESSARY_VALUE:60,60:"X_V_MODEL_UNNECESSARY_VALUE",X_V_SHOW_NO_EXPRESSION:61,61:"X_V_SHOW_NO_EXPRESSION",X_TRANSITION_INVALID_CHILDREN:62,62:"X_TRANSITION_INVALID_CHILDREN",X_IGNORED_SIDE_EFFECT_TAG:63,63:"X_IGNORED_SIDE_EFFECT_TAG",__EXTEND_POINT__:64,64:"__EXTEND_POINT__"},DOMErrorMessages:vT,DOMNodeTransforms:PT,ElementTypes:{ELEMENT:0,0:"ELEMENT",COMPONENT:1,1:"COMPONENT",SLOT:2,2:"SLOT",TEMPLATE:3,3:"TEMPLATE"},ErrorCodes:{ABRUPT_CLOSING_OF_EMPTY_COMMENT:0,0:"ABRUPT_CLOSING_OF_EMPTY_COMMENT",CDATA_IN_HTML_CONTENT:1,1:"CDATA_IN_HTML_CONTENT",DUPLICATE_ATTRIBUTE:2,2:"DUPLICATE_ATTRIBUTE",END_TAG_WITH_ATTRIBUTES:3,3:"END_TAG_WITH_ATTRIBUTES",END_TAG_WITH_TRAILING_SOLIDUS:4,4:"END_TAG_WITH_TRAILING_SOLIDUS",EOF_BEFORE_TAG_NAME:5,5:"EOF_BEFORE_TAG_NAME",EOF_IN_CDATA:6,6:"EOF_IN_CDATA",EOF_IN_COMMENT:7,7:"EOF_IN_COMMENT",EOF_IN_SCRIPT_HTML_COMMENT_LIKE_TEXT:8,8:"EOF_IN_SCRIPT_HTML_COMMENT_LIKE_TEXT",EOF_IN_TAG:9,9:"EOF_IN_TAG",INCORRECTLY_CLOSED_COMMENT:10,10:"INCORRECTLY_CLOSED_COMMENT",INCORRECTLY_OPENED_COMMENT:11,11:"INCORRECTLY_OPENED_COMMENT",INVALID_FIRST_CHARACTER_OF_TAG_NAME:12,12:"INVALID_FIRST_CHARACTER_OF_TAG_NAME",MISSING_ATTRIBUTE_VALUE:13,13:"MISSING_ATTRIBUTE_VALUE",MISSING_END_TAG_NAME:14,14:"MISSING_END_TAG_NAME",MISSING_WHITESPACE_BETWEEN_ATTRIBUTES:15,15:"MISSING_WHITESPACE_BETWEEN_ATTRIBUTES",NESTED_COMMENT:16,16:"NESTED_COMMENT",UNEXPECTED_CHARACTER_IN_ATTRIBUTE_NAME:17,17:"UNEXPECTED_CHARACTER_IN_ATTRIBUTE_NAME",UNEXPECTED_CHARACTER_IN_UNQUOTED_ATTRIBUTE_VALUE:18,18:"UNEXPECTED_CHARACTER_IN_UNQUOTED_ATTRIBUTE_VALUE",UNEXPECTED_EQUALS_SIGN_BEFORE_ATTRIBUTE_NAME:19,19:"UNEXPECTED_EQUALS_SIGN_BEFORE_ATTRIBUTE_NAME",UNEXPECTED_NULL_CHARACTER:20,20:"UNEXPECTED_NULL_CHARACTER",UNEXPECTED_QUESTION_MARK_INSTEAD_OF_TAG_NAME:21,21:"UNEXPECTED_QUESTION_MARK_INSTEAD_OF_TAG_NAME",UNEXPECTED_SOLIDUS_IN_TAG:22,22:"UNEXPECTED_SOLIDUS_IN_TAG",X_INVALID_END_TAG:23,23:"X_INVALID_END_TAG",X_MISSING_END_TAG:24,24:"X_MISSING_END_TAG",X_MISSING_INTERPOLATION_END:25,25:"X_MISSING_INTERPOLATION_END",X_MISSING_DIRECTIVE_NAME:26,26:"X_MISSING_DIRECTIVE_NAME",X_MISSING_DYNAMIC_DIRECTIVE_ARGUMENT_END:27,27:"X_MISSING_DYNAMIC_DIRECTIVE_ARGUMENT_END",X_V_IF_NO_EXPRESSION:28,28:"X_V_IF_NO_EXPRESSION",X_V_IF_SAME_KEY:29,29:"X_V_IF_SAME_KEY",X_V_ELSE_NO_ADJACENT_IF:30,30:"X_V_ELSE_NO_ADJACENT_IF",X_V_FOR_NO_EXPRESSION:31,31:"X_V_FOR_NO_EXPRESSION",X_V_FOR_MALFORMED_EXPRESSION:32,32:"X_V_FOR_MALFORMED_EXPRESSION",X_V_FOR_TEMPLATE_KEY_PLACEMENT:33,33:"X_V_FOR_TEMPLATE_KEY_PLACEMENT",X_V_BIND_NO_EXPRESSION:34,34:"X_V_BIND_NO_EXPRESSION",X_V_ON_NO_EXPRESSION:35,35:"X_V_ON_NO_EXPRESSION",X_V_SLOT_UNEXPECTED_DIRECTIVE_ON_SLOT_OUTLET:36,36:"X_V_SLOT_UNEXPECTED_DIRECTIVE_ON_SLOT_OUTLET",X_V_SLOT_MIXED_SLOT_USAGE:37,37:"X_V_SLOT_MIXED_SLOT_USAGE",X_V_SLOT_DUPLICATE_SLOT_NAMES:38,38:"X_V_SLOT_DUPLICATE_SLOT_NAMES",X_V_SLOT_EXTRANEOUS_DEFAULT_SLOT_CHILDREN:39,39:"X_V_SLOT_EXTRANEOUS_DEFAULT_SLOT_CHILDREN",X_V_SLOT_MISPLACED:40,40:"X_V_SLOT_MISPLACED",X_V_MODEL_NO_EXPRESSION:41,41:"X_V_MODEL_NO_EXPRESSION",X_V_MODEL_MALFORMED_EXPRESSION:42,42:"X_V_MODEL_MALFORMED_EXPRESSION",X_V_MODEL_ON_SCOPE_VARIABLE:43,43:"X_V_MODEL_ON_SCOPE_VARIABLE",X_V_MODEL_ON_PROPS:44,44:"X_V_MODEL_ON_PROPS",X_INVALID_EXPRESSION:45,45:"X_INVALID_EXPRESSION",X_KEEP_ALIVE_INVALID_CHILDREN:46,46:"X_KEEP_ALIVE_INVALID_CHILDREN",X_PREFIX_ID_NOT_SUPPORTED:47,47:"X_PREFIX_ID_NOT_SUPPORTED",X_MODULE_MODE_NOT_SUPPORTED:48,48:"X_MODULE_MODE_NOT_SUPPORTED",X_CACHE_HANDLER_NOT_SUPPORTED:49,49:"X_CACHE_HANDLER_NOT_SUPPORTED",X_SCOPE_ID_NOT_SUPPORTED:50,50:"X_SCOPE_ID_NOT_SUPPORTED",X_VNODE_HOOKS:51,51:"X_VNODE_HOOKS",X_V_BIND_INVALID_SAME_NAME_ARGUMENT:52,52:"X_V_BIND_INVALID_SAME_NAME_ARGUMENT",__EXTEND_POINT__:53,53:"__EXTEND_POINT__"},FRAGMENT:mb,GUARD_REACTIVE_PROPS:zb,IS_MEMO_SAME:Qb,IS_REF:Kb,KEEP_ALIVE:gb,MERGE_PROPS:Db,NORMALIZE_CLASS:Fb,NORMALIZE_PROPS:Bb,NORMALIZE_STYLE:Lb,Namespaces:{HTML:0,0:"HTML",SVG:1,1:"SVG",MATH_ML:2,2:"MATH_ML"},NodeTypes:{ROOT:0,0:"ROOT",ELEMENT:1,1:"ELEMENT",TEXT:2,2:"TEXT",COMMENT:3,3:"COMMENT",SIMPLE_EXPRESSION:4,4:"SIMPLE_EXPRESSION",INTERPOLATION:5,5:"INTERPOLATION",ATTRIBUTE:6,6:"ATTRIBUTE",DIRECTIVE:7,7:"DIRECTIVE",COMPOUND_EXPRESSION:8,8:"COMPOUND_EXPRESSION",IF:9,9:"IF",IF_BRANCH:10,10:"IF_BRANCH",FOR:11,11:"FOR",TEXT_CALL:12,12:"TEXT_CALL",VNODE_CALL:13,13:"VNODE_CALL",JS_CALL_EXPRESSION:14,14:"JS_CALL_EXPRESSION",JS_OBJECT_EXPRESSION:15,15:"JS_OBJECT_EXPRESSION",JS_PROPERTY:16,16:"JS_PROPERTY",JS_ARRAY_EXPRESSION:17,17:"JS_ARRAY_EXPRESSION",JS_FUNCTION_EXPRESSION:18,18:"JS_FUNCTION_EXPRESSION",JS_CONDITIONAL_EXPRESSION:19,19:"JS_CONDITIONAL_EXPRESSION",JS_CACHE_EXPRESSION:20,20:"JS_CACHE_EXPRESSION",JS_BLOCK_STATEMENT:21,21:"JS_BLOCK_STATEMENT",JS_TEMPLATE_LITERAL:22,22:"JS_TEMPLATE_LITERAL",JS_IF_STATEMENT:23,23:"JS_IF_STATEMENT",JS_ASSIGNMENT_EXPRESSION:24,24:"JS_ASSIGNMENT_EXPRESSION",JS_SEQUENCE_EXPRESSION:25,25:"JS_SEQUENCE_EXPRESSION",JS_RETURN_STATEMENT:26,26:"JS_RETURN_STATEMENT"},OPEN_BLOCK:yb,POP_SCOPE_ID:qb,PUSH_SCOPE_ID:Hb,RENDER_LIST:Ob,RENDER_SLOT:Nb,RESOLVE_COMPONENT:Cb,RESOLVE_DIRECTIVE:xb,RESOLVE_DYNAMIC_COMPONENT:Ib,RESOLVE_FILTER:Ab,SET_BLOCK_TRACKING:Wb,SUSPENSE:fb,TELEPORT:pb,TO_DISPLAY_STRING:Mb,TO_HANDLERS:Ub,TO_HANDLER_KEY:jb,TRANSITION:gT,TRANSITION_GROUP:bT,TS_NODE_TYPES:Dy,UNREF:Gb,V_MODEL_CHECKBOX:lT,V_MODEL_DYNAMIC:hT,V_MODEL_RADIO:cT,V_MODEL_SELECT:dT,V_MODEL_TEXT:uT,V_ON_WITH_KEYS:pT,V_ON_WITH_MODIFIERS:mT,V_SHOW:fT,WITH_CTX:Xb,WITH_DIRECTIVES:Pb,WITH_MEMO:Yb,advancePositionWithClone:function(e,t,n=t.length){return Qy({offset:e.offset,line:e.line,column:e.column},t,n)},advancePositionWithMutation:Qy,assert:function(e,t){if(!e)throw new Error(t||"unexpected compiler condition")},baseCompile:aT,baseParse:Xw,buildDirectiveArgs:Vk,buildProps:zk,buildSlots:Nk,checkCompatEnabled:Cy,compile:function(e,t={}){return aT(e,o({},wT,t,{nodeTransforms:[AT,...PT,...t.nodeTransforms||[]],directiveTransforms:o({},OT,t.directiveTransforms||{}),transformHoist:null}))},convertToBlock:fy,createArrayExpression:ry,createAssignmentExpression:function(e,t){return{type:24,left:e,right:t,loc:ey}},createBlockStatement:hy,createCacheExpression:dy,createCallExpression:cy,createCompilerError:Ay,createCompoundExpression:oy,createConditionalExpression:uy,createDOMCompilerError:_T,createForLoopParams:xk,createFunctionExpression:ly,createIfStatement:function(e,t,n){return{type:23,test:e,consequent:t,alternate:n,loc:ey}},createInterpolation:function(e,t){return{type:5,loc:t,content:b(e)?ay(e,!1,t):e}},createObjectExpression:sy,createObjectProperty:iy,createReturnStatement:function(e){return{type:26,returns:e,loc:ey}},createRoot:ty,createSequenceExpression:function(e){return{type:25,expressions:e,loc:ey}},createSimpleExpression:ay,createStructuralDirectiveTransform:ik,createTemplateLiteral:function(e){return{type:22,elements:e,loc:ey}},createTransformContext:nk,createVNodeCall:ny,errorMessages:Py,extractIdentifiers:Ry,findDir:Jy,findProp:Zy,forAliasRE:hw,generate:ck,generateCodeFrame:X,getBaseTransformPreset:iT,getConstantType:Qw,getMemoedVNodeCall:dw,getVNodeBlockHelper:py,getVNodeHelper:my,hasDynamicKeyVBind:tw,hasScopeRef:function e(t,n){if(!t||0===Object.keys(n).length)return!1;switch(t.type){case 1:for(let r=0;r<t.props.length;r++){const s=t.props[r];if(7===s.type&&(e(s.arg,n)||e(s.exp,n)))return!0}return t.children.some(t=>e(t,n));case 11:return!!e(t.source,n)||t.children.some(t=>e(t,n));case 9:return t.branches.some(t=>e(t,n));case 10:return!!e(t.condition,n)||t.children.some(t=>e(t,n));case 4:return!t.isStatic&&zy(t.content)&&!!n[t.content];case 8:return t.children.some(t=>w(t)&&e(t,n));case 5:case 12:return e(t.content,n);default:return!1}},helperNameMap:Jb,injectProp:cw,isCoreComponent:Ly,isFnExpression:Yy,isFnExpressionBrowser:Gy,isFnExpressionNode:Ky,isFunctionType:e=>/Function(?:Expression|Declaration)$|Method$/.test(e.type),isInDestructureAssignment:function(e,t){if(e&&("ObjectProperty"===e.type||"ArrayPattern"===e.type)){let e=t.length;for(;e--;){const n=t[e];if("AssignmentExpression"===n.type)return!0;if("ObjectProperty"!==n.type&&!n.type.endsWith("Pattern"))break}}return!1},isInNewExpression:function(e){let t=e.length;for(;t--;){const n=e[t];if("NewExpression"===n.type)return!0;if("MemberExpression"!==n.type)break}return!1},isMemberExpression:qy,isMemberExpressionBrowser:Wy,isMemberExpressionNode:Hy,isReferencedIdentifier:function(e,t,n){return!1},isSimpleIdentifier:zy,isSlotOutlet:iw,isStaticArgOf:ew,isStaticExp:Fy,isStaticProperty:My,isStaticPropertyKey:(e,t)=>My(t)&&t.key===e,isTemplateNode:sw,isText:nw,isVSlot:rw,locStub:ey,noopDirectiveTransform:oT,parse:function(e,t={}){return Xw(e,o({},wT,t))},parserOptions:wT,processExpression:gk,processFor:Ck,processIf:yk,processSlotOutlet:Hk,registerRuntimeHelpers:Zb,resolveComponentType:Bk,stringifyExpression:function e(t){return b(t)?t:4===t.type?t.content:t.children.map(e).join("")},toValidAssetId:uw,trackSlotScopes:Pk,trackVForSlotScopes:(e,t)=>{let n;if(sw(e)&&e.props.some(rw)&&(n=Jy(e,"for"))){const e=n.forParseResult;if(e){Ik(e);const{value:n,key:r,index:s}=e,{addIdentifiers:i,removeIdentifiers:a}=t;return n&&i(n),r&&i(r),s&&i(s),()=>{n&&a(n),r&&a(r),s&&a(s)}}}},transform:rk,transformBind:_k,transformElement:Lk,transformExpression:(e,t)=>{if(5===e.type)e.content=gk(e.content,t);else if(1===e.type){const n=Jy(e,"memo");for(let r=0;r<e.props.length;r++){const s=e.props[r];if(7===s.type&&"for"!==s.name){const e=s.exp,r=s.arg;!e||4!==e.type||"on"===s.name&&r||n&&r&&4===r.type&&"key"===r.content||(s.exp=gk(e,t,"slot"===s.name)),r&&4===r.type&&!r.isStatic&&(s.arg=gk(r,t))}}}},transformModel:Yk,transformOn:qk,transformStyle:kT,traverseNode:sk,unwrapTSNode:function e(t){return Dy.includes(t.type)?e(t.expression):t},walkBlockDeclarations:function(e,t){for(const n of e.body)if("VariableDeclaration"===n.type){if(n.declare)continue;for(const e of n.declarations)for(const n of Ry(e.id))t(n)}else if("FunctionDeclaration"===n.type||"ClassDeclaration"===n.type){if(n.declare||!n.id)continue;t(n.id)}else Oy(n)&&Ny(n,!0,t)},walkFunctionParams:function(e,t){for(const n of e.params)for(const e of Ry(n))t(e)},walkIdentifiers:function(e,t,n=!1,r=[],s=Object.create(null)){},warnDeprecation:function(e,t,n,...r){if("suppress-warning"===Sy(e,t))return;const{message:s,link:i}=vy[e],a=`(deprecation ${e}) ${"function"==typeof s?s(...r):s}${i?`\n  Details: ${i}`:""}`,o=new SyntaxError(a);o.code=e,n&&(o.loc=n),t.onWarn(o)}},Symbol.toStringTag,{value:"Module"})),RT=kc(NT),MT=kc(fc),DT=kc(ve);var FT,LT,BT,zT,UT;function $T(){return LT||(LT=1,db.exports=(FT||(FT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=RT,n=MT,r=DT;function s(e){var t=Object.create(null);if(e)for(var n in e)t[n]=e[n];return t.default=e,Object.freeze(t)}var i=s(n);const a=Object.create(null);function o(e,n){if(!r.isString(e)){if(!e.nodeType)return r.NOOP;e=e.innerHTML}const s=r.genCacheKey(e,n),o=a[s];if(o)return o;if("#"===e[0]){const t=document.querySelector(e);e=t?t.innerHTML:""}const c=r.extend({hoistStatic:!0,onError:void 0,onWarn:r.NOOP},n);c.isCustomElement||"undefined"==typeof customElements||(c.isCustomElement=e=>!!customElements.get(e));const{code:l}=t.compile(e,c),u=new Function("Vue",l)(i);return u._rc=!0,a[s]=u}n.registerRuntimeCompiler(o),e.compile=o,Object.keys(n).forEach(function(t){"default"===t||Object.prototype.hasOwnProperty.call(e,t)||(e[t]=n[t])})}(hb)),hb)),db.exports}function VT(){if(BT)return bp;BT=1;var e=Vg,t=ub,n=$T();const r="11.1.11",s={UNEXPECTED_RETURN_TYPE:e.CORE_ERROR_CODES_EXTEND_POINT,INVALID_ARGUMENT:25,MUST_BE_CALL_SETUP_TOP:26,NOT_INSTALLED:27,REQUIRED_VALUE:28,INVALID_VALUE:29,NOT_INSTALLED_WITH_PROVIDE:31,UNEXPECTED_ERROR:32};function i(t,...n){return e.createCompileError(t,null,void 0)}const a=t.makeSymbol("__translateVNode"),o=t.makeSymbol("__datetimeParts"),c=t.makeSymbol("__numberParts"),l=t.makeSymbol("__setPluralRules");t.makeSymbol("__intlifyMeta");const u=t.makeSymbol("__injectWithOption"),d=t.makeSymbol("__dispose");function h(n){if(!t.isObject(n))return n;if(e.isMessageAST(n))return n;for(const r in n)if(t.hasOwn(n,r))if(r.includes(".")){const s=r.split("."),i=s.length-1;let a=n,o=!1;for(let e=0;e<i;e++){if("__proto__"===s[e])throw new Error(`unsafe key: ${s[e]}`);if(s[e]in a||(a[s[e]]=t.create()),!t.isObject(a[s[e]])){o=!0;break}a=a[s[e]]}if(o||(e.isMessageAST(a)?e.AST_NODE_PROPS_KEYS.includes(s[i])||delete n[r]:(a[s[i]]=n[r],delete n[r])),!e.isMessageAST(a)){const e=a[s[i]];t.isObject(e)&&h(e)}}else t.isObject(n[r])&&h(n[r]);return n}function m(e,n){const{messages:r,__i18n:s,messageResolver:i,flatJson:a}=n,o=t.isPlainObject(r)?r:t.isArray(s)?t.create():{[e]:t.create()};if(t.isArray(s)&&s.forEach(e=>{if("locale"in e&&"resource"in e){const{locale:n,resource:r}=e;n?(o[n]=o[n]||t.create(),t.deepCopy(r,o[n])):t.deepCopy(r,o)}else t.isString(e)&&t.deepCopy(JSON.parse(e),o)}),null==i&&a)for(const c in o)t.hasOwn(o,c)&&h(o[c]);return o}function p(e,n,r){let s=t.isObject(n.messages)?n.messages:t.create();"__i18nGlobal"in r&&(s=m(e.locale.value,{messages:s,__i18n:r.__i18nGlobal}));const i=Object.keys(s);if(i.length&&i.forEach(t=>{e.mergeLocaleMessage(t,s[t])}),t.isObject(n.datetimeFormats)){const t=Object.keys(n.datetimeFormats);t.length&&t.forEach(t=>{e.mergeDateTimeFormat(t,n.datetimeFormats[t])})}if(t.isObject(n.numberFormats)){const t=Object.keys(n.numberFormats);t.length&&t.forEach(t=>{e.mergeNumberFormat(t,n.numberFormats[t])})}}function f(e){return n.createVNode(n.Text,null,e,0)}const g=()=>[],b=()=>!1;let y=0;function w(e){return(t,r,s,i)=>e(r,s,n.getCurrentInstance()||void 0,i)}function k(d={}){const{__root:p,__injectWithOption:k}=d,T=void 0===p,_=d.flatJson,v=t.inBrowser?n.ref:n.shallowRef;let S=!t.isBoolean(d.inheritLocale)||d.inheritLocale;const E=v(p&&S?p.locale.value:t.isString(d.locale)?d.locale:e.DEFAULT_LOCALE),C=v(p&&S?p.fallbackLocale.value:t.isString(d.fallbackLocale)||t.isArray(d.fallbackLocale)||t.isPlainObject(d.fallbackLocale)||!1===d.fallbackLocale?d.fallbackLocale:E.value),I=v(m(E.value,d)),x=v(t.isPlainObject(d.datetimeFormats)?d.datetimeFormats:{[E.value]:{}}),A=v(t.isPlainObject(d.numberFormats)?d.numberFormats:{[E.value]:{}});let P=p?p.missingWarn:!t.isBoolean(d.missingWarn)&&!t.isRegExp(d.missingWarn)||d.missingWarn,O=p?p.fallbackWarn:!t.isBoolean(d.fallbackWarn)&&!t.isRegExp(d.fallbackWarn)||d.fallbackWarn,N=p?p.fallbackRoot:!t.isBoolean(d.fallbackRoot)||d.fallbackRoot,R=!!d.fallbackFormat,M=t.isFunction(d.missing)?d.missing:null,D=t.isFunction(d.missing)?w(d.missing):null,F=t.isFunction(d.postTranslation)?d.postTranslation:null,L=p?p.warnHtmlMessage:!t.isBoolean(d.warnHtmlMessage)||d.warnHtmlMessage,B=!!d.escapeParameter;const z=p?p.modifiers:t.isPlainObject(d.modifiers)?d.modifiers:{};let U,$=d.pluralRules||p&&p.pluralRules;U=(()=>{T&&e.setFallbackContext(null);const n={version:r,locale:E.value,fallbackLocale:C.value,messages:I.value,modifiers:z,pluralRules:$,missing:null===D?void 0:D,missingWarn:P,fallbackWarn:O,fallbackFormat:R,unresolving:!0,postTranslation:null===F?void 0:F,warnHtmlMessage:L,escapeParameter:B,messageResolver:d.messageResolver,messageCompiler:d.messageCompiler,__meta:{framework:"vue"}};n.datetimeFormats=x.value,n.numberFormats=A.value,n.__datetimeFormatters=t.isPlainObject(U)?U.__datetimeFormatters:void 0,n.__numberFormatters=t.isPlainObject(U)?U.__numberFormatters:void 0;const s=e.createCoreContext(n);return T&&e.setFallbackContext(s),s})(),e.updateFallbackLocale(U,E.value,C.value);const V=n.computed({get:()=>E.value,set:e=>{U.locale=e,E.value=e}}),j=n.computed({get:()=>C.value,set:t=>{U.fallbackLocale=t,C.value=t,e.updateFallbackLocale(U,E.value,t)}}),W=n.computed(()=>I.value),H=n.computed(()=>x.value),q=n.computed(()=>A.value);const X=(n,r,a,o,c,l)=>{let u;E.value,C.value,I.value,x.value,A.value;try{0,T||(U.fallbackContext=p?e.getFallbackContext():void 0),u=n(U)}finally{T||(U.fallbackContext=void 0)}if("translate exists"!==a&&t.isNumber(u)&&u===e.NOT_REOSLVED||"translate exists"===a&&!u){const[e,t]=r();return p&&N?o(p):c(e)}if(l(u))return u;throw i(s.UNEXPECTED_RETURN_TYPE)};function G(...n){return X(t=>Reflect.apply(e.translate,null,[t,...n]),()=>e.parseTranslateArgs(...n),"translate",e=>Reflect.apply(e.t,e,[...n]),e=>e,e=>t.isString(e))}const K={normalize:function(e){return e.map(e=>t.isString(e)||t.isNumber(e)||t.isBoolean(e)?f(String(e)):e)},interpolate:e=>e,type:"vnode"};function Y(e){return I.value[e]||{}}y++,p&&t.inBrowser&&(n.watch(p.locale,t=>{S&&(E.value=t,U.locale=t,e.updateFallbackLocale(U,E.value,C.value))}),n.watch(p.fallbackLocale,t=>{S&&(C.value=t,U.fallbackLocale=t,e.updateFallbackLocale(U,E.value,C.value))}));const Q={id:y,locale:V,fallbackLocale:j,get inheritLocale(){return S},set inheritLocale(t){S=t,t&&p&&(E.value=p.locale.value,C.value=p.fallbackLocale.value,e.updateFallbackLocale(U,E.value,C.value))},get availableLocales(){return Object.keys(I.value).sort()},messages:W,get modifiers(){return z},get pluralRules(){return $||{}},get isGlobal(){return T},get missingWarn(){return P},set missingWarn(e){P=e,U.missingWarn=P},get fallbackWarn(){return O},set fallbackWarn(e){O=e,U.fallbackWarn=O},get fallbackRoot(){return N},set fallbackRoot(e){N=e},get fallbackFormat(){return R},set fallbackFormat(e){R=e,U.fallbackFormat=R},get warnHtmlMessage(){return L},set warnHtmlMessage(e){L=e,U.warnHtmlMessage=e},get escapeParameter(){return B},set escapeParameter(e){B=e,U.escapeParameter=e},t:G,getLocaleMessage:Y,setLocaleMessage:function(e,n){if(_){const r={[e]:n};for(const e in r)t.hasOwn(r,e)&&h(r[e]);n=r[e]}I.value[e]=n,U.messages=I.value},mergeLocaleMessage:function(e,n){I.value[e]=I.value[e]||{};const r={[e]:n};if(_)for(const s in r)t.hasOwn(r,s)&&h(r[s]);n=r[e],t.deepCopy(n,I.value[e]),U.messages=I.value},getPostTranslationHandler:function(){return t.isFunction(F)?F:null},setPostTranslationHandler:function(e){F=e,U.postTranslation=e},getMissingHandler:function(){return M},setMissingHandler:function(e){null!==e&&(D=w(e)),M=e,U.missing=D},[l]:function(e){$=e,U.pluralRules=$}};return Q.datetimeFormats=H,Q.numberFormats=q,Q.rt=function(...e){const[n,r,a]=e;if(a&&!t.isObject(a))throw i(s.INVALID_ARGUMENT);return G(n,r,t.assign({resolvedMessage:!0},a||{}))},Q.te=function(n,r){return X(()=>{if(!n)return!1;const s=Y(t.isString(r)?r:E.value),i=U.messageResolver(s,n);return e.isMessageAST(i)||e.isMessageFunction(i)||t.isString(i)},()=>[n],"translate exists",e=>Reflect.apply(e.te,e,[n,r]),b,e=>t.isBoolean(e))},Q.tm=function(t){const n=function(t){let n=null;const r=e.fallbackWithLocaleChain(U,C.value,E.value);for(let e=0;e<r.length;e++){const s=I.value[r[e]]||{},i=U.messageResolver(s,t);if(null!=i){n=i;break}}return n}(t);return null!=n?n:p&&p.tm(t)||{}},Q.d=function(...n){return X(t=>Reflect.apply(e.datetime,null,[t,...n]),()=>e.parseDateTimeArgs(...n),"datetime format",e=>Reflect.apply(e.d,e,[...n]),()=>e.MISSING_RESOLVE_VALUE,e=>t.isString(e)||t.isArray(e))},Q.n=function(...n){return X(t=>Reflect.apply(e.number,null,[t,...n]),()=>e.parseNumberArgs(...n),"number format",e=>Reflect.apply(e.n,e,[...n]),()=>e.MISSING_RESOLVE_VALUE,e=>t.isString(e)||t.isArray(e))},Q.getDateTimeFormat=function(e){return x.value[e]||{}},Q.setDateTimeFormat=function(t,n){x.value[t]=n,U.datetimeFormats=x.value,e.clearDateTimeFormat(U,t,n)},Q.mergeDateTimeFormat=function(n,r){x.value[n]=t.assign(x.value[n]||{},r),U.datetimeFormats=x.value,e.clearDateTimeFormat(U,n,r)},Q.getNumberFormat=function(e){return A.value[e]||{}},Q.setNumberFormat=function(t,n){A.value[t]=n,U.numberFormats=A.value,e.clearNumberFormat(U,t,n)},Q.mergeNumberFormat=function(n,r){A.value[n]=t.assign(A.value[n]||{},r),U.numberFormats=A.value,e.clearNumberFormat(U,n,r)},Q[u]=k,Q[a]=function(...n){return X(t=>{let r;const s=t;try{s.processor=K,r=Reflect.apply(e.translate,null,[s,...n])}finally{s.processor=null}return r},()=>e.parseTranslateArgs(...n),"translate",e=>e[a](...n),e=>[f(e)],e=>t.isArray(e))},Q[o]=function(...n){return X(t=>Reflect.apply(e.datetime,null,[t,...n]),()=>e.parseDateTimeArgs(...n),"datetime format",e=>e[o](...n),g,e=>t.isString(e)||t.isArray(e))},Q[c]=function(...n){return X(t=>Reflect.apply(e.number,null,[t,...n]),()=>e.parseNumberArgs(...n),"number format",e=>e[c](...n),g,e=>t.isString(e)||t.isArray(e))},Q}function T(n={}){const r=k(function(n){const r=t.isString(n.locale)?n.locale:e.DEFAULT_LOCALE,s=t.isString(n.fallbackLocale)||t.isArray(n.fallbackLocale)||t.isPlainObject(n.fallbackLocale)||!1===n.fallbackLocale?n.fallbackLocale:r,i=t.isFunction(n.missing)?n.missing:void 0,a=!t.isBoolean(n.silentTranslationWarn)&&!t.isRegExp(n.silentTranslationWarn)||!n.silentTranslationWarn,o=!t.isBoolean(n.silentFallbackWarn)&&!t.isRegExp(n.silentFallbackWarn)||!n.silentFallbackWarn,c=!t.isBoolean(n.fallbackRoot)||n.fallbackRoot,l=!!n.formatFallbackMessages,u=t.isPlainObject(n.modifiers)?n.modifiers:{},d=n.pluralizationRules,h=t.isFunction(n.postTranslation)?n.postTranslation:void 0,m=!t.isString(n.warnHtmlInMessage)||"off"!==n.warnHtmlInMessage,p=!!n.escapeParameterHtml,f=!t.isBoolean(n.sync)||n.sync;let g=n.messages;if(t.isPlainObject(n.sharedMessages)){const e=n.sharedMessages;g=Object.keys(e).reduce((n,r)=>{const s=n[r]||(n[r]={});return t.assign(s,e[r]),n},g||{})}const{__i18n:b,__root:y,__injectWithOption:w}=n,k=n.datetimeFormats,T=n.numberFormats;return{locale:r,fallbackLocale:s,messages:g,flatJson:n.flatJson,datetimeFormats:k,numberFormats:T,missing:i,missingWarn:a,fallbackWarn:o,fallbackRoot:c,fallbackFormat:l,modifiers:u,pluralRules:d,postTranslation:h,warnHtmlMessage:m,escapeParameter:p,messageResolver:n.messageResolver,inheritLocale:f,__i18n:b,__root:y,__injectWithOption:w}}(n)),{__extender:s}=n,i={id:r.id,get locale(){return r.locale.value},set locale(e){r.locale.value=e},get fallbackLocale(){return r.fallbackLocale.value},set fallbackLocale(e){r.fallbackLocale.value=e},get messages(){return r.messages.value},get datetimeFormats(){return r.datetimeFormats.value},get numberFormats(){return r.numberFormats.value},get availableLocales(){return r.availableLocales},get missing(){return r.getMissingHandler()},set missing(e){r.setMissingHandler(e)},get silentTranslationWarn(){return t.isBoolean(r.missingWarn)?!r.missingWarn:r.missingWarn},set silentTranslationWarn(e){r.missingWarn=t.isBoolean(e)?!e:e},get silentFallbackWarn(){return t.isBoolean(r.fallbackWarn)?!r.fallbackWarn:r.fallbackWarn},set silentFallbackWarn(e){r.fallbackWarn=t.isBoolean(e)?!e:e},get modifiers(){return r.modifiers},get formatFallbackMessages(){return r.fallbackFormat},set formatFallbackMessages(e){r.fallbackFormat=e},get postTranslation(){return r.getPostTranslationHandler()},set postTranslation(e){r.setPostTranslationHandler(e)},get sync(){return r.inheritLocale},set sync(e){r.inheritLocale=e},get warnHtmlInMessage(){return r.warnHtmlMessage?"warn":"off"},set warnHtmlInMessage(e){r.warnHtmlMessage="off"!==e},get escapeParameterHtml(){return r.escapeParameter},set escapeParameterHtml(e){r.escapeParameter=e},get pluralizationRules(){return r.pluralRules||{}},__composer:r,t:(...e)=>Reflect.apply(r.t,r,[...e]),rt:(...e)=>Reflect.apply(r.rt,r,[...e]),te:(e,t)=>r.te(e,t),tm:e=>r.tm(e),getLocaleMessage:e=>r.getLocaleMessage(e),setLocaleMessage(e,t){r.setLocaleMessage(e,t)},mergeLocaleMessage(e,t){r.mergeLocaleMessage(e,t)},d:(...e)=>Reflect.apply(r.d,r,[...e]),getDateTimeFormat:e=>r.getDateTimeFormat(e),setDateTimeFormat(e,t){r.setDateTimeFormat(e,t)},mergeDateTimeFormat(e,t){r.mergeDateTimeFormat(e,t)},n:(...e)=>Reflect.apply(r.n,r,[...e]),getNumberFormat:e=>r.getNumberFormat(e),setNumberFormat(e,t){r.setNumberFormat(e,t)},mergeNumberFormat(e,t){r.mergeNumberFormat(e,t)}};return i.__extender=s,i}function _(e,t){e.locale=t.locale||e.locale,e.fallbackLocale=t.fallbackLocale||e.fallbackLocale,e.missing=t.missing||e.missing,e.silentTranslationWarn=t.silentTranslationWarn||e.silentFallbackWarn,e.silentFallbackWarn=t.silentFallbackWarn||e.silentFallbackWarn,e.formatFallbackMessages=t.formatFallbackMessages||e.formatFallbackMessages,e.postTranslation=t.postTranslation||e.postTranslation,e.warnHtmlInMessage=t.warnHtmlInMessage||e.warnHtmlInMessage,e.escapeParameterHtml=t.escapeParameterHtml||e.escapeParameterHtml,e.sync=t.sync||e.sync,e.__composer[l](t.pluralizationRules||e.pluralizationRules);const n=m(e.locale,{messages:t.messages,__i18n:t.__i18n});return Object.keys(n).forEach(t=>e.mergeLocaleMessage(t,n[t])),t.datetimeFormats&&Object.keys(t.datetimeFormats).forEach(n=>e.mergeDateTimeFormat(n,t.datetimeFormats[n])),t.numberFormats&&Object.keys(t.numberFormats).forEach(n=>e.mergeNumberFormat(n,t.numberFormats[n])),e}const v={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:e=>"parent"===e||"global"===e,default:"parent"},i18n:{type:Object}};function S(){return n.Fragment}const E=n.defineComponent({name:"i18n-t",props:t.assign({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:e=>t.isNumber(e)||!isNaN(e)}},v),setup(e,r){const{slots:s,attrs:i}=r,o=e.i18n||M({useScope:e.scope,__useComponent:!0});return()=>{const c=Object.keys(s).filter(e=>"_"!==e[0]),l=t.create();e.locale&&(l.locale=e.locale),void 0!==e.plural&&(l.plural=t.isString(e.plural)?+e.plural:e.plural);const u=function({slots:e},r){if(1===r.length&&"default"===r[0])return(e.default?e.default():[]).reduce((e,t)=>[...e,...t.type===n.Fragment?t.children:[t]],[]);return r.reduce((t,n)=>{const r=e[n];return r&&(t[n]=r()),t},t.create())}(r,c),d=o[a](e.keypath,u,l),h=t.assign(t.create(),i),m=t.isString(e.tag)||t.isObject(e.tag)?e.tag:S();return n.h(m,h,d)}}}),C=E;function I(e,r,s,i){const{slots:a,attrs:o}=r;return()=>{const r={part:!0};let c=t.create();e.locale&&(r.locale=e.locale),t.isString(e.format)?r.key=e.format:t.isObject(e.format)&&(t.isString(e.format.key)&&(r.key=e.format.key),c=Object.keys(e.format).reduce((n,r)=>s.includes(r)?t.assign(t.create(),n,{[r]:e.format[r]}):n,t.create()));const l=i(e.value,r,c);let u=[r.key];t.isArray(l)?u=l.map((e,n)=>{const r=a[e.type],s=r?r({[e.type]:e.value,index:n,parts:l}):[e.value];var i;return i=s,t.isArray(i)&&!t.isString(i[0])&&(s[0].key=`${e.type}-${n}`),s}):t.isString(l)&&(u=[l]);const d=t.assign(t.create(),o),h=t.isString(e.tag)||t.isObject(e.tag)?e.tag:S();return n.h(h,d,u)}}const x=n.defineComponent({name:"i18n-n",props:t.assign({value:{type:Number,required:!0},format:{type:[String,Object]}},v),setup(t,n){const r=t.i18n||M({useScope:t.scope,__useComponent:!0});return I(t,n,e.NUMBER_FORMAT_OPTIONS_KEYS,(...e)=>r[c](...e))}}),A=x;function P(e){const r=t=>{const{instance:n,value:r}=t;if(!n||!n.$)throw i(s.UNEXPECTED_ERROR);const a=function(e,t){const n=e;if("composition"===e.mode)return n.__getInstance(t)||e.global;{const r=n.__getInstance(t);return null!=r?r.__composer:e.global.__composer}}(e,n.$),o=O(r);return[Reflect.apply(a.t,a,[...N(o)]),a]};return{created:(s,i)=>{const[a,o]=r(i);t.inBrowser&&e.global===o&&(s.__i18nWatcher=n.watch(o.locale,()=>{i.instance&&i.instance.$forceUpdate()})),s.__composer=o,s.textContent=a},unmounted:e=>{t.inBrowser&&e.__i18nWatcher&&(e.__i18nWatcher(),e.__i18nWatcher=void 0,delete e.__i18nWatcher),e.__composer&&(e.__composer=void 0,delete e.__composer)},beforeUpdate:(e,{value:t})=>{if(e.__composer){const n=e.__composer,r=O(t);e.textContent=Reflect.apply(n.t,n,[...N(r)])}},getSSRProps:e=>{const[t]=r(e);return{textContent:t}}}}function O(e){if(t.isString(e))return{path:e};if(t.isPlainObject(e)){if(!("path"in e))throw i(s.REQUIRED_VALUE);return e}throw i(s.INVALID_VALUE)}function N(e){const{path:n,locale:r,args:s,choice:i,plural:a}=e,o={},c=s||{};return t.isString(r)&&(o.locale=r),t.isNumber(i)&&(o.plural=i),t.isNumber(a)&&(o.plural=a),[n,c,o]}const R=t.makeSymbol("global-vue-i18n");function M(e={}){const r=n.getCurrentInstance();if(null==r)throw i(s.MUST_BE_CALL_SETUP_TOP);if(!r.isCE&&null!=r.appContext.app&&!r.appContext.app.__VUE_I18N_SYMBOL__)throw i(s.NOT_INSTALLED);const a=function(e){const t=n.inject(e.isCE?R:e.appContext.app.__VUE_I18N_SYMBOL__);if(!t)throw i(e.isCE?s.NOT_INSTALLED_WITH_PROVIDE:s.UNEXPECTED_ERROR);return t}(r),o=function(e){return"composition"===e.mode?e.global:e.global.__composer}(a),c=function(e){return e.type}(r),l=function(e,n){return t.isEmptyObject(e)?"__i18n"in n?"local":"global":e.useScope?e.useScope:"local"}(e,c);if("global"===l)return p(o,e,c),o;if("parent"===l){let t=function(e,t,n=!1){let r=null;const s=t.root;let i=function(e,t=!1){if(null==e)return null;return t&&e.vnode.ctx||e.parent}(t,n);for(;null!=i;){const t=e;if("composition"===e.mode)r=t.__getInstance(i);else{const e=t.__getInstance(i);null!=e&&(r=e.__composer,n&&r&&!r[u]&&(r=null))}if(null!=r)break;if(s===i)break;i=i.parent}return r}(a,r,e.__useComponent);return null==t&&(t=o),t}const h=a;let m=h.__getInstance(r);if(null==m){const s=t.assign({},e);"__i18n"in c&&(s.__i18n=c.__i18n),o&&(s.__root=o),m=k(s),h.__composerExtend&&(m[d]=h.__composerExtend(m)),function(e,t,r){n.onMounted(()=>{},t),n.onUnmounted(()=>{const n=r;e.__deleteInstance(t);const s=n[d];s&&(s(),delete n[d])},t)}(h,r,m),h.__setInstance(r,m)}return m}const D=["locale","fallbackLocale","availableLocales"],F=["t","rt","d","n","tm","te"];const L=n.defineComponent({name:"i18n-d",props:t.assign({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},v),setup(t,n){const r=t.i18n||M({useScope:t.scope,__useComponent:!0});return I(t,n,e.DATETIME_FORMAT_OPTIONS_KEYS,(...e)=>r[o](...e))}}),B=L;return e.registerMessageCompiler(e.compile),e.registerMessageResolver(e.resolveValue),e.registerLocaleFallbacker(e.fallbackWithLocaleChain),bp.DatetimeFormat=L,bp.I18nD=B,bp.I18nInjectionKey=R,bp.I18nN=A,bp.I18nT=C,bp.NumberFormat=x,bp.Translation=E,bp.VERSION=r,bp.createI18n=function(e={}){const r=!t.isBoolean(e.legacy)||e.legacy,a=!t.isBoolean(e.globalInjection)||e.globalInjection,o=new Map,[c,l]=function(e,t){const r=n.effectScope(),a=t?r.run(()=>T(e)):r.run(()=>k(e));if(null==a)throw i(s.UNEXPECTED_ERROR);return[r,a]}(e,r),u=t.makeSymbol(""),d={get mode(){return r?"legacy":"composition"},async install(e,...o){if(e.__VUE_I18N_SYMBOL__=u,e.provide(e.__VUE_I18N_SYMBOL__,d),t.isPlainObject(o[0])){const e=o[0];d.__composerExtend=e.__composerExtend,d.__vueI18nExtend=e.__vueI18nExtend}let c=null;!r&&a&&(c=function(e,t){const r=Object.create(null);D.forEach(e=>{const a=Object.getOwnPropertyDescriptor(t,e);if(!a)throw i(s.UNEXPECTED_ERROR);const o=n.isRef(a.value)?{get:()=>a.value.value,set(e){a.value.value=e}}:{get:()=>a.get&&a.get()};Object.defineProperty(r,e,o)}),e.config.globalProperties.$i18n=r,F.forEach(n=>{const r=Object.getOwnPropertyDescriptor(t,n);if(!r||!r.value)throw i(s.UNEXPECTED_ERROR);Object.defineProperty(e.config.globalProperties,`$${n}`,r)});const a=()=>{delete e.config.globalProperties.$i18n,F.forEach(t=>{delete e.config.globalProperties[`$${t}`]})};return a}(e,d.global)),function(e,n,...r){const s=t.isPlainObject(r[0])?r[0]:{};(!t.isBoolean(s.globalInstall)||s.globalInstall)&&([E.name,"I18nT"].forEach(t=>e.component(t,E)),[x.name,"I18nN"].forEach(t=>e.component(t,x)),[L.name,"I18nD"].forEach(t=>e.component(t,L))),e.directive("t",P(n))}(e,d,...o),r&&e.mixin(function(e,t,r){return{beforeCreate(){const a=n.getCurrentInstance();if(!a)throw i(s.UNEXPECTED_ERROR);const o=this.$options;if(o.i18n){const n=o.i18n;if(o.__i18n&&(n.__i18n=o.__i18n),n.__root=t,this===this.$root)this.$i18n=_(e,n);else{n.__injectWithOption=!0,n.__extender=r.__vueI18nExtend,this.$i18n=T(n);const e=this.$i18n;e.__extender&&(e.__disposer=e.__extender(this.$i18n))}}else if(o.__i18n)if(this===this.$root)this.$i18n=_(e,o);else{this.$i18n=T({__i18n:o.__i18n,__injectWithOption:!0,__extender:r.__vueI18nExtend,__root:t});const e=this.$i18n;e.__extender&&(e.__disposer=e.__extender(this.$i18n))}else this.$i18n=e;o.__i18nGlobal&&p(t,o,o),this.$t=(...e)=>this.$i18n.t(...e),this.$rt=(...e)=>this.$i18n.rt(...e),this.$te=(e,t)=>this.$i18n.te(e,t),this.$d=(...e)=>this.$i18n.d(...e),this.$n=(...e)=>this.$i18n.n(...e),this.$tm=e=>this.$i18n.tm(e),r.__setInstance(a,this.$i18n)},mounted(){},unmounted(){const e=n.getCurrentInstance();if(!e)throw i(s.UNEXPECTED_ERROR);const t=this.$i18n;delete this.$t,delete this.$rt,delete this.$te,delete this.$d,delete this.$n,delete this.$tm,t.__disposer&&(t.__disposer(),delete t.__disposer,delete t.__extender),r.__deleteInstance(e),delete this.$i18n}}}(l,l.__composer,d));const h=e.unmount;e.unmount=()=>{c&&c(),d.dispose(),h()}},get global(){return l},dispose(){c.stop()},__instances:o,__getInstance:function(e){return o.get(e)||null},__setInstance:function(e,t){o.set(e,t)},__deleteInstance:function(e){o.delete(e)}};return d},bp.useI18n=M,bp.vTDirective=P,bp}function jT(){return UT?zT:(UT=1,zT=VT())}var WT=jT();function HT(e){if(!e)throw new Error("Assertion failed.")}const qT=e=>{const t=(e%360+360)%360;if(0===t||90===t||180===t||270===t)return t;throw new Error(`Invalid rotation ${e}.`)},XT=e=>e&&e[e.length-1],GT=e=>e>=0&&e<2**32;class KT{constructor(e){this.bytes=e,this.pos=0}seekToByte(e){this.pos=8*e}readBit(){const e=Math.floor(this.pos/8),t=this.bytes[e]??0,n=7-(7&this.pos),r=(t&1<<n)>>n;return this.pos++,r}readBits(e){if(1===e)return this.readBit();let t=0;for(let n=0;n<e;n++)t<<=1,t|=this.readBit();return t}writeBits(e,t){const n=this.pos+e;for(let r=this.pos;r<n;r++){const e=Math.floor(r/8);let s=this.bytes[e];const i=7-(7&r);s&=~(1<<i),s|=(t&1<<n-r-1)>>n-r-1<<i,this.bytes[e]=s}this.pos=n}readAlignedByte(){if(this.pos%8!=0)throw new Error("Bitstream is not byte-aligned.");const e=this.pos/8,t=this.bytes[e]??0;return this.pos+=8,t}skipBits(e){this.pos+=e}getBitsLeft(){return 8*this.bytes.length-this.pos}clone(){const e=new KT(this.bytes);return e.pos=this.pos,e}}const YT=e=>{let t=0;for(;0===e.readBits(1)&&t<32;)t++;if(t>=32)throw new Error("Invalid exponential-Golomb code.");return(1<<t)-1+e.readBits(t)},QT=e=>{const t=YT(e);return 1&t?t+1>>1:-(t>>1)},JT=e=>e.constructor===Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength),ZT=e=>e.constructor===DataView?e:e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),e_=new TextDecoder,t_=new TextEncoder,n_=e=>{for(let t=0;t<e.length;t++){if(e.charCodeAt(t)>255)return!1}return!0},r_=e=>Object.fromEntries(Object.entries(e).map(([e,t])=>[t,e])),s_={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},i_=r_(s_),a_={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pg:16,hlg:18},o_=r_(a_),c_={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},l_=r_(c_),u_=e=>!!(e&&e.primaries&&e.transfer&&e.matrix&&void 0!==e.fullRange),d_=e=>e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer||ArrayBuffer.isView(e);class h_{constructor(){this.currentPromise=Promise.resolve()}async acquire(){let e;const t=new Promise(t=>{e=t}),n=this.currentPromise;return this.currentPromise=t,await n,e}}const m_=e=>[...e].map(e=>e.toString(16).padStart(2,"0")).join(""),p_=e=>(e=(e=(e=(e=(e=e>>1&1431655765|(1431655765&e)<<1)>>2&858993459|(858993459&e)<<2)>>4&252645135|(252645135&e)<<4)>>8&16711935|(16711935&e)<<8)>>16&65535|(65535&e)<<16)>>>0,f_=(e,t,n)=>{let r=0,s=e.length-1,i=-1;for(;r<=s;){const a=r+s>>1,o=n(e[a]);o===t?(i=a,s=a-1):o<t?r=a+1:s=a-1}return i},g_=(e,t,n)=>{let r=0,s=e.length-1,i=-1;for(;r<=s;){const a=r+(s-r+1)/2|0;n(e[a])<=t?(i=a,r=a+1):s=a-1}return i},b_=(e,t,n)=>{const r=g_(e,n(t),n);e.splice(r+1,0,t)},y_=()=>{let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}},w_=(e,t)=>{for(let n=e.length-1;n>=0;n--)if(t(e[n]))return e[n]},k_=(e,t)=>{for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1},T_=e=>{throw new Error(`Unexpected value: ${e}`)},__=(e,t,n)=>{const r=e.getUint8(t),s=e.getUint8(t+1),i=e.getUint8(t+2);return n?r|s<<8|i<<16:r<<16|s<<8|i},v_=(e,t,n,r)=>{n>>>=0,n&=16777215,r?(e.setUint8(t,255&n),e.setUint8(t+1,n>>>8&255),e.setUint8(t+2,n>>>16&255)):(e.setUint8(t,n>>>16&255),e.setUint8(t+1,n>>>8&255),e.setUint8(t+2,255&n))},S_=(e,t)=>({async next(){const n=await e.next();return n.done?{value:void 0,done:!0}:{value:t(n.value),done:!1}},return:()=>e.return(),throw:t=>e.throw(t),[Symbol.asyncIterator](){return this}}),E_=(e,t,n)=>Math.max(t,Math.min(n,e)),C_="und",I_=(e,t)=>{const n=10**t;return Math.round(e*n)/n},x_=(e,t)=>Math.round(e/t)*t,A_=/^[a-z]{3}$/,P_=e=>A_.test(e),O_=1e6*(1+Number.EPSILON),N_=(e,t)=>{const n={...e,...t};if(e.headers||t.headers){const r=e.headers?R_(e.headers):{},s=t.headers?R_(t.headers):{},i={...r};Object.entries(s).forEach(([e,t])=>{const n=Object.keys(i).find(t=>t.toLowerCase()===e.toLowerCase());n&&delete i[n],i[e]=t}),n.headers=i}return n},R_=e=>{if(e instanceof Headers){const t={};return e.forEach((e,n)=>{t[n]=e}),t}if(Array.isArray(e)){const t={};return e.forEach(([e,n])=>{t[e]=n}),t}return e},M_=async(e,t,n,r)=>{let s=0;for(;;)try{return await e(t,n)}catch(i){s++;const e=r(s,i);if(null===e)throw i;if(!Number.isFinite(e)||e<0)throw new TypeError("Retry delay must be a non-negative finite number.");e>0&&await new Promise(t=>setTimeout(t,1e3*e))}};class D_{constructor(){this.currentPromise=Promise.resolve()}call(e){return this.currentPromise=this.currentPromise.then(e)}}let F_=null;const L_=()=>{if(null!==F_)return F_;const e=!("undefined"==typeof navigator||!navigator.vendor?.match(/apple/i)||navigator.userAgent?.match(/crios/i)||navigator.userAgent?.match(/fxios/i)||navigator.userAgent?.match(/Opera|OPT\//));return F_=e,e};let B_=null;const z_=()=>null!==B_?B_:B_="undefined"!=typeof navigator&&navigator.userAgent?.includes("Firefox"),U_=(e,t)=>-1!==e?e:t,$_=(e,t,n,r)=>e<=r&&n<=t,V_=function*(e){for(const t in e){const n=e[t];void 0!==n&&(yield{key:t,value:n})}},j_=e=>{switch(e.toLowerCase()){case"image/jpeg":case"image/jpg":return".jpg";case"image/png":return".png";case"image/gif":return".gif";case"image/webp":return".webp";case"image/bmp":return".bmp";case"image/svg+xml":return".svg";case"image/tiff":return".tiff";case"image/avif":return".avif";case"image/x-icon":case"image/vnd.microsoft.icon":return".ico";default:return null}},W_=e=>{const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},H_=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},q_=()=>{Symbol.dispose??=Symbol("Symbol.dispose")};class X_{constructor(e,t){if(this.data=e,this.mimeType=t,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if("string"!=typeof t)throw new TypeError("mimeType must be a string.")}}class G_{constructor(e,t,n,r){if(this.data=e,this.mimeType=t,this.name=n,this.description=r,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(void 0!==t&&"string"!=typeof t)throw new TypeError("mimeType, when provided, must be a string.");if(void 0!==n&&"string"!=typeof n)throw new TypeError("name, when provided, must be a string.");if(void 0!==r&&"string"!=typeof r)throw new TypeError("description, when provided, must be a string.")}}const K_=e=>{if(!e||"object"!=typeof e)throw new TypeError("tags must be an object.");if(void 0!==e.title&&"string"!=typeof e.title)throw new TypeError("tags.title, when provided, must be a string.");if(void 0!==e.description&&"string"!=typeof e.description)throw new TypeError("tags.description, when provided, must be a string.");if(void 0!==e.artist&&"string"!=typeof e.artist)throw new TypeError("tags.artist, when provided, must be a string.");if(void 0!==e.album&&"string"!=typeof e.album)throw new TypeError("tags.album, when provided, must be a string.");if(void 0!==e.albumArtist&&"string"!=typeof e.albumArtist)throw new TypeError("tags.albumArtist, when provided, must be a string.");if(void 0!==e.trackNumber&&(!Number.isInteger(e.trackNumber)||e.trackNumber<=0))throw new TypeError("tags.trackNumber, when provided, must be a positive integer.");if(void 0!==e.tracksTotal&&(!Number.isInteger(e.tracksTotal)||e.tracksTotal<=0))throw new TypeError("tags.tracksTotal, when provided, must be a positive integer.");if(void 0!==e.discNumber&&(!Number.isInteger(e.discNumber)||e.discNumber<=0))throw new TypeError("tags.discNumber, when provided, must be a positive integer.");if(void 0!==e.discsTotal&&(!Number.isInteger(e.discsTotal)||e.discsTotal<=0))throw new TypeError("tags.discsTotal, when provided, must be a positive integer.");if(void 0!==e.genre&&"string"!=typeof e.genre)throw new TypeError("tags.genre, when provided, must be a string.");if(void 0!==e.date&&(!(e.date instanceof Date)||Number.isNaN(e.date.getTime())))throw new TypeError("tags.date, when provided, must be a valid Date.");if(void 0!==e.lyrics&&"string"!=typeof e.lyrics)throw new TypeError("tags.lyrics, when provided, must be a string.");if(void 0!==e.images){if(!Array.isArray(e.images))throw new TypeError("tags.images, when provided, must be an array.");for(const t of e.images){if(!t||"object"!=typeof t)throw new TypeError("Each image in tags.images must be an object.");if(!(t.data instanceof Uint8Array))throw new TypeError("Each image.data must be a Uint8Array.");if("string"!=typeof t.mimeType)throw new TypeError("Each image.mimeType must be a string.");if(!["coverFront","coverBack","unknown"].includes(t.kind))throw new TypeError("Each image.kind must be 'coverFront', 'coverBack', or 'unknown'.")}}if(void 0!==e.comment&&"string"!=typeof e.comment)throw new TypeError("tags.comment, when provided, must be a string.");if(void 0!==e.raw){if(!e.raw||"object"!=typeof e.raw)throw new TypeError("tags.raw, when provided, must be an object.");for(const t of Object.values(e.raw))if(!(null===t||"string"==typeof t||t instanceof Uint8Array||t instanceof X_||t instanceof G_))throw new TypeError("Each value in tags.raw must be a string, Uint8Array, RichImageData, AttachedFile, or null.")}},Y_=["avc","hevc","vp9","av1","vp8"],Q_=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],J_=["aac","opus","mp3","vorbis","flac"],Z_=[...J_,...Q_],ev=["webvtt"],tv=[{maxMacroblocks:99,maxBitrate:64e3,level:10},{maxMacroblocks:396,maxBitrate:192e3,level:11},{maxMacroblocks:396,maxBitrate:384e3,level:12},{maxMacroblocks:396,maxBitrate:768e3,level:13},{maxMacroblocks:396,maxBitrate:2e6,level:20},{maxMacroblocks:792,maxBitrate:4e6,level:21},{maxMacroblocks:1620,maxBitrate:4e6,level:22},{maxMacroblocks:1620,maxBitrate:1e7,level:30},{maxMacroblocks:3600,maxBitrate:14e6,level:31},{maxMacroblocks:5120,maxBitrate:2e7,level:32},{maxMacroblocks:8192,maxBitrate:2e7,level:40},{maxMacroblocks:8192,maxBitrate:5e7,level:41},{maxMacroblocks:8704,maxBitrate:5e7,level:42},{maxMacroblocks:22080,maxBitrate:135e6,level:50},{maxMacroblocks:36864,maxBitrate:24e7,level:51},{maxMacroblocks:36864,maxBitrate:24e7,level:52},{maxMacroblocks:139264,maxBitrate:24e7,level:60},{maxMacroblocks:139264,maxBitrate:48e7,level:61},{maxMacroblocks:139264,maxBitrate:8e8,level:62}],nv=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:35651584,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:35651584,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:35651584,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:186}],rv=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:35651584,maxBitrate:18e7,level:60},{maxPictureSize:35651584,maxBitrate:24e7,level:61},{maxPictureSize:35651584,maxBitrate:48e7,level:62}],sv=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:35651584,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:19}],iv=".01.01.01.01.00",av=".0.110.01.01.01.0",ov=(e,t,n,r)=>{if("avc"===e){const e=100,s=Math.ceil(t/16)*Math.ceil(n/16),i=tv.find(e=>s<=e.maxMacroblocks&&r<=e.maxBitrate)??XT(tv),a=i?i.level:0;return`avc1.${e.toString(16).padStart(2,"0")}${"00"}${a.toString(16).padStart(2,"0")}`}if("hevc"===e){const e="",s=1,i="6",a=t*n,o=nv.find(e=>a<=e.maxPictureSize&&r<=e.maxBitrate)??XT(nv),c="B0";return`hev1.${e}${s}.${i}.${o.tier}${o.level}.${c}`}if("vp8"===e)return"vp8";if("vp9"===e){const e=t*n,s="08";return`vp09.${"00"}.${(rv.find(t=>e<=t.maxPictureSize&&r<=t.maxBitrate)??XT(rv)).level.toString().padStart(2,"0")}.${s}`}if("av1"===e){const e=0,s=t*n,i=sv.find(e=>s<=e.maxPictureSize&&r<=e.maxBitrate)??XT(sv),a="08";return`av01.${e}.${i.level.toString().padStart(2,"0")}${i.tier}.${a}`}throw new TypeError(`Unhandled codec '${e}'.`)},cv=e=>{const t=e.split(".");return[1,1,Number(t[1]),2,1,Number(t[2]),3,1,Number(t[3]),4,1,t[4]?Number(t[4]):1]},lv=e=>{const t=e.split("."),n=Number(t[1]),r=t[2];return[129,(n<<5)+Number(r.slice(0,-1)),(("H"===r.slice(-1)?1:0)<<7)+((8===Number(t[3])?0:1)<<6)+0+((t[4]?Number(t[4]):0)<<4)+((t[5]?Number(t[5][0]):1)<<3)+((t[5]?Number(t[5][1]):1)<<2)+(t[5]?Number(t[5][2]):0),0]},uv=e=>{const{codec:t,codecDescription:n,colorSpace:r,avcCodecInfo:s,hevcCodecInfo:i,vp9CodecInfo:a,av1CodecInfo:o}=e;if("avc"===t){if(s){const e=new Uint8Array([s.avcProfileIndication,s.profileCompatibility,s.avcLevelIndication]);return`avc1.${m_(e)}`}if(!n||n.byteLength<4)throw new TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return`avc1.${m_(n.subarray(1,4))}`}if("hevc"===t){let e,t,r,s,a,o;if(i)e=i.generalProfileSpace,t=i.generalProfileIdc,r=p_(i.generalProfileCompatibilityFlags),s=i.generalTierFlag,a=i.generalLevelIdc,o=[...i.generalConstraintIndicatorFlags];else{if(!n||n.byteLength<23)throw new TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");const i=ZT(n),c=i.getUint8(1);e=c>>6&3,t=31&c,r=p_(i.getUint32(2)),s=c>>5&1,a=i.getUint8(12),o=[];for(let e=0;e<6;e++)o.push(i.getUint8(6+e))}let c="hev1.";for(c+=["","A","B","C"][e]+t,c+=".",c+=r.toString(16).toUpperCase(),c+=".",c+=0===s?"L":"H",c+=a;o.length>0&&0===o[o.length-1];)o.pop();return o.length>0&&(c+=".",c+=o.map(e=>e.toString(16).toUpperCase()).join(".")),c}if("vp8"===t)return"vp8";if("vp9"===t){if(!a){const t=e.width*e.height;let n=XT(rv).level;for(const e of rv)if(t<=e.maxPictureSize){n=e.level;break}return`vp09.00.${n.toString().padStart(2,"0")}.08`}let t=`vp09.${a.profile.toString().padStart(2,"0")}.${a.level.toString().padStart(2,"0")}.${a.bitDepth.toString().padStart(2,"0")}.${a.chromaSubsampling.toString().padStart(2,"0")}`;return t+=`.${a.colourPrimaries.toString().padStart(2,"0")}.${a.transferCharacteristics.toString().padStart(2,"0")}.${a.matrixCoefficients.toString().padStart(2,"0")}.${a.videoFullRangeFlag.toString().padStart(2,"0")}`,t.endsWith(iv)&&(t=t.slice(0,-15)),t}if("av1"===t){if(!o){const t=e.width*e.height;let n=XT(rv).level;for(const e of rv)if(t<=e.maxPictureSize){n=e.level;break}return`av01.0.${n.toString().padStart(2,"0")}M.08`}const t=o.profile,n=o.level.toString().padStart(2,"0"),s=o.tier?"H":"M",i=o.bitDepth.toString().padStart(2,"0"),a=o.monochrome?"1":"0",c=100*o.chromaSubsamplingX+10*o.chromaSubsamplingY+1*(o.chromaSubsamplingX&&o.chromaSubsamplingY?o.chromaSamplePosition:0),l=r?.primaries?s_[r.primaries]:1,u=r?.transfer?a_[r.transfer]:1,d=r?.matrix?c_[r.matrix]:1,h=r?.fullRange?1:0;let m=`av01.${t}.${n}${s}.${i}`;return m+=`.${a}.${c.toString().padStart(3,"0")}`,m+=`.${l.toString().padStart(2,"0")}`,m+=`.${u.toString().padStart(2,"0")}`,m+=`.${d.toString().padStart(2,"0")}`,m+=`.${h}`,m.endsWith(av)&&(m=m.slice(0,-17)),m}throw new TypeError(`Unhandled codec '${t}'.`)},dv=(e,t,n)=>{if("aac"===e)return t>=2&&n<=24e3?"mp4a.40.29":n<=24e3?"mp4a.40.5":"mp4a.40.2";if("mp3"===e)return"mp3";if("opus"===e)return"opus";if("vorbis"===e)return"vorbis";if("flac"===e)return"flac";if(Q_.includes(e))return e;throw new TypeError(`Unhandled codec '${e}'.`)},hv=e=>{const{codec:t,codecDescription:n,aacCodecInfo:r}=e;if("aac"===t){if(!r)throw new TypeError("AAC codec info must be provided.");if(r.isMpeg2)return"mp4a.67";return`mp4a.40.${fv(n).objectType}`}if("mp3"===t)return"mp3";if("opus"===t)return"opus";if("vorbis"===t)return"vorbis";if("flac"===t)return"flac";if(t&&Q_.includes(t))return t;throw new TypeError(`Unhandled codec '${t}'.`)},mv=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],pv=[-1,1,2,3,4,5,6,8],fv=e=>{if(!e||e.byteLength<2)throw new TypeError("AAC description must be at least 2 bytes long.");const t=new KT(e);let n=t.readBits(5);31===n&&(n=32+t.readBits(6));const r=t.readBits(4);let s=null;15===r?s=t.readBits(24):r<mv.length&&(s=mv[r]);const i=t.readBits(4);let a=null;return i>=1&&i<=7&&(a=pv[i]),{objectType:n,frequencyIndex:r,sampleRate:s,channelConfiguration:i,numberOfChannels:a}},gv=48e3,bv=/^pcm-([usf])(\d+)+(be)?$/,yv=e=>{if(HT(Q_.includes(e)),"ulaw"===e)return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if("alaw"===e)return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};const t=bv.exec(e);let n;HT(t),n="u"===t[1]?"unsigned":"s"===t[1]?"signed":"float";return{dataType:n,sampleSize:Number(t[2])/8,littleEndian:"be"!==t[3],silentValue:"pcm-u8"===e?128:0}},wv=e=>e.startsWith("avc1")||e.startsWith("avc3")?"avc":e.startsWith("hev1")||e.startsWith("hvc1")?"hevc":"vp8"===e?"vp8":e.startsWith("vp09")?"vp9":e.startsWith("av01")?"av1":e.startsWith("mp4a.40")||"mp4a.67"===e?"aac":"mp3"===e||"mp4a.69"===e||"mp4a.6B"===e||"mp4a.6b"===e?"mp3":"opus"===e?"opus":"vorbis"===e?"vorbis":"flac"===e?"flac":"ulaw"===e?"ulaw":"alaw"===e?"alaw":bv.test(e)?e:"webvtt"===e?"webvtt":null,kv=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],Tv=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,_v=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,vv=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,Sv=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,Ev=e=>{if(!e)throw new TypeError("Video chunk metadata must be provided.");if("object"!=typeof e)throw new TypeError("Video chunk metadata must be an object.");if(!e.decoderConfig)throw new TypeError("Video chunk metadata must include a decoder configuration.");if("object"!=typeof e.decoderConfig)throw new TypeError("Video chunk metadata decoder configuration must be an object.");if("string"!=typeof e.decoderConfig.codec)throw new TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!kv.some(t=>e.decoderConfig.codec.startsWith(t)))throw new TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(e.decoderConfig.codedWidth)||e.decoderConfig.codedWidth<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(e.decoderConfig.codedHeight)||e.decoderConfig.codedHeight<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(void 0!==e.decoderConfig.description&&!d_(e.decoderConfig.description))throw new TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(void 0!==e.decoderConfig.colorSpace){const{colorSpace:t}=e.decoderConfig;if("object"!=typeof t)throw new TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");const n=Object.keys(s_);if(null!=t.primaries&&!n.includes(t.primaries))throw new TypeError(`Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of ${n.join(", ")}.`);const r=Object.keys(a_);if(null!=t.transfer&&!r.includes(t.transfer))throw new TypeError(`Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of ${r.join(", ")}.`);const s=Object.keys(c_);if(null!=t.matrix&&!s.includes(t.matrix))throw new TypeError(`Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of ${s.join(", ")}.`);if(null!=t.fullRange&&"boolean"!=typeof t.fullRange)throw new TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(e.decoderConfig.codec.startsWith("avc1")||e.decoderConfig.codec.startsWith("avc3")){if(!Tv.test(e.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(e.decoderConfig.codec.startsWith("hev1")||e.decoderConfig.codec.startsWith("hvc1")){if(!_v.test(e.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(e.decoderConfig.codec.startsWith("vp8")){if("vp8"!==e.decoderConfig.codec)throw new TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(e.decoderConfig.codec.startsWith("vp09")){if(!vv.test(e.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(e.decoderConfig.codec.startsWith("av01")&&!Sv.test(e.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},Cv=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],Iv=e=>{if(!e)throw new TypeError("Audio chunk metadata must be provided.");if("object"!=typeof e)throw new TypeError("Audio chunk metadata must be an object.");if(!e.decoderConfig)throw new TypeError("Audio chunk metadata must include a decoder configuration.");if("object"!=typeof e.decoderConfig)throw new TypeError("Audio chunk metadata decoder configuration must be an object.");if("string"!=typeof e.decoderConfig.codec)throw new TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!Cv.some(t=>e.decoderConfig.codec.startsWith(t)))throw new TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(e.decoderConfig.sampleRate)||e.decoderConfig.sampleRate<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(e.decoderConfig.numberOfChannels)||e.decoderConfig.numberOfChannels<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(void 0!==e.decoderConfig.description&&!d_(e.decoderConfig.description))throw new TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(e.decoderConfig.codec.startsWith("mp4a")&&"mp4a.69"!==e.decoderConfig.codec&&"mp4a.6B"!==e.decoderConfig.codec&&"mp4a.6b"!==e.decoderConfig.codec){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(e.decoderConfig.codec))throw new TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.");if(!e.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for AAC must include a description, which is expected to be an AudioSpecificConfig as specified in ISO 14496-3.")}else if(e.decoderConfig.codec.startsWith("mp3")||e.decoderConfig.codec.startsWith("mp4a")){if("mp3"!==e.decoderConfig.codec&&"mp4a.69"!==e.decoderConfig.codec&&"mp4a.6B"!==e.decoderConfig.codec&&"mp4a.6b"!==e.decoderConfig.codec)throw new TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(e.decoderConfig.codec.startsWith("opus")){if("opus"!==e.decoderConfig.codec)throw new TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(e.decoderConfig.description&&e.decoderConfig.description.byteLength<18)throw new TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(e.decoderConfig.codec.startsWith("vorbis")){if("vorbis"!==e.decoderConfig.codec)throw new TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!e.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(e.decoderConfig.codec.startsWith("flac")){if("flac"!==e.decoderConfig.codec)throw new TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');const t=42;if(!e.decoderConfig.description||e.decoderConfig.description.byteLength<t)throw new TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((e.decoderConfig.codec.startsWith("pcm")||e.decoderConfig.codec.startsWith("ulaw")||e.decoderConfig.codec.startsWith("alaw"))&&!Q_.includes(e.decoderConfig.codec))throw new TypeError(`Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM codecs (${Q_.join(", ")}).`)},xv=e=>{if(!e)throw new TypeError("Subtitle metadata must be provided.");if("object"!=typeof e)throw new TypeError("Subtitle metadata must be an object.");if(!e.config)throw new TypeError("Subtitle metadata must include a config object.");if("object"!=typeof e.config)throw new TypeError("Subtitle metadata config must be an object.");if("string"!=typeof e.config.description)throw new TypeError("Subtitle metadata config description must be a string.")};class Av{constructor(e){this.mutex=new h_,this.firstMediaStreamTimestamp=null,this.trackTimestampInfo=new WeakMap,this.output=e}onTrackClose(e){}validateAndNormalizeTimestamp(e,t,n){t+=e.source._timestampOffset;let r=this.trackTimestampInfo.get(e);if(!r){if(!n)throw new Error("First frame must be a key frame.");r={maxTimestamp:t,maxTimestampBeforeLastKeyFrame:t},this.trackTimestampInfo.set(e,r)}if(t<0)throw new Error(`Timestamps must be non-negative (got ${t}s).`);if(n&&(r.maxTimestampBeforeLastKeyFrame=r.maxTimestamp),t<r.maxTimestampBeforeLastKeyFrame)throw new Error(`Timestamps cannot be smaller than the highest timestamp of the previous GOP (a GOP begins with a key frame and ends right before the next key frame). Got ${t}s, but highest timestamp is ${r.maxTimestampBeforeLastKeyFrame}s.`);return r.maxTimestamp=Math.max(r.maxTimestamp,t),t}}var Pv,Ov,Nv,Rv;(Ov=Pv||(Pv={}))[Ov.IDR=5]="IDR",Ov[Ov.SPS=7]="SPS",Ov[Ov.PPS=8]="PPS",Ov[Ov.SPS_EXT=13]="SPS_EXT",(Rv=Nv||(Nv={}))[Rv.RASL_N=8]="RASL_N",Rv[Rv.RASL_R=9]="RASL_R",Rv[Rv.BLA_W_LP=16]="BLA_W_LP",Rv[Rv.RSV_IRAP_VCL23=23]="RSV_IRAP_VCL23",Rv[Rv.VPS_NUT=32]="VPS_NUT",Rv[Rv.SPS_NUT=33]="SPS_NUT",Rv[Rv.PPS_NUT=34]="PPS_NUT",Rv[Rv.PREFIX_SEI_NUT=39]="PREFIX_SEI_NUT",Rv[Rv.SUFFIX_SEI_NUT=40]="SUFFIX_SEI_NUT";const Mv=e=>{const t=[];let n=0;for(;n<e.length;){let r=-1,s=0;for(let t=n;t<e.length-3;t++){if(0===e[t]&&0===e[t+1]&&1===e[t+2]){r=t,s=3;break}if(t<e.length-4&&0===e[t]&&0===e[t+1]&&0===e[t+2]&&1===e[t+3]){r=t,s=4;break}}if(-1===r)break;if(n>0&&r>n){const s=e.subarray(n,r);s.length>0&&t.push(s)}n=r+s}if(n<e.length){const r=e.subarray(n);r.length>0&&t.push(r)}return t},Dv=(e,t)=>{const n=[];let r=0;const s=new DataView(e.buffer,e.byteOffset,e.byteLength);for(;r+t<=e.length;){let i;1===t?i=s.getUint8(r):2===t?i=s.getUint16(r,!1):3===t?i=__(s,r,!1):4===t?i=s.getUint32(r,!1):(T_(t),HT(!1)),r+=t;const a=e.subarray(r,r+i);n.push(a),r+=i}return n},Fv=e=>{const t=[],n=e.length;for(let r=0;r<n;r++)r+2<n&&0===e[r]&&0===e[r+1]&&3===e[r+2]?(t.push(0,0),r+=2):t.push(e[r]);return new Uint8Array(t)},Lv=e=>31&e[0],Bv=e=>{try{const t=Mv(e),n=t.filter(e=>Lv(e)===Pv.SPS),r=t.filter(e=>Lv(e)===Pv.PPS),s=t.filter(e=>Lv(e)===Pv.SPS_EXT);if(0===n.length)return null;if(0===r.length)return null;const i=n[0],a=new KT(Fv(i));a.skipBits(1),a.skipBits(2);if(7!==a.readBits(5))return null;const o=a.readAlignedByte(),c=a.readAlignedByte(),l={configurationVersion:1,avcProfileIndication:o,profileCompatibility:c,avcLevelIndication:a.readAlignedByte(),lengthSizeMinusOne:3,sequenceParameterSets:n,pictureParameterSets:r,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if(100===o||110===o||122===o||144===o){YT(a);const e=YT(a);3===e&&a.skipBits(1);const t=YT(a),n=YT(a);l.chromaFormat=e,l.bitDepthLumaMinus8=t,l.bitDepthChromaMinus8=n,l.sequenceParameterSetExt=s}return l}catch(t){return null}},zv=(e,t)=>{if(t.description){const n=3&JT(t.description)[21];return Dv(e,n+1)}return Mv(e)},Uv=e=>e[0]>>1&63,$v=e=>{try{const t=Mv(e),n=t.filter(e=>Uv(e)===Nv.VPS_NUT),r=t.filter(e=>Uv(e)===Nv.SPS_NUT),s=t.filter(e=>Uv(e)===Nv.PPS_NUT),i=t.filter(e=>Uv(e)===Nv.PREFIX_SEI_NUT||Uv(e)===Nv.SUFFIX_SEI_NUT);if(0===r.length||0===s.length)return null;const a=r[0],o=new KT(Fv(a));o.skipBits(16),o.readBits(4);const c=o.readBits(3),l=o.readBits(1),{general_profile_space:u,general_tier_flag:d,general_profile_idc:h,general_profile_compatibility_flags:m,general_constraint_indicator_flags:p,general_level_idc:f}=Vv(o,c);YT(o);const g=YT(o);3===g&&o.skipBits(1),YT(o),YT(o),o.readBits(1)&&(YT(o),YT(o),YT(o),YT(o));const b=YT(o),y=YT(o);YT(o);const w=o.readBits(1);for(let e=w?0:c;e<=c;e++)YT(o),YT(o),YT(o);YT(o),YT(o),YT(o),YT(o),YT(o),YT(o),o.readBits(1)&&o.readBits(1)&&jv(o),o.skipBits(1),o.skipBits(1),o.readBits(1)&&(o.skipBits(4),o.skipBits(4),YT(o),YT(o),o.skipBits(1));const k=YT(o);if(Wv(o,k),o.readBits(1)){const e=YT(o);for(let t=0;t<e;t++)YT(o),o.skipBits(1)}o.skipBits(1),o.skipBits(1);let T=0;o.readBits(1)&&(T=qv(o,c));let _=0;if(s.length>0){const e=s[0],t=new KT(Fv(e));t.skipBits(16),YT(t),YT(t),t.skipBits(1),t.skipBits(1),t.skipBits(3),t.skipBits(1),t.skipBits(1),YT(t),YT(t),QT(t),t.skipBits(1),t.skipBits(1),t.readBits(1)&&YT(t),QT(t),QT(t),t.skipBits(1),t.skipBits(1),t.skipBits(1),t.skipBits(1);const n=t.readBits(1),r=t.readBits(1);_=n||r?n&&!r?2:!n&&r?3:0:0}const v=[...n.length?[{arrayCompleteness:1,nalUnitType:Nv.VPS_NUT,nalUnits:n}]:[],...r.length?[{arrayCompleteness:1,nalUnitType:Nv.SPS_NUT,nalUnits:r}]:[],...s.length?[{arrayCompleteness:1,nalUnitType:Nv.PPS_NUT,nalUnits:s}]:[],...i.length?[{arrayCompleteness:1,nalUnitType:Uv(i[0]),nalUnits:i}]:[]];return{configurationVersion:1,generalProfileSpace:u,generalTierFlag:d,generalProfileIdc:h,generalProfileCompatibilityFlags:m,generalConstraintIndicatorFlags:p,generalLevelIdc:f,minSpatialSegmentationIdc:T,parallelismType:_,chromaFormatIdc:g,bitDepthLumaMinus8:b,bitDepthChromaMinus8:y,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:c+1,temporalIdNested:l,lengthSizeMinusOne:3,arrays:v}}catch(t){return null}},Vv=(e,t)=>{const n=e.readBits(2),r=e.readBits(1),s=e.readBits(5);let i=0;for(let u=0;u<32;u++)i=i<<1|e.readBits(1);const a=new Uint8Array(6);for(let u=0;u<6;u++)a[u]=e.readBits(8);const o=e.readBits(8),c=[],l=[];for(let u=0;u<t;u++)c.push(e.readBits(1)),l.push(e.readBits(1));if(t>0)for(let u=t;u<8;u++)e.skipBits(2);for(let u=0;u<t;u++)c[u]&&e.skipBits(88),l[u]&&e.skipBits(8);return{general_profile_space:n,general_tier_flag:r,general_profile_idc:s,general_profile_compatibility_flags:i,general_constraint_indicator_flags:a,general_level_idc:o}},jv=e=>{for(let t=0;t<4;t++)for(let n=0;n<(3===t?2:6);n++){if(e.readBits(1)){const n=Math.min(64,1<<4+(t<<1));t>1&&QT(e);for(let t=0;t<n;t++)QT(e)}else YT(e)}},Wv=(e,t)=>{const n=[];for(let r=0;r<t;r++)n[r]=Hv(e,r,t,n)},Hv=(e,t,n,r)=>{let s=0,i=0,a=0;if(0!==t&&(i=e.readBits(1)),i){if(t===n){a=t-(YT(e)+1)}else a=t-1;e.readBits(1),YT(e);const i=r[a]??0;for(let t=0;t<=i;t++){e.readBits(1)||e.readBits(1)}s=r[a]}else{const t=YT(e),n=YT(e);for(let r=0;r<t;r++)YT(e),e.readBits(1);for(let r=0;r<n;r++)YT(e),e.readBits(1);s=t+n}return s},qv=(e,t)=>{if(e.readBits(1)){255===e.readBits(8)&&(e.readBits(16),e.readBits(16))}if(e.readBits(1)&&e.readBits(1),e.readBits(1)&&(e.readBits(3),e.readBits(1),e.readBits(1)&&(e.readBits(8),e.readBits(8),e.readBits(8))),e.readBits(1)&&(YT(e),YT(e)),e.readBits(1),e.readBits(1),e.readBits(1),e.readBits(1)&&(YT(e),YT(e),YT(e),YT(e)),e.readBits(1)&&(e.readBits(32),e.readBits(32),e.readBits(1)&&YT(e),e.readBits(1)&&Xv(e,!0,t)),e.readBits(1)){e.readBits(1),e.readBits(1),e.readBits(1);const t=YT(e);return YT(e),YT(e),YT(e),YT(e),t}return 0},Xv=(e,t,n)=>{let r=!1,s=!1,i=!1;r=1===e.readBits(1),s=1===e.readBits(1),(r||s)&&(i=1===e.readBits(1),i&&(e.readBits(8),e.readBits(5),e.readBits(1),e.readBits(5)),e.readBits(4),e.readBits(4),i&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(let a=0;a<=n;a++){let t=!0;1===e.readBits(1)||(t=1===e.readBits(1));let n=!1;t?YT(e):n=1===e.readBits(1);let a=1;if(!n){a=YT(e)+1}r&&Gv(e,a,i),s&&Gv(e,a,i)}},Gv=(e,t,n)=>{for(let r=0;r<t;r++)YT(e),YT(e),n&&(YT(e),YT(e)),e.readBits(1)},Kv=e=>{const t=new KT(e);if(2!==t.readBits(2))return null;const n=t.readBits(1),r=(t.readBits(1)<<1)+n;3===r&&t.skipBits(1);if(1===t.readBits(1))return null;if(0!==t.readBits(1))return null;t.skipBits(2);if(4817730!==t.readBits(24))return null;let s=8;if(r>=2){s=t.readBits(1)?12:10}const i=t.readBits(3);let a=0,o=0;if(7!==i){if(o=t.readBits(1),1===r||3===r){const e=t.readBits(1),n=t.readBits(1);a=e||n?e&&!n?2:1:3,t.skipBits(1)}else a=1}else a=3,o=1;const c=(t.readBits(16)+1)*(t.readBits(16)+1);let l=XT(rv).level;for(const u of rv)if(c<=u.maxPictureSize){l=u.level;break}return{profile:r,level:l,bitDepth:s,chromaSubsampling:a,videoFullRangeFlag:o,colourPrimaries:2===i?1:1===i?6:2,transferCharacteristics:2===i?1:1===i?6:2,matrixCoefficients:7===i?0:2===i?1:1===i?6:2}},Yv=function*(e){const t=new KT(e),n=()=>{let e=0;for(let n=0;n<8;n++){const r=t.readAlignedByte();if(e|=(127&r)<<7*n,!(128&r))break;if(7===n&&128&r)return null}return e>=2**32-1?null:e};for(;t.getBitsLeft()>=8;){t.skipBits(1);const r=t.readBits(4),s=t.readBits(1),i=t.readBits(1);let a;if(t.skipBits(1),s&&t.skipBits(8),i){const e=n();if(null===e)return;a=e}else a=Math.floor(t.getBitsLeft()/8);HT(t.pos%8==0),yield{type:r,data:e.subarray(t.pos/8,t.pos/8+a)},t.skipBits(8*a)}},Qv=e=>{for(const{type:t,data:n}of Yv(e)){if(1!==t)continue;const e=new KT(n),r=e.readBits(3);e.readBits(1);let s=0,i=0,a=0;if(e.readBits(1))s=e.readBits(5);else{if(e.readBits(1)){e.skipBits(32),e.skipBits(32);if(e.readBits(1))return null}const t=e.readBits(1);t&&(a=e.readBits(5),e.skipBits(32),e.skipBits(5),e.skipBits(5));const n=e.readBits(5);for(let r=0;r<=n;r++){e.skipBits(12);const n=e.readBits(5);if(0===r&&(s=n),n>7){const t=e.readBits(1);0===r&&(i=t)}if(t){if(e.readBits(1)){const t=a+1;e.skipBits(t),e.skipBits(t),e.skipBits(1)}}e.readBits(1)&&e.skipBits(4)}}const o=e.readBits(1);let c=8;if(2===r&&o){c=e.readBits(1)?12:10}else r<=2&&(c=o?10:8);let l=0;1!==r&&(l=e.readBits(1));let u=1,d=1,h=0;return l||(0===r?(u=1,d=1):1===r?(u=0,d=0):12===c&&(u=e.readBits(1),u&&(d=e.readBits(1))),u&&d&&(h=e.readBits(2))),{profile:r,level:s,tier:i,bitDepth:c,monochrome:l,chromaSubsamplingX:u,chromaSubsamplingY:d,chromaSamplePosition:h}}return null},Jv=e=>{const t=ZT(e),n=t.getUint8(9),r=t.getUint16(10,!0),s=t.getUint32(12,!0),i=t.getInt16(16,!0),a=t.getUint8(18);let o=null;return a&&(o=e.subarray(19,21+n)),{outputChannelCount:n,preSkip:r,inputSampleRate:s,outputGain:i,channelMappingFamily:a,channelMappingTable:o}},Zv=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],eS=e=>{if(e.length<7)throw new Error("Setup header is too short.");if(5!==e[0])throw new Error("Wrong packet type in Setup header.");if("vorbis"!==String.fromCharCode(...e.slice(1,7)))throw new Error("Invalid packet signature in Setup header.");const t=e.length,n=new Uint8Array(t);for(let u=0;u<t;u++)n[u]=e[t-1-u];const r=new KT(n);let s=0;for(;r.getBitsLeft()>97;)if(1===r.readBits(1)){s=r.pos;break}if(0===s)throw new Error("Invalid Setup header: framing bit not found.");let i=0,a=!1,o=0;for(;r.getBitsLeft()>=97;){const e=r.pos,t=r.readBits(8),n=r.readBits(16),s=r.readBits(16);if(t>63||0!==n||0!==s){r.pos=e;break}if(r.skipBits(1),i++,i>64)break;r.clone().readBits(6)+1===i&&(a=!0,o=i)}if(!a)throw new Error("Invalid Setup header: mode header not found.");if(o>63)throw new Error(`Unsupported mode count: ${o}.`);const c=o;r.pos=0,r.skipBits(s);const l=Array(c).fill(0);for(let u=c-1;u>=0;u--)r.skipBits(40),l[u]=r.readBits(1);return{modeBlockflags:l}},tS=(e,t,n)=>{switch(e){case"avc":{const e=((e,t)=>{if(t.description){const n=3&JT(t.description)[4];return Dv(e,n+1)}return Mv(e)})(n,t),r=e.some(e=>Lv(e)===Pv.IDR);return r?"key":"delta"}case"hevc":{const e=zv(n,t).some(e=>{const t=Uv(e);return Nv.BLA_W_LP<=t&&t<=Nv.RSV_IRAP_VCL23});return e?"key":"delta"}case"vp8":return 0===(1&n[0])?"key":"delta";case"vp9":{const e=new KT(n);if(2!==e.readBits(2))return null;const t=e.readBits(1);3===(e.readBits(1)<<1)+t&&e.skipBits(1);if(e.readBits(1))return null;return 0===e.readBits(1)?"key":"delta"}case"av1":{let e=!1;for(const{type:t,data:r}of Yv(n))if(1===t){const t=new KT(r);t.skipBits(4),e=!!t.readBits(1)}else if(3===t||6===t||7===t){if(e)return"key";const t=new KT(r);if(t.readBits(1))return null;return 0===t.readBits(2)?"key":"delta"}return null}default:T_(e),HT(!1)}};var nS,rS;(rS=nS||(nS={}))[rS.STREAMINFO=0]="STREAMINFO",rS[rS.VORBIS_COMMENT=4]="VORBIS_COMMENT",rS[rS.PICTURE=6]="PICTURE";const sS=(e,t)=>{const n=ZT(e);let r=0;const s=n.getUint32(r,!0);r+=4;const i=e_.decode(e.subarray(r,r+s));r+=s,s>0&&(t.raw??={},t.raw.vendor??=i);const a=n.getUint32(r,!0);r+=4;for(let o=0;o<a;o++){const s=n.getUint32(r,!0);r+=4;const i=e_.decode(e.subarray(r,r+s));r+=s;const a=i.indexOf("=");if(-1===a)continue;const o=i.slice(0,a).toUpperCase(),c=i.slice(a+1);switch(t.raw??={},t.raw[o]??=c,o){case"TITLE":t.title??=c;break;case"DESCRIPTION":t.description??=c;break;case"ARTIST":t.artist??=c;break;case"ALBUM":t.album??=c;break;case"ALBUMARTIST":t.albumArtist??=c;break;case"COMMENT":t.comment??=c;break;case"LYRICS":t.lyrics??=c;break;case"TRACKNUMBER":{const e=c.split("/"),n=Number.parseInt(e[0],10),r=e[1]&&Number.parseInt(e[1],10);Number.isInteger(n)&&n>0&&(t.trackNumber??=n),r&&Number.isInteger(r)&&r>0&&(t.tracksTotal??=r)}break;case"TRACKTOTAL":{const e=Number.parseInt(c,10);Number.isInteger(e)&&e>0&&(t.tracksTotal??=e)}break;case"DISCNUMBER":{const e=c.split("/"),n=Number.parseInt(e[0],10),r=e[1]&&Number.parseInt(e[1],10);Number.isInteger(n)&&n>0&&(t.discNumber??=n),r&&Number.isInteger(r)&&r>0&&(t.discsTotal??=r)}break;case"DISCTOTAL":{const e=Number.parseInt(c,10);Number.isInteger(e)&&e>0&&(t.discsTotal??=e)}break;case"DATE":{const e=new Date(c);Number.isNaN(e.getTime())||(t.date??=e)}break;case"GENRE":t.genre??=c;break;case"METADATA_BLOCK_PICTURE":{const e=W_(c),n=ZT(e),r=n.getUint32(0,!1),s=n.getUint32(4,!1),i=String.fromCharCode(...e.subarray(8,8+s)),a=n.getUint32(8+s,!1),o=e_.decode(e.subarray(12+s,12+s+a)),l=n.getUint32(s+a+28),u=e.subarray(s+a+32,s+a+32+l);t.images??=[],t.images.push({data:u,mimeType:i,kind:3===r?"coverFront":4===r?"coverBack":"unknown",name:void 0,description:o||void 0})}}}};class iS{constructor(e){this.input=e}}const aS=[],oS=[],cS=[],lS=[],uS=new Uint8Array(0);class dS{constructor(e,t,n,r,s=-1,i,a){if(this.data=e,this.type=t,this.timestamp=n,this.duration=r,this.sequenceNumber=s,e===uS&&void 0===i)throw new Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(void 0===i&&(i=e.byteLength),!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if("key"!==t&&"delta"!==t)throw new TypeError('type must be either "key" or "delta".');if(!Number.isFinite(n))throw new TypeError("timestamp must be a number.");if(!Number.isFinite(r)||r<0)throw new TypeError("duration must be a non-negative number.");if(!Number.isFinite(s))throw new TypeError("sequenceNumber must be a number.");if(!Number.isInteger(i)||i<0)throw new TypeError("byteLength must be a non-negative integer.");if(void 0!==a&&("object"!=typeof a||!a))throw new TypeError("sideData, when provided, must be an object.");if(void 0!==a?.alpha&&!(a.alpha instanceof Uint8Array))throw new TypeError("sideData.alpha, when provided, must be a Uint8Array.");if(void 0!==a?.alphaByteLength&&(!Number.isInteger(a.alphaByteLength)||a.alphaByteLength<0))throw new TypeError("sideData.alphaByteLength, when provided, must be a non-negative integer.");this.byteLength=i,this.sideData=a??{},this.sideData.alpha&&void 0===this.sideData.alphaByteLength&&(this.sideData.alphaByteLength=this.sideData.alpha.byteLength)}get isMetadataOnly(){return this.data===uS}get microsecondTimestamp(){return Math.trunc(O_*this.timestamp)}get microsecondDuration(){return Math.trunc(O_*this.duration)}toEncodedVideoChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if("undefined"==typeof EncodedVideoChunk)throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}alphaToEncodedVideoChunk(e=this.type){if(!this.sideData.alpha)throw new TypeError("This packet does not contain alpha side data.");if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if("undefined"==typeof EncodedVideoChunk)throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.sideData.alpha,type:e,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}toEncodedAudioChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to an audio chunk.");if("undefined"==typeof EncodedAudioChunk)throw new Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}static fromEncodedChunk(e,t){if(!(e instanceof EncodedVideoChunk||e instanceof EncodedAudioChunk))throw new TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");const n=new Uint8Array(e.byteLength);return e.copyTo(n),new dS(n,e.type,e.timestamp/1e6,(e.duration??0)/1e6,void 0,void 0,t)}clone(e){if(void 0!==e&&("object"!=typeof e||null===e))throw new TypeError("options, when provided, must be an object.");if(void 0!==e?.timestamp&&!Number.isFinite(e.timestamp))throw new TypeError("options.timestamp, when provided, must be a number.");if(void 0!==e?.duration&&!Number.isFinite(e.duration))throw new TypeError("options.duration, when provided, must be a number.");return new dS(this.data,this.type,e?.timestamp??this.timestamp,e?.duration??this.duration,this.sequenceNumber,this.byteLength)}}q_();class hS{get displayWidth(){return this.rotation%180==0?this.codedWidth:this.codedHeight}get displayHeight(){return this.rotation%180==0?this.codedHeight:this.codedWidth}get microsecondTimestamp(){return Math.trunc(O_*this.timestamp)}get microsecondDuration(){return Math.trunc(O_*this.duration)}get hasAlpha(){return this.format&&this.format.includes("A")}constructor(e,t){if(this._closed=!1,e instanceof ArrayBuffer||ArrayBuffer.isView(e)){if(!t||"object"!=typeof t)throw new TypeError("init must be an object.");if(!("format"in t)||"string"!=typeof t.format)throw new TypeError("init.format must be a string.");if(!Number.isInteger(t.codedWidth)||t.codedWidth<=0)throw new TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(t.codedHeight)||t.codedHeight<=0)throw new TypeError("init.codedHeight must be a positive integer.");if(void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(t.timestamp))throw new TypeError("init.timestamp must be a number.");if(void 0!==t.duration&&(!Number.isFinite(t.duration)||t.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=JT(e).slice(),this.format=t.format,this.codedWidth=t.codedWidth,this.codedHeight=t.codedHeight,this.rotation=t.rotation??0,this.timestamp=t.timestamp,this.duration=t.duration??0,this.colorSpace=new VideoColorSpace(t.colorSpace)}else if("undefined"!=typeof VideoFrame&&e instanceof VideoFrame){if(void 0!==t?.rotation&&![0,90,180,270].includes(t.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(void 0!==t?.timestamp&&!Number.isFinite(t?.timestamp))throw new TypeError("init.timestamp, when provided, must be a number.");if(void 0!==t?.duration&&(!Number.isFinite(t.duration)||t.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=e,this.format=e.format,this.codedWidth=e.displayWidth,this.codedHeight=e.displayHeight,this.rotation=t?.rotation??0,this.timestamp=t?.timestamp??e.timestamp/1e6,this.duration=t?.duration??(e.duration??0)/1e6,this.colorSpace=e.colorSpace}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof SVGImageElement&&e instanceof SVGImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.");{if(!t||"object"!=typeof t)throw new TypeError("init must be an object.");if(void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(t.timestamp))throw new TypeError("init.timestamp must be a number.");if(void 0!==t.duration&&(!Number.isFinite(t.duration)||t.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");if("undefined"!=typeof VideoFrame)return new hS(new VideoFrame(e,{timestamp:Math.trunc(t.timestamp*O_),duration:Math.trunc((t.duration??0)*O_)||void 0}),t);let n=0,r=0;if("naturalWidth"in e?(n=e.naturalWidth,r=e.naturalHeight):"videoWidth"in e?(n=e.videoWidth,r=e.videoHeight):"width"in e&&(n=Number(e.width),r=Number(e.height)),!n||!r)throw new TypeError("Could not determine dimensions.");const s=new OffscreenCanvas(n,r),i=s.getContext("2d",{alpha:z_(),willReadFrequently:!0});HT(i),i.drawImage(e,0,0),this._data=s,this.format="RGBX",this.codedWidth=n,this.codedHeight=r,this.rotation=t.rotation??0,this.timestamp=t.timestamp,this.duration=t.duration??0,this.colorSpace=new VideoColorSpace({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}}}clone(){if(this._closed)throw new Error("VideoSample is closed.");return HT(null!==this._data),mS(this._data)?new hS(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?new hS(this._data.slice(),{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation}):new hS(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}close(){this._closed||(mS(this._data)?this._data.close():this._data=null,this._closed=!0)}allocationSize(){if(this._closed)throw new Error("VideoSample is closed.");return HT(null!==this._data),mS(this._data)?this._data.allocationSize():this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}async copyTo(e){if(!d_(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(this._closed)throw new Error("VideoSample is closed.");if(HT(null!==this._data),mS(this._data))await this._data.copyTo(e);else if(this._data instanceof Uint8Array){JT(e).set(this._data)}else{const t=this._data.getContext("2d");HT(t);const n=t.getImageData(0,0,this.codedWidth,this.codedHeight);JT(e).set(n.data)}}toVideoFrame(){if(this._closed)throw new Error("VideoSample is closed.");return HT(null!==this._data),mS(this._data)?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0})}draw(e,t,n,r,s,i,a,o,c){let l=0,u=0,d=this.displayWidth,h=this.displayHeight,m=0,p=0,f=this.displayWidth,g=this.displayHeight;if(void 0!==i?(l=t,u=n,d=r,h=s,m=i,p=a,void 0!==o?(f=o,g=c):(f=d,g=h)):(m=t,p=n,void 0!==r&&(f=r,g=s)),!("undefined"!=typeof CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof OffscreenCanvasRenderingContext2D&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(l))throw new TypeError("sx must be a number.");if(!Number.isFinite(u))throw new TypeError("sy must be a number.");if(!Number.isFinite(d)||d<0)throw new TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(h)||h<0)throw new TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(m))throw new TypeError("dx must be a number.");if(!Number.isFinite(p))throw new TypeError("dy must be a number.");if(!Number.isFinite(f)||f<0)throw new TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(g)||g<0)throw new TypeError("dHeight must be a non-negative number.");if(this._closed)throw new Error("VideoSample is closed.");({sx:l,sy:u,sWidth:d,sHeight:h}=this._rotateSourceRegion(l,u,d,h,this.rotation));const b=this.toCanvasImageSource();e.save();const y=m+f/2,w=p+g/2;e.translate(y,w),e.rotate(this.rotation*Math.PI/180);const k=this.rotation%180==0?1:f/g;e.scale(1/k,k),e.drawImage(b,l,u,d,h,-f/2,-g/2,f,g),e.restore()}drawWithFit(e,t){if(!("undefined"!=typeof CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof OffscreenCanvasRenderingContext2D&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!t||"object"!=typeof t)throw new TypeError("options must be an object.");if(!["fill","contain","cover"].includes(t.fit))throw new TypeError("options.fit must be 'fill', 'contain', or 'cover'.");if(void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180, or 270.");void 0!==t.crop&&fS(t.crop,"options.");const n=e.canvas.width,r=e.canvas.height,s=t.rotation??this.rotation,[i,a]=s%180==0?[this.codedWidth,this.codedHeight]:[this.codedHeight,this.codedWidth];let o,c,l,u;t.crop&&pS(t.crop,i,a);const{sx:d,sy:h,sWidth:m,sHeight:p}=this._rotateSourceRegion(t.crop?.left??0,t.crop?.top??0,t.crop?.width??i,t.crop?.height??a,s);if("fill"===t.fit)o=0,c=0,l=n,u=r;else{const[e,s]=t.crop?[t.crop.width,t.crop.height]:[i,a],d="contain"===t.fit?Math.min(n/e,r/s):Math.max(n/e,r/s);l=e*d,u=s*d,o=(n-l)/2,c=(r-u)/2}const f=s%180==0?1:l/u;e.translate(n/2,r/2),e.rotate(s*Math.PI/180),e.scale(1/f,f),e.translate(-n/2,-r/2),e.drawImage(this.toCanvasImageSource(),d,h,m,p,o,c,l,u)}_rotateSourceRegion(e,t,n,r,s){return 90===s?[e,t,n,r]=[t,this.codedHeight-e-n,r,n]:180===s?[e,t]=[this.codedWidth-e-n,this.codedHeight-t-r]:270===s&&([e,t,n,r]=[this.codedWidth-t-r,e,r,n]),{sx:e,sy:t,sWidth:n,sHeight:r}}toCanvasImageSource(){if(this._closed)throw new Error("VideoSample is closed.");if(HT(null!==this._data),this._data instanceof Uint8Array){const e=this.toVideoFrame();return queueMicrotask(()=>e.close()),e}return this._data}setRotation(e){if(![0,90,180,270].includes(e))throw new TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}setDuration(e){if(!Number.isFinite(e)||e<0)throw new TypeError("newDuration must be a non-negative number.");this.duration=e}[Symbol.dispose](){this.close()}}const mS=e=>"undefined"!=typeof VideoFrame&&e instanceof VideoFrame,pS=(e,t,n)=>{e.left=Math.min(e.left,t),e.top=Math.min(e.top,n),e.width=Math.min(e.width,t-e.left),e.height=Math.min(e.height,n-e.top),HT(e.width>=0),HT(e.height>=0)},fS=(e,t)=>{if(!e||"object"!=typeof e)throw new TypeError(t+"crop, when provided, must be an object.");if(!Number.isInteger(e.left)||e.left<0)throw new TypeError(t+"crop.left must be a non-negative integer.");if(!Number.isInteger(e.top)||e.top<0)throw new TypeError(t+"crop.top must be a non-negative integer.");if(!Number.isInteger(e.width)||e.width<0)throw new TypeError(t+"crop.width must be a non-negative integer.");if(!Number.isInteger(e.height)||e.height<0)throw new TypeError(t+"crop.height must be a non-negative integer.")},gS=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]);class bS{get microsecondTimestamp(){return Math.trunc(O_*this.timestamp)}get microsecondDuration(){return Math.trunc(O_*this.duration)}constructor(e){if(this._closed=!1,_S(e)){if(null===e.format)throw new TypeError("AudioData with null format is not supported.");this._data=e,this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=e.numberOfFrames,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp/1e6,this.duration=e.numberOfFrames/e.sampleRate}else{if(!e||"object"!=typeof e)throw new TypeError("Invalid AudioDataInit: must be an object.");if(!gS.has(e.format))throw new TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(e.sampleRate)||e.sampleRate<=0)throw new TypeError("Invalid AudioDataInit: sampleRate must be > 0.");if(!Number.isInteger(e.numberOfChannels)||0===e.numberOfChannels)throw new TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(e?.timestamp))throw new TypeError("init.timestamp must be a number.");const t=e.data.byteLength/(yS(e.format)*e.numberOfChannels);if(!Number.isInteger(t))throw new TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");let n;if(this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=t,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp,this.duration=t/e.sampleRate,e.data instanceof ArrayBuffer)n=new Uint8Array(e.data);else{if(!ArrayBuffer.isView(e.data))throw new TypeError("Invalid AudioDataInit: data is not a BufferSource.");n=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength)}const r=this.numberOfFrames*this.numberOfChannels*yS(this.format);if(n.byteLength<r)throw new TypeError("Invalid AudioDataInit: insufficient data size.");this._data=n}}allocationSize(e){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(void 0!==e.format&&!gS.has(e.format))throw new TypeError("Invalid format.");if(void 0!==e.frameOffset&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(void 0!==e.frameCount&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const t=e.format??this.format,n=e.frameOffset??0;if(n>=this.numberOfFrames)throw new RangeError("frameOffset out of range");const r=void 0!==e.frameCount?e.frameCount:this.numberOfFrames-n;if(r>this.numberOfFrames-n)throw new RangeError("frameCount out of range");const s=yS(t),i=wS(t);if(i&&e.planeIndex>=this.numberOfChannels)throw new RangeError("planeIndex out of range");if(!i&&0!==e.planeIndex)throw new RangeError("planeIndex out of range");return(i?r:r*this.numberOfChannels)*s}copyTo(e,t){if(!d_(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!t||"object"!=typeof t)throw new TypeError("options must be an object.");if(!Number.isInteger(t.planeIndex)||t.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(void 0!==t.format&&!gS.has(t.format))throw new TypeError("Invalid format.");if(void 0!==t.frameOffset&&(!Number.isInteger(t.frameOffset)||t.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(void 0!==t.frameCount&&(!Number.isInteger(t.frameCount)||t.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const{planeIndex:n,format:r,frameCount:s,frameOffset:i}=t,a=r??this.format;if(!a)throw new Error("Destination format not determined");const o=this.numberOfFrames,c=this.numberOfChannels,l=i??0;if(l>=o)throw new RangeError("frameOffset out of range");const u=void 0!==s?s:o-l;if(u>o-l)throw new RangeError("frameCount out of range");const d=yS(a),h=wS(a);if(h&&n>=c)throw new RangeError("planeIndex out of range");if(!h&&0!==n)throw new RangeError("planeIndex out of range");const m=(h?u:u*c)*d;if(e.byteLength<m)throw new RangeError("Destination buffer is too small");const p=ZT(e),f=TS(a);if(_S(this._data))if(h)if("f32-planar"===a)this._data.copyTo(e,{planeIndex:n,frameOffset:l,frameCount:u,format:"f32-planar"});else{const e=new ArrayBuffer(4*u),t=new Float32Array(e);this._data.copyTo(t,{planeIndex:n,frameOffset:l,frameCount:u,format:"f32-planar"});const r=new DataView(e);for(let n=0;n<u;n++){f(p,n*d,r.getFloat32(4*n,!0))}}else{const e=c,t=new Float32Array(u);for(let n=0;n<e;n++){this._data.copyTo(t,{planeIndex:n,frameOffset:l,frameCount:u,format:"f32-planar"});for(let r=0;r<u;r++){f(p,(r*e+n)*d,t[r])}}}else{const e=this._data,t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=this.format,s=kS(r),i=yS(r),a=wS(r);for(let m=0;m<u;m++)if(h){let e;e=a?(n*o+(m+l))*i:((m+l)*c+n)*i;f(p,m*d,s(t,e))}else for(let e=0;e<c;e++){let n;n=a?(e*o+(m+l))*i:((m+l)*c+e)*i;f(p,(m*c+e)*d,s(t,n))}}}clone(){if(this._closed)throw new Error("AudioSample is closed.");if(_S(this._data)){const e=new bS(this._data.clone());return e.setTimestamp(this.timestamp),e}return new bS({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data})}close(){this._closed||(_S(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}toAudioData(){if(this._closed)throw new Error("AudioSample is closed.");if(_S(this._data)){if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(wS(this.format)){const e=this.allocationSize({planeIndex:0,format:this.format}),t=new ArrayBuffer(e*this.numberOfChannels);for(let n=0;n<this.numberOfChannels;n++)this.copyTo(new Uint8Array(t,n*e,e),{planeIndex:n,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:t})}{const e=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(e,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:e})}}return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data})}toAudioBuffer(){if(this._closed)throw new Error("AudioSample is closed.");const e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),t=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4);for(let n=0;n<this.numberOfChannels;n++)this.copyTo(t,{planeIndex:n,format:"f32-planar"}),e.copyToChannel(t,n);return e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}[Symbol.dispose](){this.close()}static*_fromAudioBuffer(e,t){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const n=e.numberOfChannels,r=e.sampleRate,s=e.length,i=Math.floor(24e4/n);let a=0,o=s;for(;o>0;){const s=Math.min(i,o),c=new Float32Array(n*s);for(let t=0;t<n;t++)e.copyFromChannel(c.subarray(t*s,(t+1)*s),t,a);yield new bS({format:"f32-planar",sampleRate:r,numberOfFrames:s,numberOfChannels:n,timestamp:t+a/r,data:c}),a+=s,o-=s}}static fromAudioBuffer(e,t){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const n=e.numberOfChannels,r=e.sampleRate,s=e.length,i=Math.floor(24e4/n);let a=0,o=s;const c=[];for(;o>0;){const s=Math.min(i,o),l=new Float32Array(n*s);for(let t=0;t<n;t++)e.copyFromChannel(l.subarray(t*s,(t+1)*s),t,a);const u=new bS({format:"f32-planar",sampleRate:r,numberOfFrames:s,numberOfChannels:n,timestamp:t+a/r,data:l});c.push(u),a+=s,o-=s}return c}}const yS=e=>{switch(e){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":case"f32":case"f32-planar":return 4;default:throw new Error("Unknown AudioSampleFormat")}},wS=e=>{switch(e){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},kS=e=>{switch(e){case"u8":case"u8-planar":return(e,t)=>(e.getUint8(t)-128)/128;case"s16":case"s16-planar":return(e,t)=>e.getInt16(t,!0)/32768;case"s32":case"s32-planar":return(e,t)=>e.getInt32(t,!0)/2147483648;case"f32":case"f32-planar":return(e,t)=>e.getFloat32(t,!0)}},TS=e=>{switch(e){case"u8":case"u8-planar":return(e,t,n)=>e.setUint8(t,E_(127.5*(n+1),0,255));case"s16":case"s16-planar":return(e,t,n)=>e.setInt16(t,E_(Math.round(32767*n),-32768,32767),!0);case"s32":case"s32-planar":return(e,t,n)=>e.setInt32(t,E_(Math.round(2147483647*n),-2147483648,2147483647),!0);case"f32":case"f32-planar":return(e,t,n)=>e.setFloat32(t,n,!0)}},_S=e=>"undefined"!=typeof AudioData&&e instanceof AudioData,vS=e=>{if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.metadataOnly&&"boolean"!=typeof e.metadataOnly)throw new TypeError("options.metadataOnly, when defined, must be a boolean.");if(void 0!==e.verifyKeyPackets&&"boolean"!=typeof e.verifyKeyPackets)throw new TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(e.verifyKeyPackets&&e.metadataOnly)throw new TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},SS=e=>{if("number"!=typeof e||Number.isNaN(e))throw new TypeError("timestamp must be a number.")},ES=(e,t,n)=>n.verifyKeyPackets?t.then(async t=>{if(!t||"delta"===t.type)return t;const n=await e.determinePacketType(t);return n&&(t.type=n),t}):t;class CS{constructor(e){if(!(e instanceof BS))throw new TypeError("track must be an InputTrack.");this._track=e}getFirstPacket(e={}){if(vS(e),this._track.input._disposed)throw new eI;return ES(this._track,this._track._backing.getFirstPacket(e),e)}getPacket(e,t={}){if(SS(e),vS(t),this._track.input._disposed)throw new eI;return ES(this._track,this._track._backing.getPacket(e,t),t)}getNextPacket(e,t={}){if(!(e instanceof dS))throw new TypeError("packet must be an EncodedPacket.");if(vS(t),this._track.input._disposed)throw new eI;return ES(this._track,this._track._backing.getNextPacket(e,t),t)}async getKeyPacket(e,t={}){if(SS(e),vS(t),this._track.input._disposed)throw new eI;if(!t.verifyKeyPackets)return this._track._backing.getKeyPacket(e,t);const n=await this._track._backing.getKeyPacket(e,t);if(!n||"delta"===n.type)return n;return"delta"===await this._track.determinePacketType(n)?this.getKeyPacket(n.timestamp-1/this._track.timeResolution,t):n}async getNextKeyPacket(e,t={}){if(!(e instanceof dS))throw new TypeError("packet must be an EncodedPacket.");if(vS(t),this._track.input._disposed)throw new eI;if(!t.verifyKeyPackets)return this._track._backing.getNextKeyPacket(e,t);const n=await this._track._backing.getNextKeyPacket(e,t);if(!n||"delta"===n.type)return n;return"delta"===await this._track.determinePacketType(n)?this.getNextKeyPacket(n,t):n}packets(e,t,n={}){if(void 0!==e&&!(e instanceof dS))throw new TypeError("startPacket must be an EncodedPacket.");if(void 0!==e&&e.isMetadataOnly&&!n?.metadataOnly)throw new TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(void 0!==t&&!(t instanceof dS))throw new TypeError("endPacket must be an EncodedPacket.");if(vS(n),this._track.input._disposed)throw new eI;const r=[];let{promise:s,resolve:i}=y_(),{promise:a,resolve:o}=y_(),c=!1,l=!1,u=null;const d=[],h=()=>Math.max(2,d.length);(async()=>{let u=e??await this.getFirstPacket(n);for(;u&&!l&&!this._track.input._disposed&&!(t&&u.sequenceNumber>=t?.sequenceNumber);)r.length>h()?(({promise:a,resolve:o}=y_()),await a):(r.push(u),i(),({promise:s,resolve:i}=y_()),u=await this.getNextPacket(u,n));c=!0,i()})().catch(e=>{u||(u=e,i())});const m=this._track;return{async next(){for(;;){if(m.input._disposed)throw new eI;if(l)return{value:void 0,done:!0};if(u)throw u;if(r.length>0){const e=r.shift(),t=performance.now();for(d.push(t);d.length>0&&t-d[0]>=1e3;)d.shift();return o(),{value:e,done:!1}}if(c)return{value:void 0,done:!0};await s}},return:async()=>(l=!0,o(),i(),{value:void 0,done:!0}),async throw(e){throw e},[Symbol.asyncIterator](){return this}}}}class IS{constructor(e,t){this.onSample=e,this.onError=t}}class xS{mediaSamplesInRange(e=0,t=1/0){SS(e),SS(t);const n=[];let r=!1,s=null,{promise:i,resolve:a}=y_(),{promise:o,resolve:c}=y_(),l=!1,u=!1,d=!1,h=null;(async()=>{const m=new Error,p=await this._createDecoder(o=>{c(),o.timestamp>=t&&(u=!0),u?o.close():(s&&(o.timestamp>e?(n.push(s),r=!0):s.close()),o.timestamp>=e&&(n.push(o),r=!0),s=r?null:o,n.length>0&&(a(),({promise:i,resolve:a}=y_())))},e=>{h||(e.stack=m.stack,h=e,a())}),f=this._createPacketSink(),g=await f.getKeyPacket(e,{verifyKeyPackets:!0})??await f.getFirstPacket();if(!g)return;let b,y=g;if(t<1/0){const e=await f.getPacket(t),n=e?"key"===e.type&&e.timestamp===t?e:await f.getNextKeyPacket(e,{verifyKeyPackets:!0}):null;n&&(b=n)}const w=f.packets(g,b);for(await w.next();y&&!u&&!this._track.input._disposed;){const e=AS(n.length);if(n.length+p.getDecodeQueueSize()>e){({promise:o,resolve:c}=y_()),await o;continue}p.decode(y);const t=await w.next();if(t.done)break;y=t.value}await w.return(),d||this._track.input._disposed||await p.flush(),p.close(),!r&&s&&n.push(s),l=!0,a()})().catch(e=>{h||(h=e,a())});const m=this._track,p=()=>{s?.close();for(const e of n)e.close()};return{async next(){for(;;){if(m.input._disposed)throw p(),new eI;if(d)return{value:void 0,done:!0};if(h)throw p(),h;if(n.length>0){const e=n.shift();return c(),{value:e,done:!1}}if(l)return{value:void 0,done:!0};await i}},return:async()=>(d=!0,u=!0,c(),a(),p(),{value:void 0,done:!0}),async throw(e){throw e},[Symbol.asyncIterator](){return this}}}mediaSamplesAtTimestamps(e){(e=>{if(!(Symbol.iterator in e)&&!(Symbol.asyncIterator in e))throw new TypeError("Argument must be an iterable or async iterable.")})(e);const t=async function*(e){Symbol.iterator in e?yield*e[Symbol.iterator]():yield*e[Symbol.asyncIterator]()}(e),n=[],r=[];let{promise:s,resolve:i}=y_(),{promise:a,resolve:o}=y_(),c=!1,l=!1,u=null;const d=e=>{r.push(e),i(),({promise:s,resolve:i}=y_())};(async()=>{const e=new Error,s=await this._createDecoder(e=>{if(o(),l)return void e.close();let t=0;for(;n.length>0&&e.timestamp-n[0]>-1e-10;)t++,n.shift();if(t>0)for(let n=0;n<t;n++)d(n<t-1?e.clone():e);else e.close()},t=>{u||(t.stack=e.stack,u=t,i())}),h=this._createPacketSink();let m=null,p=null,f=-1;const g=async()=>{HT(p);let e=p;for(s.decode(e);e.sequenceNumber<f;){const t=AS(r.length);for(;r.length+s.getDecodeQueueSize()>t&&!l;)({promise:a,resolve:o}=y_()),await a;if(l)break;const n=await h.getNextPacket(e);HT(n),s.decode(n),e=n}f=-1},b=async()=>{await s.flush();for(let e=0;e<n.length;e++)d(null);n.length=0};for await(const r of t){if(SS(r),l||this._track.input._disposed)break;const e=await h.getPacket(r),t=e&&await h.getKeyPacket(r,{verifyKeyPackets:!0});t?(m&&(t.sequenceNumber!==p.sequenceNumber||e.timestamp<m.timestamp)&&(await g(),await b()),n.push(e.timestamp),f=Math.max(e.sequenceNumber,f),m=e,p=t):(-1!==f&&(await g(),await b()),d(null),m=null)}l||this._track.input._disposed||(-1!==f&&await g(),await b()),s.close(),c=!0,i()})().catch(e=>{u||(u=e,i())});const h=this._track,m=()=>{for(const e of r)e?.close()};return{async next(){for(;;){if(h.input._disposed)throw m(),new eI;if(l)return{value:void 0,done:!0};if(u)throw m(),u;if(r.length>0){const e=r.shift();return HT(void 0!==e),o(),{value:e,done:!1}}if(c)return{value:void 0,done:!0};await s}},return:async()=>(l=!0,o(),i(),m(),{value:void 0,done:!0}),async throw(e){throw e},[Symbol.asyncIterator](){return this}}}}const AS=e=>0===e?40:8;class PS extends IS{constructor(e,t,n,r,s,i){super(e,t),this.codec=n,this.decoderConfig=r,this.rotation=s,this.timeResolution=i,this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new D_,this.customDecoderQueueSize=0,this.inputTimestamps=[],this.sampleQueue=[],this.currentPacketIndex=0,this.raslSkipped=!1,this.alphaDecoder=null,this.alphaHadKeyframe=!1,this.colorQueue=[],this.alphaQueue=[],this.merger=null,this.mergerCreationFailed=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue=[],this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1;const a=aS.find(e=>e.supports(n,r));if(a)this.customDecoder=new a,this.customDecoder.codec=n,this.customDecoder.config=r,this.customDecoder.onSample=e=>{if(!(e instanceof hS))throw new TypeError("The argument passed to onSample must be a VideoSample.");this.finalizeAndEmitSample(e)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const e=e=>{if(this.alphaQueue.length>0){const t=this.alphaQueue.shift();HT(void 0!==t),this.mergeAlpha(e,t)}else this.colorQueue.push(e)};this.decoder=new VideoDecoder({output:t=>{try{e(t)}catch(n){this.onError(n)}},error:t}),this.decoder.configure(r)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(HT(this.decoder),Math.max(this.decoder.decodeQueueSize,this.alphaDecoder?.decodeQueueSize??0))}decode(e){if("hevc"===this.codec&&this.currentPacketIndex>0&&!this.raslSkipped){if(this.hasHevcRaslPicture(e.data))return;this.raslSkipped=!0}this.currentPacketIndex++,this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(HT(this.decoder),L_()||b_(this.inputTimestamps,e.timestamp,e=>e),this.decoder.decode(e.toEncodedVideoChunk()),this.decodeAlphaData(e))}decodeAlphaData(e){if(!e.sideData.alpha||this.mergerCreationFailed)return void this.pushNullAlphaFrame();if(!this.merger)try{this.merger=new OS}catch(n){return this.mergerCreationFailed=!0,void this.decodeAlphaData(e)}if(!this.alphaDecoder){const e=e=>{if(this.alphaDecoderQueueSize--,this.colorQueue.length>0){const t=this.colorQueue.shift();HT(void 0!==t),this.mergeAlpha(t,e)}else this.alphaQueue.push(e);for(this.decodedAlphaChunkCount++;this.nullAlphaFrameQueue.length>0&&this.nullAlphaFrameQueue[0]===this.decodedAlphaChunkCount;)if(this.nullAlphaFrameQueue.shift(),this.colorQueue.length>0){const e=this.colorQueue.shift();HT(void 0!==e),this.mergeAlpha(e,null)}else this.alphaQueue.push(null)};this.alphaDecoder=new VideoDecoder({output:t=>{try{e(t)}catch(n){this.onError(n)}},error:this.onError}),this.alphaDecoder.configure(this.decoderConfig)}const t=tS(this.codec,this.decoderConfig,e.sideData.alpha);if(this.alphaHadKeyframe||(this.alphaHadKeyframe="key"===t),this.alphaHadKeyframe){if("hevc"===this.codec&&this.currentAlphaPacketIndex>0&&!this.alphaRaslSkipped){if(this.hasHevcRaslPicture(e.sideData.alpha))return void this.pushNullAlphaFrame();this.alphaRaslSkipped=!0}this.currentAlphaPacketIndex++,this.alphaDecoder.decode(e.alphaToEncodedVideoChunk(t??e.type)),this.alphaDecoderQueueSize++}else this.pushNullAlphaFrame()}pushNullAlphaFrame(){0===this.alphaDecoderQueueSize?this.alphaQueue.push(null):this.nullAlphaFrameQueue.push(this.decodedAlphaChunkCount+this.alphaDecoderQueueSize)}hasHevcRaslPicture(e){return zv(e,this.decoderConfig).some(e=>{const t=Uv(e);return t===Nv.RASL_N||t===Nv.RASL_R})}sampleHandler(e){if(L_()){if(this.sampleQueue.length>0&&e.timestamp>=XT(this.sampleQueue).timestamp){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}b_(this.sampleQueue,e,e=>e.timestamp)}else{const t=this.inputTimestamps.shift();HT(void 0!==t),e.setTimestamp(t),this.finalizeAndEmitSample(e)}}finalizeAndEmitSample(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}mergeAlpha(e,t){if(!t){const t=new hS(e);return void this.sampleHandler(t)}HT(this.merger),this.merger.update(e,t),e.close(),t.close();const n=new VideoFrame(this.merger.canvas,{timestamp:e.timestamp,duration:e.duration??void 0}),r=new hS(n);this.sampleHandler(r)}async flush(){if(this.customDecoder?await this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(HT(this.decoder),await Promise.all([this.decoder.flush(),this.alphaDecoder?.flush()]),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.alphaHadKeyframe=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue.length=0,this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1),L_()){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}this.currentPacketIndex=0,this.raslSkipped=!1}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(HT(this.decoder),this.decoder.close(),this.alphaDecoder?.close(),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.merger?.close());for(const e of this.sampleQueue)e.close();this.sampleQueue.length=0}}class OS{constructor(){"undefined"!=typeof OffscreenCanvas?this.canvas=new OffscreenCanvas(300,150):this.canvas=document.createElement("canvas");const e=this.canvas.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=e,this.program=this.createProgram(),this.vao=this.createVAO(),this.colorTexture=this.createTexture(),this.alphaTexture=this.createTexture(),this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_colorTexture"),0),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_alphaTexture"),1)}createProgram(){const e=this.createShader(this.gl.VERTEX_SHADER,"#version 300 es\n\t\t\tin vec2 a_position;\n\t\t\tin vec2 a_texCoord;\n\t\t\tout vec2 v_texCoord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = vec4(a_position, 0.0, 1.0);\n\t\t\t\tv_texCoord = a_texCoord;\n\t\t\t}\n\t\t"),t=this.createShader(this.gl.FRAGMENT_SHADER,"#version 300 es\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform sampler2D u_colorTexture;\n\t\t\tuniform sampler2D u_alphaTexture;\n\t\t\tin vec2 v_texCoord;\n\t\t\tout vec4 fragColor;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec3 color = texture(u_colorTexture, v_texCoord).rgb;\n\t\t\t\tfloat alpha = texture(u_alphaTexture, v_texCoord).r;\n\t\t\t\tfragColor = vec4(color, alpha);\n\t\t\t}\n\t\t"),n=this.gl.createProgram();return this.gl.attachShader(n,e),this.gl.attachShader(n,t),this.gl.linkProgram(n),n}createShader(e,t){const n=this.gl.createShader(e);return this.gl.shaderSource(n,t),this.gl.compileShader(n),n}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const t=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW);const r=this.gl.getAttribLocation(this.program,"a_position"),s=this.gl.getAttribLocation(this.program,"a_texCoord");return this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}update(e,t){e.displayWidth===this.canvas.width&&e.displayHeight===this.canvas.height||(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.alphaTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class NS extends xS{constructor(e){if(!(e instanceof zS))throw new TypeError("videoTrack must be an InputVideoTrack.");super(),this._track=e}async _createDecoder(e,t){if(!(await this._track.canDecode()))throw new Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");const n=this._track.codec,r=this._track.rotation,s=await this._track.getDecoderConfig(),i=this._track.timeResolution;return HT(n&&s),new PS(e,t,n,s,r,i)}_createPacketSink(){return new CS(this._track)}async getSample(e){SS(e);for await(const t of this.mediaSamplesAtTimestamps([e]))return t;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,t=1/0){return this.mediaSamplesInRange(e,t)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class RS{constructor(e,t={}){if(this._nextCanvasIndex=0,!(e instanceof zS))throw new TypeError("videoTrack must be an InputVideoTrack.");if(t&&"object"!=typeof t)throw new TypeError("options must be an object.");if(void 0!==t.alpha&&"boolean"!=typeof t.alpha)throw new TypeError("options.alpha, when provided, must be a boolean.");if(void 0!==t.width&&(!Number.isInteger(t.width)||t.width<=0))throw new TypeError("options.width, when defined, must be a positive integer.");if(void 0!==t.height&&(!Number.isInteger(t.height)||t.height<=0))throw new TypeError("options.height, when defined, must be a positive integer.");if(void 0!==t.fit&&!["fill","contain","cover"].includes(t.fit))throw new TypeError('options.fit, when provided, must be one of "fill", "contain", or "cover".');if(void 0!==t.width&&void 0!==t.height&&void 0===t.fit)throw new TypeError("When both options.width and options.height are provided, options.fit must also be provided.");if(void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180 or 270.");if(void 0!==t.crop&&fS(t.crop,"options."),void 0!==t.poolSize&&("number"!=typeof t.poolSize||!Number.isInteger(t.poolSize)||t.poolSize<0))throw new TypeError("poolSize must be a non-negative integer.");const n=t.rotation??e.rotation,[r,s]=n%180==0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],i=t.crop;i&&pS(i,r,s);let[a,o]=i?[i.width,i.height]:[r,s];const c=a/o;void 0!==t.width&&void 0===t.height?(a=t.width,o=Math.round(a/c)):void 0===t.width&&void 0!==t.height?(o=t.height,a=Math.round(o*c)):void 0!==t.width&&void 0!==t.height&&(a=t.width,o=t.height),this._videoTrack=e,this._alpha=t.alpha??!1,this._width=a,this._height=o,this._rotation=n,this._crop=i,this._fit=t.fit??"fill",this._videoSampleSink=new NS(e),this._canvasPool=Array.from({length:t.poolSize??0},()=>null)}_videoSampleToWrappedCanvas(e){let t=this._canvasPool[this._nextCanvasIndex],n=!1;t||("undefined"!=typeof document?(t=document.createElement("canvas"),t.width=this._width,t.height=this._height):t=new OffscreenCanvas(this._width,this._height),this._canvasPool.length>0&&(this._canvasPool[this._nextCanvasIndex]=t),n=!0),this._canvasPool.length>0&&(this._nextCanvasIndex=(this._nextCanvasIndex+1)%this._canvasPool.length);const r=t.getContext("2d",{alpha:this._alpha||z_()});HT(r),r.resetTransform(),n||(!this._alpha&&z_()?(r.fillStyle="black",r.fillRect(0,0,this._width,this._height)):r.clearRect(0,0,this._width,this._height)),e.drawWithFit(r,{fit:this._fit,rotation:this._rotation,crop:this._crop});const s={canvas:t,timestamp:e.timestamp,duration:e.duration};return e.close(),s}async getCanvas(e){SS(e);const t=await this._videoSampleSink.getSample(e);return t&&this._videoSampleToWrappedCanvas(t)}canvases(e=0,t=1/0){return S_(this._videoSampleSink.samples(e,t),e=>this._videoSampleToWrappedCanvas(e))}canvasesAtTimestamps(e){return S_(this._videoSampleSink.samplesAtTimestamps(e),e=>e&&this._videoSampleToWrappedCanvas(e))}}class MS extends IS{constructor(e,t,n,r){super(e,t),this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new D_,this.customDecoderQueueSize=0,this.currentTimestamp=null;const s=t=>{(null===this.currentTimestamp||Math.abs(t.timestamp-this.currentTimestamp)>=t.duration)&&(this.currentTimestamp=t.timestamp);const n=this.currentTimestamp;if(this.currentTimestamp+=t.duration,0===t.numberOfFrames)return void t.close();const s=r.sampleRate;t.setTimestamp(Math.round(n*s)/s),e(t)},i=oS.find(e=>e.supports(n,r));i?(this.customDecoder=new i,this.customDecoder.codec=n,this.customDecoder.config=r,this.customDecoder.onSample=e=>{if(!(e instanceof bS))throw new TypeError("The argument passed to onSample must be an AudioSample.");s(e)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init())):(this.decoder=new AudioDecoder({output:e=>{try{s(new bS(e))}catch(t){this.onError(t)}},error:t}),this.decoder.configure(r))}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(HT(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(HT(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}flush(){return this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(HT(this.decoder),this.decoder.flush())}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(HT(this.decoder),this.decoder.close())}}class DS extends IS{constructor(e,t,n){super(e,t),this.decoderConfig=n,this.currentTimestamp=null,HT(Q_.includes(n.codec)),this.codec=n.codec;const{dataType:r,sampleSize:s,littleEndian:i}=yv(this.codec);switch(this.inputSampleSize=s,s){case 1:"unsigned"===r?this.readInputValue=(e,t)=>e.getUint8(t)-128:"signed"===r?this.readInputValue=(e,t)=>e.getInt8(t):"ulaw"===r?this.readInputValue=(e,t)=>(e=>{let t=0,n=0,r=~e;128&r&&(r&=-129,t=-1),n=5+((240&r)>>4);const s=(1<<n|(15&r)<<n-4|1<<n-5)-33;return 0===t?s:-s})(e.getUint8(t)):"alaw"===r?this.readInputValue=(e,t)=>(e=>{let t=0,n=0,r=85^e;128&r&&(r&=-129,t=-1),n=4+((240&r)>>4);let s=0;return s=4!==n?1<<n|(15&r)<<n-4|1<<n-5:r<<1|1,0===t?s:-s})(e.getUint8(t)):HT(!1);break;case 2:"unsigned"===r?this.readInputValue=(e,t)=>e.getUint16(t,i)-32768:"signed"===r?this.readInputValue=(e,t)=>e.getInt16(t,i):HT(!1);break;case 3:"unsigned"===r?this.readInputValue=(e,t)=>__(e,t,i)-2**23:"signed"===r?this.readInputValue=(e,t)=>((e,t,n)=>__(e,t,n)<<8>>8)(e,t,i):HT(!1);break;case 4:"unsigned"===r?this.readInputValue=(e,t)=>e.getUint32(t,i)-2**31:"signed"===r?this.readInputValue=(e,t)=>e.getInt32(t,i):"float"===r?this.readInputValue=(e,t)=>e.getFloat32(t,i):HT(!1);break;case 8:"float"===r?this.readInputValue=(e,t)=>e.getFloat64(t,i):HT(!1);break;default:T_(s),HT(!1)}switch(s){case 1:"ulaw"===r||"alaw"===r?(this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(e,t,n)=>e.setInt16(t,n,!0)):(this.outputSampleSize=1,this.outputFormat="u8",this.writeOutputValue=(e,t,n)=>e.setUint8(t,n+128));break;case 2:this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(e,t,n)=>e.setInt16(t,n,!0);break;case 3:this.outputSampleSize=4,this.outputFormat="s32",this.writeOutputValue=(e,t,n)=>e.setInt32(t,n<<8,!0);break;case 4:this.outputSampleSize=4,"float"===r?(this.outputFormat="f32",this.writeOutputValue=(e,t,n)=>e.setFloat32(t,n,!0)):(this.outputFormat="s32",this.writeOutputValue=(e,t,n)=>e.setInt32(t,n,!0));break;case 8:this.outputSampleSize=4,this.outputFormat="f32",this.writeOutputValue=(e,t,n)=>e.setFloat32(t,n,!0);break;default:T_(s),HT(!1)}}getDecodeQueueSize(){return 0}decode(e){const t=ZT(e.data),n=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,r=n*this.decoderConfig.numberOfChannels*this.outputSampleSize,s=new ArrayBuffer(r),i=new DataView(s);for(let l=0;l<n*this.decoderConfig.numberOfChannels;l++){const e=l*this.inputSampleSize,n=l*this.outputSampleSize,r=this.readInputValue(t,e);this.writeOutputValue(i,n,r)}const a=n/this.decoderConfig.sampleRate;(null===this.currentTimestamp||Math.abs(e.timestamp-this.currentTimestamp)>=a)&&(this.currentTimestamp=e.timestamp);const o=this.currentTimestamp;this.currentTimestamp+=a;const c=new bS({format:this.outputFormat,data:s,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:n,timestamp:o});this.onSample(c)}async flush(){}close(){}}class FS extends xS{constructor(e){if(!(e instanceof US))throw new TypeError("audioTrack must be an InputAudioTrack.");super(),this._track=e}async _createDecoder(e,t){if(!(await this._track.canDecode()))throw new Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");const n=this._track.codec,r=await this._track.getDecoderConfig();return HT(n&&r),Q_.includes(r.codec)?new DS(e,t,r):new MS(e,t,n,r)}_createPacketSink(){return new CS(this._track)}async getSample(e){SS(e);for await(const t of this.mediaSamplesAtTimestamps([e]))return t;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,t=1/0){return this.mediaSamplesInRange(e,t)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class LS{constructor(e){if(!(e instanceof US))throw new TypeError("audioTrack must be an InputAudioTrack.");this._audioSampleSink=new FS(e)}_audioSampleToWrappedArrayBuffer(e){return{buffer:e.toAudioBuffer(),timestamp:e.timestamp,duration:e.duration}}async getBuffer(e){SS(e);const t=await this._audioSampleSink.getSample(e);return t&&this._audioSampleToWrappedArrayBuffer(t)}buffers(e=0,t=1/0){return S_(this._audioSampleSink.samples(e,t),e=>this._audioSampleToWrappedArrayBuffer(e))}buffersAtTimestamps(e){return S_(this._audioSampleSink.samplesAtTimestamps(e),e=>e&&this._audioSampleToWrappedArrayBuffer(e))}}class BS{constructor(e,t){this.input=e,this._backing=t}isVideoTrack(){return this instanceof zS}isAudioTrack(){return this instanceof US}get id(){return this._backing.getId()}get internalCodecId(){return this._backing.getInternalCodecId()}get languageCode(){return this._backing.getLanguageCode()}get name(){return this._backing.getName()}get timeResolution(){return this._backing.getTimeResolution()}getFirstTimestamp(){return this._backing.getFirstTimestamp()}computeDuration(){return this._backing.computeDuration()}async computePacketStats(e=1/0){const t=new CS(this);let n=1/0,r=-1/0,s=0,i=0;for await(const a of t.packets(void 0,void 0,{metadataOnly:!0})){if(s>=e&&a.timestamp>=r)break;n=Math.min(n,a.timestamp),r=Math.max(r,a.timestamp+a.duration),s++,i+=a.byteLength}return{packetCount:s,averagePacketRate:s?Number((s/(r-n)).toPrecision(16)):0,averageBitrate:s?Number((8*i/(r-n)).toPrecision(16)):0}}}class zS extends BS{constructor(e,t){super(e,t),this._backing=t}get type(){return"video"}get codec(){return this._backing.getCodec()}get codedWidth(){return this._backing.getCodedWidth()}get codedHeight(){return this._backing.getCodedHeight()}get rotation(){return this._backing.getRotation()}get displayWidth(){return this._backing.getRotation()%180==0?this._backing.getCodedWidth():this._backing.getCodedHeight()}get displayHeight(){return this._backing.getRotation()%180==0?this._backing.getCodedHeight():this._backing.getCodedWidth()}getColorSpace(){return this._backing.getColorSpace()}async hasHighDynamicRange(){const e=await this._backing.getColorSpace();return"bt2020"===e.primaries||"smpte432"===e.primaries||"pg"===e.transfer||"hlg"===e.transfer||"bt2020-ncl"===e.matrix}canBeTransparent(){return this._backing.canBeTransparent()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){const e=await this._backing.getDecoderConfig();return e?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const t=this._backing.getCodec();if(HT(null!==t),aS.some(n=>n.supports(t,e)))return!0;if("undefined"==typeof VideoDecoder)return!1;return!0===(await VideoDecoder.isConfigSupported(e)).supported}catch(e){return!1}}async determinePacketType(e){if(!(e instanceof dS))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("packet must not be metadata-only to determine its type.");if(null===this.codec)return null;const t=await this.getDecoderConfig();return HT(t),tS(this.codec,t,e.data)}}class US extends BS{constructor(e,t){super(e,t),this._backing=t}get type(){return"audio"}get codec(){return this._backing.getCodec()}get numberOfChannels(){return this._backing.getNumberOfChannels()}get sampleRate(){return this._backing.getSampleRate()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){const e=await this._backing.getDecoderConfig();return e?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const t=this._backing.getCodec();if(HT(null!==t),oS.some(n=>n.supports(t,e)))return!0;if(e.codec.startsWith("pcm-"))return!0;if("undefined"==typeof AudioDecoder)return!1;return!0===(await AudioDecoder.isConfigSupported(e)).supported}catch(e){return!1}}async determinePacketType(e){if(!(e instanceof dS))throw new TypeError("packet must be an EncodedPacket.");return null===this.codec?null:"key"}}const $S=e=>{let t=(e.hasVideo?"video/":e.hasAudio?"audio/":"application/")+(e.isQuickTime?"quicktime":"mp4");if(e.codecStrings.length>0){t+=`; codecs="${[...new Set(e.codecStrings)].join(", ")}"`}return t},VS=16,jS=e=>{let t=dI(e);const n=kI(e,4);let r=8;1===t&&(t=fI(e),r=16);const s=t-r;return s<0?null:{name:n,totalSize:t,headerSize:r,contentSize:s}},WS=e=>mI(e)/65536,HS=e=>mI(e)/1073741824,qS=e=>{let t=0;for(let n=0;n<4;n++){t<<=7;const n=iI(e);if(t|=127&n,!(128&n))break}return t},XS=e=>{let t=oI(e);return e.skip(2),t=Math.min(t,e.remainingLength),e_.decode(sI(e,t))},GS=e=>{const t=jS(e);if(!t||"data"!==t.name)return null;const n=dI(e);e.skip(4);const r=sI(e,t.contentSize-8);switch(n){case 1:return e_.decode(r);case 2:return new TextDecoder("utf-16be").decode(r);case 13:return new X_(r,"image/jpeg");case 14:return new X_(r,"image/png");case 27:return new X_(r,"image/bmp");default:return r}};class KS extends iS{constructor(e){super(e),this.moovSlice=null,this.currentTrack=null,this.tracks=[],this.metadataPromise=null,this.movieTimescale=-1,this.movieDurationInTimescale=-1,this.isQuickTime=!1,this.metadataTags={},this.currentMetadataKeys=null,this.isFragmented=!1,this.fragmentTrackDefaults=[],this.fragments=[],this.currentFragment=null,this.fragmentLookupMutex=new h_,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),t=await Promise.all(e.map(e=>e.computeDuration()));return Math.max(0,...t)}async getTracks(){return await this.readMetadata(),this.tracks.map(e=>e.inputTrack)}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(e=>e.inputTrack.getCodecParameterString()));return $S({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some(e=>"video"===e.info?.type),hasAudio:this.tracks.some(e=>"audio"===e.info?.type),codecStrings:e.filter(Boolean)})}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let t=this.reader.requestSliceRange(e,8,VS);if(t instanceof Promise&&(t=await t),!t)break;const n=e,r=jS(t);if(!r)break;if("ftyp"===r.name){const e=kI(t,4);this.isQuickTime="qt  "===e}else if("moov"===r.name){let e=this.reader.requestSlice(t.filePos,r.contentSize);if(e instanceof Promise&&(e=await e),!e)break;this.moovSlice=e,this.readContiguousBoxes(this.moovSlice);for(const t of this.tracks){const e=t.editListPreviousSegmentDurations/this.movieTimescale;t.editListOffset-=Math.round(e*t.timescale)}break}e=n+r.totalSize}if(this.isFragmented&&null!==this.reader.fileSize){let e=this.reader.requestSlice(this.reader.fileSize-4,4);e instanceof Promise&&(e=await e),HT(e);const t=dI(e),n=this.reader.fileSize-t;if(n>=0&&n<=this.reader.fileSize-VS){let e=this.reader.requestSliceRange(n,8,VS);if(e instanceof Promise&&(e=await e),e){const t=jS(e);if(t&&"mfra"===t.name){let n=this.reader.requestSlice(e.filePos,t.contentSize);n instanceof Promise&&(n=await n),n&&this.readContiguousBoxes(n)}}}}})()}getSampleTableForTrack(e){if(e.sampleTable)return e.sampleTable;const t={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};e.sampleTable=t,HT(this.moovSlice);const n=this.moovSlice.slice(e.sampleTableByteOffset);this.currentTrack=e,this.traverseBox(n),this.currentTrack=null;if("audio"===e.info?.type&&e.info.codec&&Q_.includes(e.info.codec)&&0===t.sampleCompositionTimeOffsets.length){HT("audio"===e.info?.type);const n=yv(e.info.codec),r=[],s=[];for(let i=0;i<t.sampleToChunk.length;i++){const a=t.sampleToChunk[i],o=t.sampleToChunk[i+1],c=(o?o.startChunkIndex:t.chunkOffsets.length)-a.startChunkIndex;for(let i=0;i<c;i++){const o=a.startSampleIndex+i*a.samplesPerChunk,c=o+a.samplesPerChunk,l=g_(t.sampleTimingEntries,o,e=>e.startIndex),u=t.sampleTimingEntries[l],d=g_(t.sampleTimingEntries,c,e=>e.startIndex),h=t.sampleTimingEntries[d],m=u.startDecodeTimestamp+(o-u.startIndex)*u.delta,p=h.startDecodeTimestamp+(c-h.startIndex)*h.delta-m,f=XT(r);f&&f.delta===p?f.count++:r.push({startIndex:a.startChunkIndex+i,startDecodeTimestamp:m,count:1,delta:p});const g=a.samplesPerChunk*n.sampleSize*e.info.numberOfChannels;s.push(g)}a.startSampleIndex=a.startChunkIndex,a.samplesPerChunk=1}t.sampleTimingEntries=r,t.sampleSizes=s}if(t.sampleCompositionTimeOffsets.length>0){t.presentationTimestamps=[];for(const e of t.sampleTimingEntries)for(let n=0;n<e.count;n++)t.presentationTimestamps.push({presentationTimestamp:e.startDecodeTimestamp+n*e.delta,sampleIndex:e.startIndex+n});for(const e of t.sampleCompositionTimeOffsets)for(let n=0;n<e.count;n++){const r=e.startIndex+n,s=t.presentationTimestamps[r];s&&(s.presentationTimestamp+=e.offset)}t.presentationTimestamps.sort((e,t)=>e.presentationTimestamp-t.presentationTimestamp),t.presentationTimestampIndexMap=Array(t.presentationTimestamps.length).fill(-1);for(let e=0;e<t.presentationTimestamps.length;e++)t.presentationTimestampIndexMap[t.presentationTimestamps[e].sampleIndex]=e}return t}async readFragment(e){let t=this.reader.requestSliceRange(e,8,VS);t instanceof Promise&&(t=await t),HT(t);const n=jS(t);HT("moof"===n?.name);let r=this.reader.requestSlice(e,n.totalSize);r instanceof Promise&&(r=await r),HT(r),this.traverseBox(r);const s=f_(this.fragments,e,e=>e.moofOffset);HT(-1!==s);const i=this.fragments[s];HT(i.moofOffset===e);for(const[a,o]of i.trackData){if(o.startTimestampIsFinal)continue;const t=this.tracks.find(e=>e.id===a);let n=0,r=null,s=null;const i=g_(t.fragments,e-1,e=>e.moofOffset);-1!==i&&(r=t.fragments[i],s=r,n=r.moofOffset+r.moofSize);let c=0===n;for(;n<=e-8;){if(r?.nextFragment)r=r.nextFragment,n=r.moofOffset+r.moofSize;else{let e=this.reader.requestSliceRange(n,8,VS);if(e instanceof Promise&&(e=await e),!e)break;const t=n,s=jS(e);if(!s)break;if("moof"===s.name){const e=f_(this.fragments,t,e=>e.moofOffset);let n;n=-1===e?await this.readFragment(t):this.fragments[e],r&&(r.nextFragment=n),r=n,c&&(n.isKnownToBeFirstFragment=!0,c=!1)}n=t+s.totalSize}r&&r.trackData.has(a)&&(s=r)}if(s){const e=s.trackData.get(a);HT(e.startTimestampIsFinal),rE(o,e.endTimestamp)}o.startTimestampIsFinal=!0}return i}readContiguousBoxes(e){const t=e.filePos;for(;e.filePos-t<=e.length-8;){if(!this.traverseBox(e))break}}*iterateContiguousBoxes(e){const t=e.filePos;for(;e.filePos-t<=e.length-8;){const t=e.filePos,n=jS(e);if(!n)break;yield{boxInfo:n,slice:e},e.filePos=t+n.totalSize}}traverseBox(e){const t=e.filePos,n=jS(e);if(!n)return!1;const r=e.filePos,s=t+n.totalSize;switch(n.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":case"wave":this.readContiguousBoxes(e.slice(r,n.contentSize));break;case"mvhd":{const t=iI(e);e.skip(3),1===t?(e.skip(16),this.movieTimescale=dI(e),this.movieDurationInTimescale=fI(e)):(e.skip(8),this.movieTimescale=dI(e),this.movieDurationInTimescale=dI(e))}break;case"trak":{const t={id:-1,demuxer:this,inputTrack:null,info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,internalCodecId:null,name:null,languageCode:C_,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:null,currentFragmentState:null,fragments:[],fragmentsWithKeyFrame:[],editListPreviousSegmentDurations:0,editListOffset:0};if(this.currentTrack=t,this.readContiguousBoxes(e.slice(r,n.contentSize)),-1!==t.id&&-1!==t.timescale&&null!==t.info)if("video"===t.info.type&&-1!==t.info.width){const e=t;t.inputTrack=new zS(this.input,new QS(e)),this.tracks.push(t)}else if("audio"===t.info.type&&-1!==t.info.numberOfChannels){const e=t;t.inputTrack=new US(this.input,new JS(e)),this.tracks.push(t)}this.currentTrack=null}break;case"tkhd":{const t=this.currentTrack;if(!t)break;const n=iI(e);if(!!!(1&cI(e)))break;if(0===n)e.skip(8),t.id=dI(e),e.skip(4),t.durationInMovieTimescale=dI(e);else{if(1!==n)throw new Error(`Incorrect track header version ${n}.`);e.skip(16),t.id=dI(e),e.skip(4),t.durationInMovieTimescale=fI(e)}e.skip(16);const r=[WS(e),WS(e),HS(e),WS(e),WS(e),HS(e),WS(e),WS(e),HS(e)],s=qT(x_(sE(r),90));HT(0===s||90===s||180===s||270===s),t.rotation=s}break;case"elst":{const t=this.currentTrack;if(!t)break;const n=iI(e);e.skip(3);let r=!1,s=0;const i=dI(e);for(let a=0;a<i;a++){const i=1===n?fI(e):dI(e),a=1===n?gI(e):mI(e),o=WS(e);if(0!==i){if(r)break;if(-1!==a){if(1!==o)break;t.editListPreviousSegmentDurations=s,t.editListOffset=a,r=!0}else s+=i}}}break;case"mdhd":{const t=this.currentTrack;if(!t)break;const n=iI(e);e.skip(3),0===n?(e.skip(8),t.timescale=dI(e),t.durationInMediaTimescale=dI(e)):1===n&&(e.skip(16),t.timescale=dI(e),t.durationInMediaTimescale=fI(e));let r=oI(e);if(r>0){t.languageCode="";for(let e=0;e<3;e++)t.languageCode=String.fromCharCode(96+(31&r))+t.languageCode,r>>=5;P_(t.languageCode)||(t.languageCode=C_)}}break;case"hdlr":{const t=this.currentTrack;if(!t)break;e.skip(8);const n=kI(e,4);"vide"===n?t.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:"soun"===n&&(t.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case"stbl":{const s=this.currentTrack;if(!s)break;s.sampleTableByteOffset=t,this.readContiguousBoxes(e.slice(r,n.contentSize))}break;case"stsd":{const t=this.currentTrack;if(!t)break;if(null===t.info||t.sampleTable)break;const n=iI(e);e.skip(3);const r=dI(e);for(let s=0;s<r;s++){const r=e.filePos,s=jS(e);if(!s)break;t.internalCodecId=s.name;const i=s.name.toLowerCase();if("video"===t.info.type)"avc1"===i?t.info.codec="avc":"hvc1"===i||"hev1"===i?t.info.codec="hevc":"vp08"===i?t.info.codec="vp8":"vp09"===i?t.info.codec="vp9":"av01"===i&&(t.info.codec="av1"),e.skip(24),t.info.width=oI(e),t.info.height=oI(e),e.skip(50),this.readContiguousBoxes(e.slice(e.filePos,r+s.totalSize-e.filePos));else{"mp4a"===i||("opus"===i?t.info.codec="opus":"flac"===i?t.info.codec="flac":"twos"===i||"sowt"===i||"raw "===i||"in24"===i||"in32"===i||"fl32"===i||"fl64"===i||"lpcm"===i||"ipcm"===i||"fpcm"===i||("ulaw"===i?t.info.codec="ulaw":"alaw"===i&&(t.info.codec="alaw"))),e.skip(8);const a=oI(e);e.skip(6);let o=oI(e),c=oI(e);e.skip(4);let l=dI(e)/65536;if(0===n&&a>0)if(1===a)e.skip(4),c=8*dI(e),e.skip(8);else if(2===a){e.skip(4),l=wI(e),o=dI(e),e.skip(4),c=dI(e);const n=dI(e);if(e.skip(8),"lpcm"===i){const e=c+7>>3,r=Boolean(1&n),s=Boolean(2&n),i=4&n?-1:0;c>0&&c<=64&&(r?32===c&&(t.info.codec=s?"pcm-f32be":"pcm-f32"):i&1<<e-1?1===e?t.info.codec="pcm-s8":2===e?t.info.codec=s?"pcm-s16be":"pcm-s16":3===e?t.info.codec=s?"pcm-s24be":"pcm-s24":4===e&&(t.info.codec=s?"pcm-s32be":"pcm-s32"):1===e&&(t.info.codec="pcm-u8")),t.info.codec}}"opus"===t.info.codec&&(l=gv),t.info.numberOfChannels=o,t.info.sampleRate=l,"twos"===i?t.info.codec=8===c?"pcm-s8":16===c?"pcm-s16be":null:"sowt"===i?t.info.codec=8===c?"pcm-s8":16===c?"pcm-s16":null:"raw "===i?t.info.codec="pcm-u8":"in24"===i?t.info.codec="pcm-s24be":"in32"===i?t.info.codec="pcm-s32be":"fl32"===i?t.info.codec="pcm-f32be":"fl64"===i?t.info.codec="pcm-f64be":"ipcm"===i?t.info.codec="pcm-s16be":"fpcm"===i&&(t.info.codec="pcm-f32be"),this.readContiguousBoxes(e.slice(e.filePos,r+s.totalSize-e.filePos))}}}break;case"avcC":{const t=this.currentTrack;if(!t)break;HT(t.info),t.info.codecDescription=sI(e,n.contentSize)}break;case"hvcC":{const t=this.currentTrack;if(!t)break;HT(t.info),t.info.codecDescription=sI(e,n.contentSize)}break;case"vpcC":{const t=this.currentTrack;if(!t)break;HT("video"===t.info?.type),e.skip(4);const n=iI(e),r=iI(e),s=iI(e),i=s>>4,a=s>>1&7,o=1&s,c=iI(e),l=iI(e),u=iI(e);t.info.vp9CodecInfo={profile:n,level:r,bitDepth:i,chromaSubsampling:a,videoFullRangeFlag:o,colourPrimaries:c,transferCharacteristics:l,matrixCoefficients:u}}break;case"av1C":{const t=this.currentTrack;if(!t)break;HT("video"===t.info?.type),e.skip(1);const n=iI(e),r=n>>5,s=31&n,i=iI(e),a=i>>7,o=i>>6&1,c=i>>4&1,l=i>>3&1,u=i>>2&1,d=3&i,h=2===r&&o?i>>5&1?12:10:o?10:8;t.info.av1CodecInfo={profile:r,level:s,tier:a,bitDepth:h,monochrome:c,chromaSubsamplingX:l,chromaSubsamplingY:u,chromaSamplePosition:d}}break;case"colr":{const t=this.currentTrack;if(!t)break;HT("video"===t.info?.type);if("nclx"!==kI(e,4))break;const n=oI(e),r=oI(e),s=oI(e),i=Boolean(128&iI(e));t.info.colorSpace={primaries:i_[n],transfer:o_[r],matrix:l_[s],fullRange:i}}break;case"esds":{const t=this.currentTrack;if(!t)break;HT("audio"===t.info?.type),e.skip(4);HT(3===iI(e)),qS(e),e.skip(2);const n=iI(e),r=!!(64&n),s=!!(32&n);if(!!(128&n)&&e.skip(2),r){const t=iI(e);e.skip(t)}s&&e.skip(2);HT(4===iI(e));const i=qS(e),a=e.filePos,o=iI(e);if(64===o||103===o?(t.info.codec="aac",t.info.aacCodecInfo={isMpeg2:103===o}):105===o||107===o?t.info.codec="mp3":221===o&&(t.info.codec="vorbis"),e.skip(12),i>e.filePos-a){HT(5===iI(e));const n=qS(e);if(t.info.codecDescription=sI(e,n),"aac"===t.info.codec){const e=fv(t.info.codecDescription);null!==e.numberOfChannels&&(t.info.numberOfChannels=e.numberOfChannels),null!==e.sampleRate&&(t.info.sampleRate=e.sampleRate)}}}break;case"enda":{const t=this.currentTrack;if(!t)break;HT("audio"===t.info?.type);255&oI(e)&&("pcm-s16be"===t.info.codec?t.info.codec="pcm-s16":"pcm-s24be"===t.info.codec?t.info.codec="pcm-s24":"pcm-s32be"===t.info.codec?t.info.codec="pcm-s32":"pcm-f32be"===t.info.codec?t.info.codec="pcm-f32":"pcm-f64be"===t.info.codec&&(t.info.codec="pcm-f64"))}break;case"pcmC":{const t=this.currentTrack;if(!t)break;HT("audio"===t.info?.type),e.skip(4);const n=iI(e),r=Boolean(1&n),s=iI(e);"pcm-s16be"===t.info.codec?t.info.codec=r?16===s?"pcm-s16":24===s?"pcm-s24":32===s?"pcm-s32":null:16===s?"pcm-s16be":24===s?"pcm-s24be":32===s?"pcm-s32be":null:"pcm-f32be"===t.info.codec&&(t.info.codec=r?32===s?"pcm-f32":64===s?"pcm-f64":null:32===s?"pcm-f32be":64===s?"pcm-f64be":null);break}case"dOps":{const t=this.currentTrack;if(!t)break;HT("audio"===t.info?.type),e.skip(1);const n=iI(e),r=oI(e),s=dI(e),i=lI(e),a=iI(e);let o;o=0!==a?sI(e,2+n):new Uint8Array(0);const c=new Uint8Array(19+o.byteLength),l=new DataView(c.buffer);l.setUint32(0,1332770163,!1),l.setUint32(4,1214603620,!1),l.setUint8(8,1),l.setUint8(9,n),l.setUint16(10,r,!0),l.setUint32(12,s,!0),l.setInt16(16,i,!0),l.setUint8(18,a),c.set(o,19),t.info.codecDescription=c,t.info.numberOfChannels=n}break;case"dfLa":{const t=this.currentTrack;if(!t)break;HT("audio"===t.info?.type),e.skip(4);const n=127,r=128,i=e.filePos;for(;e.filePos<s;){const s=iI(e),i=cI(e);if((s&n)===nS.STREAMINFO){e.skip(10);const n=dI(e),r=n>>>12,s=1+(n>>9&7);t.info.sampleRate=r,t.info.numberOfChannels=s,e.skip(20)}else e.skip(i);if(s&r)break}const a=e.filePos;e.filePos=i;const o=sI(e,a-i),c=new Uint8Array(4+o.byteLength);new DataView(c.buffer).setUint32(0,1716281667,!1),c.set(o,4),t.info.codecDescription=c}break;case"stts":{const t=this.currentTrack;if(!t)break;if(!t.sampleTable)break;e.skip(4);const n=dI(e);let r=0,s=0;for(let i=0;i<n;i++){const n=dI(e),i=dI(e);t.sampleTable.sampleTimingEntries.push({startIndex:r,startDecodeTimestamp:s,count:n,delta:i}),r+=n,s+=n*i}}break;case"ctts":{const t=this.currentTrack;if(!t)break;if(!t.sampleTable)break;e.skip(4);const n=dI(e);let r=0;for(let s=0;s<n;s++){const n=dI(e),s=mI(e);t.sampleTable.sampleCompositionTimeOffsets.push({startIndex:r,count:n,offset:s}),r+=n}}break;case"stsz":{const t=this.currentTrack;if(!t)break;if(!t.sampleTable)break;e.skip(4);const n=dI(e),r=dI(e);if(0===n)for(let s=0;s<r;s++){const n=dI(e);t.sampleTable.sampleSizes.push(n)}else t.sampleTable.sampleSizes.push(n)}break;case"stz2":{const t=this.currentTrack;if(!t)break;if(!t.sampleTable)break;e.skip(4),e.skip(3);const n=iI(e),r=dI(e),s=sI(e,Math.ceil(r*n/8)),i=new KT(s);for(let e=0;e<r;e++){const e=i.readBits(n);t.sampleTable.sampleSizes.push(e)}}break;case"stss":{const t=this.currentTrack;if(!t)break;if(!t.sampleTable)break;e.skip(4),t.sampleTable.keySampleIndices=[];const n=dI(e);for(let r=0;r<n;r++){const n=dI(e)-1;t.sampleTable.keySampleIndices.push(n)}0!==t.sampleTable.keySampleIndices[0]&&t.sampleTable.keySampleIndices.unshift(0)}break;case"stsc":{const t=this.currentTrack;if(!t)break;if(!t.sampleTable)break;e.skip(4);const n=dI(e);for(let s=0;s<n;s++){const n=dI(e)-1,r=dI(e),s=dI(e);t.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:n,samplesPerChunk:r,sampleDescriptionIndex:s})}let r=0;for(let e=0;e<t.sampleTable.sampleToChunk.length;e++)if(t.sampleTable.sampleToChunk[e].startSampleIndex=r,e<t.sampleTable.sampleToChunk.length-1){r+=(t.sampleTable.sampleToChunk[e+1].startChunkIndex-t.sampleTable.sampleToChunk[e].startChunkIndex)*t.sampleTable.sampleToChunk[e].samplesPerChunk}}break;case"stco":{const t=this.currentTrack;if(!t)break;if(!t.sampleTable)break;e.skip(4);const n=dI(e);for(let r=0;r<n;r++){const n=dI(e);t.sampleTable.chunkOffsets.push(n)}}break;case"co64":{const t=this.currentTrack;if(!t)break;if(!t.sampleTable)break;e.skip(4);const n=dI(e);for(let r=0;r<n;r++){const n=fI(e);t.sampleTable.chunkOffsets.push(n)}}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(e.slice(r,n.contentSize));break;case"mehd":{const t=iI(e);e.skip(3);const n=1===t?fI(e):dI(e);this.movieDurationInTimescale=n}break;case"trex":{e.skip(4);const t=dI(e),n=dI(e),r=dI(e),s=dI(e),i=dI(e);this.fragmentTrackDefaults.push({trackId:t,defaultSampleDescriptionIndex:n,defaultSampleDuration:r,defaultSampleSize:s,defaultSampleFlags:i})}break;case"tfra":{const t=iI(e);e.skip(3);const n=dI(e),r=this.tracks.find(e=>e.id===n);if(!r)break;r.fragmentLookupTable=[];const s=dI(e),i=(12&s)>>2,a=3&s,o=[iI,oI,cI,dI],c=o[(48&s)>>4],l=o[i],u=o[a],d=dI(e);for(let h=0;h<d;h++){const n=1===t?fI(e):dI(e),s=1===t?fI(e):dI(e);c(e),l(e),u(e),r.fragmentLookupTable.push({timestamp:n,moofOffset:s})}}break;case"moof":this.currentFragment={moofOffset:t,moofSize:n.totalSize,implicitBaseDataOffset:t,trackData:new Map,dataStart:1/0,dataEnd:0,nextFragment:null,isKnownToBeFirstFragment:!1},this.readContiguousBoxes(e.slice(r,n.contentSize)),b_(this.fragments,this.currentFragment,e=>e.moofOffset);for(const[,e]of this.currentFragment.trackData){const t=e.samples[0],n=XT(e.samples);this.currentFragment.dataStart=Math.min(this.currentFragment.dataStart,t.byteOffset),this.currentFragment.dataEnd=Math.max(this.currentFragment.dataEnd,n.byteOffset+n.byteSize)}this.currentFragment=null;break;case"traf":if(HT(this.currentFragment),this.readContiguousBoxes(e.slice(r,n.contentSize)),this.currentTrack){const e=this.currentFragment.trackData.get(this.currentTrack.id);if(e){b_(this.currentTrack.fragments,this.currentFragment,e=>e.moofOffset);null!==e.firstKeyFrameTimestamp&&b_(this.currentTrack.fragmentsWithKeyFrame,this.currentFragment,e=>e.moofOffset);const{currentFragmentState:t}=this.currentTrack;HT(t),null!==t.startTimestamp&&(rE(e,t.startTimestamp),e.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":{HT(this.currentFragment),e.skip(1);const t=cI(e),n=Boolean(1&t),r=Boolean(2&t),s=Boolean(8&t),i=Boolean(16&t),a=Boolean(32&t),o=Boolean(65536&t),c=Boolean(131072&t),l=dI(e),u=this.tracks.find(e=>e.id===l);if(!u)break;const d=this.fragmentTrackDefaults.find(e=>e.trackId===l);this.currentTrack=u,u.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:d?.defaultSampleDescriptionIndex??null,defaultSampleDuration:d?.defaultSampleDuration??null,defaultSampleSize:d?.defaultSampleSize??null,defaultSampleFlags:d?.defaultSampleFlags??null,startTimestamp:null},n?u.currentFragmentState.baseDataOffset=fI(e):c&&(u.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),r&&(u.currentFragmentState.sampleDescriptionIndex=dI(e)),s&&(u.currentFragmentState.defaultSampleDuration=dI(e)),i&&(u.currentFragmentState.defaultSampleSize=dI(e)),a&&(u.currentFragmentState.defaultSampleFlags=dI(e)),o&&(u.currentFragmentState.defaultSampleDuration=0)}break;case"tfdt":{const t=this.currentTrack;if(!t)break;HT(t.currentFragmentState);const n=iI(e);e.skip(3);const r=0===n?dI(e):fI(e);t.currentFragmentState.startTimestamp=r}break;case"trun":{const t=this.currentTrack;if(!t)break;if(HT(this.currentFragment),HT(t.currentFragmentState),this.currentFragment.trackData.has(t.id))break;const n=iI(e),r=cI(e),s=Boolean(1&r),i=Boolean(4&r),a=Boolean(256&r),o=Boolean(512&r),c=Boolean(1024&r),l=Boolean(2048&r),u=dI(e);let d=t.currentFragmentState.baseDataOffset;s&&(d+=mI(e));let h=null;i&&(h=dI(e));let m=d;if(0===u){this.currentFragment.implicitBaseDataOffset=m;break}let p=0;const f={startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(t.id,f);for(let y=0;y<u;y++){let r,s,i;a?r=dI(e):(HT(null!==t.currentFragmentState.defaultSampleDuration),r=t.currentFragmentState.defaultSampleDuration),o?s=dI(e):(HT(null!==t.currentFragmentState.defaultSampleSize),s=t.currentFragmentState.defaultSampleSize),c?i=dI(e):(HT(null!==t.currentFragmentState.defaultSampleFlags),i=t.currentFragmentState.defaultSampleFlags),0===y&&null!==h&&(i=h);let u=0;l&&(u=0===n?dI(e):mI(e));const d=!(65536&i);f.samples.push({presentationTimestamp:p+u,duration:r,byteOffset:m,byteSize:s,isKeyFrame:d}),m+=s,p+=r}f.presentationTimestamps=f.samples.map((e,t)=>({presentationTimestamp:e.presentationTimestamp,sampleIndex:t})).sort((e,t)=>e.presentationTimestamp-t.presentationTimestamp);for(let e=0;e<f.presentationTimestamps.length;e++){const t=f.presentationTimestamps[e],n=f.samples[t.sampleIndex];if(null===f.firstKeyFrameTimestamp&&n.isKeyFrame&&(f.firstKeyFrameTimestamp=n.presentationTimestamp),e<f.presentationTimestamps.length-1){const r=f.presentationTimestamps[e+1];n.duration=r.presentationTimestamp-t.presentationTimestamp}}const g=f.samples[f.presentationTimestamps[0].sampleIndex],b=f.samples[XT(f.presentationTimestamps).sampleIndex];f.startTimestamp=g.presentationTimestamp,f.endTimestamp=b.presentationTimestamp+b.duration,this.currentFragment.implicitBaseDataOffset=m}break;case"udta":{const t=this.iterateContiguousBoxes(e.slice(r,n.contentSize));for(const{boxInfo:e,slice:n}of t){if("meta"!==e.name&&!this.currentTrack){const t=n.filePos;this.metadataTags.raw??={},"©"===e.name[0]?this.metadataTags.raw[e.name]??=XS(n):this.metadataTags.raw[e.name]??=sI(n,e.contentSize),n.filePos=t}switch(e.name){case"meta":n.skip(-e.headerSize),this.traverseBox(n);break;case"©nam":case"name":this.currentTrack?this.currentTrack.name=e_.decode(sI(n,e.contentSize)):this.metadataTags.title??=XS(n);break;case"©des":this.currentTrack||(this.metadataTags.description??=XS(n));break;case"©ART":this.currentTrack||(this.metadataTags.artist??=XS(n));break;case"©alb":this.currentTrack||(this.metadataTags.album??=XS(n));break;case"albr":this.currentTrack||(this.metadataTags.albumArtist??=XS(n));break;case"©gen":this.currentTrack||(this.metadataTags.genre??=XS(n));break;case"©day":if(!this.currentTrack){const e=new Date(XS(n));Number.isNaN(e.getTime())||(this.metadataTags.date??=e)}break;case"©cmt":this.currentTrack||(this.metadataTags.comment??=XS(n));break;case"©lyr":this.currentTrack||(this.metadataTags.lyrics??=XS(n))}}}break;case"meta":{if(this.currentTrack)break;const t=0!==dI(e);this.currentMetadataKeys=new Map,t?this.readContiguousBoxes(e.slice(r,n.contentSize)):this.readContiguousBoxes(e.slice(r+4,n.contentSize-4)),this.currentMetadataKeys=null}break;case"keys":{if(!this.currentMetadataKeys)break;e.skip(4);const t=dI(e);for(let n=0;n<t;n++){const t=dI(e);e.skip(4);const r=e_.decode(sI(e,t-8));this.currentMetadataKeys.set(n+1,r)}}break;case"ilst":{if(!this.currentMetadataKeys)break;const t=this.iterateContiguousBoxes(e.slice(r,n.contentSize));for(const{boxInfo:e,slice:n}of t){let t=e.name;const r=(t.charCodeAt(0)<<24)+(t.charCodeAt(1)<<16)+(t.charCodeAt(2)<<8)+t.charCodeAt(3);this.currentMetadataKeys.has(r)&&(t=this.currentMetadataKeys.get(r));const s=GS(n);switch(this.metadataTags.raw??={},this.metadataTags.raw[t]??=s,t){case"©nam":case"titl":case"com.apple.quicktime.title":case"title":"string"==typeof s&&(this.metadataTags.title??=s);break;case"©des":case"desc":case"dscp":case"com.apple.quicktime.description":case"description":"string"==typeof s&&(this.metadataTags.description??=s);break;case"©ART":case"com.apple.quicktime.artist":case"artist":"string"==typeof s&&(this.metadataTags.artist??=s);break;case"©alb":case"albm":case"com.apple.quicktime.album":case"album":"string"==typeof s&&(this.metadataTags.album??=s);break;case"aART":case"album_artist":"string"==typeof s&&(this.metadataTags.albumArtist??=s);break;case"©cmt":case"com.apple.quicktime.comment":case"comment":"string"==typeof s&&(this.metadataTags.comment??=s);break;case"©gen":case"gnre":case"com.apple.quicktime.genre":case"genre":"string"==typeof s&&(this.metadataTags.genre??=s);break;case"©lyr":case"lyrics":"string"==typeof s&&(this.metadataTags.lyrics??=s);break;case"©day":case"rldt":case"com.apple.quicktime.creationdate":case"date":if("string"==typeof s){const e=new Date(s);Number.isNaN(e.getTime())||(this.metadataTags.date??=e)}break;case"covr":case"com.apple.quicktime.artwork":s instanceof X_?(this.metadataTags.images??=[],this.metadataTags.images.push({data:s.data,kind:"coverFront",mimeType:s.mimeType})):s instanceof Uint8Array&&(this.metadataTags.images??=[],this.metadataTags.images.push({data:s,kind:"coverFront",mimeType:"image/*"}));break;case"track":if("string"==typeof s){const e=s.split("/"),t=Number.parseInt(e[0],10),n=e[1]&&Number.parseInt(e[1],10);Number.isInteger(t)&&t>0&&(this.metadataTags.trackNumber??=t),n&&Number.isInteger(n)&&n>0&&(this.metadataTags.tracksTotal??=n)}break;case"trkn":if(s instanceof Uint8Array&&s.length>=6){const e=ZT(s),t=e.getUint16(2,!1),n=e.getUint16(4,!1);t>0&&(this.metadataTags.trackNumber??=t),n>0&&(this.metadataTags.tracksTotal??=n)}break;case"disc":case"disk":if(s instanceof Uint8Array&&s.length>=6){const e=ZT(s),t=e.getUint16(2,!1),n=e.getUint16(4,!1);t>0&&(this.metadataTags.discNumber??=t),n>0&&(this.metadataTags.discsTotal??=n)}}}}}return e.filePos=s,!0}}class YS{constructor(e){this.internalTrack=e,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.internalCodecId}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}getTimeResolution(){return this.internalTrack.timescale}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){const e=await this.getFirstPacket({metadataOnly:!0});return e?.timestamp??0}async getFirstPacket(e){const t=await this.fetchPacketForSampleIndex(0,e);return t||!this.internalTrack.demuxer.isFragmented?t:this.performFragmentedLookup(()=>{const e=this.internalTrack.demuxer.fragments[0]??null;if(e?.isKnownToBeFirstFragment){let t=e;for(;t;){if(t.trackData.get(this.internalTrack.id))return{fragmentIndex:f_(this.internalTrack.fragments,t.moofOffset,e=>e.moofOffset),sampleIndex:0,correctSampleFound:!0};t=t.nextFragment}}return{fragmentIndex:-1,sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,e)}mapTimestampIntoTimescale(e){return I_(e*this.internalTrack.timescale,14)+this.internalTrack.editListOffset}async getPacket(e,t){const n=this.mapTimestampIntoTimescale(e),r=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=ZS(r,n),i=await this.fetchPacketForSampleIndex(s,t);return iE(r)&&this.internalTrack.demuxer.isFragmented?this.performFragmentedLookup(()=>this.findSampleInFragmentsForTimestamp(n),n,n,t):i}async getNextPacket(e,t){const n=this.packetToSampleIndex.get(e);if(void 0!==n)return this.fetchPacketForSampleIndex(n+1,t);const r=this.packetToFragmentLocation.get(e);if(void 0===r)throw new Error("Packet was not created from this track.");const s=r.fragment.trackData.get(this.internalTrack.id),i=f_(this.internalTrack.fragments,r.fragment.moofOffset,e=>e.moofOffset);return HT(-1!==i),this.performFragmentedLookup(()=>{if(r.sampleIndex+1<s.samples.length)return{fragmentIndex:i,sampleIndex:r.sampleIndex+1,correctSampleFound:!0};{let e=r.fragment;for(;e.nextFragment;){e=e.nextFragment;if(e.trackData.get(this.internalTrack.id)){const t=f_(this.internalTrack.fragments,e.moofOffset,e=>e.moofOffset);return HT(-1!==t),{fragmentIndex:t,sampleIndex:0,correctSampleFound:!0}}}return{fragmentIndex:i,sampleIndex:-1,correctSampleFound:!1}}},-1/0,1/0,t)}async getKeyPacket(e,t){const n=this.mapTimestampIntoTimescale(e),r=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=ZS(r,n),i=-1===s?-1:tE(r,s),a=await this.fetchPacketForSampleIndex(i,t);return iE(r)&&this.internalTrack.demuxer.isFragmented?this.performFragmentedLookup(()=>this.findKeySampleInFragmentsForTimestamp(n),n,n,t):a}async getNextKeyPacket(e,t){const n=this.packetToSampleIndex.get(e);if(void 0!==n){const e=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),r=nE(e,n);return this.fetchPacketForSampleIndex(r,t)}const r=this.packetToFragmentLocation.get(e);if(void 0===r)throw new Error("Packet was not created from this track.");const s=r.fragment.trackData.get(this.internalTrack.id),i=f_(this.internalTrack.fragments,r.fragment.moofOffset,e=>e.moofOffset);return HT(-1!==i),this.performFragmentedLookup(()=>{const e=s.samples.findIndex((e,t)=>e.isKeyFrame&&t>r.sampleIndex);if(-1!==e)return{fragmentIndex:i,sampleIndex:e,correctSampleFound:!0};{let e=r.fragment;for(;e.nextFragment;){e=e.nextFragment;const t=e.trackData.get(this.internalTrack.id);if(t&&null!==t.firstKeyFrameTimestamp){const n=f_(this.internalTrack.fragments,e.moofOffset,e=>e.moofOffset);HT(-1!==n);const r=t.samples.findIndex(e=>e.isKeyFrame);return HT(-1!==r),{fragmentIndex:n,sampleIndex:r,correctSampleFound:!0}}}return{fragmentIndex:i,sampleIndex:-1,correctSampleFound:!1}}},-1/0,1/0,t)}async fetchPacketForSampleIndex(e,t){if(-1===e)return null;const n=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),r=eE(n,e);if(!r)return null;let s;if(t.metadataOnly)s=uS;else{let e=this.internalTrack.demuxer.reader.requestSlice(r.sampleOffset,r.sampleSize);e instanceof Promise&&(e=await e),HT(e),s=sI(e,r.sampleSize)}const i=(r.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,a=r.duration/this.internalTrack.timescale,o=new dS(s,r.isKeyFrame?"key":"delta",i,a,e,r.sampleSize);return this.packetToSampleIndex.set(o,e),o}async fetchPacketInFragment(e,t,n){if(-1===t)return null;const r=e.trackData.get(this.internalTrack.id).samples[t];let s;if(HT(r),n.metadataOnly)s=uS;else{let e=this.internalTrack.demuxer.reader.requestSlice(r.byteOffset,r.byteSize);e instanceof Promise&&(e=await e),HT(e),s=sI(e,r.byteSize)}const i=(r.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,a=r.duration/this.internalTrack.timescale,o=new dS(s,r.isKeyFrame?"key":"delta",i,a,e.moofOffset+t,r.byteSize);return this.packetToFragmentLocation.set(o,{fragment:e,sampleIndex:t}),o}findSampleInFragmentsForTimestamp(e){const t=g_(this.internalTrack.fragments,e,e=>e.trackData.get(this.internalTrack.id).startTimestamp);let n=-1,r=!1;if(-1!==t){const s=this.internalTrack.fragments[t].trackData.get(this.internalTrack.id),i=g_(s.presentationTimestamps,e,e=>e.presentationTimestamp);HT(-1!==i),n=s.presentationTimestamps[i].sampleIndex,r=e<s.endTimestamp}return{fragmentIndex:t,sampleIndex:n,correctSampleFound:r}}findKeySampleInFragmentsForTimestamp(e){const t=g_(this.internalTrack.fragmentsWithKeyFrame,e,e=>e.trackData.get(this.internalTrack.id).startTimestamp);let n=-1,r=-1,s=!1;if(-1!==t){const i=this.internalTrack.fragmentsWithKeyFrame[t];n=f_(this.internalTrack.fragments,i.moofOffset,e=>e.moofOffset),HT(-1!==n);const a=i.trackData.get(this.internalTrack.id),o=k_(a.presentationTimestamps,t=>a.samples[t.sampleIndex].isKeyFrame&&t.presentationTimestamp<=e);HT(-1!==o);r=a.presentationTimestamps[o].sampleIndex,s=e<a.endTimestamp}return{fragmentIndex:n,sampleIndex:r,correctSampleFound:s}}async performFragmentedLookup(e,t,n,r){const s=this.internalTrack.demuxer,i=await s.fragmentLookupMutex.acquire();try{const{fragmentIndex:i,sampleIndex:a,correctSampleFound:o}=e();if(o){const e=this.internalTrack.fragments[i];return this.fetchPacketInFragment(e,a,r)}let c=null,l=i,u=a;const d=this.internalTrack.fragmentLookupTable?g_(this.internalTrack.fragmentLookupTable,t,e=>e.timestamp):-1,h=-1!==d?this.internalTrack.fragmentLookupTable[d]:null;let m,p=!1;if(-1===i)m=h?.moofOffset??0,p=0===m;else{const e=this.internalTrack.fragments[i];!h||e.moofOffset>=h.moofOffset?(m=e.moofOffset+e.moofSize,c=e):m=h.moofOffset}for(;;){if(c){const e=c.trackData.get(this.internalTrack.id);if(e&&e.startTimestamp>n)break;if(c.nextFragment){m=c.nextFragment.moofOffset+c.nextFragment.moofSize,c=c.nextFragment;continue}}let t=s.reader.requestSliceRange(m,8,VS);if(t instanceof Promise&&(t=await t),!t)break;const i=m,a=jS(t);if(!a)break;if("moof"===a.name){const t=f_(s.fragments,i,e=>e.moofOffset);let n;n=-1===t?await s.readFragment(i):s.fragments[t],c&&(c.nextFragment=n),c=n,p&&(n.isKnownToBeFirstFragment=!0,p=!1);const{fragmentIndex:a,sampleIndex:o,correctSampleFound:d}=e();if(d){const e=this.internalTrack.fragments[a];return this.fetchPacketInFragment(e,o,r)}-1!==a&&(l=a,u=o)}m=i+a.totalSize}const f=-1!==l?this.internalTrack.fragments[l]:null;if(h&&(!f||f.moofOffset<h.moofOffset)){const t=this.internalTrack.fragmentLookupTable[d-1],s=t?.timestamp??-1/0;return this.performFragmentedLookup(e,s,n,r)}return f?this.fetchPacketInFragment(f,u,r):null}finally{i()}}}class QS extends YS{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return!1}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{if("vp9"!==this.internalTrack.info.codec||this.internalTrack.info.vp9CodecInfo){if("av1"===this.internalTrack.info.codec&&!this.internalTrack.info.av1CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.av1CodecInfo=e&&Qv(e.data)}}else{const e=await this.getFirstPacket({});this.internalTrack.info.vp9CodecInfo=e&&Kv(e.data)}return{codec:uv(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class JS extends YS{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:hv(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const ZS=(e,t)=>{if(e.presentationTimestamps){const n=g_(e.presentationTimestamps,t,e=>e.presentationTimestamp);return-1===n?-1:e.presentationTimestamps[n].sampleIndex}{const n=g_(e.sampleTimingEntries,t,e=>e.startDecodeTimestamp);if(-1===n)return-1;const r=e.sampleTimingEntries[n];return r.startIndex+Math.min(Math.floor((t-r.startDecodeTimestamp)/r.delta),r.count-1)}},eE=(e,t)=>{const n=g_(e.sampleTimingEntries,t,e=>e.startIndex),r=e.sampleTimingEntries[n];if(!r||r.startIndex+r.count<=t)return null;let s=r.startDecodeTimestamp+(t-r.startIndex)*r.delta;const i=g_(e.sampleCompositionTimeOffsets,t,e=>e.startIndex),a=e.sampleCompositionTimeOffsets[i];a&&t-a.startIndex<a.count&&(s+=a.offset);const o=e.sampleSizes[Math.min(t,e.sampleSizes.length-1)],c=g_(e.sampleToChunk,t,e=>e.startSampleIndex),l=e.sampleToChunk[c];HT(l);const u=l.startChunkIndex+Math.floor((t-l.startSampleIndex)/l.samplesPerChunk),d=e.chunkOffsets[u],h=l.startSampleIndex+(u-l.startChunkIndex)*l.samplesPerChunk;let m=0,p=d;if(1===e.sampleSizes.length)p+=o*(t-h),m+=o*l.samplesPerChunk;else for(let g=h;g<h+l.samplesPerChunk;g++){const n=e.sampleSizes[g];g<t&&(p+=n),m+=n}let f=r.delta;if(e.presentationTimestamps){const n=e.presentationTimestampIndexMap[t];if(HT(void 0!==n),n<e.presentationTimestamps.length-1){f=e.presentationTimestamps[n+1].presentationTimestamp-s}}return{presentationTimestamp:s,duration:f,sampleOffset:p,sampleSize:o,chunkOffset:d,chunkSize:m,isKeyFrame:!e.keySampleIndices||-1!==f_(e.keySampleIndices,t,e=>e)}},tE=(e,t)=>{if(!e.keySampleIndices)return t;const n=g_(e.keySampleIndices,t,e=>e);return e.keySampleIndices[n]??-1},nE=(e,t)=>{if(!e.keySampleIndices)return t+1;const n=g_(e.keySampleIndices,t,e=>e);return e.keySampleIndices[n+1]??-1},rE=(e,t)=>{e.startTimestamp+=t,e.endTimestamp+=t;for(const n of e.samples)n.presentationTimestamp+=t;for(const n of e.presentationTimestamps)n.presentationTimestamp+=t},sE=e=>{const[t,,,n]=e,r=Math.hypot(t,n),s=t/r,i=n/r,a=-Math.atan2(i,s)*(180/Math.PI);return Number.isFinite(a)?a:0},iE=e=>0===e.sampleSizes.length;class aE{constructor(e){this.value=e}}class oE{constructor(e){this.value=e}}class cE{constructor(e){this.value=e}}class lE{constructor(e){this.value=e}}var uE,dE;(dE=uE||(uE={}))[dE.EBML=440786851]="EBML",dE[dE.EBMLVersion=17030]="EBMLVersion",dE[dE.EBMLReadVersion=17143]="EBMLReadVersion",dE[dE.EBMLMaxIDLength=17138]="EBMLMaxIDLength",dE[dE.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",dE[dE.DocType=17026]="DocType",dE[dE.DocTypeVersion=17031]="DocTypeVersion",dE[dE.DocTypeReadVersion=17029]="DocTypeReadVersion",dE[dE.Void=236]="Void",dE[dE.Segment=408125543]="Segment",dE[dE.SeekHead=290298740]="SeekHead",dE[dE.Seek=19899]="Seek",dE[dE.SeekID=21419]="SeekID",dE[dE.SeekPosition=21420]="SeekPosition",dE[dE.Duration=17545]="Duration",dE[dE.Info=357149030]="Info",dE[dE.TimestampScale=2807729]="TimestampScale",dE[dE.MuxingApp=19840]="MuxingApp",dE[dE.WritingApp=22337]="WritingApp",dE[dE.Tracks=374648427]="Tracks",dE[dE.TrackEntry=174]="TrackEntry",dE[dE.TrackNumber=215]="TrackNumber",dE[dE.TrackUID=29637]="TrackUID",dE[dE.TrackType=131]="TrackType",dE[dE.FlagEnabled=185]="FlagEnabled",dE[dE.FlagDefault=136]="FlagDefault",dE[dE.FlagForced=21930]="FlagForced",dE[dE.FlagLacing=156]="FlagLacing",dE[dE.Name=21358]="Name",dE[dE.Language=2274716]="Language",dE[dE.LanguageBCP47=2274717]="LanguageBCP47",dE[dE.CodecID=134]="CodecID",dE[dE.CodecPrivate=25506]="CodecPrivate",dE[dE.CodecDelay=22186]="CodecDelay",dE[dE.SeekPreRoll=22203]="SeekPreRoll",dE[dE.DefaultDuration=2352003]="DefaultDuration",dE[dE.Video=224]="Video",dE[dE.PixelWidth=176]="PixelWidth",dE[dE.PixelHeight=186]="PixelHeight",dE[dE.AlphaMode=21440]="AlphaMode",dE[dE.Audio=225]="Audio",dE[dE.SamplingFrequency=181]="SamplingFrequency",dE[dE.Channels=159]="Channels",dE[dE.BitDepth=25188]="BitDepth",dE[dE.SimpleBlock=163]="SimpleBlock",dE[dE.BlockGroup=160]="BlockGroup",dE[dE.Block=161]="Block",dE[dE.BlockAdditions=30113]="BlockAdditions",dE[dE.BlockMore=166]="BlockMore",dE[dE.BlockAdditional=165]="BlockAdditional",dE[dE.BlockAddID=238]="BlockAddID",dE[dE.BlockDuration=155]="BlockDuration",dE[dE.ReferenceBlock=251]="ReferenceBlock",dE[dE.Cluster=524531317]="Cluster",dE[dE.Timestamp=231]="Timestamp",dE[dE.Cues=475249515]="Cues",dE[dE.CuePoint=187]="CuePoint",dE[dE.CueTime=179]="CueTime",dE[dE.CueTrackPositions=183]="CueTrackPositions",dE[dE.CueTrack=247]="CueTrack",dE[dE.CueClusterPosition=241]="CueClusterPosition",dE[dE.Colour=21936]="Colour",dE[dE.MatrixCoefficients=21937]="MatrixCoefficients",dE[dE.TransferCharacteristics=21946]="TransferCharacteristics",dE[dE.Primaries=21947]="Primaries",dE[dE.Range=21945]="Range",dE[dE.Projection=30320]="Projection",dE[dE.ProjectionType=30321]="ProjectionType",dE[dE.ProjectionPoseRoll=30325]="ProjectionPoseRoll",dE[dE.Attachments=423732329]="Attachments",dE[dE.AttachedFile=24999]="AttachedFile",dE[dE.FileDescription=18046]="FileDescription",dE[dE.FileName=18030]="FileName",dE[dE.FileMediaType=18016]="FileMediaType",dE[dE.FileData=18012]="FileData",dE[dE.FileUID=18094]="FileUID",dE[dE.Chapters=272869232]="Chapters",dE[dE.Tags=307544935]="Tags",dE[dE.Tag=29555]="Tag",dE[dE.Targets=25536]="Targets",dE[dE.TargetTypeValue=26826]="TargetTypeValue",dE[dE.TargetType=25546]="TargetType",dE[dE.TagTrackUID=25541]="TagTrackUID",dE[dE.TagEditionUID=25545]="TagEditionUID",dE[dE.TagChapterUID=25540]="TagChapterUID",dE[dE.TagAttachmentUID=25542]="TagAttachmentUID",dE[dE.SimpleTag=26568]="SimpleTag",dE[dE.TagName=17827]="TagName",dE[dE.TagLanguage=17530]="TagLanguage",dE[dE.TagString=17543]="TagString",dE[dE.TagBinary=17541]="TagBinary",dE[dE.ContentEncodings=28032]="ContentEncodings",dE[dE.ContentEncoding=25152]="ContentEncoding",dE[dE.ContentEncodingOrder=20529]="ContentEncodingOrder",dE[dE.ContentEncodingScope=20530]="ContentEncodingScope",dE[dE.ContentCompression=20532]="ContentCompression",dE[dE.ContentCompAlgo=16980]="ContentCompAlgo",dE[dE.ContentCompSettings=16981]="ContentCompSettings",dE[dE.ContentEncryption=20533]="ContentEncryption";const hE=[uE.EBML,uE.Segment],mE=[uE.SeekHead,uE.Info,uE.Cluster,uE.Tracks,uE.Cues,uE.Attachments,uE.Chapters,uE.Tags],pE=[...hE,...mE],fE=e=>e<256?1:e<65536?2:e<1<<24?3:e<2**32?4:e<2**40?5:6,gE=e=>e<256n?1:e<65536n?2:e<1n<<24n?3:e<1n<<32n?4:e<1n<<40n?5:e<1n<<48n?6:e<1n<<56n?7:8,bE=e=>e>=-64&&e<64?1:e>=-8192&&e<8192?2:e>=-1048576&&e<1<<20?3:e>=-134217728&&e<1<<27?4:e>=-17179869184&&e<2**34?5:6;class yE{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}writeByte(e){this.helperView.setUint8(0,e),this.writer.write(this.helper.subarray(0,1))}writeFloat32(e){this.helperView.setFloat32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeFloat64(e){this.helperView.setFloat64(0,e,!1),this.writer.write(this.helper)}writeUnsignedInt(e,t=fE(e)){let n=0;switch(t){case 6:this.helperView.setUint8(n++,e/2**40|0);case 5:this.helperView.setUint8(n++,e/2**32|0);case 4:this.helperView.setUint8(n++,e>>24);case 3:this.helperView.setUint8(n++,e>>16);case 2:this.helperView.setUint8(n++,e>>8);case 1:this.helperView.setUint8(n++,e);break;default:throw new Error("Bad unsigned int size "+t)}this.writer.write(this.helper.subarray(0,n))}writeUnsignedBigInt(e,t=gE(e)){let n=0;for(let r=t-1;r>=0;r--)this.helperView.setUint8(n++,Number(e>>BigInt(8*r)&0xffn));this.writer.write(this.helper.subarray(0,n))}writeSignedInt(e,t=bE(e)){e<0&&(e+=2**(8*t)),this.writeUnsignedInt(e,t)}writeVarInt(e,t=(e=>{if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<268435455)return 4;if(e<2**35-1)return 5;if(e<2**42-1)return 6;throw new Error("EBML varint size not supported "+e)})(e)){let n=0;switch(t){case 1:this.helperView.setUint8(n++,128|e);break;case 2:this.helperView.setUint8(n++,64|e>>8),this.helperView.setUint8(n++,e);break;case 3:this.helperView.setUint8(n++,32|e>>16),this.helperView.setUint8(n++,e>>8),this.helperView.setUint8(n++,e);break;case 4:this.helperView.setUint8(n++,16|e>>24),this.helperView.setUint8(n++,e>>16),this.helperView.setUint8(n++,e>>8),this.helperView.setUint8(n++,e);break;case 5:this.helperView.setUint8(n++,8|e/2**32&7),this.helperView.setUint8(n++,e>>24),this.helperView.setUint8(n++,e>>16),this.helperView.setUint8(n++,e>>8),this.helperView.setUint8(n++,e);break;case 6:this.helperView.setUint8(n++,4|e/2**40&3),this.helperView.setUint8(n++,e/2**32|0),this.helperView.setUint8(n++,e>>24),this.helperView.setUint8(n++,e>>16),this.helperView.setUint8(n++,e>>8),this.helperView.setUint8(n++,e);break;default:throw new Error("Bad EBML varint size "+t)}this.writer.write(this.helper.subarray(0,n))}writeAsciiString(e){this.writer.write(new Uint8Array(e.split("").map(e=>e.charCodeAt(0))))}writeEBML(e){if(null!==e)if(e instanceof Uint8Array)this.writer.write(e);else if(Array.isArray(e))for(const t of e)this.writeEBML(t);else if(this.offsets.set(e,this.writer.getPos()),this.writeUnsignedInt(e.id),Array.isArray(e.data)){const t=this.writer.getPos(),n=-1===e.size?1:e.size??4;-1===e.size?this.writeByte(255):this.writer.seek(this.writer.getPos()+n);const r=this.writer.getPos();if(this.dataOffsets.set(e,r),this.writeEBML(e.data),-1!==e.size){const e=this.writer.getPos()-r,s=this.writer.getPos();this.writer.seek(t),this.writeVarInt(e,n),this.writer.seek(s)}}else if("number"==typeof e.data){const t=e.size??fE(e.data);this.writeVarInt(t),this.writeUnsignedInt(e.data,t)}else if("bigint"==typeof e.data){const t=e.size??gE(e.data);this.writeVarInt(t),this.writeUnsignedBigInt(e.data,t)}else if("string"==typeof e.data)this.writeVarInt(e.data.length),this.writeAsciiString(e.data);else if(e.data instanceof Uint8Array)this.writeVarInt(e.data.byteLength,e.size),this.writer.write(e.data);else if(e.data instanceof aE)this.writeVarInt(4),this.writeFloat32(e.data.value);else if(e.data instanceof oE)this.writeVarInt(8),this.writeFloat64(e.data.value);else if(e.data instanceof cE){const t=e.size??bE(e.data.value);this.writeVarInt(t),this.writeSignedInt(e.data.value,t)}else if(e.data instanceof lE){const t=t_.encode(e.data.value);this.writeVarInt(t.length),this.writer.write(t)}else T_(e.data)}}const wE=16,kE=e=>{const t=iI(e);if(e.skip(-1),0===t)return null;let n=1,r=128;for(;0===(t&r);)n++,r>>=1;return n},TE=e=>{const t=iI(e);if(0===t)return null;let n=1,r=128;for(;0===(t&r);)n++,r>>=1;let s=t&r-1;for(let i=1;i<n;i++)s*=256,s+=iI(e);return s},_E=(e,t)=>{if(t<1||t>8)throw new Error("Bad unsigned int size "+t);let n=0;for(let r=0;r<t;r++)n*=256,n+=iI(e);return n},vE=e=>{const t=kE(e);if(null===t)return null;return _E(e,t)},SE=e=>{let t=iI(e);return 255===t?t=null:(e.skip(-1),t=TE(e),72057594037927940===t&&(t=null)),t},EE=e=>{const t=vE(e);if(null===t)return null;return{id:t,size:SE(e)}},CE=(e,t)=>{const n=sI(e,t);let r=0;for(;r<t&&0!==n[r];)r+=1;return String.fromCharCode(...n.subarray(0,r))},IE=(e,t)=>{const n=sI(e,t);let r=0;for(;r<t&&0!==n[r];)r+=1;return e_.decode(n.subarray(0,r))},xE=(e,t)=>{if(0===t)return 0;if(4!==t&&8!==t)throw new Error("Bad float size "+t);return 4===t?yI(e):wI(e)},AE=async(e,t,n,r)=>{const s=new Set(n);let i=t;for(;null===r||i<r;){let t=e.requestSliceRange(i,2,wE);if(t instanceof Promise&&(t=await t),!t)break;const n=EE(t);if(!n)break;if(s.has(n.id))return{pos:i,found:!0};NE(n.size),i=t.filePos+n.size}return{pos:null!==r&&r>i?r:i,found:!1}},PE=async(e,t,n,r)=>{const s=new Set(n);let i=t;for(;i<r;){let t=e.requestSliceRange(i,0,Math.min(65536,r-i));if(t instanceof Promise&&(t=await t),!t)break;if(t.length<8)break;for(let e=0;e<t.length-8;e++){t.filePos=i;const e=vE(t);if(null!==e&&s.has(e))return i;i++}}return null},OE={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC","pcm-u8":"A_PCM/INT/LIT","pcm-s16":"A_PCM/INT/LIT","pcm-s16be":"A_PCM/INT/BIG","pcm-s24":"A_PCM/INT/LIT","pcm-s24be":"A_PCM/INT/BIG","pcm-s32":"A_PCM/INT/LIT","pcm-s32be":"A_PCM/INT/BIG","pcm-f32":"A_PCM/FLOAT/IEEE","pcm-f64":"A_PCM/FLOAT/IEEE",webvtt:"S_TEXT/WEBVTT"};function NE(e){if(null===e)throw new Error("Undefined element size is used in a place where it is not supported.")}const RE=e=>{let t=(e.hasVideo?"video/":e.hasAudio?"audio/":"application/")+(e.isWebM?"webm":"x-matroska");if(e.codecStrings.length>0){t+=`; codecs="${[...new Set(e.codecStrings.filter(Boolean))].join(", ")}"`}return t};var ME,DE,FE,LE,BE,zE;(DE=ME||(ME={}))[DE.None=0]="None",DE[DE.Xiph=1]="Xiph",DE[DE.FixedSize=2]="FixedSize",DE[DE.Ebml=3]="Ebml",(LE=FE||(FE={}))[LE.Block=1]="Block",LE[LE.Private=2]="Private",LE[LE.Next=4]="Next",(zE=BE||(BE={}))[zE.Zlib=0]="Zlib",zE[zE.Bzlib=1]="Bzlib",zE[zE.lzo1x=2]="lzo1x",zE[zE.HeaderStripping=3]="HeaderStripping";const UE=[{id:uE.SeekHead,flag:"seekHeadSeen"},{id:uE.Info,flag:"infoSeen"},{id:uE.Tracks,flag:"tracksSeen"},{id:uE.Cues,flag:"cuesSeen"}],$E=10485760;class VE extends iS{constructor(e){super(e),this.readMetadataPromise=null,this.segments=[],this.currentSegment=null,this.currentTrack=null,this.currentCluster=null,this.currentBlock=null,this.currentBlockAdditional=null,this.currentCueTime=null,this.currentDecodingInstruction=null,this.currentTagTargetIsMovie=!0,this.currentSimpleTagName=null,this.currentAttachedFile=null,this.isWebM=!1,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),t=await Promise.all(e.map(e=>e.computeDuration()));return Math.max(0,...t)}async getTracks(){return await this.readMetadata(),this.segments.flatMap(e=>e.tracks.map(e=>e.inputTrack))}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),t=await Promise.all(e.map(e=>e.getCodecParameterString()));return RE({isWebM:this.isWebM,hasVideo:this.segments.some(e=>e.tracks.some(e=>"video"===e.info?.type)),hasAudio:this.segments.some(e=>e.tracks.some(e=>"audio"===e.info?.type)),codecStrings:t.filter(Boolean)})}async getMetadataTags(){await this.readMetadata();for(const t of this.segments)t.metadataTagsCollected||(null!==this.reader.fileSize&&await this.loadSegmentMetadata(t),t.metadataTagsCollected=!0);let e={};for(const t of this.segments)e={...e,...t.metadataTags};return e}readMetadata(){return this.readMetadataPromise??=(async()=>{let e=0;for(;;){let t=this.reader.requestSliceRange(e,2,wE);if(t instanceof Promise&&(t=await t),!t)break;const n=EE(t);if(!n)break;const r=n.id;let s=n.size;const i=t.filePos;if(r===uE.EBML){NE(s);let e=this.reader.requestSlice(i,s);if(e instanceof Promise&&(e=await e),!e)break;this.readContiguousElements(e)}else if(r===uE.Segment){if(await this.readSegment(i,s),null===s)break;if(null===this.reader.fileSize)break}else if(r===uE.Cluster){if(null===this.reader.fileSize)break;if(null===s){s=(await AE(this.reader,i,pE,this.reader.fileSize)).pos-i}const e=XT(this.segments);e&&(e.elementEndPos=i+s)}NE(s),e=i+s}})()}async readSegment(e,t){this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,tagsSeen:!1,attachmentsSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:e,elementEndPos:null===t?null:e+t,clusterSeekStartPos:e,clusters:[],clusterLookupMutex:new h_,metadataTags:{},metadataTagsCollected:!1},this.segments.push(this.currentSegment);let n=e;for(;null===this.currentSegment.elementEndPos||n<this.currentSegment.elementEndPos;){let e=this.reader.requestSliceRange(n,2,wE);if(e instanceof Promise&&(e=await e),!e)break;const t=n,r=EE(e);if(!r||!mE.includes(r.id)&&r.id!==uE.Void){const e=await PE(this.reader,t,mE,Math.min(this.currentSegment.elementEndPos??1/0,t+$E));if(e){n=e;continue}break}const{id:s,size:i}=r,a=e.filePos,o=UE.findIndex(e=>e.id===s);if(-1!==o){const e=UE[o].flag;this.currentSegment[e]=!0,NE(i);let t=this.reader.requestSlice(a,i);t instanceof Promise&&(t=await t),t&&this.readContiguousElements(t)}else if(s===uE.Tags||s===uE.Attachments){s===uE.Tags?this.currentSegment.tagsSeen=!0:this.currentSegment.attachmentsSeen=!0,NE(i);let e=this.reader.requestSlice(a,i);e instanceof Promise&&(e=await e),e&&this.readContiguousElements(e)}else if(s===uE.Cluster){this.currentSegment.clusterSeekStartPos=t;break}if(null===i)break;n=a+i}if(this.currentSegment.seekEntries.sort((e,t)=>e.segmentPosition-t.segmentPosition),null!==this.reader.fileSize)for(const o of this.currentSegment.seekEntries){const t=UE.find(e=>e.id===o.id);if(!t)continue;if(this.currentSegment[t.flag])continue;let n=this.reader.requestSliceRange(e+o.segmentPosition,2,wE);if(n instanceof Promise&&(n=await n),!n)continue;const r=EE(n);if(!r)continue;const{id:s,size:i}=r;if(s!==t.id)continue;NE(i),this.currentSegment[t.flag]=!0;let a=this.reader.requestSlice(n.filePos,i);a instanceof Promise&&(a=await a),a&&this.readContiguousElements(a)}-1===this.currentSegment.timestampScale&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e3),this.currentSegment.tracks.sort((e,t)=>Number(t.isDefault)-Number(e.isDefault)),this.currentSegment.cuePoints.sort((e,t)=>e.clusterPosition-t.clusterPosition);const r=this.currentSegment.tracks.map(e=>e.id),s=new Set;let i=null,a=null;for(const o of this.currentSegment.cuePoints){if(o.clusterPosition!==i){for(const e of s){HT(a);const t=this.currentSegment.tracks.find(t=>t.id===e);t.cuePoints.push(a)}for(const e of r)s.add(e)}if(a=o,!s.has(o.trackId))continue;const e=this.currentSegment.tracks.find(e=>e.id===o.trackId);e.cuePoints.push(o),s.delete(o.trackId),i=o.clusterPosition}for(const o of s){HT(a);const e=this.currentSegment.tracks.find(e=>e.id===o);e.cuePoints.push(a)}for(const o of this.currentSegment.tracks)o.cuePoints.sort((e,t)=>e.time-t.time);this.currentSegment=null}async readCluster(e,t){let n=this.reader.requestSliceRange(e,2,wE);n instanceof Promise&&(n=await n),HT(n);const r=e,s=EE(n);HT(s);const i=s.id;let a=s.size;const o=n.filePos;if(null===a){a=(await AE(this.reader,o,pE,t.elementEndPos)).pos-o}HT(i===uE.Cluster);let c=this.reader.requestSlice(o,a);c instanceof Promise&&(c=await c);const l={segment:t,elementStartPos:r,elementEndPos:o+a,dataStartPos:o,timestamp:-1,trackData:new Map,nextCluster:null,isKnownToBeFirstCluster:!1};this.currentCluster=l,c&&this.readContiguousElements(c);for(const[,u]of l.trackData){const e=u.track;HT(u.blocks.length>0);let t=!1,n=!1;for(let i=0;i<u.blocks.length;i++){const e=u.blocks[i];e.timestamp+=l.timestamp,t||=e.referencedTimestamps.length>0,n||=e.lacing!==ME.None}t&&(u.blocks=qE(u.blocks)),u.presentationTimestamps=u.blocks.map((e,t)=>({timestamp:e.timestamp,blockIndex:t})).sort((e,t)=>e.timestamp-t.timestamp);for(let i=0;i<u.presentationTimestamps.length;i++){const t=u.presentationTimestamps[i],n=u.blocks[t.blockIndex];if(null===u.firstKeyFrameTimestamp&&n.isKeyFrame&&(u.firstKeyFrameTimestamp=n.timestamp),i<u.presentationTimestamps.length-1){const e=u.presentationTimestamps[i+1];n.duration=e.timestamp-n.timestamp}else 0===n.duration&&null!=e.defaultDuration&&n.lacing===ME.None&&(n.duration=e.defaultDuration)}n&&(this.expandLacedBlocks(u.blocks,e),u.presentationTimestamps=u.blocks.map((e,t)=>({timestamp:e.timestamp,blockIndex:t})).sort((e,t)=>e.timestamp-t.timestamp));const r=u.blocks[u.presentationTimestamps[0].blockIndex],s=u.blocks[XT(u.presentationTimestamps).blockIndex];u.startTimestamp=r.timestamp,u.endTimestamp=s.timestamp+s.duration,b_(e.clusters,l,e=>e.elementStartPos);null!==u.firstKeyFrameTimestamp&&b_(e.clustersWithKeyFrame,l,e=>e.elementStartPos)}return b_(t.clusters,l,e=>e.elementStartPos),this.currentCluster=null,l}getTrackDataInCluster(e,t){let n=e.trackData.get(t);if(!n){const r=e.segment.tracks.find(e=>e.id===t);if(!r)return null;n={track:r,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(t,n)}return n}expandLacedBlocks(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.lacing===ME.None)continue;r.decoded||(r.data=this.decodeBlockData(t,r.data),r.decoded=!0);const s=nI.tempFromBytes(r.data),i=[],a=iI(s)+1;switch(r.lacing){case ME.Xiph:{let e=0;for(let t=0;t<a-1;t++){let t=0;for(;s.bufferPos<s.length;){const n=iI(s);if(t+=n,n<255){i.push(t),e+=t;break}}}i.push(s.length-(s.bufferPos+e))}break;case ME.FixedSize:{const e=s.length-1,t=Math.floor(e/a);for(let n=0;n<a;n++)i.push(t)}break;case ME.Ebml:{const e=TE(s);HT(null!==e);let t=e;i.push(t);let n=t;for(let r=1;r<a-1;r++){const e=s.bufferPos,r=TE(s);HT(null!==r);t+=r-((1<<7*(s.bufferPos-e)-1)-1),i.push(t),n+=t}i.push(s.length-(s.bufferPos+n))}break;default:HT(!1)}HT(i.length===a),e.splice(n,1);for(let o=0;o<a;o++){const c=i[o],l=sI(s,c),u=r.duration||a*(t.defaultDuration??0),d=r.timestamp+u*o/a,h=u/a;e.splice(n+o,0,{timestamp:d,duration:h,isKeyFrame:r.isKeyFrame,referencedTimestamps:r.referencedTimestamps,data:l,lacing:ME.None,decoded:!0,mainAdditional:r.mainAdditional})}n+=a,n--}}async loadSegmentMetadata(e){for(const t of e.seekEntries){if(t.id!==uE.Tags||e.tagsSeen){if(t.id!==uE.Attachments||e.attachmentsSeen)continue}else;let n=this.reader.requestSliceRange(e.dataStartPos+t.segmentPosition,2,wE);if(n instanceof Promise&&(n=await n),!n)continue;const r=EE(n);if(!r||r.id!==t.id)continue;const{size:s}=r;NE(s),HT(!this.currentSegment),this.currentSegment=e;let i=this.reader.requestSlice(n.filePos,s);i instanceof Promise&&(i=await i),i&&this.readContiguousElements(i),this.currentSegment=null,t.id===uE.Tags?e.tagsSeen=!0:t.id===uE.Attachments&&(e.attachmentsSeen=!0)}}readContiguousElements(e){const t=e.filePos;for(;e.filePos-t<=e.length-2;){if(!this.traverseElement(e))break}}traverseElement(e){const t=EE(e);if(!t)return!1;const{id:n,size:r}=t,s=e.filePos;switch(NE(r),n){case uE.DocType:this.isWebM="webm"===CE(e,r);break;case uE.Seek:{if(!this.currentSegment)break;const t={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(t),this.readContiguousElements(e.slice(s,r)),-1!==t.id&&-1!==t.segmentPosition||this.currentSegment.seekEntries.pop()}break;case uE.SeekID:{const t=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!t)break;t.id=_E(e,r)}break;case uE.SeekPosition:{const t=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!t)break;t.segmentPosition=_E(e,r)}break;case uE.TimestampScale:if(!this.currentSegment)break;this.currentSegment.timestampScale=_E(e,r),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale;break;case uE.Duration:if(!this.currentSegment)break;this.currentSegment.duration=xE(e,r);break;case uE.TrackEntry:if(!this.currentSegment)break;if(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusters:[],clustersWithKeyFrame:[],cuePoints:[],isDefault:!1,inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,name:null,languageCode:C_,decodingInstructions:[],info:null},this.readContiguousElements(e.slice(s,r)),this.currentTrack.decodingInstructions.some(e=>"decompress"!==e.data?.type||e.scope!==FE.Block||e.data.algorithm!==BE.HeaderStripping)&&(this.currentTrack=null),this.currentTrack&&-1!==this.currentTrack.id&&this.currentTrack.codecId&&this.currentTrack.info){const e=this.currentTrack.codecId.indexOf("/"),t=-1===e?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,e);if("video"===this.currentTrack.info.type&&-1!==this.currentTrack.info.width&&-1!==this.currentTrack.info.height){this.currentTrack.codecId===OE.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===OE.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):t===OE.vp8?this.currentTrack.info.codec="vp8":t===OE.vp9?this.currentTrack.info.codec="vp9":t===OE.av1&&(this.currentTrack.info.codec="av1");const e=this.currentTrack,n=new zS(this.input,new WE(e));this.currentTrack.inputTrack=n,this.currentSegment.tracks.push(this.currentTrack)}else if("audio"===this.currentTrack.info.type&&-1!==this.currentTrack.info.numberOfChannels&&-1!==this.currentTrack.info.sampleRate){t===OE.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2")},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===OE.mp3?this.currentTrack.info.codec="mp3":t===OE.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate,this.currentTrack.info.sampleRate=gv):t===OE.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):t===OE.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):"A_PCM/INT/LIT"===this.currentTrack.codecId?8===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-u8":16===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s16":24===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s24":32===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-s32"):"A_PCM/INT/BIG"===this.currentTrack.codecId?8===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-u8":16===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s16be":24===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s24be":32===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-s32be"):"A_PCM/FLOAT/IEEE"===this.currentTrack.codecId&&(32===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-f32":64===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-f64"));const e=this.currentTrack,n=new US(this.input,new HE(e));this.currentTrack.inputTrack=n,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null;break;case uE.TrackNumber:if(!this.currentTrack)break;this.currentTrack.id=_E(e,r);break;case uE.TrackType:{if(!this.currentTrack)break;const t=_E(e,r);1===t?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null,alphaMode:!1}:2===t&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case uE.FlagEnabled:if(!this.currentTrack)break;_E(e,r)||(this.currentSegment.tracks.pop(),this.currentTrack=null);break;case uE.FlagDefault:if(!this.currentTrack)break;this.currentTrack.isDefault=!!_E(e,r);break;case uE.CodecID:if(!this.currentTrack)break;this.currentTrack.codecId=CE(e,r);break;case uE.CodecPrivate:if(!this.currentTrack)break;this.currentTrack.codecPrivate=sI(e,r);break;case uE.DefaultDuration:if(!this.currentTrack)break;this.currentTrack.defaultDuration=this.currentTrack.segment.timestampFactor*_E(e,r)/1e9;break;case uE.Name:if(!this.currentTrack)break;this.currentTrack.name=IE(e,r);break;case uE.Language:if(!this.currentTrack)break;if(this.currentTrack.languageCode!==C_)break;this.currentTrack.languageCode=CE(e,r),P_(this.currentTrack.languageCode)||(this.currentTrack.languageCode=C_);break;case uE.LanguageBCP47:{if(!this.currentTrack)break;const t=CE(e,r).split("-")[0];this.currentTrack.languageCode=t||C_}break;case uE.Video:if("video"!==this.currentTrack?.info?.type)break;this.readContiguousElements(e.slice(s,r));break;case uE.PixelWidth:if("video"!==this.currentTrack?.info?.type)break;this.currentTrack.info.width=_E(e,r);break;case uE.PixelHeight:if("video"!==this.currentTrack?.info?.type)break;this.currentTrack.info.height=_E(e,r);break;case uE.AlphaMode:if("video"!==this.currentTrack?.info?.type)break;this.currentTrack.info.alphaMode=1===_E(e,r);break;case uE.Colour:if("video"!==this.currentTrack?.info?.type)break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e.slice(s,r));break;case uE.MatrixCoefficients:{if("video"!==this.currentTrack?.info?.type||!this.currentTrack.info.colorSpace)break;const t=_E(e,r),n=l_[t]??null;this.currentTrack.info.colorSpace.matrix=n}break;case uE.Range:if("video"!==this.currentTrack?.info?.type||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=2===_E(e,r);break;case uE.TransferCharacteristics:{if("video"!==this.currentTrack?.info?.type||!this.currentTrack.info.colorSpace)break;const t=_E(e,r),n=o_[t]??null;this.currentTrack.info.colorSpace.transfer=n}break;case uE.Primaries:{if("video"!==this.currentTrack?.info?.type||!this.currentTrack.info.colorSpace)break;const t=_E(e,r),n=i_[t]??null;this.currentTrack.info.colorSpace.primaries=n}break;case uE.Projection:if("video"!==this.currentTrack?.info?.type)break;this.readContiguousElements(e.slice(s,r));break;case uE.ProjectionPoseRoll:{if("video"!==this.currentTrack?.info?.type)break;const t=-xE(e,r);try{this.currentTrack.info.rotation=qT(t)}catch{}}break;case uE.Audio:if("audio"!==this.currentTrack?.info?.type)break;this.readContiguousElements(e.slice(s,r));break;case uE.SamplingFrequency:if("audio"!==this.currentTrack?.info?.type)break;this.currentTrack.info.sampleRate=xE(e,r);break;case uE.Channels:if("audio"!==this.currentTrack?.info?.type)break;this.currentTrack.info.numberOfChannels=_E(e,r);break;case uE.BitDepth:if("audio"!==this.currentTrack?.info?.type)break;this.currentTrack.info.bitDepth=_E(e,r);break;case uE.CuePoint:if(!this.currentSegment)break;this.readContiguousElements(e.slice(s,r)),this.currentCueTime=null;break;case uE.CueTime:this.currentCueTime=_E(e,r);break;case uE.CueTrackPositions:{if(null===this.currentCueTime)break;HT(this.currentSegment);const t={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(t),this.readContiguousElements(e.slice(s,r)),-1!==t.trackId&&-1!==t.clusterPosition||this.currentSegment.cuePoints.pop()}break;case uE.CueTrack:{const t=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!t)break;t.trackId=_E(e,r)}break;case uE.CueClusterPosition:{const t=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!t)break;HT(this.currentSegment),t.clusterPosition=this.currentSegment.dataStartPos+_E(e,r)}break;case uE.Timestamp:if(!this.currentCluster)break;this.currentCluster.timestamp=_E(e,r);break;case uE.SimpleBlock:{if(!this.currentCluster)break;const t=TE(e);if(null===t)break;const n=this.getTrackDataInCluster(this.currentCluster,t);if(!n)break;const i=lI(e),a=iI(e),o=!!(128&a),c=a>>1&3,l=sI(e,r-(e.filePos-s)),u=n.track.decodingInstructions.length>0;n.blocks.push({timestamp:i,duration:0,isKeyFrame:o,referencedTimestamps:[],data:l,lacing:c,decoded:!u,mainAdditional:null})}break;case uE.BlockGroup:if(!this.currentCluster)break;if(this.readContiguousElements(e.slice(s,r)),this.currentBlock){for(let e=0;e<this.currentBlock.referencedTimestamps.length;e++)this.currentBlock.referencedTimestamps[e]+=this.currentBlock.timestamp;this.currentBlock=null}break;case uE.Block:{if(!this.currentCluster)break;const t=TE(e);if(null===t)break;const n=this.getTrackDataInCluster(this.currentCluster,t);if(!n)break;const i=lI(e),a=iI(e)>>1&3,o=sI(e,r-(e.filePos-s)),c=n.track.decodingInstructions.length>0;this.currentBlock={timestamp:i,duration:0,isKeyFrame:!0,referencedTimestamps:[],data:o,lacing:a,decoded:!c,mainAdditional:null},n.blocks.push(this.currentBlock)}break;case uE.BlockAdditions:this.readContiguousElements(e.slice(s,r));break;case uE.BlockMore:if(!this.currentBlock)break;this.currentBlockAdditional={addId:1,data:null},this.readContiguousElements(e.slice(s,r)),this.currentBlockAdditional.data&&1===this.currentBlockAdditional.addId&&(this.currentBlock.mainAdditional=this.currentBlockAdditional.data),this.currentBlockAdditional=null;break;case uE.BlockAdditional:if(!this.currentBlockAdditional)break;this.currentBlockAdditional.data=sI(e,r);break;case uE.BlockAddID:if(!this.currentBlockAdditional)break;this.currentBlockAdditional.addId=_E(e,r);break;case uE.BlockDuration:if(!this.currentBlock)break;this.currentBlock.duration=_E(e,r);break;case uE.ReferenceBlock:{if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1;const t=((e,t)=>{let n=_E(e,t);return n&1<<8*t-1&&(n-=2**(8*t)),n})(e,r);this.currentBlock.referencedTimestamps.push(t)}break;case uE.Tag:this.currentTagTargetIsMovie=!0,this.readContiguousElements(e.slice(s,r));break;case uE.Targets:this.readContiguousElements(e.slice(s,r));break;case uE.TargetTypeValue:50!==_E(e,r)&&(this.currentTagTargetIsMovie=!1);break;case uE.TagTrackUID:case uE.TagEditionUID:case uE.TagChapterUID:case uE.TagAttachmentUID:this.currentTagTargetIsMovie=!1;break;case uE.SimpleTag:if(!this.currentTagTargetIsMovie)break;this.currentSimpleTagName=null,this.readContiguousElements(e.slice(s,r));break;case uE.TagName:this.currentSimpleTagName=IE(e,r);break;case uE.TagString:{if(!this.currentSimpleTagName)break;const t=IE(e,r);this.processTagValue(this.currentSimpleTagName,t)}break;case uE.TagBinary:{if(!this.currentSimpleTagName)break;const t=sI(e,r);this.processTagValue(this.currentSimpleTagName,t)}break;case uE.AttachedFile:{if(!this.currentSegment)break;this.currentAttachedFile={fileUid:null,fileName:null,fileMediaType:null,fileData:null,fileDescription:null},this.readContiguousElements(e.slice(s,r));const t=this.currentSegment.metadataTags;if(this.currentAttachedFile.fileUid&&this.currentAttachedFile.fileData&&(t.raw??={},t.raw[this.currentAttachedFile.fileUid.toString()]=new G_(this.currentAttachedFile.fileData,this.currentAttachedFile.fileMediaType??void 0,this.currentAttachedFile.fileName??void 0,this.currentAttachedFile.fileDescription??void 0)),this.currentAttachedFile.fileMediaType?.startsWith("image/")&&this.currentAttachedFile.fileData){const e=this.currentAttachedFile.fileName;let n="unknown";if(e){const t=e.toLowerCase();t.startsWith("cover.")?n="coverFront":t.startsWith("back.")&&(n="coverBack")}t.images??=[],t.images.push({data:this.currentAttachedFile.fileData,mimeType:this.currentAttachedFile.fileMediaType,kind:n,name:this.currentAttachedFile.fileName??void 0,description:this.currentAttachedFile.fileDescription??void 0})}this.currentAttachedFile=null}break;case uE.FileUID:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileUid=((e,t)=>{if(t<1)throw new Error("Bad unsigned int size "+t);let n=0n;for(let r=0;r<t;r++)n<<=8n,n+=BigInt(iI(e));return n})(e,r);break;case uE.FileName:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileName=IE(e,r);break;case uE.FileMediaType:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileMediaType=CE(e,r);break;case uE.FileData:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileData=sI(e,r);break;case uE.FileDescription:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileDescription=IE(e,r);break;case uE.ContentEncodings:if(!this.currentTrack)break;this.readContiguousElements(e.slice(s,r)),this.currentTrack.decodingInstructions.sort((e,t)=>t.order-e.order);break;case uE.ContentEncoding:this.currentDecodingInstruction={order:0,scope:FE.Block,data:null},this.readContiguousElements(e.slice(s,r)),this.currentDecodingInstruction.data&&this.currentTrack.decodingInstructions.push(this.currentDecodingInstruction),this.currentDecodingInstruction=null;break;case uE.ContentEncodingOrder:if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.order=_E(e,r);break;case uE.ContentEncodingScope:if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.scope=_E(e,r);break;case uE.ContentCompression:if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decompress",algorithm:BE.Zlib,settings:null},this.readContiguousElements(e.slice(s,r));break;case uE.ContentCompAlgo:if("decompress"!==this.currentDecodingInstruction?.data?.type)break;this.currentDecodingInstruction.data.algorithm=_E(e,r);break;case uE.ContentCompSettings:if("decompress"!==this.currentDecodingInstruction?.data?.type)break;this.currentDecodingInstruction.data.settings=sI(e,r);break;case uE.ContentEncryption:if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decrypt"}}return e.filePos=s+r,!0}decodeBlockData(e,t){HT(e.decodingInstructions.length>0);let n=t;for(const r of e.decodingInstructions)if(HT(r.data),"decompress"===r.data.type)if(r.data.algorithm===BE.HeaderStripping)if(r.data.settings&&r.data.settings.length>0){const e=r.data.settings,t=new Uint8Array(e.length+n.length);t.set(e,0),t.set(n,e.length),n=t}return n}processTagValue(e,t){if(!this.currentSegment?.metadataTags)return;const n=this.currentSegment.metadataTags;if(n.raw??={},n.raw[e]??=t,"string"==typeof t)switch(e.toLowerCase()){case"title":n.title??=t;break;case"description":n.description??=t;break;case"artist":n.artist??=t;break;case"album":n.album??=t;break;case"album_artist":n.albumArtist??=t;break;case"genre":n.genre??=t;break;case"comment":n.comment??=t;break;case"lyrics":n.lyrics??=t;break;case"date":{const e=new Date(t);Number.isNaN(e.getTime())||(n.date??=e)}break;case"track_number":case"part_number":{const e=t.split("/"),r=Number.parseInt(e[0],10),s=e[1]&&Number.parseInt(e[1],10);Number.isInteger(r)&&r>0&&(n.trackNumber??=r),s&&Number.isInteger(s)&&s>0&&(n.tracksTotal??=s)}break;case"disc_number":case"disc":{const e=t.split("/"),r=Number.parseInt(e[0],10),s=e[1]&&Number.parseInt(e[1],10);Number.isInteger(r)&&r>0&&(n.discNumber??=r),s&&Number.isInteger(s)&&s>0&&(n.discsTotal??=s)}}}}class jE{constructor(e){this.internalTrack=e,this.packetToClusterLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.codecId}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}async getFirstTimestamp(){const e=await this.getFirstPacket({metadataOnly:!0});return e?.timestamp??0}getTimeResolution(){return this.internalTrack.segment.timestampFactor}async getFirstPacket(e){return this.performClusterLookup(()=>{const e=this.internalTrack.segment.clusters[0]??null;if(e?.isKnownToBeFirstCluster){let t=e;for(;t;){if(t.trackData.get(this.internalTrack.id))return{clusterIndex:f_(this.internalTrack.clusters,t.elementStartPos,e=>e.elementStartPos),blockIndex:0,correctBlockFound:!0};t=t.nextCluster}}return{clusterIndex:-1,blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,e)}intoTimescale(e){return I_(e*this.internalTrack.segment.timestampFactor,14)}async getPacket(e,t){const n=this.intoTimescale(e);return this.performClusterLookup(()=>this.findBlockInClustersForTimestamp(n),n,n,t)}async getNextPacket(e,t){const n=this.packetToClusterLocation.get(e);if(void 0===n)throw new Error("Packet was not created from this track.");const r=n.cluster.trackData.get(this.internalTrack.id),s=f_(this.internalTrack.clusters,n.cluster.elementStartPos,e=>e.elementStartPos);return HT(-1!==s),this.performClusterLookup(()=>{if(n.blockIndex+1<r.blocks.length)return{clusterIndex:s,blockIndex:n.blockIndex+1,correctBlockFound:!0};{let e=n.cluster;for(;e.nextCluster;){e=e.nextCluster;if(e.trackData.get(this.internalTrack.id)){const t=f_(this.internalTrack.clusters,e.elementStartPos,e=>e.elementStartPos);return HT(-1!==t),{clusterIndex:t,blockIndex:0,correctBlockFound:!0}}}return{clusterIndex:s,blockIndex:-1,correctBlockFound:!1}}},-1/0,1/0,t)}async getKeyPacket(e,t){const n=this.intoTimescale(e);return this.performClusterLookup(()=>this.findKeyBlockInClustersForTimestamp(n),n,n,t)}async getNextKeyPacket(e,t){const n=this.packetToClusterLocation.get(e);if(void 0===n)throw new Error("Packet was not created from this track.");const r=n.cluster.trackData.get(this.internalTrack.id),s=f_(this.internalTrack.clusters,n.cluster.elementStartPos,e=>e.elementStartPos);return HT(-1!==s),this.performClusterLookup(()=>{const e=r.blocks.findIndex((e,t)=>e.isKeyFrame&&t>n.blockIndex);if(-1!==e)return{clusterIndex:s,blockIndex:e,correctBlockFound:!0};{let e=n.cluster;for(;e.nextCluster;){e=e.nextCluster;const t=e.trackData.get(this.internalTrack.id);if(t&&null!==t.firstKeyFrameTimestamp){const n=f_(this.internalTrack.clusters,e.elementStartPos,e=>e.elementStartPos);HT(-1!==n);const r=t.blocks.findIndex(e=>e.isKeyFrame);return HT(-1!==r),{clusterIndex:n,blockIndex:r,correctBlockFound:!0}}}return{clusterIndex:s,blockIndex:-1,correctBlockFound:!1}}},-1/0,1/0,t)}async fetchPacketInCluster(e,t,n){if(-1===t)return null;const r=e.trackData.get(this.internalTrack.id).blocks[t];HT(r),r.decoded||(r.data=this.internalTrack.demuxer.decodeBlockData(this.internalTrack,r.data),r.decoded=!0);const s=n.metadataOnly?uS:r.data,i=r.timestamp/this.internalTrack.segment.timestampFactor,a=r.duration/this.internalTrack.segment.timestampFactor,o={};r.mainAdditional&&"video"===this.internalTrack.info?.type&&this.internalTrack.info.alphaMode&&(o.alpha=n.metadataOnly?uS:r.mainAdditional,o.alphaByteLength=r.mainAdditional.byteLength);const c=new dS(s,r.isKeyFrame?"key":"delta",i,a,e.dataStartPos+t,r.data.byteLength,o);return this.packetToClusterLocation.set(c,{cluster:e,blockIndex:t}),c}findBlockInClustersForTimestamp(e){const t=g_(this.internalTrack.clusters,e,e=>e.trackData.get(this.internalTrack.id).startTimestamp);let n=-1,r=!1;if(-1!==t){const s=this.internalTrack.clusters[t].trackData.get(this.internalTrack.id),i=g_(s.presentationTimestamps,e,e=>e.timestamp);HT(-1!==i),n=s.presentationTimestamps[i].blockIndex,r=e<s.endTimestamp}return{clusterIndex:t,blockIndex:n,correctBlockFound:r}}findKeyBlockInClustersForTimestamp(e){const t=g_(this.internalTrack.clustersWithKeyFrame,e,e=>e.trackData.get(this.internalTrack.id).firstKeyFrameTimestamp);let n=-1,r=-1,s=!1;if(-1!==t){const i=this.internalTrack.clustersWithKeyFrame[t];n=f_(this.internalTrack.clusters,i.elementStartPos,e=>e.elementStartPos),HT(-1!==n);const a=i.trackData.get(this.internalTrack.id),o=k_(a.presentationTimestamps,t=>a.blocks[t.blockIndex].isKeyFrame&&t.timestamp<=e);HT(-1!==o);r=a.presentationTimestamps[o].blockIndex,s=e<a.endTimestamp}return{clusterIndex:n,blockIndex:r,correctBlockFound:s}}async performClusterLookup(e,t,n,r){const{demuxer:s,segment:i}=this.internalTrack,a=await i.clusterLookupMutex.acquire();try{const{clusterIndex:a,blockIndex:o,correctBlockFound:c}=e();if(c){const e=this.internalTrack.clusters[a];return this.fetchPacketInCluster(e,o,r)}let l=null,u=a,d=o;const h=g_(this.internalTrack.cuePoints,t,e=>e.time),m=-1!==h?this.internalTrack.cuePoints[h]:null;let p,f=!1;if(-1===a)p=m?.clusterPosition??i.clusterSeekStartPos,f=p===i.clusterSeekStartPos;else{const e=this.internalTrack.clusters[a];!m||e.elementStartPos>=m.clusterPosition?(p=e.elementEndPos,l=e):p=m.clusterPosition}for(;null===i.elementEndPos||p<=i.elementEndPos-2;){if(l){const e=l.trackData.get(this.internalTrack.id);if(e&&e.startTimestamp>n)break;if(l.nextCluster){p=l.nextCluster.elementEndPos,l=l.nextCluster;continue}}let t=s.reader.requestSliceRange(p,2,wE);if(t instanceof Promise&&(t=await t),!t)break;const a=p,o=EE(t);if(!o||!mE.includes(o.id)&&o.id!==uE.Void){const e=await PE(s.reader,a,mE,Math.min(i.elementEndPos??1/0,a+$E));if(e){p=e;continue}break}const c=o.id;let h=o.size;const m=t.filePos;if(c===uE.Cluster){const t=f_(i.clusters,a,e=>e.elementStartPos);let n;n=-1===t?await s.readCluster(a,i):i.clusters[t],l&&(l.nextCluster=n),l=n,f&&(n.isKnownToBeFirstCluster=!0,f=!1);const{clusterIndex:o,blockIndex:c,correctBlockFound:h}=e();if(h){const e=this.internalTrack.clusters[o];return this.fetchPacketInCluster(e,c,r)}-1!==o&&(u=o,d=c)}if(null===h){if(c===uE.Cluster)HT(l),h=l.elementEndPos-m;else{h=(await AE(s.reader,m,pE,i.elementEndPos)).pos-m}const e=m+h;if(null!==i.elementEndPos&&e>i.elementEndPos-2)break;{let t=s.reader.requestSliceRange(e,2,wE);if(t instanceof Promise&&(t=await t),!t)break;if(vE(t)===uE.Segment){i.elementEndPos=e;break}}}p=m+h}const g=-1!==u?this.internalTrack.clusters[u]:null;if(m&&(!g||g.elementStartPos<m.clusterPosition)){const t=this.internalTrack.cuePoints[h-1],s=t?.time??-1/0;return this.performClusterLookup(e,s,n,r)}return g?this.fetchPacketInCluster(g,d,r):null}finally{a()}}}class WE extends jE{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.info.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return this.internalTrack.info.alphaMode}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{let e=null;return("vp9"===this.internalTrack.info.codec||"av1"===this.internalTrack.info.codec||"avc"===this.internalTrack.info.codec&&!this.internalTrack.info.codecDescription||"hevc"===this.internalTrack.info.codec&&!this.internalTrack.info.codecDescription)&&(e=await this.getFirstPacket({})),{codec:uv({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcCodecInfo:"avc"===this.internalTrack.info.codec&&e?Bv(e.data):null,hevcCodecInfo:"hevc"===this.internalTrack.info.codec&&e?$v(e.data):null,vp9CodecInfo:"vp9"===this.internalTrack.info.codec&&e?Kv(e.data):null,av1CodecInfo:"av1"===this.internalTrack.info.codec&&e?Qv(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class HE extends jE{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:hv({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const qE=e=>{const t=new Map;for(let i=0;i<e.length;i++){const n=e[i];t.set(n.timestamp,n)}const n=new Set,r=[],s=e=>{if(!n.has(e)){n.add(e);for(let n=0;n<e.referencedTimestamps.length;n++){const r=e.referencedTimestamps[n],i=t.get(r);i&&s(i)}r.push(e)}};for(let i=0;i<e.length;i++)s(e[i]);return r},XE=[44100,48e3,32e3],GE=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1,-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1,-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],KE=(e,t)=>{const n=e>>>24,r=e>>>16&255,s=e>>>8&255,i=255&e;if(255!==n&&255!==r&&255!==s&&255!==i)return{header:null,bytesAdvanced:4};if(255!==n)return{header:null,bytesAdvanced:1};if(224&~r)return{header:null,bytesAdvanced:1};let a=0,o=0;16&r?a=8&r?0:1:(a=1,o=1);const c=r>>3&3,l=r>>1&3,u=(s>>2&3)%3,d=i>>6&3,h=i>>4&3,m=i>>3&1,p=i>>2&1,f=3&i,g=GE[16*a*4+16*l+(s>>4&15)];if(-1===g)return{header:null,bytesAdvanced:1};const b=1e3*g,y=XE[u]>>a+o,w=((e,t,n,r,s)=>0===t?0:1===t?Math.floor(144*n/(r<<e))+s:2===t?Math.floor(144*n/r)+s:4*(Math.floor(12*n/r)+s))(a,l,b,y,s>>1&1);if(null!==t&&t<w)return{header:null,bytesAdvanced:1};let k;return k=3===c?3===l?384:1152:3===l?384:2===l?1152:576,{header:{totalSize:w,mpegVersionId:c,layer:l,bitrate:b,frequencyIndex:u,sampleRate:y,channel:d,modeExtension:h,copyright:m,original:p,emphasis:f,audioSamplesInFrame:k},bytesAdvanced:1}},YE=e=>{let t=2130706432,n=0;for(;0!==t;)n>>=1,n|=e&t,t>>=8;return n};var QE,JE,ZE,eC;(JE=QE||(QE={}))[JE.Unsynchronisation=128]="Unsynchronisation",JE[JE.ExtendedHeader=64]="ExtendedHeader",JE[JE.ExperimentalIndicator=32]="ExperimentalIndicator",JE[JE.Footer=16]="Footer",(eC=ZE||(ZE={}))[eC.ISO_8859_1=0]="ISO_8859_1",eC[eC.UTF_16_WITH_BOM=1]="UTF_16_WITH_BOM",eC[eC.UTF_16_BE_NO_BOM=2]="UTF_16_BE_NO_BOM",eC[eC.UTF_8=3]="UTF_8";const tC=128,nC=["Blues","Classic rock","Country","Dance","Disco","Funk","Grunge","Hip-hop","Jazz","Metal","New age","Oldies","Other","Pop","Rhythm and blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death metal","Pranks","Soundtrack","Euro-techno","Ambient","Trip-hop","Vocal","Jazz & funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound clip","Gospel","Noise","Alternative rock","Bass","Soul","Punk","Space","Meditative","Instrumental pop","Instrumental rock","Ethnic","Gothic","Darkwave","Techno-industrial","Electronic","Pop-folk","Eurodance","Dream","Southern rock","Comedy","Cult","Gangsta","Top 40","Christian rap","Pop/funk","Jungle music","Native US","Cabaret","New wave","Psychedelic","Rave","Showtunes","Trailer","Lo-fi","Tribal","Acid punk","Acid jazz","Polka","Retro","Musical","Rock 'n' roll","Hard rock","Folk","Folk rock","National folk","Swing","Fast fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic rock","Progressive rock","Psychedelic rock","Symphonic rock","Slow rock","Big band","Chorus","Easy listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber music","Sonata","Symphony","Booty bass","Primus","Porn groove","Satire","Slow jam","Club","Tango","Samba","Folklore","Ballad","Power ballad","Rhythmic Soul","Freestyle","Duet","Punk rock","Drum solo","A cappella","Euro-house","Dance hall","Goa music","Drum & bass","Club-house","Hardcore techno","Terror","Indie","Britpop","Negerpunk","Polsk punk","Beat","Christian gangsta rap","Heavy metal","Black metal","Crossover","Contemporary Christian","Christian rock","Merengue","Salsa","Thrash metal","Anime","Jpop","Synthpop","Christmas","Art rock","Baroque","Bhangra","Big beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math rock","New romantic","Nu-breakz","Post-punk","Post-rock","Psytrance","Shoegaze","Space rock","Trop rock","World music","Neoclassical","Audiobook","Audio theatre","Neue Deutsche Welle","Podcast","Indie rock","G-Funk","Dubstep","Garage rock","Psybient"],rC=(e,t)=>{const n=sI(e,t),r=U_(n.indexOf(0),n.length),s=n.subarray(0,r);let i="";for(let a=0;a<s.length;a++)i+=String.fromCharCode(s[a]);return i.trimEnd()},sC=e=>{const t=e.filePos,n=kI(e,3),r=iI(e),s=iI(e),i=iI(e),a=dI(e);if("ID3"!==n||255===r||255===s||2155905152&a)return e.filePos=t,null;return{majorVersion:r,revision:s,flags:i,size:YE(a)}},iC=(e,t,n)=>{if(![2,3,4].includes(t.majorVersion))return;const r=sI(e,t.size),s=new aC(t,r);if(t.flags&QE.Footer&&s.removeFooter(),t.flags&QE.Unsynchronisation&&3===t.majorVersion&&s.ununsynchronizeAll(),t.flags&QE.ExtendedHeader){const e=s.readU32();3===t.majorVersion?s.pos+=e:s.pos+=e-4}for(;s.pos<=s.bytes.length-s.frameHeaderSize();){const e=s.readId3V2Frame();if(!e)break;const r=s.pos,i=s.pos+e.size;let a=!1,o=!1,c=!1;if(3===t.majorVersion?(a=!!(64&e.flags),o=!!(128&e.flags)):4===t.majorVersion&&(a=!!(4&e.flags),o=!!(8&e.flags),c=!!(2&e.flags)||!!(t.flags&QE.Unsynchronisation)),a)s.pos=i;else if(o)s.pos=i;else{switch(c&&s.ununsynchronizeRegion(s.pos,i),n.raw??={},"T"===e.id[0]?n.raw[e.id]??=s.readId3V2EncodingAndText(i):n.raw[e.id]??=s.readBytes(e.size),s.pos=r,e.id){case"TIT2":case"TT2":n.title??=s.readId3V2EncodingAndText(i);break;case"TIT3":case"TT3":n.description??=s.readId3V2EncodingAndText(i);break;case"TPE1":case"TP1":n.artist??=s.readId3V2EncodingAndText(i);break;case"TALB":case"TAL":n.album??=s.readId3V2EncodingAndText(i);break;case"TPE2":case"TP2":n.albumArtist??=s.readId3V2EncodingAndText(i);break;case"TRCK":case"TRK":{const e=s.readId3V2EncodingAndText(i).split("/"),t=Number.parseInt(e[0],10),r=e[1]&&Number.parseInt(e[1],10);Number.isInteger(t)&&t>0&&(n.trackNumber??=t),r&&Number.isInteger(r)&&r>0&&(n.tracksTotal??=r)}break;case"TPOS":case"TPA":{const e=s.readId3V2EncodingAndText(i).split("/"),t=Number.parseInt(e[0],10),r=e[1]&&Number.parseInt(e[1],10);Number.isInteger(t)&&t>0&&(n.discNumber??=t),r&&Number.isInteger(r)&&r>0&&(n.discsTotal??=r)}break;case"TCON":case"TCO":{const e=s.readId3V2EncodingAndText(i);let t=/^\((\d+)\)/.exec(e);if(t){const e=Number.parseInt(t[1]);if(void 0!==nC[e]){n.genre??=nC[e];break}}if(t=/^\d+$/.exec(e),t){const e=Number.parseInt(t[0]);if(void 0!==nC[e]){n.genre??=nC[e];break}}n.genre??=e}break;case"TDRC":case"TDAT":{const e=s.readId3V2EncodingAndText(i),t=new Date(e);Number.isNaN(t.getTime())||(n.date??=t)}break;case"TYER":case"TYE":{const e=s.readId3V2EncodingAndText(i),t=Number.parseInt(e,10);Number.isInteger(t)&&(n.date??=new Date(t,0,1))}break;case"USLT":case"ULT":{const e=s.readU8();s.pos+=3,s.readId3V2Text(e,i),n.lyrics??=s.readId3V2Text(e,i)}break;case"COMM":case"COM":{const e=s.readU8();s.pos+=3,s.readId3V2Text(e,i),n.comment??=s.readId3V2Text(e,i)}break;case"APIC":case"PIC":{const e=s.readId3V2TextEncoding();let r;if(2===t.majorVersion){const e=s.readAscii(3);r="PNG"===e?"image/png":"JPG"===e?"image/jpeg":"image/*"}else r=s.readId3V2Text(e,i);const a=s.readU8(),o=s.readId3V2Text(e,i).trimEnd(),c=i-s.pos;if(c>=0){const e=s.readBytes(c);n.images||(n.images=[]),n.images.push({data:e,mimeType:r,kind:3===a?"coverFront":4===a?"coverBack":"unknown",description:o})}}break;default:s.pos+=e.size}s.pos=i}}};class aC{constructor(e,t){this.header=e,this.bytes=t,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength)}frameHeaderSize(){return 2===this.header.majorVersion?6:10}ununsynchronizeAll(){const e=[];for(let t=0;t<this.bytes.length;t++){const n=this.bytes[t];if(e.push(n),255===n&&t!==this.bytes.length-1){0===this.bytes[t]&&t++}}this.bytes=new Uint8Array(e),this.view=new DataView(this.bytes.buffer)}ununsynchronizeRegion(e,t){const n=[];for(let i=e;i<t;i++){const e=this.bytes[i];if(n.push(e),255===e&&i!==t-1){0===this.bytes[i+1]&&i++}}const r=this.bytes.subarray(0,e),s=this.bytes.subarray(t);this.bytes=new Uint8Array(r.length+n.length+s.length),this.bytes.set(r,0),this.bytes.set(n,r.length),this.bytes.set(s,r.length+n.length),this.view=new DataView(this.bytes.buffer)}removeFooter(){this.bytes=this.bytes.subarray(0,this.bytes.length-10),this.view=new DataView(this.bytes.buffer)}readBytes(e){const t=this.bytes.subarray(this.pos,this.pos+e);return this.pos+=e,t}readU8(){const e=this.view.getUint8(this.pos);return this.pos+=1,e}readU16(){const e=this.view.getUint16(this.pos,!1);return this.pos+=2,e}readU24(){const e=this.view.getUint16(this.pos,!1),t=this.view.getUint8(this.pos+1);return this.pos+=3,256*e+t}readU32(){const e=this.view.getUint32(this.pos,!1);return this.pos+=4,e}readAscii(e){let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(this.view.getUint8(this.pos+n));return this.pos+=e,t}readId3V2Frame(){if(2===this.header.majorVersion){const e=this.readAscii(3);if("\0\0\0"===e)return null;return{id:e,size:this.readU24(),flags:0}}{const e=this.readAscii(4);if("\0\0\0\0"===e)return null;const t=this.readU32();let n=4===this.header.majorVersion?YE(t):t;const r=this.readU16(),s=this.pos,i=e=>{const t=this.pos+e;if(t>this.bytes.length)return!1;if(t<=this.bytes.length-this.frameHeaderSize()){this.pos+=e;const t=this.readAscii(4);if("\0\0\0\0"!==t&&!/[0-9A-Z]{4}/.test(t))return!1}return!0};if(!i(n)){const e=4===this.header.majorVersion?t:YE(t);i(e)&&(n=e)}return this.pos=s,{id:e,size:n,flags:r}}}readId3V2TextEncoding(){const e=this.readU8();if(e>3)throw new Error(`Unsupported text encoding: ${e}`);return e}readId3V2Text(e,t){const n=this.pos,r=this.readBytes(t-this.pos);switch(e){case ZE.ISO_8859_1:{let e="";for(let t=0;t<r.length;t++){const s=r[t];if(0===s){this.pos=n+t+1;break}e+=String.fromCharCode(s)}return e}case ZE.UTF_16_WITH_BOM:if(255===r[0]&&254===r[1]){const e=new TextDecoder("utf-16le"),t=U_(r.findIndex((e,t)=>0===e&&0===r[t+1]&&t%2==0),r.length);return this.pos=n+Math.min(t+2,r.length),e.decode(r.subarray(2,t))}if(254===r[0]&&255===r[1]){const e=new TextDecoder("utf-16be"),t=U_(r.findIndex((e,t)=>0===e&&0===r[t+1]&&t%2==0),r.length);return this.pos=n+Math.min(t+2,r.length),e.decode(r.subarray(2,t))}{const e=U_(r.findIndex(e=>0===e),r.length);return this.pos=n+Math.min(e+1,r.length),e_.decode(r.subarray(0,e))}case ZE.UTF_16_BE_NO_BOM:{const e=new TextDecoder("utf-16be"),t=U_(r.findIndex((e,t)=>0===e&&0===r[t+1]&&t%2==0),r.length);return this.pos=n+Math.min(t+2,r.length),e.decode(r.subarray(0,t))}case ZE.UTF_8:{const e=U_(r.findIndex(e=>0===e),r.length);return this.pos=n+Math.min(e+1,r.length),e_.decode(r.subarray(0,e))}}}readId3V2EncodingAndText(e){if(this.pos>=e)return"";const t=this.readId3V2TextEncoding();return this.readId3V2Text(t,e)}}class oC{constructor(e){this.helper=new Uint8Array(8),this.helperView=ZT(this.helper),this.writer=e}writeId3V2Tag(e){const t=this.writer.getPos();this.writeAscii("ID3"),this.writeU8(4),this.writeU8(0),this.writeU8(0),this.writeSynchsafeU32(0);const n=this.writer.getPos(),r=new Set;for(const{key:a,value:o}of V_(e))switch(a){case"title":this.writeId3V2TextFrame("TIT2",o),r.add("TIT2");break;case"description":this.writeId3V2TextFrame("TIT3",o),r.add("TIT3");break;case"artist":this.writeId3V2TextFrame("TPE1",o),r.add("TPE1");break;case"album":this.writeId3V2TextFrame("TALB",o),r.add("TALB");break;case"albumArtist":this.writeId3V2TextFrame("TPE2",o),r.add("TPE2");break;case"trackNumber":{const t=void 0!==e.tracksTotal?`${o}/${e.tracksTotal}`:o.toString();this.writeId3V2TextFrame("TRCK",t),r.add("TRCK")}break;case"discNumber":{const t=void 0!==e.discsTotal?`${o}/${e.discsTotal}`:o.toString();this.writeId3V2TextFrame("TPOS",t),r.add("TPOS")}break;case"genre":this.writeId3V2TextFrame("TCON",o),r.add("TCON");break;case"date":this.writeId3V2TextFrame("TDRC",o.toISOString().slice(0,10)),r.add("TDRC");break;case"lyrics":this.writeId3V2LyricsFrame(o),r.add("USLT");break;case"comment":this.writeId3V2CommentFrame(o),r.add("COMM");break;case"images":{const e={coverFront:3,coverBack:4,unknown:0};for(const t of o){const n=e[t.kind]??0,r=t.description??"";this.writeId3V2ApicFrame(t.mimeType,n,r,t.data)}}break;case"tracksTotal":case"discsTotal":case"raw":break;default:T_(a)}if(e.raw)for(const a in e.raw){const t=e.raw[a];if(null==t||4!==a.length||r.has(a))continue;let n;if("string"==typeof t){const e=t_.encode(t);n=new Uint8Array(e.byteLength+2),n[0]=ZE.UTF_8,n.set(e,1)}else{if(!(t instanceof Uint8Array))continue;n=t}this.writeAscii(a),this.writeSynchsafeU32(n.byteLength),this.writeU16(0),this.writer.write(n)}const s=this.writer.getPos(),i=s-n;return this.writer.seek(t+6),this.writeSynchsafeU32(i),this.writer.seek(s),i+10}writeU8(e){this.helper[0]=e,this.writer.write(this.helper.subarray(0,1))}writeU16(e){this.helperView.setUint16(0,e,!1),this.writer.write(this.helper.subarray(0,2))}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeAscii(e){for(let t=0;t<e.length;t++)this.helper[t]=e.charCodeAt(t);this.writer.write(this.helper.subarray(0,e.length))}writeSynchsafeU32(e){this.writeU32((e=>{let t=127,n=0,r=e;for(;2147483647^t;)n=r&~t,n<<=1,n|=r&t,t=(t+1<<8)-1,r=n;return n})(e))}writeIsoString(e){const t=new Uint8Array(e.length+1);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);t[e.length]=0,this.writer.write(t)}writeUtf8String(e){const t=t_.encode(e);this.writer.write(t),this.writeU8(0)}writeId3V2TextFrame(e,t){const n=n_(t),r=1+(n?t.length:t_.encode(t).byteLength)+1;this.writeAscii(e),this.writeSynchsafeU32(r),this.writeU16(0),this.writeU8(n?ZE.ISO_8859_1:ZE.UTF_8),n?this.writeIsoString(t):this.writeUtf8String(t)}writeId3V2LyricsFrame(e){const t=n_(e),n=5+e.length+1;this.writeAscii("USLT"),this.writeSynchsafeU32(n),this.writeU16(0),this.writeU8(t?ZE.ISO_8859_1:ZE.UTF_8),this.writeAscii("und"),t?(this.writeIsoString(""),this.writeIsoString(e)):(this.writeUtf8String(""),this.writeUtf8String(e))}writeId3V2CommentFrame(e){const t=n_(e),n=5+(t?e.length:t_.encode(e).byteLength)+1;this.writeAscii("COMM"),this.writeSynchsafeU32(n),this.writeU16(0),this.writeU8(t?ZE.ISO_8859_1:ZE.UTF_8),this.writeU8(117),this.writeU8(110),this.writeU8(100),t?(this.writeIsoString(""),this.writeIsoString(e)):(this.writeUtf8String(""),this.writeUtf8String(e))}writeId3V2ApicFrame(e,t,n,r){const s=n_(e)&&n_(n),i=s?n.length:t_.encode(n).byteLength,a=1+e.length+1+1+i+1+r.byteLength;this.writeAscii("APIC"),this.writeSynchsafeU32(a),this.writeU16(0),this.writeU8(s?ZE.ISO_8859_1:ZE.UTF_8),s?this.writeIsoString(e):this.writeUtf8String(e),this.writeU8(t),s?this.writeIsoString(n):this.writeUtf8String(n),this.writer.write(r)}}const cC=async(e,t,n)=>{let r=t;for(;null===n||r<n;){let t=e.requestSlice(r,4);if(t instanceof Promise&&(t=await t),!t)break;const n=dI(t),s=KE(n,null!==e.fileSize?e.fileSize-r:null);if(s.header)return{header:s.header,startPos:r};r+=s.bytesAdvanced}return null};class lC extends iS{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.metadataTags=null,this.tracks=[],this.readingMutex=new h_,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();if(!this.firstFrameHeader)throw new Error("No valid MP3 frame found.");this.tracks=[new US(this.input,new uC(this))]})()}async advanceReader(){if(0===this.lastLoadedPos)for(;;){let e=this.reader.requestSlice(this.lastLoadedPos,10);if(e instanceof Promise&&(e=await e),!e)return void(this.lastSampleLoaded=!0);const t=sC(e);if(!t)break;this.lastLoadedPos=e.filePos+t.size}const e=await cC(this.reader,this.lastLoadedPos,this.reader.fileSize);if(!e)return void(this.lastSampleLoaded=!0);const t=e.header;this.lastLoadedPos=e.startPos+t.totalSize-1;const n=(r=t.mpegVersionId,s=t.channel,3===r?3===s?21:36:3===s?13:21);var r,s;let i=this.reader.requestSlice(e.startPos+n,4);if(i instanceof Promise&&(i=await i),i){const e=dI(i);if(1483304551===e||1231971951===e)return}this.firstFrameHeader||(this.firstFrameHeader=t),t.sampleRate,this.firstFrameHeader.sampleRate;const a=t.audioSamplesInFrame/this.firstFrameHeader.sampleRate,o={timestamp:this.nextTimestampInSamples/this.firstFrameHeader.sampleRate,duration:a,dataStart:e.startPos,dataSize:t.totalSize};this.loadedSamples.push(o),this.nextTimestampInSamples+=t.audioSamplesInFrame}async getMimeType(){return"audio/mpeg"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return HT(e),e.computeDuration()}async getMetadataTags(){const e=await this.readingMutex.acquire();try{if(await this.readMetadata(),this.metadataTags)return this.metadataTags;this.metadataTags={};let e=0,t=!1;for(;;){let n=this.reader.requestSlice(e,10);if(n instanceof Promise&&(n=await n),!n)break;const r=sC(n);if(!r)break;t=!0;let s=this.reader.requestSlice(n.filePos,r.size);if(s instanceof Promise&&(s=await s),!s)break;iC(s,r,this.metadataTags),e=n.filePos+r.size}if(!t&&null!==this.reader.fileSize&&this.reader.fileSize>=tC){let e=this.reader.requestSlice(this.reader.fileSize-tC,tC);e instanceof Promise&&(e=await e),HT(e);"TAG"===kI(e,3)&&((e,t)=>{const n=e.filePos;t.raw??={},t.raw.TAG??=sI(e,125),e.filePos=n;const r=rC(e,30);r&&(t.title??=r);const s=rC(e,30);s&&(t.artist??=s);const i=rC(e,30);i&&(t.album??=i);const a=rC(e,4),o=Number.parseInt(a,10);Number.isInteger(o)&&o>0&&(t.date??=new Date(o,0,1));const c=sI(e,30);let l;if(0===c[28]&&0!==c[29]){const n=c[29];n>0&&(t.trackNumber??=n),e.skip(-30),l=rC(e,28),e.skip(2)}else e.skip(-30),l=rC(e,30);l&&(t.comment??=l);const u=iI(e);u<nC.length&&(t.genre??=nC[u])})(e,this.metadataTags)}return this.metadataTags}finally{e()}}}class uC{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return HT(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return C_}getCodec(){return"mp3"}getInternalCodecId(){return null}getNumberOfChannels(){return HT(this.demuxer.firstFrameHeader),3===this.demuxer.firstFrameHeader.channel?1:2}getSampleRate(){return HT(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}async getDecoderConfig(){return HT(this.demuxer.firstFrameHeader),{codec:"mp3",numberOfChannels:3===this.demuxer.firstFrameHeader.channel?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}}async getPacketAtIndex(e,t){if(-1===e)return null;const n=this.demuxer.loadedSamples[e];if(!n)return null;let r;if(t.metadataOnly)r=uS;else{let e=this.demuxer.reader.requestSlice(n.dataStart,n.dataSize);if(e instanceof Promise&&(e=await e),!e)return null;r=sI(e,n.dataSize)}return new dS(r,"key",n.timestamp,n.duration,e,n.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,t){const n=await this.demuxer.readingMutex.acquire();try{const n=f_(this.demuxer.loadedSamples,e.timestamp,e=>e.timestamp);if(-1===n)throw new Error("Packet was not created from this track.");const r=n+1;for(;r>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(r,t)}finally{n()}}async getPacket(e,t){const n=await this.demuxer.readingMutex.acquire();try{for(;;){const n=g_(this.demuxer.loadedSamples,e,e=>e.timestamp);if(-1===n&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(n,t);if(n>=0&&n+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(n,t);await this.demuxer.advanceReader()}}finally{n()}}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}}const dC=1399285583,hC=new Uint32Array(256);for(let ZB=0;ZB<256;ZB++){let e=ZB<<24;for(let t=0;t<8;t++)e=2147483648&e?e<<1^79764919:e<<1;hC[ZB]=e>>>0&4294967295}const mC=e=>{const t=ZT(e),n=t.getUint32(22,!0);t.setUint32(22,0,!0);let r=0;for(let s=0;s<e.length;s++){const t=e[s];r=(r<<8^hC[r>>>24^t])>>>0}return t.setUint32(22,n,!0),r},pC=(e,t,n)=>{let r=0,s=null;if(e.length>0)if("vorbis"===t.codec){HT(t.vorbisInfo);const i=(e=>{let t=0;for(;e;)t++,e>>=1;return t})(t.vorbisInfo.modeBlockflags.length-1),a=(1<<i)-1<<1,o=(e[0]&a)>>1;if(o>=t.vorbisInfo.modeBlockflags.length)throw new Error("Invalid mode number.");let c=n;const l=t.vorbisInfo.modeBlockflags[o];if(s=t.vorbisInfo.blocksizes[l],1===l){const n=1+(1|a),r=e[0]&n?1:0;c=t.vorbisInfo.blocksizes[r]}r=null!==c?c+s>>2:0}else if("opus"===t.codec){r=(e=>{const t=e[0]>>3;return{durationInSamples:Zv[t]}})(e).durationInSamples}return{durationInSamples:r,vorbisBlockSize:s}},fC=27,gC=282,bC=e=>{const t=e.filePos;if(hI(e)!==dC)return null;e.skip(1);const n=iI(e),r=bI(e),s=hI(e),i=hI(e),a=hI(e),o=iI(e),c=new Uint8Array(o);for(let d=0;d<o;d++)c[d]=iI(e);const l=27+o,u=c.reduce((e,t)=>e+t,0);return{headerStartPos:t,totalSize:l+u,dataStartPos:t+l,dataSize:u,headerType:n,granulePosition:r,serialNumber:s,sequenceNumber:i,checksum:a,lacingValues:c}},yC=(e,t)=>{for(;e.filePos<t-3;){const t=hI(e),n=79;if((255&t)===n||(t>>>8&255)===n||(t>>>16&255)===n||(t>>>24&255)===n){if(e.skip(-4),t===dC)return!0;e.skip(1)}}return!1};class wC extends iS{constructor(e){super(e),this.metadataPromise=null,this.bitstreams=[],this.tracks=[],this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let t=this.reader.requestSliceRange(e,fC,gC);if(t instanceof Promise&&(t=await t),!t)break;const n=bC(t);if(!n)break;if(!!!(2&n.headerType))break;this.bitstreams.push({serialNumber:n.serialNumber,bosPage:n,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),e=n.headerStartPos+n.totalSize}for(const t of this.bitstreams){const e=await this.readPacket(t.bosPage,0);e&&(e.data.byteLength>=7&&1===e.data[0]&&118===e.data[1]&&111===e.data[2]&&114===e.data[3]&&98===e.data[4]&&105===e.data[5]&&115===e.data[6]?await this.readVorbisMetadata(e,t):e.data.byteLength>=8&&79===e.data[0]&&112===e.data[1]&&117===e.data[2]&&115===e.data[3]&&72===e.data[4]&&101===e.data[5]&&97===e.data[6]&&100===e.data[7]&&await this.readOpusMetadata(e,t),null!==t.codecInfo.codec&&this.tracks.push(new US(this.input,new kC(t,this))))}})()}async readVorbisMetadata(e,t){let n=await this.findNextPacketStart(e);if(!n)return;const r=await this.readPacket(n.startPage,n.startSegmentIndex);if(!r)return;if(n=await this.findNextPacketStart(r),!n)return;const s=await this.readPacket(n.startPage,n.startSegmentIndex);if(!s)return;if(3!==r.data[0]||5!==s.data[0])return;const i=[],a=e=>{for(;i.push(Math.min(255,e)),!(e<255);)e-=255};a(e.data.length),a(r.data.length);const o=new Uint8Array(1+i.length+e.data.length+r.data.length+s.data.length);o[0]=2,o.set(i,1),o.set(e.data,1+i.length),o.set(r.data,1+i.length+e.data.length),o.set(s.data,1+i.length+e.data.length+r.data.length),t.codecInfo.codec="vorbis",t.description=o,t.lastMetadataPacket=s;const c=ZT(e.data);t.numberOfChannels=c.getUint8(11),t.sampleRate=c.getUint32(12,!0);const l=c.getUint8(28);t.codecInfo.vorbisInfo={blocksizes:[1<<(15&l),1<<(l>>4)],modeBlockflags:eS(s.data).modeBlockflags},sS(r.data.subarray(7),this.metadataTags)}async readOpusMetadata(e,t){const n=await this.findNextPacketStart(e);if(!n)return;const r=await this.readPacket(n.startPage,n.startSegmentIndex);if(!r)return;t.codecInfo.codec="opus",t.description=e.data,t.lastMetadataPacket=r;const s=Jv(e.data);t.numberOfChannels=s.outputChannelCount,t.sampleRate=gv,t.codecInfo.opusInfo={preSkip:s.preSkip},sS(r.data.subarray(8),this.metadataTags)}async readPacket(e,t){HT(t<e.lacingValues.length);let n=0;for(let u=0;u<t;u++)n+=e.lacingValues[u];let r=e,s=n,i=t;const a=[];e:for(;;){let t=this.reader.requestSlice(r.dataStartPos,r.dataSize);t instanceof Promise&&(t=await t),HT(t);const o=sI(t,r.dataSize);for(;;){if(i===r.lacingValues.length){a.push(o.subarray(n,s));break}const e=r.lacingValues[i];if(s+=e,e<255){a.push(o.subarray(n,s));break e}i++}let c=r.headerStartPos+r.totalSize;for(;;){let t=this.reader.requestSliceRange(c,fC,gC);if(t instanceof Promise&&(t=await t),!t)return null;const n=bC(t);if(!n)return null;if(r=n,r.serialNumber===e.serialNumber)break;c=r.headerStartPos+r.totalSize}n=0,s=0,i=0}const o=a.reduce((e,t)=>e+t.length,0),c=new Uint8Array(o);let l=0;for(let u=0;u<a.length;u++){const e=a[u];c.set(e,l),l+=e.length}return{data:c,endPage:r,endSegmentIndex:i}}async findNextPacketStart(e){if(e.endSegmentIndex<e.endPage.lacingValues.length-1)return{startPage:e.endPage,startSegmentIndex:e.endSegmentIndex+1};if(!!(4&e.endPage.headerType))return null;let t=e.endPage.headerStartPos+e.endPage.totalSize;for(;;){let n=this.reader.requestSliceRange(t,fC,gC);if(n instanceof Promise&&(n=await n),!n)return null;const r=bC(n);if(!r)return null;if(r.serialNumber===e.endPage.serialNumber)return{startPage:r,startSegmentIndex:0};t=r.headerStartPos+r.totalSize}}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(e=>e.getCodecParameterString()));return(e=>{let t="audio/ogg";e.codecStrings&&(t+=`; codecs="${[...new Set(e.codecStrings)].join(", ")}"`);return t})({codecStrings:e.filter(Boolean)})}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){const e=await this.getTracks(),t=await Promise.all(e.map(e=>e.computeDuration()));return Math.max(0,...t)}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}class kC{constructor(e,t){this.bitstream=e,this.demuxer=t,this.encodedPacketToMetadata=new WeakMap,this.sequentialScanCache=[],this.sequentialScanMutex=new h_,this.internalSampleRate="opus"===e.codecInfo.codec?gv:e.sampleRate}getId(){return this.bitstream.serialNumber}getNumberOfChannels(){return this.bitstream.numberOfChannels}getSampleRate(){return this.bitstream.sampleRate}getTimeResolution(){return this.bitstream.sampleRate}getCodec(){return this.bitstream.codecInfo.codec}getInternalCodecId(){return null}async getDecoderConfig(){return HT(this.bitstream.codecInfo.codec),{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:this.bitstream.description??void 0}}getName(){return null}getLanguageCode(){return C_}async getFirstTimestamp(){return 0}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}granulePositionToTimestampInSamples(e){return"opus"===this.bitstream.codecInfo.codec?(HT(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}createEncodedPacketFromOggPacket(e,t,n){if(!e)return null;const{durationInSamples:r,vorbisBlockSize:s}=pC(e.data,this.bitstream.codecInfo,t.vorbisLastBlocksize),i=new dS(n.metadataOnly?uS:e.data,"key",Math.max(0,t.timestampInSamples)/this.internalSampleRate,r/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(i,{packet:e,timestampInSamples:t.timestampInSamples,durationInSamples:r,vorbisLastBlockSize:t.vorbisLastBlocksize,vorbisBlockSize:s}),i}async getFirstPacket(e){HT(this.bitstream.lastMetadataPacket);const t=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!t)return null;let n=0;"opus"===this.bitstream.codecInfo.codec&&(HT(this.bitstream.codecInfo.opusInfo),n-=this.bitstream.codecInfo.opusInfo.preSkip);const r=await this.demuxer.readPacket(t.startPage,t.startSegmentIndex);return this.createEncodedPacketFromOggPacket(r,{timestampInSamples:n,vorbisLastBlocksize:null},e)}async getNextPacket(e,t){const n=this.encodedPacketToMetadata.get(e);if(!n)throw new Error("Packet was not created from this track.");const r=await this.demuxer.findNextPacketStart(n.packet);if(!r)return null;const s=n.timestampInSamples+n.durationInSamples,i=await this.demuxer.readPacket(r.startPage,r.startSegmentIndex);return this.createEncodedPacketFromOggPacket(i,{timestampInSamples:s,vorbisLastBlocksize:n.vorbisBlockSize},t)}async getPacket(e,t){if(null===this.demuxer.reader.fileSize)return this.getPacketSequential(e,t);const n=I_(e*this.internalSampleRate,14);if(0===n)return this.getFirstPacket(t);if(n<0)return null;HT(this.bitstream.lastMetadataPacket);const r=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!r)return null;let s=r.startPage,i=this.demuxer.reader.fileSize;const a=[s];e:for(;s.headerStartPos+s.totalSize<i;){const e=s.headerStartPos,t=Math.floor((e+i)/2);let r=t;for(;;){const e=Math.min(r+65307,i-fC);let o=this.demuxer.reader.requestSlice(r,e-r);o instanceof Promise&&(o=await o),HT(o);if(!yC(o,e)){i=t+fC;continue e}let c=this.demuxer.reader.requestSliceRange(o.filePos,fC,gC);c instanceof Promise&&(c=await c),HT(c);const l=bC(c);HT(l);let u=!1;if(l.serialNumber===this.bitstream.serialNumber)u=!0;else{let e=this.demuxer.reader.requestSlice(l.headerStartPos,l.totalSize);e instanceof Promise&&(e=await e),HT(e);const t=sI(e,l.totalSize);u=mC(t)===l.checksum}if(!u){r=l.headerStartPos+4;continue}if(u&&l.serialNumber!==this.bitstream.serialNumber){r=l.headerStartPos+l.totalSize;continue}if(!(-1===l.granulePosition)){this.granulePositionToTimestampInSamples(l.granulePosition)>n?i=l.headerStartPos:(s=l,a.push(l));continue e}r=l.headerStartPos+l.totalSize}}let o=r.startPage;for(const b of a){if(b.granulePosition===s.granulePosition)break;(!o||b.headerStartPos>o.headerStartPos)&&(o=b)}let c=o;const l=[c];for(;c.serialNumber!==this.bitstream.serialNumber||c.granulePosition!==s.granulePosition;){const e=c.headerStartPos+c.totalSize;let t=this.demuxer.reader.requestSliceRange(e,fC,gC);t instanceof Promise&&(t=await t),HT(t);const n=bC(t);HT(n),c=n,c.serialNumber===this.bitstream.serialNumber&&l.push(c)}HT(-1!==c.granulePosition);let u,d,h=null,m=c,p=0;if(c.headerStartPos===r.startPage.headerStartPos)u=this.granulePositionToTimestampInSamples(0),d=!0,h=0;else{u=0,d=!1;for(let t=c.lacingValues.length-1;t>=0;t--){if(c.lacingValues[t]<255){h=t+1;break}}if(null===h)throw new Error("Invalid page with granule position: no packets end on this page.");p=h-1;const e={data:uS,endPage:m,endSegmentIndex:p};if(await this.demuxer.findNextPacketStart(e)){const e=_C(l,c,h);HT(e);const t=TC(l,e.page,e.segmentIndex);t&&(c=t.page,h=t.segmentIndex)}else for(;;){const e=_C(l,c,h);if(!e)break;const t=TC(l,e.page,e.segmentIndex);if(!t)break;if(c=t.page,h=t.segmentIndex,e.page.headerStartPos!==m.headerStartPos){m=e.page,p=e.segmentIndex;break}}}let f=null,g=null;for(;null!==c;){HT(null!==h);const e=await this.demuxer.readPacket(c,h);if(!e)break;if(!(c.headerStartPos===r.startPage.headerStartPos&&h<r.startSegmentIndex)){let r=this.createEncodedPacketFromOggPacket(e,{timestampInSamples:u,vorbisLastBlocksize:g?.vorbisBlockSize??null},t);HT(r);let s=this.encodedPacketToMetadata.get(r);if(HT(s),d||e.endPage.headerStartPos!==m.headerStartPos||e.endSegmentIndex!==p?u+=s.durationInSamples:(u=this.granulePositionToTimestampInSamples(c.granulePosition),d=!0,r=this.createEncodedPacketFromOggPacket(e,{timestampInSamples:u-s.durationInSamples,vorbisLastBlocksize:g?.vorbisBlockSize??null},t),HT(r),s=this.encodedPacketToMetadata.get(r),HT(s)),f=r,g=s,d&&(Math.max(u,0)>n||Math.max(s.timestampInSamples,0)===n))break}const s=await this.demuxer.findNextPacketStart(e);if(!s)break;c=s.startPage,h=s.startSegmentIndex}return f}async getPacketSequential(e,t){const n=await this.sequentialScanMutex.acquire();try{const n=I_(e*this.internalSampleRate,14);e=n/this.internalSampleRate;const r=g_(this.sequentialScanCache,n,e=>e.timestampInSamples);let s;if(-1!==r){const e=this.sequentialScanCache[r];s=this.createEncodedPacketFromOggPacket(e.packet,{timestampInSamples:e.timestampInSamples,vorbisLastBlocksize:e.vorbisLastBlockSize},t)}else s=await this.getFirstPacket(t);let i=0;for(;s&&s.timestamp<e;){const n=await this.getNextPacket(s,t);if(!n||n.timestamp>e)break;if(s=n,i++,100===i){i=0;const e=this.encodedPacketToMetadata.get(s);HT(e),this.sequentialScanCache.length>0&&HT(XT(this.sequentialScanCache).timestampInSamples<=e.timestampInSamples),this.sequentialScanCache.push(e)}}return s}finally{n()}}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}}const TC=(e,t,n)=>{let r=t,s=n;e:for(;;){for(s--;s>=0;s--){if(r.lacingValues[s]<255){s++;break e}}HT(-1===s);if(!(1&r.headerType)){s=0;break}const t=w_(e,e=>e.headerStartPos<r.headerStartPos);if(!t)return null;r=t,s=r.lacingValues.length}if(HT(-1!==s),s===r.lacingValues.length){const t=e[e.indexOf(r)+1];HT(t),r=t,s=0}return{page:r,segmentIndex:s}},_C=(e,t,n)=>{if(n>0)return{page:t,segmentIndex:n-1};const r=w_(e,e=>e.headerStartPos<t.headerStartPos);return r?{page:r,segmentIndex:r.lacingValues.length-1}:null};var vC,SC;(SC=vC||(vC={}))[SC.PCM=1]="PCM",SC[SC.IEEE_FLOAT=3]="IEEE_FLOAT",SC[SC.ALAW=6]="ALAW",SC[SC.MULAW=7]="MULAW",SC[SC.EXTENSIBLE=65534]="EXTENSIBLE";class EC extends iS{constructor(e){super(e),this.metadataPromise=null,this.dataStart=-1,this.dataSize=-1,this.audioInfo=null,this.tracks=[],this.lastKnownPacketIndex=0,this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=this.reader.requestSlice(0,12);e instanceof Promise&&(e=await e),HT(e);const t=kI(e,4),n="RIFX"!==t,r="RF64"===t,s=uI(e,n);let i=r?this.reader.fileSize:Math.min(s+8,this.reader.fileSize??1/0);if("WAVE"!==kI(e,4))throw new Error("Invalid WAVE file - wrong format");let a=0,o=null,c=e.filePos;for(;null===i||c<i;){let e=this.reader.requestSlice(c,8);if(e instanceof Promise&&(e=await e),!e)break;const t=kI(e,4),s=uI(e,n),l=e.filePos;if(r&&0===a&&"ds64"!==t)throw new Error('Invalid RF64 file: First chunk must be "ds64".');if("fmt "===t)await this.parseFmtChunk(l,s,n);else if("data"===t){if(o??=s,this.dataStart=e.filePos,this.dataSize=Math.min(o,(i??1/0)-this.dataStart),null===this.reader.fileSize)break}else if("ds64"===t){let e=this.reader.requestSlice(l,s);if(e instanceof Promise&&(e=await e),!e)break;const t=pI(e,n);o=pI(e,n),i=Math.min(t+8,this.reader.fileSize??1/0)}else"LIST"===t?await this.parseListChunk(l,s,n):"ID3 "!==t&&"id3 "!==t||await this.parseId3Chunk(l,s);c=l+s+(1&s),a++}if(!this.audioInfo)throw new Error('Invalid WAVE file - missing "fmt " chunk');if(-1===this.dataStart)throw new Error('Invalid WAVE file - missing "data" chunk');const l=this.audioInfo.blockSizeInBytes;this.dataSize=Math.floor(this.dataSize/l)*l,this.tracks.push(new US(this.input,new IC(this)))})()}async parseFmtChunk(e,t,n){let r=this.reader.requestSlice(e,t);if(r instanceof Promise&&(r=await r),!r)return;let s=aI(r,n);const i=aI(r,n),a=uI(r,n);r.skip(4);const o=aI(r,n);let c;if(c=14===t?8:aI(r,n),t>=18&&357!==s){const e=aI(r,n),i=t-18;if(Math.min(i,e)>=22&&s===vC.EXTENSIBLE){r.skip(6);const e=sI(r,16);s=e[0]|e[1]<<8}}s!==vC.MULAW&&s!==vC.ALAW||(c=8),this.audioInfo={format:s,numberOfChannels:i,sampleRate:a,sampleSizeInBytes:Math.ceil(c/8),blockSizeInBytes:o}}async parseListChunk(e,t,n){let r=this.reader.requestSlice(e,t);if(r instanceof Promise&&(r=await r),!r)return;const s=kI(r,4);if("INFO"!==s&&"INF0"!==s)return;let i=r.filePos;for(;i<=e+t-8;){r.filePos=i;const e=kI(r,4),t=uI(r,n),s=sI(r,t);let a=0;for(let n=0;n<s.length&&0!==s[n];n++)a++;const o=String.fromCharCode(...s.subarray(0,a));switch(this.metadataTags.raw??={},this.metadataTags.raw[e]=o,e){case"INAM":case"TITL":this.metadataTags.title??=o;break;case"TIT3":this.metadataTags.description??=o;break;case"IART":this.metadataTags.artist??=o;break;case"IPRD":this.metadataTags.album??=o;break;case"IPRT":case"ITRK":case"TRCK":{const e=o.split("/"),t=Number.parseInt(e[0],10),n=e[1]&&Number.parseInt(e[1],10);Number.isInteger(t)&&t>0&&(this.metadataTags.trackNumber??=t),n&&Number.isInteger(n)&&n>0&&(this.metadataTags.tracksTotal??=n)}break;case"ICRD":case"IDIT":{const e=new Date(o);Number.isNaN(e.getTime())||(this.metadataTags.date??=e)}break;case"YEAR":{const e=Number.parseInt(o,10);Number.isInteger(e)&&e>0&&(this.metadataTags.date??=new Date(e,0,1))}break;case"IGNR":case"GENR":this.metadataTags.genre??=o;break;case"ICMT":case"CMNT":case"COMM":this.metadataTags.comment??=o}i+=8+t+(1&t)}}async parseId3Chunk(e,t){let n=this.reader.requestSlice(e,t);if(n instanceof Promise&&(n=await n),!n)return;const r=sC(n);if(r){const t=n.slice(e+10,r.size);iC(t,r,this.metadataTags)}}getCodec(){if(HT(this.audioInfo),this.audioInfo.format===vC.MULAW)return"ulaw";if(this.audioInfo.format===vC.ALAW)return"alaw";if(this.audioInfo.format===vC.PCM){if(1===this.audioInfo.sampleSizeInBytes)return"pcm-u8";if(2===this.audioInfo.sampleSizeInBytes)return"pcm-s16";if(3===this.audioInfo.sampleSizeInBytes)return"pcm-s24";if(4===this.audioInfo.sampleSizeInBytes)return"pcm-s32"}return this.audioInfo.format===vC.IEEE_FLOAT&&4===this.audioInfo.sampleSizeInBytes?"pcm-f32":null}async getMimeType(){return"audio/wav"}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return HT(e),e.computeDuration()}async getTracks(){return await this.readMetadata(),this.tracks}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}const CC=2048;class IC{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return this.demuxer.getCodec()}getInternalCodecId(){return HT(this.demuxer.audioInfo),this.demuxer.audioInfo.format}async getDecoderConfig(){const e=this.demuxer.getCodec();return e?(HT(this.demuxer.audioInfo),{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}):null}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getNumberOfChannels(){return HT(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}getSampleRate(){return HT(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getTimeResolution(){return HT(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return C_}async getFirstTimestamp(){return 0}async getPacketAtIndex(e,t){HT(this.demuxer.audioInfo);const n=e*CC*this.demuxer.audioInfo.blockSizeInBytes;if(n>=this.demuxer.dataSize)return null;const r=Math.min(CC*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-n);if(null===this.demuxer.reader.fileSize){let e=this.demuxer.reader.requestSlice(this.demuxer.dataStart+n,r);if(e instanceof Promise&&(e=await e),!e)return null}let s;if(t.metadataOnly)s=uS;else{let e=this.demuxer.reader.requestSlice(this.demuxer.dataStart+n,r);e instanceof Promise&&(e=await e),HT(e),s=sI(e,r)}const i=e*CC/this.demuxer.audioInfo.sampleRate,a=r/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate;return this.demuxer.lastKnownPacketIndex=Math.max(e,i),new dS(s,"key",i,a,e,r)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getPacket(e,t){HT(this.demuxer.audioInfo);const n=Math.floor(Math.min(e*this.demuxer.audioInfo.sampleRate/CC,(this.demuxer.dataSize-1)/(CC*this.demuxer.audioInfo.blockSizeInBytes))),r=await this.getPacketAtIndex(n,t);if(r)return r;if(0===n)return null;HT(null===this.demuxer.reader.fileSize);let s=await this.getPacketAtIndex(this.demuxer.lastKnownPacketIndex,t);for(;s;){const e=await this.getNextPacket(s,t);if(!e)break;s=e}return s}getNextPacket(e,t){HT(this.demuxer.audioInfo);const n=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/CC);return this.getPacketAtIndex(n+1,t)}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}}const xC=e=>{const t=e.filePos,n=sI(e,9),r=new KT(n);if(4095!==r.readBits(12))return null;r.skipBits(1);if(0!==r.readBits(2))return null;const s=r.readBits(1),i=r.readBits(2)+1,a=r.readBits(4);if(15===a)return null;r.skipBits(1);const o=r.readBits(3);if(0===o)throw new Error("ADTS frames with channel configuration 0 are not supported.");r.skipBits(1),r.skipBits(1),r.skipBits(1),r.skipBits(1);const c=r.readBits(13);r.skipBits(11);const l=r.readBits(2)+1;if(1!==l)throw new Error("ADTS frames with more than one AAC frame are not supported.");let u=null;return 1===s?e.filePos-=2:u=r.readBits(16),{objectType:i,samplingFrequencyIndex:a,channelConfiguration:o,frameLength:c,numberOfAacFrames:l,crcCheck:u,startPos:t}},AC=1024;class PC extends iS{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.tracks=[],this.readingMutex=new h_,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();HT(this.firstFrameHeader),this.tracks=[new US(this.input,new OC(this))]})()}async advanceReader(){let e=this.reader.requestSliceRange(this.lastLoadedPos,7,9);if(e instanceof Promise&&(e=await e),!e)return void(this.lastSampleLoaded=!0);const t=xC(e);if(!t)return void(this.lastSampleLoaded=!0);if(null!==this.reader.fileSize&&t.startPos+t.frameLength>this.reader.fileSize)return void(this.lastSampleLoaded=!0);this.firstFrameHeader||(this.firstFrameHeader=t);const n=mv[t.samplingFrequencyIndex];HT(void 0!==n);const r=AC/n,s=t.crcCheck?9:7,i={timestamp:this.nextTimestampInSamples/n,duration:r,dataStart:t.startPos+s,dataSize:t.frameLength-s};this.loadedSamples.push(i),this.nextTimestampInSamples+=AC,this.lastLoadedPos=t.startPos+t.frameLength}async getMimeType(){return"audio/aac"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return HT(e),e.computeDuration()}async getMetadataTags(){return{}}}class OC{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return this.getSampleRate()/AC}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return C_}getCodec(){return"aac"}getInternalCodecId(){return HT(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.objectType}getNumberOfChannels(){HT(this.demuxer.firstFrameHeader);const e=pv[this.demuxer.firstFrameHeader.channelConfiguration];return HT(void 0!==e),e}getSampleRate(){HT(this.demuxer.firstFrameHeader);const e=mv[this.demuxer.firstFrameHeader.samplingFrequencyIndex];return HT(void 0!==e),e}async getDecoderConfig(){HT(this.demuxer.firstFrameHeader);const e=new Uint8Array(3),t=new KT(e),{objectType:n,samplingFrequencyIndex:r,channelConfiguration:s}=this.demuxer.firstFrameHeader;return n>31?(t.writeBits(5,31),t.writeBits(6,n-32)):t.writeBits(5,n),t.writeBits(4,r),t.writeBits(4,s),{codec:`mp4a.40.${this.demuxer.firstFrameHeader.objectType}`,numberOfChannels:this.getNumberOfChannels(),sampleRate:this.getSampleRate(),description:e.subarray(0,Math.ceil((t.pos-1)/8))}}async getPacketAtIndex(e,t){if(-1===e)return null;const n=this.demuxer.loadedSamples[e];if(!n)return null;let r;if(t.metadataOnly)r=uS;else{let e=this.demuxer.reader.requestSlice(n.dataStart,n.dataSize);if(e instanceof Promise&&(e=await e),!e)return null;r=sI(e,n.dataSize)}return new dS(r,"key",n.timestamp,n.duration,e,n.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,t){const n=await this.demuxer.readingMutex.acquire();try{const n=f_(this.demuxer.loadedSamples,e.timestamp,e=>e.timestamp);if(-1===n)throw new Error("Packet was not created from this track.");const r=n+1;for(;r>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(r,t)}finally{n()}}async getPacket(e,t){const n=await this.demuxer.readingMutex.acquire();try{for(;;){const n=g_(this.demuxer.loadedSamples,e,e=>e.timestamp);if(-1===n&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(n,t);if(n>=0&&n+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(n,t);await this.demuxer.advanceReader()}}finally{n()}}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}}class NC extends iS{constructor(e){super(e),this.loadedSamples=[],this.metadataPromise=null,this.track=null,this.metadataTags={},this.audioInfo=null,this.lastLoadedPos=null,this.blockingBit=null,this.readingMutex=new h_,this.lastSampleLoaded=!1,this.reader=e._reader}async computeDuration(){return await this.readMetadata(),HT(this.track),this.track.computeDuration()}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}async getTracks(){return await this.readMetadata(),HT(this.track),[this.track]}async getMimeType(){return"audio/flac"}async readMetadata(){let e=4;return this.metadataPromise??=(async()=>{for(;null===this.reader.fileSize||e<this.reader.fileSize;){let t=this.reader.requestSlice(e,4);if(t instanceof Promise&&(t=await t),e+=4,null===t)throw new Error(`Metadata block at position ${e} is too small! Corrupted file.`);HT(t);const n=iI(t),r=cI(t),s=!!(128&n);switch(127&n){case nS.STREAMINFO:{let t=this.reader.requestSlice(e,r);if(t instanceof Promise&&(t=await t),HT(t),null===t)throw new Error(`StreamInfo block at position ${e} is too small! Corrupted file.`);const n=sI(t,34),s=new KT(n),i=s.readBits(16),a=s.readBits(16),o=s.readBits(24),c=s.readBits(24),l=s.readBits(20),u=s.readBits(3)+1;s.readBits(5);const d=s.readBits(36);s.skipBits(128);const h=new Uint8Array(42);h.set(new Uint8Array([102,76,97,67]),0),h.set(new Uint8Array([128,0,0,34]),4),h.set(n,8),this.audioInfo={numberOfChannels:u,sampleRate:l,totalSamples:d,minimumBlockSize:i,maximumBlockSize:a,minimumFrameSize:o,maximumFrameSize:c,description:h},this.track=new US(this.input,new RC(this));break}case nS.VORBIS_COMMENT:{let t=this.reader.requestSlice(e,r);t instanceof Promise&&(t=await t),HT(t),sS(sI(t,r),this.metadataTags);break}case nS.PICTURE:{let t=this.reader.requestSlice(e,r);t instanceof Promise&&(t=await t),HT(t);const n=dI(t),s=dI(t),i=e_.decode(sI(t,s)),a=dI(t),o=e_.decode(sI(t,a));t.skip(16);const c=dI(t),l=sI(t,c);this.metadataTags.images??=[],this.metadataTags.images.push({data:l,mimeType:i,kind:3===n?"coverFront":4===n?"coverBack":"unknown",description:o});break}}if(e+=r,s){this.lastLoadedPos=e;break}}})()}async readNextFlacFrame({startPos:e,isFirstPacket:t}){HT(this.audioInfo);const n=this.audioInfo.maximumFrameSize+16,r=await this.reader.requestSliceRange(e,this.audioInfo.minimumFrameSize,n);if(!r)return null;const s=this.readFlacFrameHeader({slice:r,isFirstPacket:t});if(!s)return null;for(r.filePos=e+this.audioInfo.minimumFrameSize;;){if(r.filePos>r.end-6)return{num:s.num,blockSize:s.blockSize,sampleRate:s.sampleRate,size:r.end-e,isLastFrame:!0};if(255===iI(r)){if(iI(r)!==(1===this.blockingBit?249:248)){r.skip(-1);continue}r.skip(-2);const t=r.filePos-e;if(!this.readFlacFrameHeader({slice:r,isFirstPacket:!1})){r.skip(-1);continue}return{num:s.num,blockSize:s.blockSize,sampleRate:s.sampleRate,size:t,isLastFrame:!1}}}}readFlacFrameHeader({slice:e,isFirstPacket:t}){const n=e.filePos,r=sI(e,4),s=new KT(r);if(32764!==s.readBits(15))return null;if(null===this.blockingBit){HT(t);const e=s.readBits(1);this.blockingBit=e}else if(1===this.blockingBit){HT(!t);if(1!==s.readBits(1))return null}else{if(0!==this.blockingBit)throw new Error("Invalid blocking bit");HT(!t);if(0!==s.readBits(1))return null}const i=(e=>0===e?null:1===e?192:e>=2&&e<=5?144*2**e:6===e?"uncommon-u8":7===e?"uncommon-u16":e>=8&&e<=15?2**e:null)(s.readBits(4));if(!i)return null;HT(this.audioInfo);const a=((e,t)=>{switch(e){case 0:return t;case 1:return 88200;case 2:return 176400;case 3:return 192e3;case 4:return 8e3;case 5:return 16e3;case 6:return 22050;case 7:return 24e3;case 8:return 32e3;case 9:return 44100;case 10:return 48e3;case 11:return 96e3;case 12:return"uncommon-u8";case 13:return"uncommon-u16";case 14:return"uncommon-u16-10";default:return null}})(s.readBits(4),this.audioInfo.sampleRate);if(!a)return null;s.readBits(4),s.readBits(3);if(0!==s.readBits(1))return null;const o=(e=>{let t=0;const n=new KT(sI(e,1));for(;1===n.readBits(1);)t++;if(0===t)return n.readBits(7);const r=[],s=t-1,i=new KT(sI(e,s)),a=8-t-1;for(let o=0;o<a;o++)r.unshift(n.readBits(1));for(let o=0;o<s;o++)for(let e=0;e<8;e++){const t=i.readBits(1);e<2||r.unshift(t)}return r.reduce((e,t,n)=>e|t<<n,0)})(e),c=((e,t)=>"uncommon-u16"===t?oI(e)+1:"uncommon-u8"===t?iI(e)+1:"number"==typeof t?t:(T_(t),void HT(!1)))(e,i),l=((e,t)=>"uncommon-u16"===t?oI(e):"uncommon-u16-10"===t?10*oI(e):"uncommon-u8"===t?iI(e):"number"==typeof t?t:null)(e,a);if(null===l)return null;const u=e.filePos-n,d=iI(e);e.skip(-u),e.skip(-1);const h=(e=>{let t=0;for(const n of e){t^=n;for(let e=0;e<8;e++)128&t?t=t<<1^7:t<<=1,t&=255}return t})(sI(e,u));return d!==h?null:{num:o,blockSize:c,sampleRate:l}}async advanceReader(){await this.readMetadata(),HT(null!==this.lastLoadedPos),HT(this.audioInfo);const e=this.lastLoadedPos,t=await this.readNextFlacFrame({startPos:e,isFirstPacket:0===this.loadedSamples.length});if(!t)return void(this.lastSampleLoaded=!0);const n=this.loadedSamples[this.loadedSamples.length-1],r={blockOffset:n?n.blockOffset+n.blockSize:0,blockSize:t.blockSize,byteOffset:e,byteSize:t.size};this.lastLoadedPos=this.lastLoadedPos+t.size,this.loadedSamples.push(r),t.isLastFrame&&(this.lastSampleLoaded=!0)}}class RC{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return"flac"}getInternalCodecId(){return null}getNumberOfChannels(){return HT(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getSampleRate(){return HT(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return C_}getTimeResolution(){return HT(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}async getFirstTimestamp(){return 0}async getDecoderConfig(){return HT(this.demuxer.audioInfo),{codec:"flac",numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate,description:this.demuxer.audioInfo.description}}async getPacket(e,t){if(HT(this.demuxer.audioInfo),e<0)throw new Error("Timestamp cannot be negative");const n=await this.demuxer.readingMutex.acquire();try{for(;;){const n=g_(this.demuxer.loadedSamples,e,e=>e.blockOffset/this.demuxer.audioInfo.sampleRate);if(-1===n){await this.demuxer.advanceReader();continue}const r=this.demuxer.loadedSamples[n],s=r.blockOffset/this.demuxer.audioInfo.sampleRate;if(!(s+r.blockSize/this.demuxer.audioInfo.sampleRate<=e))return this.getPacketAtIndex(n,t);if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(this.demuxer.loadedSamples.length-1,t);await this.demuxer.advanceReader()}}finally{n()}}async getNextPacket(e,t){const n=await this.demuxer.readingMutex.acquire();try{const n=e.sequenceNumber+1;if(this.demuxer.lastSampleLoaded&&n>=this.demuxer.loadedSamples.length)return null;for(;n>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(n,t)}finally{n()}}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}async getPacketAtIndex(e,t){const n=this.demuxer.loadedSamples[e];if(!n)return null;let r;if(t.metadataOnly)r=uS;else{let e=this.demuxer.reader.requestSlice(n.byteOffset,n.byteSize);if(e instanceof Promise&&(e=await e),!e)return null;r=sI(e,n.byteSize)}HT(this.demuxer.audioInfo);const s=n.blockOffset/this.demuxer.audioInfo.sampleRate,i=n.blockSize/this.demuxer.audioInfo.sampleRate;return new dS(r,"key",s,i,e,n.byteSize)}async getFirstPacket(e){for(;0===this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(0,e)}}class MC{}class DC extends MC{async _getMajorBrand(e){let t=e._reader.requestSlice(0,12);if(t instanceof Promise&&(t=await t),!t)return null;t.skip(4);return"ftyp"!==kI(t,4)?null:kI(t,4)}_createDemuxer(e){return new KS(e)}}class FC extends MC{async isSupportedEBMLOfDocType(e,t){let n=e._reader.requestSlice(0,wE);if(n instanceof Promise&&(n=await n),!n)return!1;const r=kE(n);if(null===r)return!1;if(r<1||r>8)return!1;if(_E(n,r)!==uE.EBML)return!1;const s=SE(n);if(null===s)return!1;let i=e._reader.requestSlice(n.filePos,s);if(i instanceof Promise&&(i=await i),!i)return!1;const a=n.filePos;for(;i.filePos<=a+s-2;){const e=EE(i);if(!e)break;const{id:n,size:r}=e,s=i.filePos;if(null===r)return!1;switch(n){case uE.EBMLVersion:if(1!==_E(i,r))return!1;break;case uE.EBMLReadVersion:if(1!==_E(i,r))return!1;break;case uE.DocType:if(CE(i,r)!==t)return!1;break;case uE.DocTypeVersion:if(_E(i,r)>4)return!1}i.filePos=s+r}return!0}_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"matroska")}_createDemuxer(e){return new VE(e)}get name(){return"Matroska"}get mimeType(){return"video/x-matroska"}}const LC=new class extends DC{async _canReadInput(e){const t=await this._getMajorBrand(e);return!!t&&"qt  "!==t}get name(){return"MP4"}get mimeType(){return"video/mp4"}},BC=new class extends DC{async _canReadInput(e){return"qt  "===await this._getMajorBrand(e)}get name(){return"QuickTime File Format"}get mimeType(){return"video/quicktime"}},zC=new FC,UC=new class extends FC{_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"webm")}get name(){return"WebM"}get mimeType(){return"video/webm"}},$C=new class extends MC{async _canReadInput(e){let t=e._reader.requestSlice(0,10);if(t instanceof Promise&&(t=await t),!t)return!1;let n=0,r=!1;for(;;){let t=e._reader.requestSlice(n,10);if(t instanceof Promise&&(t=await t),!t)break;const s=sC(t);if(!s)break;r=!0,n=t.filePos+s.size}const s=await cC(e._reader,n,n+4096);if(!s)return!1;if(r)return!0;n=s.startPos+s.header.totalSize;const i=await cC(e._reader,n,n+4);if(!i)return!1;const a=s.header,o=i.header;return a.channel===o.channel&&a.sampleRate===o.sampleRate}_createDemuxer(e){return new lC(e)}get name(){return"MP3"}get mimeType(){return"audio/mpeg"}},VC=new class extends MC{async _canReadInput(e){let t=e._reader.requestSlice(0,12);if(t instanceof Promise&&(t=await t),!t)return!1;const n=kI(t,4);if("RIFF"!==n&&"RIFX"!==n&&"RF64"!==n)return!1;t.skip(4);return"WAVE"===kI(t,4)}_createDemuxer(e){return new EC(e)}get name(){return"WAVE"}get mimeType(){return"audio/wav"}},jC=new class extends MC{async _canReadInput(e){let t=e._reader.requestSlice(0,4);return t instanceof Promise&&(t=await t),!!t&&"OggS"===kI(t,4)}_createDemuxer(e){return new wC(e)}get name(){return"Ogg"}get mimeType(){return"application/ogg"}},WC=new class extends MC{async _canReadInput(e){let t=e._reader.requestSliceRange(0,7,9);if(t instanceof Promise&&(t=await t),!t)return!1;const n=xC(t);if(!n)return!1;if(t=e._reader.requestSliceRange(n.frameLength,7,9),t instanceof Promise&&(t=await t),!t)return!1;const r=xC(t);return!!r&&(n.objectType===r.objectType&&n.samplingFrequencyIndex===r.samplingFrequencyIndex&&n.channelConfiguration===r.channelConfiguration)}_createDemuxer(e){return new PC(e)}get name(){return"ADTS"}get mimeType(){return"audio/aac"}},HC=[LC,BC,zC,UC,VC,jC,new class extends MC{async _canReadInput(e){let t=e._reader.requestSlice(0,4);return t instanceof Promise&&(t=await t),!!t&&"fLaC"===kI(t,4)}get name(){return"FLAC"}get mimeType(){return"audio/flac"}_createDemuxer(e){return new NC(e)}},$C,WC];class qC{constructor(){this._disposed=!1,this._sizePromise=null,this.onread=null}async getSizeOrNull(){if(this._disposed)throw new eI;return this._sizePromise??=Promise.resolve(this._retrieveSize())}async getSize(){if(this._disposed)throw new eI;const e=await this.getSizeOrNull();if(null===e)throw new Error("Cannot determine the size of an unsized source.");return e}}class XC extends qC{constructor(e,t={}){if(!(e instanceof Blob))throw new TypeError("blob must be a Blob.");if(!t||"object"!=typeof t)throw new TypeError("options must be an object.");if(void 0!==t.maxCacheSize&&(!Number.isInteger(t.maxCacheSize)||t.maxCacheSize<0))throw new TypeError("options.maxCacheSize, when provided, must be a non-negative integer.");super(),this._readers=new WeakMap,this._blob=e,this._orchestrator=new JC({maxCacheSize:t.maxCacheSize??8388608,maxWorkerCount:4,runWorker:this._runWorker.bind(this),prefetchProfile:QC.fileSystem})}_retrieveSize(){const e=this._blob.size;return this._orchestrator.fileSize=e,e}_read(e,t){return this._orchestrator.read(e,t)}async _runWorker(e){let t=this._readers.get(e);if(void 0===t){if("stream"in this._blob){t=this._blob.slice(e.currentPos).stream().getReader()}else t=null;this._readers.set(e,t)}for(;e.currentPos<e.targetPos&&!e.aborted;)if(t){const{done:n,value:r}=await t.read();if(n){if(this._orchestrator.forgetWorker(e),e.currentPos<e.targetPos)throw new Error("Blob reader stopped unexpectedly before all requested data was read.");break}this.onread?.(e.currentPos,e.currentPos+r.length),this._orchestrator.supplyWorkerData(e,r)}else{const t=await this._blob.slice(e.currentPos,e.targetPos).arrayBuffer();this.onread?.(e.currentPos,e.currentPos+t.byteLength),this._orchestrator.supplyWorkerData(e,new Uint8Array(t))}e.running=!1}_dispose(){this._orchestrator.dispose()}}const GC=524288,KC=e=>Math.min(2**(e-2),16);class YC extends qC{constructor(e,t={}){if(!("string"==typeof e||e instanceof URL||"undefined"!=typeof Request&&e instanceof Request))throw new TypeError("url must be a string, URL or Request.");if(!t||"object"!=typeof t)throw new TypeError("options must be an object.");if(void 0!==t.requestInit&&(!t.requestInit||"object"!=typeof t.requestInit))throw new TypeError("options.requestInit, when provided, must be an object.");if(void 0!==t.getRetryDelay&&"function"!=typeof t.getRetryDelay)throw new TypeError("options.getRetryDelay, when provided, must be a function.");if(void 0!==t.maxCacheSize&&(!Number.isInteger(t.maxCacheSize)||t.maxCacheSize<0))throw new TypeError("options.maxCacheSize, when provided, must be a non-negative integer.");if(void 0!==t.fetchFn&&"function"!=typeof t.fetchFn)throw new TypeError("options.fetchFn, when provided, must be a function.");super(),this._existingResponses=new WeakMap,this._url=e,this._options=t,this._getRetryDelay=t.getRetryDelay??KC,this._orchestrator=new JC({maxCacheSize:t.maxCacheSize??67108864,maxWorkerCount:2,runWorker:this._runWorker.bind(this),prefetchProfile:QC.network})}async _retrieveSize(){const e=new AbortController,t=await M_(this._options.fetchFn??fetch,this._url,N_(this._options.requestInit??{},{headers:{Range:"bytes=0-"},signal:e.signal}),this._getRetryDelay);if(!t.ok)throw new Error(`Error fetching ${String(this._url)}: ${t.status} ${t.statusText}`);let n,r;if(206===t.status)r=this._getPartialLengthFromRangeResponse(t),n=this._orchestrator.createWorker(0,Math.min(r,GC));else{const e=t.headers.get("Content-Length");if(!e)throw new Error(`HTTP response (status ${t.status}) must surface Content-Length header.`);r=Number(e),n=this._orchestrator.createWorker(0,r),this._orchestrator.options.maxCacheSize=1/0}return this._orchestrator.fileSize=r,this._existingResponses.set(n,{response:t,abortController:e}),this._orchestrator.runWorker(n),r}_read(e,t){return this._orchestrator.read(e,t)}async _runWorker(e){for(;!e.aborted;){const n=this._existingResponses.get(e);this._existingResponses.delete(e);let r=n?.abortController,s=n?.response;if(r||(r=new AbortController,s=await M_(this._options.fetchFn??fetch,this._url,N_(this._options.requestInit??{},{headers:{Range:`bytes=${e.currentPos}-`},signal:r.signal}),this._getRetryDelay)),HT(s),!s.ok)throw new Error(`Error fetching ${String(this._url)}: ${s.status} ${s.statusText}`);if(e.currentPos>0&&206!==s.status)throw new Error("HTTP server did not respond with 206 Partial Content to a range request. To enable efficient media file streaming across a network, please make sure your server supports range requests.");const i=this._getPartialLengthFromRangeResponse(s),a=e.targetPos-e.currentPos;if(i<a)throw new Error(`HTTP response unexpectedly too short: Needed at least ${a} bytes, got only ${i}.`);if(!s.body)throw new Error("Missing HTTP response body stream. The used fetch function must provide the response body as a ReadableStream.");const o=s.body.getReader();for(;;){if(e.currentPos>=e.targetPos||e.aborted)return r.abort(),void(e.running=!1);let n;try{n=await o.read()}catch(t){const e=this._getRetryDelay(1,t);if(null!==e){await new Promise(t=>setTimeout(t,1e3*e));break}throw t}const{done:s,value:i}=n;if(s){if(this._orchestrator.forgetWorker(e),e.currentPos<e.targetPos)throw new Error("Response stream reader stopped unexpectedly before all requested data was read.");return void(e.running=!1)}this.onread?.(e.currentPos,e.currentPos+i.length),this._orchestrator.supplyWorkerData(e,i)}}e.running=!1}_getPartialLengthFromRangeResponse(e){const t=e.headers.get("Content-Range");if(t){const e=/\/(\d+)/.exec(t);if(e)return Number(e[1]);throw new Error(`Invalid Content-Range header: ${t}`)}{const t=e.headers.get("Content-Length");if(t)return Number(t);throw new Error("Partial HTTP response (status 206) must surface either Content-Range or Content-Length header.")}}_dispose(){this._orchestrator.dispose()}}const QC={fileSystem:(e,t)=>{const n=65536;return{start:e=Math.floor((e-n)/n)*n,end:t=Math.ceil((t+n)/n)*n}},network:(e,t,n)=>{const r=65536;e=Math.max(0,Math.floor((e-r)/r)*r);for(const s of n){const n=8388608,r=Math.max((s.startPos+s.targetPos)/2,s.targetPos-n);if($_(e,t,r,s.targetPos)){const e=s.targetPos-s.startPos,r=Math.ceil((e+1)/n)*n,i=2**Math.ceil(Math.log2(e+1)),a=Math.min(i,r);t=Math.max(t,s.startPos+a)}}return{start:e,end:t=Math.max(t,e+GC)}}};class JC{constructor(e){this.options=e,this.fileSize=null,this.nextAge=0,this.workers=[],this.cache=[],this.currentCacheSize=0}read(e,t){HT(null!==this.fileSize);const n=this.options.prefetchProfile(e,t,this.workers),r=Math.max(n.start,0),s=Math.min(n.end,this.fileSize);HT(r<=e&&t<=s);let i=null;const a=g_(this.cache,e,e=>e.start),o=-1!==a?this.cache[a]:null;o&&o.start<=e&&t<=o.end&&(o.age=this.nextAge++,i={bytes:o.bytes,view:o.view,offset:o.start});const c=g_(this.cache,r,e=>e.start),l=i?null:new Uint8Array(t-e);let u=0,d=r;const h=[];if(-1!==c){for(let n=c;n<this.cache.length;n++){const i=this.cache[n];if(i.start>=s)break;if(i.end<=r)continue;const a=Math.max(r,i.start),o=Math.min(s,i.end);if(HT(a<=o),d<a&&h.push({start:d,end:a}),d=o,l){const n=Math.max(e,i.start),r=Math.min(t,i.end);if(n<r){const t=n-e;l.set(i.bytes.subarray(n-i.start,r-i.start),t),t===u&&(u=r-e)}}i.age=this.nextAge++}d<s&&h.push({start:d,end:s})}else h.push({start:r,end:s});if(l&&u>=l.length&&(i={bytes:l,view:ZT(l),offset:e}),0===h.length)return HT(i),i;const{promise:m,resolve:p,reject:f}=y_(),g=[];for(const b of h){const n=Math.max(e,b.start),r=Math.min(t,b.end);n===b.start&&r===b.end?g.push(b):n<r&&g.push({start:n,end:r})}for(const b of h){const t=l&&{start:e,bytes:l,holes:g,resolve:p,reject:f};let n=!1;for(const e of this.workers){const r=2**17;if($_(b.start-r,b.start,e.currentPos,e.targetPos)){e.targetPos=Math.max(e.targetPos,b.end),n=!0,t&&!e.pendingSlices.includes(t)&&e.pendingSlices.push(t),e.running||this.runWorker(e);break}}if(!n){const e=this.createWorker(b.start,b.end);t&&(e.pendingSlices=[t]),this.runWorker(e)}}return i||(HT(l),i=m.then(t=>({bytes:t,view:ZT(t),offset:e}))),i}createWorker(e,t){const n={startPos:e,currentPos:e,targetPos:t,running:!1,aborted:!1,pendingSlices:[],age:this.nextAge++};for(this.workers.push(n);this.workers.length>this.options.maxWorkerCount;){let e=0,t=this.workers[0];for(let n=1;n<this.workers.length;n++){const r=this.workers[n];r.age<t.age&&(e=n,t=r)}if(t.running&&t.pendingSlices.length>0)break;t.aborted=!0,this.workers.splice(e,1)}return n}runWorker(e){HT(!e.running),HT(e.currentPos<e.targetPos),e.running=!0,e.age=this.nextAge++,this.options.runWorker(e).catch(t=>{if(e.running=!1,!(e.pendingSlices.length>0))throw t;e.pendingSlices.forEach(e=>e.reject(t)),e.pendingSlices.length=0})}supplyWorkerData(e,t){const n=e.currentPos,r=n+t.length;this.insertIntoCache({start:n,end:r,bytes:t,view:ZT(t),age:this.nextAge++}),e.currentPos+=t.length,e.targetPos=Math.max(e.targetPos,e.currentPos);for(let s=0;s<e.pendingSlices.length;s++){const i=e.pendingSlices[s],a=Math.max(n,i.start),o=Math.min(r,i.start+i.bytes.length);a<o&&i.bytes.set(t.subarray(a-n,o-n),a-i.start);for(let e=0;e<i.holes.length;e++){const t=i.holes[e];n<=t.start&&r>t.start&&(t.start=r),t.end<=t.start&&(i.holes.splice(e,1),e--)}0===i.holes.length&&(i.resolve(i.bytes),e.pendingSlices.splice(s,1),s--)}for(let s=0;s<this.workers.length;s++){const t=this.workers[s];e===t||t.running||$_(n,r,t.currentPos,t.targetPos)&&(this.workers.splice(s,1),s--)}}forgetWorker(e){const t=this.workers.indexOf(e);HT(-1!==t),this.workers.splice(t,1)}insertIntoCache(e){if(0===this.options.maxCacheSize)return;let t=g_(this.cache,e.start,e=>e.start)+1;if(t>0){const n=this.cache[t-1];if(n.end>=e.end)return;if(n.end>e.start){const r=new Uint8Array(e.end-n.start);r.set(n.bytes,0),r.set(e.bytes,e.start-n.start),this.currentCacheSize+=e.end-n.end,n.bytes=r,n.view=ZT(r),n.end=e.end,t--,e=n}else this.cache.splice(t,0,e),this.currentCacheSize+=e.bytes.length}else this.cache.splice(t,0,e),this.currentCacheSize+=e.bytes.length;for(let n=t+1;n<this.cache.length;n++){const t=this.cache[n];if(e.end<=t.start)break;if(e.end>=t.end){this.cache.splice(n,1),this.currentCacheSize-=t.bytes.length,n--;continue}const r=new Uint8Array(t.end-e.start);r.set(e.bytes,0),r.set(t.bytes,t.start-e.start),this.currentCacheSize-=e.end-t.start,e.bytes=r,e.view=ZT(r),e.end=t.end,this.cache.splice(n,1);break}for(;this.currentCacheSize>this.options.maxCacheSize;){let e=0,t=this.cache[0];for(let n=1;n<this.cache.length;n++){const r=this.cache[n];r.age<t.age&&(e=n,t=r)}if(this.currentCacheSize-t.bytes.length<=this.options.maxCacheSize)break;this.cache.splice(e,1),this.currentCacheSize-=t.bytes.length}}dispose(){for(const e of this.workers)e.aborted=!0;this.workers.length=0,this.cache.length=0}}q_();class ZC{get disposed(){return this._disposed}constructor(e){if(this._demuxerPromise=null,this._format=null,this._disposed=!1,!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(!Array.isArray(e.formats)||e.formats.some(e=>!(e instanceof MC)))throw new TypeError("options.formats must be an array of InputFormat.");if(!(e.source instanceof qC))throw new TypeError("options.source must be a Source.");if(e.source._disposed)throw new Error("options.source must not be disposed.");this._formats=e.formats,this._source=e.source,this._reader=new tI(e.source)}_getDemuxer(){return this._demuxerPromise??=(async()=>{this._reader.fileSize=await this._source.getSizeOrNull();for(const e of this._formats){if(await e._canReadInput(this))return this._format=e,e._createDemuxer(this)}throw new Error("Input has an unsupported or unrecognizable format.")})()}get source(){return this._source}async getFormat(){return await this._getDemuxer(),HT(this._format),this._format}async computeDuration(){return(await this._getDemuxer()).computeDuration()}async getTracks(){return(await this._getDemuxer()).getTracks()}async getVideoTracks(){return(await this.getTracks()).filter(e=>e.isVideoTrack())}async getAudioTracks(){return(await this.getTracks()).filter(e=>e.isAudioTrack())}async getPrimaryVideoTrack(){return(await this.getTracks()).find(e=>e.isVideoTrack())??null}async getPrimaryAudioTrack(){return(await this.getTracks()).find(e=>e.isAudioTrack())??null}async getMimeType(){return(await this._getDemuxer()).getMimeType()}async getMetadataTags(){return(await this._getDemuxer()).getMetadataTags()}dispose(){this._disposed||(this._disposed=!0,this._source._disposed=!0,this._source._dispose())}[Symbol.dispose](){this.dispose()}}class eI extends Error{constructor(e="Input has been disposed."){super(e),this.name="InputDisposedError"}}class tI{constructor(e){this.source=e}requestSlice(e,t){if(this.source._disposed)throw new eI;if(null!==this.fileSize&&e+t>this.fileSize)return null;const n=e+t,r=this.source._read(e,n);return r instanceof Promise?r.then(t=>t?new nI(t.bytes,t.view,t.offset,e,n):null):r?new nI(r.bytes,r.view,r.offset,e,n):null}requestSliceRange(e,t,n){if(this.source._disposed)throw new eI;if(null!==this.fileSize)return this.requestSlice(e,E_(this.fileSize-e,t,n));{const r=this.requestSlice(e,n),s=r=>{if(r)return r;const s=r=>(HT(null!==r),this.requestSlice(e,E_(r-e,t,n))),i=this.source._retrieveSize();return i instanceof Promise?i.then(s):s(i)};return r instanceof Promise?r.then(s):s(r)}}}class nI{constructor(e,t,n,r,s){this.bytes=e,this.view=t,this.offset=n,this.start=r,this.end=s,this.bufferPos=r-n}static tempFromBytes(e){return new nI(e,ZT(e),0,0,e.length)}get length(){return this.end-this.start}get filePos(){return this.offset+this.bufferPos}set filePos(e){this.bufferPos=e-this.offset}get remainingLength(){return Math.max(this.end-this.filePos,0)}skip(e){this.bufferPos+=e}slice(e,t=this.end-e){if(e<this.start||e+t>this.end)throw new RangeError("Slicing outside of original slice.");return new nI(this.bytes,this.view,this.offset,e,e+t)}}const rI=(e,t)=>{if(e.filePos<e.start||e.filePos+t>e.end)throw new RangeError(`Tried reading [${e.filePos}, ${e.filePos+t}), but slice is [${e.start}, ${e.end}). This is likely an internal error, please report it alongside the file that caused it.`)},sI=(e,t)=>{rI(e,t);const n=e.bytes.subarray(e.bufferPos,e.bufferPos+t);return e.bufferPos+=t,n},iI=e=>(rI(e,1),e.view.getUint8(e.bufferPos++)),aI=(e,t)=>{rI(e,2);const n=e.view.getUint16(e.bufferPos,t);return e.bufferPos+=2,n},oI=e=>{rI(e,2);const t=e.view.getUint16(e.bufferPos,!1);return e.bufferPos+=2,t},cI=e=>{rI(e,3);const t=__(e.view,e.bufferPos,!1);return e.bufferPos+=3,t},lI=e=>{rI(e,2);const t=e.view.getInt16(e.bufferPos,!1);return e.bufferPos+=2,t},uI=(e,t)=>{rI(e,4);const n=e.view.getUint32(e.bufferPos,t);return e.bufferPos+=4,n},dI=e=>{rI(e,4);const t=e.view.getUint32(e.bufferPos,!1);return e.bufferPos+=4,t},hI=e=>{rI(e,4);const t=e.view.getUint32(e.bufferPos,!0);return e.bufferPos+=4,t},mI=e=>{rI(e,4);const t=e.view.getInt32(e.bufferPos,!1);return e.bufferPos+=4,t},pI=(e,t)=>{let n,r;return t?(n=uI(e,!0),r=uI(e,!0)):(r=uI(e,!1),n=uI(e,!1)),4294967296*r+n},fI=e=>4294967296*dI(e)+dI(e),gI=e=>4294967296*mI(e)+dI(e),bI=e=>{const t=hI(e),n=(e=>{rI(e,4);const t=e.view.getInt32(e.bufferPos,!0);return e.bufferPos+=4,t})(e);return 4294967296*n+t},yI=e=>{rI(e,4);const t=e.view.getFloat32(e.bufferPos,!1);return e.bufferPos+=4,t},wI=e=>{rI(e,8);const t=e.view.getFloat64(e.bufferPos,!1);return e.bufferPos+=8,t},kI=(e,t)=>{rI(e,t);let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e.bytes[e.bufferPos++]);return n},TI=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,_I=/(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})/,vI=e=>{const t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),r=Math.floor(e%6e4/1e3),s=e%1e3;return t.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+"."+s.toString().padStart(3,"0")};class SI{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,Math.floor(e/2**32),!1),this.helperView.setUint32(4,e,!1),this.writer.write(this.helper.subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)this.helperView.setUint8(t%8,e.charCodeAt(t)),t%8==7&&this.writer.write(this.helper);e.length%8!=0&&this.writer.write(this.helper.subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.writer.getPos()),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.writer.write(e.contents);else{const t=this.writer.getPos();if(this.writeBoxHeader(e,0),e.contents&&this.writer.write(e.contents),e.children)for(const s of e.children)s&&this.writeBox(s);const n=this.writer.getPos(),r=e.size??n-t;this.writer.seek(t),this.writeBoxHeader(e,r),this.writer.seek(n)}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){const t=this.offsets.get(e);HT(void 0!==t);const n=this.writer.getPos();this.writer.seek(t),this.writeBox(e),this.writer.seek(n)}measureBox(e){if(e.contents&&!e.children){return this.measureBoxHeader(e)+e.contents.byteLength}{let t=this.measureBoxHeader(e);if(e.contents&&(t+=e.contents.byteLength),e.children)for(const n of e.children)n&&(t+=this.measureBox(n));return t}}}const EI=new Uint8Array(8),CI=new DataView(EI.buffer),II=e=>[(e%256+256)%256],xI=e=>(CI.setUint16(0,e,!1),[EI[0],EI[1]]),AI=e=>(CI.setInt16(0,e,!1),[EI[0],EI[1]]),PI=e=>(CI.setUint32(0,e,!1),[EI[1],EI[2],EI[3]]),OI=e=>(CI.setUint32(0,e,!1),[EI[0],EI[1],EI[2],EI[3]]),NI=e=>(CI.setInt32(0,e,!1),[EI[0],EI[1],EI[2],EI[3]]),RI=e=>(CI.setUint32(0,Math.floor(e/2**32),!1),CI.setUint32(4,e,!1),[EI[0],EI[1],EI[2],EI[3],EI[4],EI[5],EI[6],EI[7]]),MI=e=>(CI.setInt16(0,256*e,!1),[EI[0],EI[1]]),DI=e=>(CI.setInt32(0,65536*e,!1),[EI[0],EI[1],EI[2],EI[3]]),FI=e=>(CI.setInt32(0,2**30*e,!1),[EI[0],EI[1],EI[2],EI[3]]),LI=(e,t)=>{const n=[];let r=e;do{let e=127&r;r>>=7,n.length>0&&(e|=128),n.push(e)}while(r>0||t);return n.reverse()},BI=(e,t=!1)=>{const n=Array(e.length).fill(null).map((t,n)=>e.charCodeAt(n));return t&&n.push(0),n},zI=e=>{let t=null;for(const n of e)(!t||n.timestamp>t.timestamp)&&(t=n);return t},UI=e=>{const t=e*(Math.PI/180),n=Math.round(Math.cos(t)),r=Math.round(Math.sin(t));return[n,r,0,-r,n,0,0,0,1]},$I=UI(0),VI=e=>[DI(e[0]),DI(e[1]),FI(e[2]),DI(e[3]),DI(e[4]),FI(e[5]),DI(e[6]),DI(e[7]),FI(e[8])],jI=(e,t,n)=>({type:e,contents:t&&new Uint8Array(t.flat(10)),children:n}),WI=(e,t,n,r,s)=>jI(e,[II(t),PI(n),r??[]],s),HI=e=>({type:"mdat",largeSize:e}),qI=e=>jI("moov",void 0,[XI(e.creationTime,e.trackDatas),...e.trackDatas.map(t=>GI(t,e.creationTime)),e.isFragmented?Ix(e.trackDatas):null,$x(e)]),XI=(e,t)=>{const n=hA(Math.max(0,...t.filter(e=>e.samples.length>0).map(e=>{const t=zI(e.samples);return t.timestamp+t.duration})),uA),r=Math.max(0,...t.map(e=>e.track.id))+1,s=!GT(e)||!GT(n),i=s?RI:OI;return WI("mvhd",+s,0,[i(e),i(e),OI(uA),i(n),DI(1),MI(1),Array(10).fill(0),VI($I),Array(24).fill(0),OI(r)])},GI=(e,t)=>{const n=dA(e);return jI("trak",void 0,[KI(e,t),YI(e,t),void 0!==n.name?jI("udta",void 0,[jI("name",[...t_.encode(n.name)])]):null])},KI=(e,t)=>{const n=zI(e.samples),r=hA(n?n.timestamp+n.duration:0,uA),s=!GT(t)||!GT(r),i=s?RI:OI;let a;if("video"===e.type){const t=e.track.metadata.rotation;a=UI(t??0)}else a=$I;return WI("tkhd",+s,3,[i(t),i(t),OI(e.track.id),OI(0),i(r),Array(8).fill(0),xI(0),xI(e.track.id),MI("audio"===e.type?1:0),xI(0),VI(a),DI("video"===e.type?e.info.width:0),DI("video"===e.type?e.info.height:0)])},YI=(e,t)=>jI("mdia",void 0,[QI(e,t),ex(!0,JI[e.type],ZI[e.type]),tx(e)]),QI=(e,t)=>{const n=zI(e.samples),r=hA(n?n.timestamp+n.duration:0,e.timescale),s=!GT(t)||!GT(r),i=s?RI:OI;return WI("mdhd",+s,0,[i(t),i(t),OI(e.timescale),i(r),xI(tA(e.track.metadata.languageCode??C_)),xI(0)])},JI={video:"vide",audio:"soun",subtitle:"text"},ZI={video:"MediabunnyVideoHandler",audio:"MediabunnySoundHandler",subtitle:"MediabunnyTextHandler"},ex=(e,t,n,r="\0\0\0\0")=>WI("hdlr",0,0,[e?BI("mhlr"):OI(0),BI(t),BI(r),OI(0),OI(0),BI(n,!0)]),tx=e=>jI("minf",void 0,[nx[e.type](),rx(),ax(e)]),nx={video:()=>WI("vmhd",0,1,[xI(0),xI(0),xI(0),xI(0)]),audio:()=>WI("smhd",0,0,[xI(0),xI(0)]),subtitle:()=>WI("nmhd",0,0)},rx=()=>jI("dinf",void 0,[sx()]),sx=()=>WI("dref",0,0,[OI(1)],[ix()]),ix=()=>WI("url ",0,1),ax=e=>{const t=e.compositionTimeOffsetTable.length>1||e.compositionTimeOffsetTable.some(e=>0!==e.sampleCompositionTimeOffset);return jI("stbl",void 0,[ox(e),kx(e),t?Ex(e):null,t?Cx(e):null,_x(e),vx(e),Sx(e),Tx(e)])},ox=e=>{let t;if("video"===e.type)t=cx(Kx[e.track.source._codec],e);else if("audio"===e.type){const n=Qx(e.track.source._codec,e.muxer.isQuickTime);HT(n),t=dx(n,e)}else"subtitle"===e.type&&(t=wx(Zx[e.track.source._codec],e));return HT(t),WI("stsd",0,0,[OI(1)],[t])},cx=(e,t)=>jI(e,[Array(6).fill(0),xI(1),xI(0),xI(0),Array(12).fill(0),xI(t.info.width),xI(t.info.height),OI(4718592),OI(4718592),OI(0),xI(1),Array(32).fill(0),xI(24),AI(65535)],[Yx[t.track.source._codec](t),u_(t.info.decoderConfig.colorSpace)?lx(t):null]),lx=e=>jI("colr",[BI("nclx"),xI(s_[e.info.decoderConfig.colorSpace.primaries]),xI(a_[e.info.decoderConfig.colorSpace.transfer]),xI(c_[e.info.decoderConfig.colorSpace.matrix]),II((e.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),ux=e=>{if(!e.info.decoderConfig)return null;const t=e.info.decoderConfig,n=t.codec.split("."),r=Number(n[1]),s=Number(n[2]),i=(Number(n[3])<<4)+((n[4]?Number(n[4]):1)<<1)+(n[8]?Number(n[8]):Number(t.colorSpace?.fullRange??0)),a=n[5]?Number(n[5]):t.colorSpace?.primaries?s_[t.colorSpace.primaries]:2,o=n[6]?Number(n[6]):t.colorSpace?.transfer?a_[t.colorSpace.transfer]:2,c=n[7]?Number(n[7]):t.colorSpace?.matrix?c_[t.colorSpace.matrix]:2;return WI("vpcC",1,0,[II(r),II(s),II(i),II(a),II(o),II(c),xI(0)])},dx=(e,t)=>{let n,r=0,s=16;if(Q_.includes(t.track.source._codec)){const e=t.track.source._codec,{sampleSize:n}=yv(e);s=8*n,s>16&&(r=1)}return n=0===r?[Array(6).fill(0),xI(1),xI(r),xI(0),OI(0),xI(t.info.numberOfChannels),xI(s),xI(0),xI(0),xI(t.info.sampleRate<65536?t.info.sampleRate:0),xI(0)]:[Array(6).fill(0),xI(1),xI(r),xI(0),OI(0),xI(t.info.numberOfChannels),xI(Math.min(s,16)),xI(0),xI(0),xI(t.info.sampleRate<65536?t.info.sampleRate:0),xI(0),OI(1),OI(s/8),OI(t.info.numberOfChannels*s/8),OI(2)],jI(e,n,[Jx(t.track.source._codec,t.muxer.isQuickTime)?.(t)??null])},hx=e=>{let t;switch(e.track.source._codec){case"aac":t=64;break;case"mp3":t=107;break;case"vorbis":t=221;break;default:throw new Error(`Unhandled audio codec: ${e.track.source._codec}`)}let n=[...II(t),...II(21),...PI(0),...OI(0),...OI(0)];if(e.info.decoderConfig.description){const t=JT(e.info.decoderConfig.description);n=[...n,...II(5),...LI(t.byteLength),...t]}return n=[...xI(1),...II(0),...II(4),...LI(n.length),...n,...II(6),...II(1),...II(2)],n=[...II(3),...LI(n.length),...n],WI("esds",0,0,n)},mx=e=>jI("wave",void 0,[px(e),fx(e),jI("\0\0\0\0")]),px=e=>jI("frma",[BI(Qx(e.track.source._codec,e.muxer.isQuickTime))]),fx=e=>{const{littleEndian:t}=yv(e.track.source._codec);return jI("enda",[xI(+t)])},gx=e=>{let t=e.info.numberOfChannels,n=3840,r=e.info.sampleRate,s=0,i=0,a=new Uint8Array(0);const o=e.info.decoderConfig?.description;if(o){HT(o.byteLength>=18);const e=JT(o),c=Jv(e);t=c.outputChannelCount,n=c.preSkip,r=c.inputSampleRate,s=c.outputGain,i=c.channelMappingFamily,c.channelMappingTable&&(a=c.channelMappingTable)}return jI("dOps",[II(0),II(t),xI(n),OI(r),AI(s),II(i),...a])},bx=e=>{const t=e.info.decoderConfig?.description;HT(t);const n=JT(t);return WI("dfLa",0,0,[...n.subarray(4)])},yx=e=>{const{littleEndian:t,sampleSize:n}=yv(e.track.source._codec);return WI("pcmC",0,0,[II(+t),II(8*n)])},wx=(e,t)=>jI(e,[Array(6).fill(0),xI(1)],[eA[t.track.source._codec](t)]),kx=e=>WI("stts",0,0,[OI(e.timeToSampleTable.length),e.timeToSampleTable.map(e=>[OI(e.sampleCount),OI(e.sampleDelta)])]),Tx=e=>{if(e.samples.every(e=>"key"===e.type))return null;const t=[...e.samples.entries()].filter(([,e])=>"key"===e.type);return WI("stss",0,0,[OI(t.length),t.map(([e])=>OI(e+1))])},_x=e=>WI("stsc",0,0,[OI(e.compactlyCodedChunkTable.length),e.compactlyCodedChunkTable.map(e=>[OI(e.firstChunk),OI(e.samplesPerChunk),OI(1)])]),vx=e=>{if("audio"===e.type&&e.info.requiresPcmTransformation){const{sampleSize:t}=yv(e.track.source._codec);return WI("stsz",0,0,[OI(t*e.info.numberOfChannels),OI(e.samples.reduce((t,n)=>t+hA(n.duration,e.timescale),0))])}return WI("stsz",0,0,[OI(0),OI(e.samples.length),e.samples.map(e=>OI(e.size))])},Sx=e=>e.finalizedChunks.length>0&&XT(e.finalizedChunks).offset>=2**32?WI("co64",0,0,[OI(e.finalizedChunks.length),e.finalizedChunks.map(e=>RI(e.offset))]):WI("stco",0,0,[OI(e.finalizedChunks.length),e.finalizedChunks.map(e=>OI(e.offset))]),Ex=e=>WI("ctts",1,0,[OI(e.compositionTimeOffsetTable.length),e.compositionTimeOffsetTable.map(e=>[OI(e.sampleCount),NI(e.sampleCompositionTimeOffset)])]),Cx=e=>{let t=1/0,n=-1/0,r=1/0,s=-1/0;HT(e.compositionTimeOffsetTable.length>0),HT(e.samples.length>0);for(let a=0;a<e.compositionTimeOffsetTable.length;a++){const r=e.compositionTimeOffsetTable[a];t=Math.min(t,r.sampleCompositionTimeOffset),n=Math.max(n,r.sampleCompositionTimeOffset)}for(let a=0;a<e.samples.length;a++){const t=e.samples[a];r=Math.min(r,hA(t.timestamp,e.timescale)),s=Math.max(s,hA(t.timestamp+t.duration,e.timescale))}const i=Math.max(-t,0);return s>=2**31?null:WI("cslg",0,0,[NI(i),NI(t),NI(n),NI(r),NI(s)])},Ix=e=>jI("mvex",void 0,e.map(xx)),xx=e=>WI("trex",0,0,[OI(e.track.id),OI(1),OI(0),OI(0),OI(0)]),Ax=(e,t)=>jI("moof",void 0,[Px(e),...t.map(Nx)]),Px=e=>WI("mfhd",0,0,[OI(e)]),Ox=e=>{let t=0,n=0;const r="delta"===e.type;return n|=+r,t|=r?1:2,t<<24|n<<16},Nx=e=>jI("traf",void 0,[Rx(e),Mx(e),Dx(e)]),Rx=e=>{HT(e.currentChunk);let t=0;t|=8,t|=16,t|=32,t|=131072;const n=e.currentChunk.samples[1]??e.currentChunk.samples[0],r={duration:n.timescaleUnitsToNextSample,size:n.size,flags:Ox(n)};return WI("tfhd",0,131128,[OI(e.track.id),OI(r.duration),OI(r.size),OI(r.flags)])},Mx=e=>(HT(e.currentChunk),WI("tfdt",1,0,[RI(hA(e.currentChunk.startTimestamp,e.timescale))])),Dx=e=>{HT(e.currentChunk);const t=e.currentChunk.samples.map(e=>e.timescaleUnitsToNextSample),n=e.currentChunk.samples.map(e=>e.size),r=e.currentChunk.samples.map(Ox),s=e.currentChunk.samples.map(t=>hA(t.timestamp-t.decodeTimestamp,e.timescale)),i=new Set(t),a=new Set(n),o=new Set(r),c=new Set(s),l=2===o.size&&r[0]!==r[1],u=i.size>1,d=a.size>1,h=!l&&o.size>1,m=c.size>1||[...c].some(e=>0!==e);let p=0;return p|=1,p|=4*+l,p|=256*+u,p|=512*+d,p|=1024*+h,p|=2048*+m,WI("trun",1,p,[OI(e.currentChunk.samples.length),OI(e.currentChunk.offset-e.currentChunk.moofOffset||0),l?OI(r[0]):[],e.currentChunk.samples.map((e,i)=>[u?OI(t[i]):[],d?OI(n[i]):[],h?OI(r[i]):[],m?NI(s[i]):[]])])},Fx=(e,t)=>WI("tfra",1,0,[OI(e.track.id),OI(63),OI(e.finalizedChunks.length),e.finalizedChunks.map(n=>[RI(hA(n.samples[0].timestamp,e.timescale)),RI(n.moofOffset),OI(t+1),OI(1),OI(1)])]),Lx=()=>WI("mfro",0,0,[OI(0)]),Bx=()=>jI("vtte"),zx=(e,t,n,r,s)=>jI("vttc",void 0,[null!==s?jI("vsid",[NI(s)]):null,null!==n?jI("iden",[...t_.encode(n)]):null,null!==t?jI("ctim",[...t_.encode(vI(t))]):null,null!==r?jI("sttg",[...t_.encode(r)]):null,jI("payl",[...t_.encode(e)])]),Ux=e=>jI("vtta",[...t_.encode(e)]),$x=e=>{const t=[],n=e.format._options.metadataFormat??"auto",r=e.output._metadataTags;if("mdir"===n||"auto"===n&&!e.isQuickTime){const e=qx(r);e&&t.push(e)}else if("mdta"===n){const e=Xx(r);e&&t.push(e)}else("udta"===n||"auto"===n&&e.isQuickTime)&&Vx(t,e.output._metadataTags);return 0===t.length?null:jI("udta",void 0,t)},Vx=(e,t)=>{for(const{key:n,value:r}of V_(t))switch(n){case"title":e.push(jx("©nam",r));break;case"description":e.push(jx("©des",r));break;case"artist":e.push(jx("©ART",r));break;case"album":e.push(jx("©alb",r));break;case"albumArtist":e.push(jx("albr",r));break;case"genre":e.push(jx("©gen",r));break;case"date":e.push(jx("©day",r.toISOString().slice(0,10)));break;case"comment":e.push(jx("©cmt",r));break;case"lyrics":e.push(jx("©lyr",r));break;case"raw":case"discNumber":case"discsTotal":case"trackNumber":case"tracksTotal":case"images":break;default:T_(n)}if(t.raw)for(const n in t.raw){const r=t.raw[n];null==r||4!==n.length||e.some(e=>e.type===n)||("string"==typeof r?e.push(jx(n,r)):r instanceof Uint8Array&&e.push(jI(n,Array.from(r))))}},jx=(e,t)=>{const n=t_.encode(t);return jI(e,[xI(n.length),xI(tA("und")),Array.from(n)])},Wx={"image/jpeg":13,"image/png":14,"image/bmp":27},Hx=(e,t)=>{const n=[];for(const{key:r,value:s}of V_(e))switch(r){case"title":n.push({key:t?"title":"©nam",value:Gx(s)});break;case"description":n.push({key:t?"description":"©des",value:Gx(s)});break;case"artist":n.push({key:t?"artist":"©ART",value:Gx(s)});break;case"album":n.push({key:t?"album":"©alb",value:Gx(s)});break;case"albumArtist":n.push({key:t?"album_artist":"aART",value:Gx(s)});break;case"comment":n.push({key:t?"comment":"©cmt",value:Gx(s)});break;case"genre":n.push({key:t?"genre":"©gen",value:Gx(s)});break;case"lyrics":n.push({key:t?"lyrics":"©lyr",value:Gx(s)});break;case"date":n.push({key:t?"date":"©day",value:Gx(s.toISOString().slice(0,10))});break;case"images":for(const e of s)"coverFront"===e.kind&&n.push({key:"covr",value:jI("data",[OI(Wx[e.mimeType]??0),OI(0),Array.from(e.data)])});break;case"trackNumber":if(t){const t=void 0!==e.tracksTotal?`${s}/${e.tracksTotal}`:s.toString();n.push({key:"track",value:Gx(t)})}else n.push({key:"trkn",value:jI("data",[OI(0),OI(0),xI(0),xI(s),xI(e.tracksTotal??0),xI(0)])});break;case"discNumber":t||n.push({key:"disc",value:jI("data",[OI(0),OI(0),xI(0),xI(s),xI(e.discsTotal??0),xI(0)])});break;case"tracksTotal":case"discsTotal":case"raw":break;default:T_(r)}if(e.raw)for(const r in e.raw){const s=e.raw[r];null==s||!t&&4!==r.length||n.some(e=>e.key===r)||("string"==typeof s?n.push({key:r,value:Gx(s)}):s instanceof Uint8Array?n.push({key:r,value:jI("data",[OI(0),OI(0),Array.from(s)])}):s instanceof X_&&n.push({key:r,value:jI("data",[OI(Wx[s.mimeType]??0),OI(0),Array.from(s.data)])}))}return n},qx=e=>{const t=Hx(e,!1);return 0===t.length?null:WI("meta",0,0,void 0,[ex(!1,"mdir","","appl"),jI("ilst",void 0,t.map(e=>jI(e.key,void 0,[e.value])))])},Xx=e=>{const t=Hx(e,!0);return 0===t.length?null:jI("meta",void 0,[ex(!1,"mdta",""),WI("keys",0,0,[OI(t.length)],t.map(e=>jI("mdta",[...t_.encode(e.key)]))),jI("ilst",void 0,t.map((e,t)=>{const n=String.fromCharCode(...OI(t+1));return jI(n,void 0,[e.value])}))])},Gx=e=>jI("data",[OI(1),OI(0),...t_.encode(e)]),Kx={avc:"avc1",hevc:"hvc1",vp8:"vp08",vp9:"vp09",av1:"av01"},Yx={avc:e=>e.info.decoderConfig&&jI("avcC",[...JT(e.info.decoderConfig.description)]),hevc:e=>e.info.decoderConfig&&jI("hvcC",[...JT(e.info.decoderConfig.description)]),vp8:ux,vp9:ux,av1:e=>jI("av1C",lv(e.info.decoderConfig.codec))},Qx=(e,t)=>{switch(e){case"aac":case"mp3":case"vorbis":return"mp4a";case"opus":return"Opus";case"flac":return"fLaC";case"ulaw":return"ulaw";case"alaw":return"alaw";case"pcm-u8":return"raw ";case"pcm-s8":return"sowt"}if(t)switch(e){case"pcm-s16":return"sowt";case"pcm-s16be":return"twos";case"pcm-s24":case"pcm-s24be":return"in24";case"pcm-s32":case"pcm-s32be":return"in32";case"pcm-f32":case"pcm-f32be":return"fl32";case"pcm-f64":case"pcm-f64be":return"fl64"}else switch(e){case"pcm-s16":case"pcm-s16be":case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":return"ipcm";case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return"fpcm"}},Jx=(e,t)=>{switch(e){case"aac":case"mp3":case"vorbis":return hx;case"opus":return gx;case"flac":return bx}if(t)switch(e){case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return mx}else switch(e){case"pcm-s16":case"pcm-s16be":case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return yx}return null},Zx={webvtt:"wvtt"},eA={webvtt:e=>jI("vttC",[...t_.encode(e.info.config.description)])},tA=e=>{HT(3===e.length);let t=0;for(let n=0;n<3;n++)t<<=5,t+=e.charCodeAt(n)-96;return t};class nA{constructor(){this.ensureMonotonicity=!1,this.trackedWrites=null,this.trackedStart=-1,this.trackedEnd=-1}start(){}maybeTrackWrites(e){if(!this.trackedWrites)return;let t=this.getPos();if(t<this.trackedStart){if(t+e.byteLength<=this.trackedStart)return;e=e.subarray(this.trackedStart-t),t=0}const n=t+e.byteLength-this.trackedStart;let r=this.trackedWrites.byteLength;for(;r<n;)r*=2;if(r!==this.trackedWrites.byteLength){const e=new Uint8Array(r);e.set(this.trackedWrites,0),this.trackedWrites=e}this.trackedWrites.set(e,t-this.trackedStart),this.trackedEnd=Math.max(this.trackedEnd,t+e.byteLength)}startTrackingWrites(){this.trackedWrites=new Uint8Array(1024),this.trackedStart=this.getPos(),this.trackedEnd=this.trackedStart}stopTrackingWrites(){if(!this.trackedWrites)throw new Error("Internal error: Can't get tracked writes since nothing was tracked.");const e={data:this.trackedWrites.subarray(0,this.trackedEnd-this.trackedStart),start:this.trackedStart,end:this.trackedEnd};return this.trackedWrites=null,e}}const rA=65536,sA=2**32;class iA extends nA{constructor(e){if(super(),this.pos=0,this.maxPos=0,this.target=e,this.supportsResize="resize"in new ArrayBuffer(0),this.supportsResize)try{this.buffer=new ArrayBuffer(rA,{maxByteLength:sA})}catch{this.buffer=new ArrayBuffer(rA),this.supportsResize=!1}else this.buffer=new ArrayBuffer(rA);this.bytes=new Uint8Array(this.buffer)}ensureSize(e){let t=this.buffer.byteLength;for(;t<e;)t*=2;if(t!==this.buffer.byteLength){if(t>sA)throw new Error("ArrayBuffer exceeded maximum size of 4294967296 bytes. Please consider using another target.");if(this.supportsResize)this.buffer.resize(t);else{const e=new ArrayBuffer(t),n=new Uint8Array(e);n.set(this.bytes,0),this.buffer=e,this.bytes=n}}}write(e){this.maybeTrackWrites(e),this.ensureSize(this.pos+e.byteLength),this.bytes.set(e,this.pos),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength,this.maxPos=Math.max(this.maxPos,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){}async finalize(){this.ensureSize(this.pos),this.target.buffer=this.buffer.slice(0,Math.max(this.maxPos,this.pos))}async close(){}getSlice(e,t){return this.bytes.slice(e,t)}}class aA extends nA{constructor(e){super(),this.target=e,this.pos=0}write(e){this.maybeTrackWrites(e),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength}getPos(){return this.pos}seek(e){this.pos=e}async flush(){}async finalize(){}async close(){}}class oA{constructor(){this._output=null,this.onwrite=null}}class cA extends oA{constructor(){super(...arguments),this.buffer=null}_createWriter(){return new iA(this)}}class lA extends oA{_createWriter(){return new aA(this)}}const uA=1e3,dA=e=>{const t={},n=e.track;return void 0!==n.metadata.name&&(t.name=n.metadata.name),t},hA=(e,t,n=!0)=>{const r=e*t;return n?Math.round(r):r};class mA extends Av{constructor(e,t){super(e),this.auxTarget=new cA,this.auxWriter=this.auxTarget._createWriter(),this.auxBoxWriter=new SI(this.auxWriter),this.mdat=null,this.ftypSize=null,this.trackDatas=[],this.allTracksKnown=y_(),this.creationTime=Math.floor(Date.now()/1e3)+2082844800,this.finalizedChunks=[],this.nextFragmentNumber=1,this.maxWrittenTimestamp=-1/0,this.format=t,this.writer=e._writer,this.boxWriter=new SI(this.writer),this.isQuickTime=t instanceof _A;const n=this.writer instanceof iA&&"in-memory";this.fastStart=t._options.fastStart??n,this.isFragmented="fragmented"===this.fastStart,("in-memory"===this.fastStart||this.isFragmented)&&(this.writer.ensureMonotonicity=!0),this.minimumFragmentDuration=t._options.minimumFragmentDuration??1}async start(){const e=await this.mutex.acquire(),t=this.output._tracks.some(e=>"video"===e.type&&"avc"===e.source._codec);if(this.format._options.onFtyp&&this.writer.startTrackingWrites(),this.boxWriter.writeBox((n={isQuickTime:this.isQuickTime,holdsAvc:t,fragmented:this.isFragmented}).isQuickTime?jI("ftyp",[BI("qt  "),OI(512),BI("qt  ")]):n.fragmented?jI("ftyp",[BI("iso5"),OI(512),BI("iso5"),BI("iso6"),BI("mp41")]):jI("ftyp",[BI("isom"),OI(512),BI("isom"),n.holdsAvc?BI("avc1"):[],BI("mp41")])),this.format._options.onFtyp){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onFtyp(e,t)}var n;if(this.ftypSize=this.writer.getPos(),"in-memory"===this.fastStart);else if("reserve"===this.fastStart){for(const r of this.output._tracks)if(void 0===r.metadata.maximumPacketCount)throw new Error("All tracks must specify maximumPacketCount in their metadata when using fastStart: 'reserve'.")}else this.isFragmented||(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=HI(!0),this.boxWriter.writeBox(this.mdat));await this.writer.flush(),e()}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(t=>t.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map(e=>{if("video"===e.type)return e.info.decoderConfig.codec;if("audio"===e.type)return e.info.decoderConfig.codec;return{webvtt:"wvtt"}[e.track.source._codec]});return $S({isQuickTime:this.isQuickTime,hasVideo:this.trackDatas.some(e=>"video"===e.type),hasAudio:this.trackDatas.some(e=>"audio"===e.type),codecStrings:e})}getVideoTrackData(e,t,n){const r=this.trackDatas.find(t=>t.track===e);if(r)return r;Ev(n),HT(n),HT(n.decoderConfig);const s={...n.decoderConfig};HT(void 0!==s.codedWidth),HT(void 0!==s.codedHeight);let i=!1;if("avc"!==e.source._codec||s.description){if("hevc"===e.source._codec&&!s.description){const e=$v(t.data);if(!e)throw new Error("Couldn't extract an HEVCDecoderConfigurationRecord from the HEVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.265) when not providing a description, or provide a description (must be an HEVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in HEVC format.");s.description=(e=>{const t=[];t.push(e.configurationVersion),t.push((3&e.generalProfileSpace)<<6|(1&e.generalTierFlag)<<5|31&e.generalProfileIdc),t.push(e.generalProfileCompatibilityFlags>>>24&255),t.push(e.generalProfileCompatibilityFlags>>>16&255),t.push(e.generalProfileCompatibilityFlags>>>8&255),t.push(255&e.generalProfileCompatibilityFlags),t.push(...e.generalConstraintIndicatorFlags),t.push(255&e.generalLevelIdc),t.push(240|e.minSpatialSegmentationIdc>>8&15),t.push(255&e.minSpatialSegmentationIdc),t.push(252|3&e.parallelismType),t.push(252|3&e.chromaFormatIdc),t.push(248|7&e.bitDepthLumaMinus8),t.push(248|7&e.bitDepthChromaMinus8),t.push(e.avgFrameRate>>8&255),t.push(255&e.avgFrameRate),t.push((3&e.constantFrameRate)<<6|(7&e.numTemporalLayers)<<3|(1&e.temporalIdNested)<<2|3&e.lengthSizeMinusOne),t.push(255&e.arrays.length);for(const n of e.arrays){t.push((1&n.arrayCompleteness)<<7|63&n.nalUnitType),t.push(n.nalUnits.length>>8&255),t.push(255&n.nalUnits.length);for(const e of n.nalUnits){t.push(e.length>>8&255),t.push(255&e.length);for(let n=0;n<e.length;n++)t.push(e[n])}}return new Uint8Array(t)})(e),i=!0}}else{const e=Bv(t.data);if(!e)throw new Error("Couldn't extract an AVCDecoderConfigurationRecord from the AVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.264) when not providing a description, or provide a description (must be an AVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in AVCC format.");s.description=(e=>{const t=[];t.push(e.configurationVersion),t.push(e.avcProfileIndication),t.push(e.profileCompatibility),t.push(e.avcLevelIndication),t.push(252|3&e.lengthSizeMinusOne),t.push(224|31&e.sequenceParameterSets.length);for(const n of e.sequenceParameterSets){const e=n.byteLength;t.push(e>>8),t.push(255&e);for(let r=0;r<e;r++)t.push(n[r])}t.push(e.pictureParameterSets.length);for(const n of e.pictureParameterSets){const e=n.byteLength;t.push(e>>8),t.push(255&e);for(let r=0;r<e;r++)t.push(n[r])}if(100===e.avcProfileIndication||110===e.avcProfileIndication||122===e.avcProfileIndication||144===e.avcProfileIndication){HT(null!==e.chromaFormat),HT(null!==e.bitDepthLumaMinus8),HT(null!==e.bitDepthChromaMinus8),HT(null!==e.sequenceParameterSetExt),t.push(252|3&e.chromaFormat),t.push(248|7&e.bitDepthLumaMinus8),t.push(248|7&e.bitDepthChromaMinus8),t.push(e.sequenceParameterSetExt.length);for(const n of e.sequenceParameterSetExt){const e=n.byteLength;t.push(e>>8),t.push(255&e);for(let r=0;r<e;r++)t.push(n[r])}}return new Uint8Array(t)})(e),i=!0}const a=((e,t)=>{const n=e<0?-1:1;let r=0,s=1,i=1,a=0,o=e=Math.abs(e);for(;;){const e=Math.floor(o),c=e*i+r,l=e*a+s;if(l>t)return{numerator:n*i,denominator:a};if(r=i,s=a,i=c,a=l,o=1/(o-e),!isFinite(o))break}return{numerator:n*i,denominator:a}})(1/(e.metadata.frameRate??57600),1e6).denominator,o={muxer:this,track:e,type:"video",info:{width:s.codedWidth,height:s.codedHeight,decoderConfig:s,requiresAnnexBTransformation:i},timescale:a,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(o),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),o}getAudioTrackData(e,t){const n=this.trackDatas.find(t=>t.track===e);if(n)return n;Iv(t),HT(t),HT(t.decoderConfig);const r={muxer:this,track:e,type:"audio",info:{numberOfChannels:t.decoderConfig.numberOfChannels,sampleRate:t.decoderConfig.sampleRate,decoderConfig:t.decoderConfig,requiresPcmTransformation:!this.isFragmented&&Q_.includes(e.source._codec)},timescale:t.decoderConfig.sampleRate,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(r),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),r}getSubtitleTrackData(e,t){const n=this.trackDatas.find(t=>t.track===e);if(n)return n;xv(t),HT(t),HT(t.config);const r={muxer:this,track:e,type:"subtitle",info:{config:t.config},timescale:1e3,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[],lastCueEndTimestamp:0,cueQueue:[],nextSourceId:0,cueToSourceId:new WeakMap};return this.trackDatas.push(r),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),r}async addEncodedVideoPacket(e,t,n){const r=await this.mutex.acquire();try{const r=this.getVideoTrackData(e,t,n);let s=t.data;if(r.info.requiresAnnexBTransformation){const e=(e=>{const t=Mv(e);if(0===t.length)return null;let n=0;for(const a of t)n+=4+a.byteLength;const r=new Uint8Array(n),s=new DataView(r.buffer);let i=0;for(const a of t){const e=a.byteLength;s.setUint32(i,e,!1),i+=4,r.set(a,i),i+=a.byteLength}return r})(s);if(!e)throw new Error("Failed to transform packet data. Make sure all packets are provided in Annex B format, as specified in ITU-T-REC-H.264 and ITU-T-REC-H.265.");s=e}const i=this.validateAndNormalizeTimestamp(r.track,t.timestamp,"key"===t.type),a=this.createSampleForTrack(r,s,i,t.duration,t.type);await this.registerSample(r,a)}finally{r()}}async addEncodedAudioPacket(e,t,n){const r=await this.mutex.acquire();try{const r=this.getAudioTrackData(e,n),s=this.validateAndNormalizeTimestamp(r.track,t.timestamp,"key"===t.type),i=this.createSampleForTrack(r,t.data,s,t.duration,t.type);r.info.requiresPcmTransformation&&await this.maybePadWithSilence(r,s),await this.registerSample(r,i)}finally{r()}}async maybePadWithSilence(e,t){const n=XT(e.samples),r=n?n.timestamp+n.duration:0,s=t-r,i=hA(s,e.timescale);if(i>0){const{sampleSize:t,silentValue:n}=yv(e.info.decoderConfig.codec),a=i*e.info.numberOfChannels,o=new Uint8Array(t*a).fill(n),c=this.createSampleForTrack(e,new Uint8Array(o.buffer),r,s,"key");await this.registerSample(e,c)}}async addSubtitleCue(e,t,n){const r=await this.mutex.acquire();try{const r=this.getSubtitleTrackData(e,n);this.validateAndNormalizeTimestamp(r.track,t.timestamp,!0),"webvtt"===e.source._codec&&(r.cueQueue.push(t),await this.processWebVTTCues(r,t.timestamp))}finally{r()}}async processWebVTTCues(e,t){for(;e.cueQueue.length>0;){const n=new Set([]);for(const c of e.cueQueue)HT(c.timestamp<=t),HT(e.lastCueEndTimestamp<=c.timestamp+c.duration),n.add(Math.max(c.timestamp,e.lastCueEndTimestamp)),n.add(c.timestamp+c.duration);const r=[...n].sort((e,t)=>e-t),s=r[0],i=r[1]??s;if(t<i)break;if(e.lastCueEndTimestamp<s){this.auxWriter.seek(0);const t=Bx();this.auxBoxWriter.writeBox(t);const n=this.auxWriter.getSlice(0,this.auxWriter.getPos()),r=this.createSampleForTrack(e,n,e.lastCueEndTimestamp,s-e.lastCueEndTimestamp,"key");await this.registerSample(e,r),e.lastCueEndTimestamp=s}this.auxWriter.seek(0);for(let t=0;t<e.cueQueue.length;t++){const n=e.cueQueue[t];if(n.timestamp>=i)break;TI.lastIndex=0;const r=TI.test(n.text),a=n.timestamp+n.duration;let o=e.cueToSourceId.get(n);if(void 0===o&&i<a&&(o=e.nextSourceId++,e.cueToSourceId.set(n,o)),n.notes){const e=Ux(n.notes);this.auxBoxWriter.writeBox(e)}const c=zx(n.text,r?s:null,n.identifier??null,n.settings??null,o??null);this.auxBoxWriter.writeBox(c),a===i&&e.cueQueue.splice(t--,1)}const a=this.auxWriter.getSlice(0,this.auxWriter.getPos()),o=this.createSampleForTrack(e,a,s,i-s,"key");await this.registerSample(e,o),e.lastCueEndTimestamp=i}}createSampleForTrack(e,t,n,r,s){return{timestamp:n,decodeTimestamp:n,duration:r,data:t,size:t.byteLength,type:s,timescaleUnitsToNextSample:hA(r,e.timescale)}}processTimestamps(e,t){if(0===e.timestampProcessingQueue.length)return;if("audio"===e.type&&e.info.requiresPcmTransformation){let t=0;for(let n=0;n<e.timestampProcessingQueue.length;n++){const r=e.timestampProcessingQueue[n];t+=hA(r.duration,e.timescale)}if(0===e.timeToSampleTable.length)e.timeToSampleTable.push({sampleCount:t,sampleDelta:1});else{XT(e.timeToSampleTable).sampleCount+=t}return void(e.timestampProcessingQueue.length=0)}const n=e.timestampProcessingQueue.map(e=>e.timestamp).sort((e,t)=>e-t);for(let r=0;r<e.timestampProcessingQueue.length;r++){const t=e.timestampProcessingQueue[r];t.decodeTimestamp=n[r],this.isFragmented||null!==e.lastTimescaleUnits||(t.decodeTimestamp=0);const s=hA(t.timestamp-t.decodeTimestamp,e.timescale),i=hA(t.duration,e.timescale);if(null!==e.lastTimescaleUnits){HT(e.lastSample);const n=hA(t.decodeTimestamp,e.timescale,!1),r=Math.round(n-e.lastTimescaleUnits);if(HT(r>=0),e.lastTimescaleUnits+=r,e.lastSample.timescaleUnitsToNextSample=r,!this.isFragmented){let t=XT(e.timeToSampleTable);if(HT(t),1===t.sampleCount){t.sampleDelta=r;const n=e.timeToSampleTable[e.timeToSampleTable.length-2];n&&n.sampleDelta===r&&(n.sampleCount++,e.timeToSampleTable.pop(),t=n)}else t.sampleDelta!==r&&(t.sampleCount--,e.timeToSampleTable.push(t={sampleCount:1,sampleDelta:r}));t.sampleDelta===i?t.sampleCount++:e.timeToSampleTable.push({sampleCount:1,sampleDelta:i});const n=XT(e.compositionTimeOffsetTable);HT(n),n.sampleCompositionTimeOffset===s?n.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:s})}}else e.lastTimescaleUnits=hA(t.decodeTimestamp,e.timescale,!1),this.isFragmented||(e.timeToSampleTable.push({sampleCount:1,sampleDelta:i}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:s}));e.lastSample=t}if(e.timestampProcessingQueue.length=0,HT(e.lastSample),HT(null!==e.lastTimescaleUnits),void 0!==t&&0===e.lastSample.timescaleUnitsToNextSample){HT("key"===t.type);const n=hA(t.timestamp,e.timescale,!1),r=Math.round(n-e.lastTimescaleUnits);e.lastSample.timescaleUnitsToNextSample=r}}async registerSample(e,t){"key"===t.type&&this.processTimestamps(e,t),e.timestampProcessingQueue.push(t),this.isFragmented?(e.sampleQueue.push(t),await this.interleaveSamples()):"reserve"===this.fastStart?await this.registerSampleFastStartReserve(e,t):await this.addSampleToTrack(e,t)}async addSampleToTrack(e,t){if(!this.isFragmented&&(e.samples.push(t),"reserve"===this.fastStart)){const t=e.track.metadata.maximumPacketCount;if(HT(void 0!==t),e.samples.length>t)throw new Error(`Track #${e.track.id} has already reached the maximum packet count (${t}). Either add less packets or increase the maximum packet count.`)}let n=!1;if(e.currentChunk){e.currentChunk.startTimestamp=Math.min(e.currentChunk.startTimestamp,t.timestamp);const r=t.timestamp-e.currentChunk.startTimestamp;if(this.isFragmented){const s=this.trackDatas.every(n=>{if(e===n)return"key"===t.type;const r=n.sampleQueue[0];return r?"key"===r.type:n.track.source._closed});r>=this.minimumFragmentDuration&&s&&t.timestamp>this.maxWrittenTimestamp&&(n=!0,await this.finalizeFragment())}else n=r>=.5}else n=!0;n&&(e.currentChunk&&await this.finalizeCurrentChunk(e),e.currentChunk={startTimestamp:t.timestamp,samples:[],offset:null,moofOffset:null}),HT(e.currentChunk),e.currentChunk.samples.push(t),this.isFragmented&&(this.maxWrittenTimestamp=Math.max(this.maxWrittenTimestamp,t.timestamp))}async finalizeCurrentChunk(e){if(HT(!this.isFragmented),!e.currentChunk)return;e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk);let t=e.currentChunk.samples.length;if("audio"===e.type&&e.info.requiresPcmTransformation&&(t=e.currentChunk.samples.reduce((t,n)=>t+hA(n.duration,e.timescale),0)),0!==e.compactlyCodedChunkTable.length&&XT(e.compactlyCodedChunkTable).samplesPerChunk===t||e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:t}),"in-memory"!==this.fastStart){e.currentChunk.offset=this.writer.getPos();for(const t of e.currentChunk.samples)HT(t.data),this.writer.write(t.data),t.data=null;await this.writer.flush()}else e.currentChunk.offset=0}async interleaveSamples(e=!1){if(HT(this.isFragmented),e||this.allTracksAreKnown())e:for(;;){let t=null,n=1/0;for(const s of this.trackDatas){if(!e&&0===s.sampleQueue.length&&!s.track.source._closed)break e;s.sampleQueue.length>0&&s.sampleQueue[0].timestamp<n&&(t=s,n=s.sampleQueue[0].timestamp)}if(!t)break;const r=t.sampleQueue.shift();await this.addSampleToTrack(t,r)}}async finalizeFragment(e=!0){HT(this.isFragmented);const t=this.nextFragmentNumber++;if(1===t){this.format._options.onMoov&&this.writer.startTrackingWrites();const e=qI(this);if(this.boxWriter.writeBox(e),this.format._options.onMoov){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}}const n=this.trackDatas.filter(e=>e.currentChunk),r=Ax(t,n),s=this.writer.getPos(),i=s+this.boxWriter.measureBox(r);let a=i+8,o=1/0;for(const h of n){h.currentChunk.offset=a,h.currentChunk.moofOffset=s;for(const e of h.currentChunk.samples)a+=e.size;o=Math.min(o,h.currentChunk.startTimestamp)}const c=a-i,l=c>=2**32;if(l)for(const h of n)h.currentChunk.offset+=8;this.format._options.onMoof&&this.writer.startTrackingWrites();const u=Ax(t,n);if(this.boxWriter.writeBox(u),this.format._options.onMoof){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoof(e,t,o)}HT(this.writer.getPos()===i),this.format._options.onMdat&&this.writer.startTrackingWrites();const d=HI(l);d.size=c,this.boxWriter.writeBox(d),this.writer.seek(i+(l?VS:8));for(const h of n)for(const e of h.currentChunk.samples)this.writer.write(e.data),e.data=null;if(this.format._options.onMdat){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}for(const h of n)h.finalizedChunks.push(h.currentChunk),this.finalizedChunks.push(h.currentChunk),h.currentChunk=null;e&&await this.writer.flush()}async registerSampleFastStartReserve(e,t){if(this.allTracksAreKnown()){if(!this.mdat){const e=qI(this),t=this.boxWriter.measureBox(e)+this.computeSampleTableSizeUpperBound()+4096;HT(null!==this.ftypSize),this.writer.seek(this.ftypSize+t),this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=HI(!0),this.boxWriter.writeBox(this.mdat);for(const n of this.trackDatas){for(const e of n.sampleQueue)await this.addSampleToTrack(n,e);n.sampleQueue.length=0}}await this.addSampleToTrack(e,t)}else e.sampleQueue.push(t)}computeSampleTableSizeUpperBound(){HT("reserve"===this.fastStart);let e=0;for(const t of this.trackDatas){const n=t.track.metadata.maximumPacketCount;HT(void 0!==n),e+=8*Math.ceil(2/3*n),e+=4*n,e+=8*Math.ceil(2/3*n),e+=12*Math.ceil(2/3*n),e+=4*n,e+=8*n}return e}async onTrackClose(e){const t=await this.mutex.acquire();if("subtitle"===e.type&&"webvtt"===e.source._codec){const t=this.trackDatas.find(t=>t.track===e);t&&await this.processWebVTTCues(t,1/0)}this.allTracksAreKnown()&&this.allTracksKnown.resolve(),this.isFragmented&&await this.interleaveSamples(),t()}async finalize(){const e=await this.mutex.acquire();this.allTracksKnown.resolve();for(const n of this.trackDatas)"subtitle"===n.type&&"webvtt"===n.track.source._codec&&await this.processWebVTTCues(n,1/0);if(this.isFragmented){await this.interleaveSamples(!0);for(const e of this.trackDatas)this.processTimestamps(e);await this.finalizeFragment(!1)}else for(const n of this.trackDatas)this.processTimestamps(n),await this.finalizeCurrentChunk(n);if("in-memory"===this.fastStart){let e;this.mdat=HI(!1);for(let n=0;n<2;n++){const t=qI(this),n=this.boxWriter.measureBox(t);e=this.boxWriter.measureBox(this.mdat);let r=this.writer.getPos()+n+e;for(const s of this.finalizedChunks){s.offset=r;for(const{data:t}of s.samples)HT(t),r+=t.byteLength,e+=t.byteLength}if(r<2**32)break;e>=2**32&&(this.mdat.largeSize=!0)}this.format._options.onMoov&&this.writer.startTrackingWrites();const t=qI(this);if(this.boxWriter.writeBox(t),this.format._options.onMoov){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat.size=e,this.boxWriter.writeBox(this.mdat);for(const n of this.finalizedChunks)for(const e of n.samples)HT(e.data),this.writer.write(e.data),e.data=null;if(this.format._options.onMdat){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}}else if(this.isFragmented){const e=this.writer.getPos(),n=(t=this.trackDatas,jI("mfra",void 0,[...t.map(Fx),Lx()]));this.boxWriter.writeBox(n);const r=this.writer.getPos()-e;this.writer.seek(this.writer.getPos()-4),this.boxWriter.writeU32(r)}else{HT(this.mdat);const e=this.boxWriter.offsets.get(this.mdat);HT(void 0!==e);const t=this.writer.getPos()-e;if(this.mdat.size=t,this.mdat.largeSize=t>=2**32,this.boxWriter.patchBox(this.mdat),this.format._options.onMdat){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}const n=qI(this);if("reserve"===this.fastStart){HT(null!==this.ftypSize),this.writer.seek(this.ftypSize),this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(n);const e=this.boxWriter.offsets.get(this.mdat)-this.writer.getPos();this.boxWriter.writeBox({type:"free",size:e})}else this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(n);if(this.format._options.onMoov){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}}var t;e()}}const pA="Mediabunny",fA={video:1,audio:2,subtitle:17};class gA extends Av{constructor(e,t){super(e),this.trackDatas=[],this.allTracksKnown=y_(),this.segment=null,this.segmentInfo=null,this.seekHead=null,this.tracksElement=null,this.tagsElement=null,this.attachmentsElement=null,this.segmentDuration=null,this.cues=null,this.currentCluster=null,this.currentClusterStartMsTimestamp=null,this.currentClusterMaxMsTimestamp=null,this.trackDatasInCurrentCluster=new Map,this.duration=0,this.writer=e._writer,this.format=t,this.ebmlWriter=new yE(this.writer),this.format._options.appendOnly&&(this.writer.ensureMonotonicity=!0)}async start(){const e=await this.mutex.acquire();this.writeEBMLHeader(),this.createSegmentInfo(),this.createCues(),await this.writer.flush(),e()}writeEBMLHeader(){this.format._options.onEbmlHeader&&this.writer.startTrackingWrites();const e={id:uE.EBML,data:[{id:uE.EBMLVersion,data:1},{id:uE.EBMLReadVersion,data:1},{id:uE.EBMLMaxIDLength,data:4},{id:uE.EBMLMaxSizeLength,data:8},{id:uE.DocType,data:this.format instanceof SA?"webm":"matroska"},{id:uE.DocTypeVersion,data:2},{id:uE.DocTypeReadVersion,data:2}]};if(this.ebmlWriter.writeEBML(e),this.format._options.onEbmlHeader){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onEbmlHeader(e,t)}}maybeCreateSeekHead(e){if(this.format._options.appendOnly)return;const t=new Uint8Array([28,83,187,107]),n=new Uint8Array([21,73,169,102]),r=new Uint8Array([22,84,174,107]),s=new Uint8Array([25,65,164,105]),i=new Uint8Array([18,84,195,103]),a={id:uE.SeekHead,data:[{id:uE.Seek,data:[{id:uE.SeekID,data:t},{id:uE.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.cues)-this.segmentDataOffset:0}]},{id:uE.Seek,data:[{id:uE.SeekID,data:n},{id:uE.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.segmentInfo)-this.segmentDataOffset:0}]},{id:uE.Seek,data:[{id:uE.SeekID,data:r},{id:uE.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.tracksElement)-this.segmentDataOffset:0}]},this.attachmentsElement?{id:uE.Seek,data:[{id:uE.SeekID,data:s},{id:uE.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.attachmentsElement)-this.segmentDataOffset:0}]}:null,this.tagsElement?{id:uE.Seek,data:[{id:uE.SeekID,data:i},{id:uE.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.tagsElement)-this.segmentDataOffset:0}]}:null]};this.seekHead=a}createSegmentInfo(){const e={id:uE.Duration,data:new oE(0)};this.segmentDuration=e;const t={id:uE.Info,data:[{id:uE.TimestampScale,data:1e6},{id:uE.MuxingApp,data:pA},{id:uE.WritingApp,data:pA},this.format._options.appendOnly?null:e]};this.segmentInfo=t}createTracks(){const e={id:uE.Tracks,data:[]};this.tracksElement=e;for(const t of this.trackDatas){const n=OE[t.track.source._codec];HT(n);let r=0;if("audio"===t.type&&"opus"===t.track.source._codec){r=8e7;const e=t.info.decoderConfig.description;if(e){const t=JT(e),n=Jv(t);r=Math.round(n.preSkip/gv*1e9)}}e.data.push({id:uE.TrackEntry,data:[{id:uE.TrackNumber,data:t.track.id},{id:uE.TrackUID,data:t.track.id},{id:uE.TrackType,data:fA[t.type]},{id:uE.FlagLacing,data:0},{id:uE.Language,data:t.track.metadata.languageCode??C_},{id:uE.CodecID,data:n},{id:uE.CodecDelay,data:0},{id:uE.SeekPreRoll,data:r},void 0!==t.track.metadata.name?{id:uE.Name,data:new lE(t.track.metadata.name)}:null,"video"===t.type?this.videoSpecificTrackInfo(t):null,"audio"===t.type?this.audioSpecificTrackInfo(t):null,"subtitle"===t.type?this.subtitleSpecificTrackInfo(t):null]})}}videoSpecificTrackInfo(e){const{frameRate:t,rotation:n}=e.track.metadata,r=[e.info.decoderConfig.description?{id:uE.CodecPrivate,data:JT(e.info.decoderConfig.description)}:null,t?{id:uE.DefaultDuration,data:1e9/t}:null],s=n?qT(-n):0,i=e.info.decoderConfig.colorSpace,a={id:uE.Video,data:[{id:uE.PixelWidth,data:e.info.width},{id:uE.PixelHeight,data:e.info.height},e.info.alphaMode?{id:uE.AlphaMode,data:1}:null,u_(i)?{id:uE.Colour,data:[{id:uE.MatrixCoefficients,data:c_[i.matrix]},{id:uE.TransferCharacteristics,data:a_[i.transfer]},{id:uE.Primaries,data:s_[i.primaries]},{id:uE.Range,data:i.fullRange?2:1}]}:null,s?{id:uE.Projection,data:[{id:uE.ProjectionType,data:0},{id:uE.ProjectionPoseRoll,data:new aE((s+180)%360-180)}]}:null]};return r.push(a),r}audioSpecificTrackInfo(e){const t=Q_.includes(e.track.source._codec)?yv(e.track.source._codec):null;return[e.info.decoderConfig.description?{id:uE.CodecPrivate,data:JT(e.info.decoderConfig.description)}:null,{id:uE.Audio,data:[{id:uE.SamplingFrequency,data:new aE(e.info.sampleRate)},{id:uE.Channels,data:e.info.numberOfChannels},t?{id:uE.BitDepth,data:8*t.sampleSize}:null]}]}subtitleSpecificTrackInfo(e){return[{id:uE.CodecPrivate,data:t_.encode(e.info.config.description)}]}maybeCreateTags(){const e=[],t=(t,n)=>{e.push({id:uE.SimpleTag,data:[{id:uE.TagName,data:new lE(t)},"string"==typeof n?{id:uE.TagString,data:new lE(n)}:{id:uE.TagBinary,data:n}]})},n=this.output._metadataTags,r=new Set;for(const{key:s,value:i}of V_(n))switch(s){case"title":t("TITLE",i),r.add("TITLE");break;case"description":t("DESCRIPTION",i),r.add("DESCRIPTION");break;case"artist":t("ARTIST",i),r.add("ARTIST");break;case"album":t("ALBUM",i),r.add("ALBUM");break;case"albumArtist":t("ALBUM_ARTIST",i),r.add("ALBUM_ARTIST");break;case"genre":t("GENRE",i),r.add("GENRE");break;case"comment":t("COMMENT",i),r.add("COMMENT");break;case"lyrics":t("LYRICS",i),r.add("LYRICS");break;case"date":t("DATE",i.toISOString().slice(0,10)),r.add("DATE");break;case"trackNumber":t("PART_NUMBER",void 0!==n.tracksTotal?`${i}/${n.tracksTotal}`:i.toString()),r.add("PART_NUMBER");break;case"discNumber":t("DISC",void 0!==n.discsTotal?`${i}/${n.discsTotal}`:i.toString()),r.add("DISC");break;case"tracksTotal":case"discsTotal":case"images":case"raw":break;default:T_(s)}if(n.raw)for(const s in n.raw){const e=n.raw[s];null==e||r.has(s)||("string"==typeof e||e instanceof Uint8Array)&&t(s,e)}0!==e.length&&(this.tagsElement={id:uE.Tags,data:[{id:uE.Tag,data:[{id:uE.Targets,data:[{id:uE.TargetTypeValue,data:50},{id:uE.TargetType,data:"MOVIE"}]},...e]}]})}maybeCreateAttachments(){const e=this.output._metadataTags,t=[],n=new Set,r=e.images??[];for(const s of r){let e,r=s.name;if(void 0===r){r=("coverFront"===s.kind?"cover":"coverBack"===s.kind?"back":"image")+(j_(s.mimeType)??"")}for(;;){e=0n;for(let t=0;t<8;t++)e<<=8n,e|=BigInt(Math.floor(256*Math.random()));if(0n!==e&&!n.has(e))break}n.add(e),t.push({id:uE.AttachedFile,data:[void 0!==s.description?{id:uE.FileDescription,data:new lE(s.description)}:null,{id:uE.FileName,data:new lE(r)},{id:uE.FileMediaType,data:s.mimeType},{id:uE.FileData,data:s.data},{id:uE.FileUID,data:e}]})}for(const[s,i]of Object.entries(e.raw??{})){if(!(i instanceof G_))continue;/^\d+$/.test(s)&&(r.find(e=>e.mimeType===i.mimeType&&H_(e.data,i.data))||t.push({id:uE.AttachedFile,data:[void 0!==i.description?{id:uE.FileDescription,data:new lE(i.description)}:null,{id:uE.FileName,data:new lE(i.name??"")},{id:uE.FileMediaType,data:i.mimeType??""},{id:uE.FileData,data:i.data},{id:uE.FileUID,data:BigInt(s)}]}))}0!==t.length&&(this.attachmentsElement={id:uE.Attachments,data:t})}createSegment(){this.createTracks(),this.maybeCreateTags(),this.maybeCreateAttachments(),this.maybeCreateSeekHead(!1);const e={id:uE.Segment,size:this.format._options.appendOnly?-1:6,data:[this.seekHead,this.segmentInfo,this.tracksElement,this.attachmentsElement,this.tagsElement]};if(this.segment=e,this.format._options.onSegmentHeader&&this.writer.startTrackingWrites(),this.ebmlWriter.writeEBML(e),this.format._options.onSegmentHeader){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onSegmentHeader(e,t)}}createCues(){this.cues={id:uE.Cues,data:[]}}get segmentDataOffset(){return HT(this.segment),this.ebmlWriter.dataOffsets.get(this.segment)}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(t=>t.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map(e=>{if("video"===e.type)return e.info.decoderConfig.codec;if("audio"===e.type)return e.info.decoderConfig.codec;return{webvtt:"wvtt"}[e.track.source._codec]});return RE({isWebM:this.format instanceof SA,hasVideo:this.trackDatas.some(e=>"video"===e.type),hasAudio:this.trackDatas.some(e=>"audio"===e.type),codecStrings:e})}getVideoTrackData(e,t,n){const r=this.trackDatas.find(t=>t.track===e);if(r)return r;Ev(n),HT(n),HT(n.decoderConfig),HT(void 0!==n.decoderConfig.codedWidth),HT(void 0!==n.decoderConfig.codedHeight);const s={track:e,type:"video",info:{width:n.decoderConfig.codedWidth,height:n.decoderConfig.codedHeight,decoderConfig:n.decoderConfig,alphaMode:!!t.sideData.alpha},chunkQueue:[],lastWrittenMsTimestamp:null};return"vp9"===e.source._codec?s.info.decoderConfig={...s.info.decoderConfig,description:new Uint8Array(cv(s.info.decoderConfig.codec))}:"av1"===e.source._codec&&(s.info.decoderConfig={...s.info.decoderConfig,description:new Uint8Array(lv(s.info.decoderConfig.codec))}),this.trackDatas.push(s),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),s}getAudioTrackData(e,t){const n=this.trackDatas.find(t=>t.track===e);if(n)return n;Iv(t),HT(t),HT(t.decoderConfig);const r={track:e,type:"audio",info:{numberOfChannels:t.decoderConfig.numberOfChannels,sampleRate:t.decoderConfig.sampleRate,decoderConfig:t.decoderConfig},chunkQueue:[],lastWrittenMsTimestamp:null};return this.trackDatas.push(r),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),r}getSubtitleTrackData(e,t){const n=this.trackDatas.find(t=>t.track===e);if(n)return n;xv(t),HT(t),HT(t.config);const r={track:e,type:"subtitle",info:{config:t.config},chunkQueue:[],lastWrittenMsTimestamp:null};return this.trackDatas.push(r),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),r}async addEncodedVideoPacket(e,t,n){const r=await this.mutex.acquire();try{const r=this.getVideoTrackData(e,t,n),s="key"===t.type;let i=this.validateAndNormalizeTimestamp(r.track,t.timestamp,s),a=t.duration;void 0!==e.metadata.frameRate&&(i=x_(i,1/e.metadata.frameRate),a=x_(a,1/e.metadata.frameRate));const o=r.info.alphaMode?t.sideData.alpha??null:null,c=this.createInternalChunk(t.data,i,a,t.type,o);"vp9"===e.source._codec&&this.fixVP9ColorSpace(r,c),r.chunkQueue.push(c),await this.interleaveChunks()}finally{r()}}async addEncodedAudioPacket(e,t,n){const r=await this.mutex.acquire();try{const r=this.getAudioTrackData(e,n),s="key"===t.type,i=this.validateAndNormalizeTimestamp(r.track,t.timestamp,s),a=this.createInternalChunk(t.data,i,t.duration,t.type);r.chunkQueue.push(a),await this.interleaveChunks()}finally{r()}}async addSubtitleCue(e,t,n){const r=await this.mutex.acquire();try{const r=this.getSubtitleTrackData(e,n),s=this.validateAndNormalizeTimestamp(r.track,t.timestamp,!0);let i=t.text;const a=Math.round(1e3*s);TI.lastIndex=0,i=i.replace(TI,e=>{const t=(e=>{const t=_I.exec(e);if(!t)throw new Error("Expected match.");return 36e5*Number(t[1]||"0")+6e4*Number(t[2])+1e3*Number(t[3])+Number(t[4])})(e.slice(1,-1));return`<${vI(t-a)}>`});const o=t_.encode(i),c=`${t.settings??""}\n${t.identifier??""}\n${t.notes??""}`,l=this.createInternalChunk(o,s,t.duration,"key",c.trim()?t_.encode(c):null);r.chunkQueue.push(l),await this.interleaveChunks()}finally{r()}}async interleaveChunks(e=!1){if(e||this.allTracksAreKnown()){e:for(;;){let t=null,n=1/0;for(const s of this.trackDatas){if(!e&&0===s.chunkQueue.length&&!s.track.source._closed)break e;s.chunkQueue.length>0&&s.chunkQueue[0].timestamp<n&&(t=s,n=s.chunkQueue[0].timestamp)}if(!t)break;const r=t.chunkQueue.shift();this.writeBlock(t,r)}e||await this.writer.flush()}}fixVP9ColorSpace(e,t){if("key"!==t.type)return;if(!e.info.decoderConfig.colorSpace||!e.info.decoderConfig.colorSpace.matrix)return;const n=new KT(t.data);n.skipBits(2);const r=n.readBits(1),s=(n.readBits(1)<<1)+r;3===s&&n.skipBits(1);if(n.readBits(1))return;if(0!==n.readBits(1))return;n.skipBits(2);if(4817730!==n.readBits(24))return;s>=2&&n.skipBits(1);const i={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[e.info.decoderConfig.colorSpace.matrix];((e,t,n,r)=>{for(let s=t;s<n;s++){const t=Math.floor(s/8);let i=e[t];const a=7-(7&s);i&=~(1<<a),i|=(r&1<<n-s-1)>>n-s-1<<a,e[t]=i}})(t.data,n.pos,n.pos+3,i)}createInternalChunk(e,t,n,r,s=null){return{data:e,type:r,timestamp:t,duration:n,additions:s}}writeBlock(e,t){this.segment||this.createSegment();const n=Math.round(1e3*t.timestamp),r=this.trackDatas.every(n=>{if(e===n)return"key"===t.type;const r=n.chunkQueue[0];return r?"key"===r.type:n.track.source._closed});let s=!1;if(this.currentCluster){HT(null!==this.currentClusterStartMsTimestamp),HT(null!==this.currentClusterMaxMsTimestamp);const e=n-this.currentClusterStartMsTimestamp;s=r&&n>this.currentClusterMaxMsTimestamp&&e>=1e3*(this.format._options.minimumClusterDuration??1)||e>32767}else s=!0;s&&this.createNewCluster(n);const i=n-this.currentClusterStartMsTimestamp;if(i<-32768)return;const a=new Uint8Array(4),o=new DataView(a.buffer);o.setUint8(0,128|e.track.id),o.setInt16(1,i,!1);const c=Math.round(1e3*t.duration);if(t.additions){const r={id:uE.BlockGroup,data:[{id:uE.Block,data:[a,t.data]},"delta"===t.type?{id:uE.ReferenceBlock,data:new cE(e.lastWrittenMsTimestamp-n)}:null,t.additions?{id:uE.BlockAdditions,data:[{id:uE.BlockMore,data:[{id:uE.BlockAddID,data:1},{id:uE.BlockAdditional,data:t.additions}]}]}:null,c>0?{id:uE.BlockDuration,data:c}:null]};this.ebmlWriter.writeEBML(r)}else{o.setUint8(3,Number("key"===t.type)<<7);const e={id:uE.SimpleBlock,data:[a,t.data]};this.ebmlWriter.writeEBML(e)}this.duration=Math.max(this.duration,n+c),e.lastWrittenMsTimestamp=n,this.trackDatasInCurrentCluster.has(e)||this.trackDatasInCurrentCluster.set(e,{firstMsTimestamp:n}),this.currentClusterMaxMsTimestamp=Math.max(this.currentClusterMaxMsTimestamp,n)}createNewCluster(e){this.currentCluster&&this.finalizeCurrentCluster(),this.format._options.onCluster&&this.writer.startTrackingWrites(),this.currentCluster={id:uE.Cluster,size:this.format._options.appendOnly?-1:5,data:[{id:uE.Timestamp,data:e}]},this.ebmlWriter.writeEBML(this.currentCluster),this.currentClusterStartMsTimestamp=e,this.currentClusterMaxMsTimestamp=e,this.trackDatasInCurrentCluster.clear()}finalizeCurrentCluster(){if(HT(this.currentCluster),!this.format._options.appendOnly){const e=this.writer.getPos()-this.ebmlWriter.dataOffsets.get(this.currentCluster),t=this.writer.getPos();this.writer.seek(this.ebmlWriter.offsets.get(this.currentCluster)+4),this.ebmlWriter.writeVarInt(e,5),this.writer.seek(t)}if(this.format._options.onCluster){HT(null!==this.currentClusterStartMsTimestamp);const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onCluster(e,t,this.currentClusterStartMsTimestamp/1e3)}const e=this.ebmlWriter.offsets.get(this.currentCluster)-this.segmentDataOffset,t=new Map;for(const[r,{firstMsTimestamp:s}]of this.trackDatasInCurrentCluster)t.has(s)||t.set(s,[]),t.get(s).push(r);const n=[...t.entries()].sort((e,t)=>e[0]-t[0]);for(const[r,s]of n)HT(this.cues),this.cues.data.push({id:uE.CuePoint,data:[{id:uE.CueTime,data:r},...s.map(t=>({id:uE.CueTrackPositions,data:[{id:uE.CueTrack,data:t.track.id},{id:uE.CueClusterPosition,data:e}]}))]})}async onTrackClose(){const e=await this.mutex.acquire();this.allTracksAreKnown()&&this.allTracksKnown.resolve(),await this.interleaveChunks(),e()}async finalize(){const e=await this.mutex.acquire();if(this.allTracksKnown.resolve(),this.segment||this.createSegment(),await this.interleaveChunks(!0),this.currentCluster&&this.finalizeCurrentCluster(),HT(this.cues),this.ebmlWriter.writeEBML(this.cues),!this.format._options.appendOnly){const e=this.writer.getPos(),t=this.writer.getPos()-this.segmentDataOffset;this.writer.seek(this.ebmlWriter.offsets.get(this.segment)+4),this.ebmlWriter.writeVarInt(t,6),this.segmentDuration.data=new oE(this.duration),this.writer.seek(this.ebmlWriter.offsets.get(this.segmentDuration)),this.ebmlWriter.writeEBML(this.segmentDuration),HT(this.seekHead),this.writer.seek(this.ebmlWriter.offsets.get(this.seekHead)),this.maybeCreateSeekHead(!0),this.ebmlWriter.writeEBML(this.seekHead),this.writer.seek(e)}e()}}class bA{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer)}writeU16(e){this.helperView.setUint16(0,e,!0),this.writer.write(this.helper.subarray(0,2))}writeU32(e){this.helperView.setUint32(0,e,!0),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,e,!0),this.helperView.setUint32(4,Math.floor(e/2**32),!0),this.writer.write(this.helper)}writeAscii(e){this.writer.write((new TextEncoder).encode(e))}}class yA extends Av{constructor(e,t){super(e),this.headerWritten=!1,this.dataSize=0,this.sampleRate=null,this.sampleCount=0,this.riffSizePos=null,this.dataSizePos=null,this.ds64RiffSizePos=null,this.ds64DataSizePos=null,this.ds64SampleCountPos=null,this.format=t,this.writer=e._writer,this.riffWriter=new bA(e._writer),this.isRf64=!!t._options.large}async start(){}async getMimeType(){return"audio/wav"}async addEncodedVideoPacket(){throw new Error("WAVE does not support video.")}async addEncodedAudioPacket(e,t,n){const r=await this.mutex.acquire();try{if(this.headerWritten||(Iv(n),HT(n),HT(n.decoderConfig),this.writeHeader(e,n.decoderConfig),this.sampleRate=n.decoderConfig.sampleRate,this.headerWritten=!0),this.validateAndNormalizeTimestamp(e,t.timestamp,"key"===t.type),!this.isRf64&&this.writer.getPos()+t.data.byteLength>=2**32)throw new Error("Adding more audio data would exceed the maximum RIFF size of 4 GiB. To write larger files, use RF64 by setting `large: true` in the WavOutputFormatOptions.");this.writer.write(t.data),this.dataSize+=t.data.byteLength,this.sampleCount+=Math.round(t.duration*this.sampleRate),await this.writer.flush()}finally{r()}}async addSubtitleCue(){throw new Error("WAVE does not support subtitles.")}writeHeader(e,t){let n;this.format._options.onHeader&&this.writer.startTrackingWrites();const r=e.source._codec,s=yv(r);n="ulaw"===s.dataType?vC.MULAW:"alaw"===s.dataType?vC.ALAW:"float"===s.dataType?vC.IEEE_FLOAT:vC.PCM;const i=t.numberOfChannels,a=t.sampleRate,o=s.sampleSize*i;if(this.riffWriter.writeAscii(this.isRf64?"RF64":"RIFF"),this.isRf64?this.riffWriter.writeU32(4294967295):(this.riffSizePos=this.writer.getPos(),this.riffWriter.writeU32(0)),this.riffWriter.writeAscii("WAVE"),this.isRf64&&(this.riffWriter.writeAscii("ds64"),this.riffWriter.writeU32(28),this.ds64RiffSizePos=this.writer.getPos(),this.riffWriter.writeU64(0),this.ds64DataSizePos=this.writer.getPos(),this.riffWriter.writeU64(0),this.ds64SampleCountPos=this.writer.getPos(),this.riffWriter.writeU64(0),this.riffWriter.writeU32(0)),this.riffWriter.writeAscii("fmt "),this.riffWriter.writeU32(16),this.riffWriter.writeU16(n),this.riffWriter.writeU16(i),this.riffWriter.writeU32(a),this.riffWriter.writeU32(a*o),this.riffWriter.writeU16(o),this.riffWriter.writeU16(8*s.sampleSize),void 0!==(c=this.output._metadataTags).title||void 0!==c.description||void 0!==c.artist||void 0!==c.album||void 0!==c.albumArtist||void 0!==c.trackNumber||void 0!==c.tracksTotal||void 0!==c.discNumber||void 0!==c.discsTotal||void 0!==c.genre||void 0!==c.date||void 0!==c.lyrics||c.images&&0!==c.images.length||void 0!==c.comment||void 0!==c.raw&&0!==Object.keys(c.raw).length){const e=this.format._options.metadataFormat??"info";"info"===e?this.writeInfoChunk(this.output._metadataTags):"id3"===e?this.writeId3Chunk(this.output._metadataTags):T_(e)}var c;if(this.riffWriter.writeAscii("data"),this.isRf64?this.riffWriter.writeU32(4294967295):(this.dataSizePos=this.writer.getPos(),this.riffWriter.writeU32(0)),this.format._options.onHeader){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onHeader(e,t)}}writeInfoChunk(e){const t=this.writer.getPos();this.riffWriter.writeAscii("LIST"),this.riffWriter.writeU32(0),this.riffWriter.writeAscii("INFO");const n=new Set,r=(e,t)=>{if(!n_(t))return;const r=t.length+1,s=new Uint8Array(r);for(let n=0;n<t.length;n++)s[n]=t.charCodeAt(n);this.riffWriter.writeAscii(e),this.riffWriter.writeU32(r),this.writer.write(s),1&r&&this.writer.write(new Uint8Array(1)),n.add(e)};for(const{key:a,value:o}of V_(e))switch(a){case"title":r("INAM",o),n.add("INAM");break;case"artist":r("IART",o),n.add("IART");break;case"album":r("IPRD",o),n.add("IPRD");break;case"trackNumber":r("ITRK",void 0!==e.tracksTotal?`${o}/${e.tracksTotal}`:o.toString()),n.add("ITRK");break;case"genre":r("IGNR",o),n.add("IGNR");break;case"date":r("ICRD",o.toISOString().slice(0,10)),n.add("ICRD");break;case"comment":r("ICMT",o),n.add("ICMT");break;case"albumArtist":case"discNumber":case"tracksTotal":case"discsTotal":case"description":case"lyrics":case"images":case"raw":break;default:T_(a)}if(e.raw)for(const a in e.raw){const t=e.raw[a];null==t||4!==a.length||n.has(a)||"string"==typeof t&&r(a,t)}const s=this.writer.getPos(),i=s-t-8;this.writer.seek(t+4),this.riffWriter.writeU32(i),this.writer.seek(s),1&i&&this.writer.write(new Uint8Array(1))}writeId3Chunk(e){const t=this.writer.getPos();this.riffWriter.writeAscii("ID3 "),this.riffWriter.writeU32(0);const n=new oC(this.writer).writeId3V2Tag(e),r=this.writer.getPos();this.writer.seek(t+4),this.riffWriter.writeU32(n),this.writer.seek(r),1&n&&this.writer.write(new Uint8Array(1))}async finalize(){const e=await this.mutex.acquire(),t=this.writer.getPos();this.isRf64?(HT(null!==this.ds64RiffSizePos),this.writer.seek(this.ds64RiffSizePos),this.riffWriter.writeU64(t-8),HT(null!==this.ds64DataSizePos),this.writer.seek(this.ds64DataSizePos),this.riffWriter.writeU64(this.dataSize),HT(null!==this.ds64SampleCountPos),this.writer.seek(this.ds64SampleCountPos),this.riffWriter.writeU64(this.sampleCount)):(HT(null!==this.riffSizePos),this.writer.seek(this.riffSizePos),this.riffWriter.writeU32(t-8),HT(null!==this.dataSizePos),this.writer.seek(this.dataSizePos),this.riffWriter.writeU32(this.dataSize)),this.writer.seek(t),e()}}class wA{getSupportedVideoCodecs(){return this.getSupportedCodecs().filter(e=>Y_.includes(e))}getSupportedAudioCodecs(){return this.getSupportedCodecs().filter(e=>Z_.includes(e))}getSupportedSubtitleCodecs(){return this.getSupportedCodecs().filter(e=>ev.includes(e))}_codecUnsupportedHint(e){return""}}class kA extends wA{constructor(e={}){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.fastStart&&![!1,"in-memory","reserve","fragmented"].includes(e.fastStart))throw new TypeError("options.fastStart, when provided, must be false, 'in-memory', 'reserve', or 'fragmented'.");if(void 0!==e.minimumFragmentDuration&&(!Number.isFinite(e.minimumFragmentDuration)||e.minimumFragmentDuration<0))throw new TypeError("options.minimumFragmentDuration, when provided, must be a non-negative number.");if(void 0!==e.onFtyp&&"function"!=typeof e.onFtyp)throw new TypeError("options.onFtyp, when provided, must be a function.");if(void 0!==e.onMoov&&"function"!=typeof e.onMoov)throw new TypeError("options.onMoov, when provided, must be a function.");if(void 0!==e.onMdat&&"function"!=typeof e.onMdat)throw new TypeError("options.onMdat, when provided, must be a function.");if(void 0!==e.onMoof&&"function"!=typeof e.onMoof)throw new TypeError("options.onMoof, when provided, must be a function.");if(void 0!==e.metadataFormat&&!["mdir","mdta","udta","auto"].includes(e.metadataFormat))throw new TypeError("options.metadataFormat, when provided, must be either 'auto', 'mdir', 'mdta', or 'udta'.");super(),this._options=e}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:2**32-1}}}get supportsVideoRotationMetadata(){return!0}_createMuxer(e){return new mA(e,this)}}class TA extends kA{constructor(e){super(e)}get _name(){return"MP4"}get fileExtension(){return".mp4"}get mimeType(){return"video/mp4"}getSupportedCodecs(){return[...Y_,...J_,"pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be",...ev]}_codecUnsupportedHint(e){return(new _A).getSupportedCodecs().includes(e)?" Switching to MOV will grant support for this codec.":""}}class _A extends kA{constructor(e){super(e)}get _name(){return"MOV"}get fileExtension(){return".mov"}get mimeType(){return"video/quicktime"}getSupportedCodecs(){return[...Y_,...Z_]}_codecUnsupportedHint(e){return(new TA).getSupportedCodecs().includes(e)?" Switching to MP4 will grant support for this codec.":""}}class vA extends wA{constructor(e={}){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.appendOnly&&"boolean"!=typeof e.appendOnly)throw new TypeError("options.appendOnly, when provided, must be a boolean.");if(void 0!==e.minimumClusterDuration&&(!Number.isFinite(e.minimumClusterDuration)||e.minimumClusterDuration<0))throw new TypeError("options.minimumClusterDuration, when provided, must be a non-negative number.");if(void 0!==e.onEbmlHeader&&"function"!=typeof e.onEbmlHeader)throw new TypeError("options.onEbmlHeader, when provided, must be a function.");if(void 0!==e.onSegmentHeader&&"function"!=typeof e.onSegmentHeader)throw new TypeError("options.onHeader, when provided, must be a function.");if(void 0!==e.onCluster&&"function"!=typeof e.onCluster)throw new TypeError("options.onCluster, when provided, must be a function.");super(),this._options=e}_createMuxer(e){return new gA(e,this)}get _name(){return"Matroska"}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:127}}}get fileExtension(){return".mkv"}get mimeType(){return"video/x-matroska"}getSupportedCodecs(){return[...Y_,...J_,...Q_.filter(e=>!["pcm-s8","pcm-f32be","pcm-f64be","ulaw","alaw"].includes(e)),...ev]}get supportsVideoRotationMetadata(){return!1}}class SA extends vA{constructor(e){super(e)}getSupportedCodecs(){return[...Y_.filter(e=>["vp8","vp9","av1"].includes(e)),...Z_.filter(e=>["opus","vorbis"].includes(e)),...ev]}get _name(){return"WebM"}get fileExtension(){return".webm"}get mimeType(){return"video/webm"}_codecUnsupportedHint(e){return(new vA).getSupportedCodecs().includes(e)?" Switching to MKV will grant support for this codec.":""}}class EA extends wA{constructor(e={}){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.large&&"boolean"!=typeof e.large)throw new TypeError("options.large, when provided, must be a boolean.");if(void 0!==e.metadataFormat&&!["info","id3"].includes(e.metadataFormat))throw new TypeError("options.metadataFormat, when provided, must be either 'info' or 'id3'.");if(void 0!==e.onHeader&&"function"!=typeof e.onHeader)throw new TypeError("options.onHeader, when provided, must be a function.");super(),this._options=e}_createMuxer(e){return new yA(e,this)}get _name(){return"WAVE"}getSupportedTrackCounts(){return{video:{min:0,max:0},audio:{min:1,max:1},subtitle:{min:0,max:0},total:{min:1,max:1}}}get fileExtension(){return".wav"}get mimeType(){return"audio/wav"}getSupportedCodecs(){return[...Q_.filter(e=>["pcm-s16","pcm-s24","pcm-s32","pcm-f32","pcm-u8","ulaw","alaw"].includes(e))]}get supportsVideoRotationMetadata(){return!1}}const CA=e=>{if(!e||"object"!=typeof e)throw new TypeError("Encoding config must be an object.");if(!Y_.includes(e.codec))throw new TypeError(`Invalid video codec '${e.codec}'. Must be one of: ${Y_.join(", ")}.`);if(!(e.bitrate instanceof NA)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw new TypeError("config.bitrate must be a positive integer or a quality.");if(void 0!==e.keyFrameInterval&&(!Number.isFinite(e.keyFrameInterval)||e.keyFrameInterval<0))throw new TypeError("config.keyFrameInterval, when provided, must be a non-negative number.");if(void 0!==e.sizeChangeBehavior&&!["deny","passThrough","fill","contain","cover"].includes(e.sizeChangeBehavior))throw new TypeError("config.sizeChangeBehavior, when provided, must be 'deny', 'passThrough', 'fill', 'contain' or 'cover'.");if(void 0!==e.onEncodedPacket&&"function"!=typeof e.onEncodedPacket)throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(void 0!==e.onEncoderConfig&&"function"!=typeof e.onEncoderConfig)throw new TypeError("config.onEncoderConfig, when provided, must be a function.");IA(e.codec,e)},IA=(e,t)=>{if(!t||"object"!=typeof t)throw new TypeError("Encoding options must be an object.");if(void 0!==t.alpha&&!["discard","keep"].includes(t.alpha))throw new TypeError("options.alpha, when provided, must be 'discard' or 'keep'.");if(void 0!==t.bitrateMode&&!["constant","variable"].includes(t.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(void 0!==t.latencyMode&&!["quality","realtime"].includes(t.latencyMode))throw new TypeError("latencyMode, when provided, must be 'quality' or 'realtime'.");if(void 0!==t.fullCodecString&&"string"!=typeof t.fullCodecString)throw new TypeError("fullCodecString, when provided, must be a string.");if(void 0!==t.fullCodecString&&wv(t.fullCodecString)!==e)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${e}).`);if(void 0!==t.hardwareAcceleration&&!["no-preference","prefer-hardware","prefer-software"].includes(t.hardwareAcceleration))throw new TypeError("hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.");if(void 0!==t.scalabilityMode&&"string"!=typeof t.scalabilityMode)throw new TypeError("scalabilityMode, when provided, must be a string.");if(void 0!==t.contentHint&&"string"!=typeof t.contentHint)throw new TypeError("contentHint, when provided, must be a string.")},xA=e=>{const t=e.bitrate instanceof NA?e.bitrate._toVideoBitrate(e.codec,e.width,e.height):e.bitrate;return{codec:e.fullCodecString??ov(e.codec,e.width,e.height,t),width:e.width,height:e.height,bitrate:t,bitrateMode:e.bitrateMode,alpha:e.alpha??"discard",framerate:e.framerate,latencyMode:e.latencyMode,hardwareAcceleration:e.hardwareAcceleration,scalabilityMode:e.scalabilityMode,contentHint:e.contentHint,...(n=e.codec,"avc"===n?{avc:{format:"avc"}}:"hevc"===n?{hevc:{format:"hevc"}}:{})};var n},AA=e=>{if(!e||"object"!=typeof e)throw new TypeError("Encoding config must be an object.");if(!Z_.includes(e.codec))throw new TypeError(`Invalid audio codec '${e.codec}'. Must be one of: ${Z_.join(", ")}.`);if(void 0===e.bitrate&&(!Q_.includes(e.codec)||"flac"===e.codec))throw new TypeError("config.bitrate must be provided for compressed audio codecs.");if(void 0!==e.bitrate&&!(e.bitrate instanceof NA)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw new TypeError("config.bitrate, when provided, must be a positive integer or a quality.");if(void 0!==e.onEncodedPacket&&"function"!=typeof e.onEncodedPacket)throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(void 0!==e.onEncoderConfig&&"function"!=typeof e.onEncoderConfig)throw new TypeError("config.onEncoderConfig, when provided, must be a function.");PA(e.codec,e)},PA=(e,t)=>{if(!t||"object"!=typeof t)throw new TypeError("Encoding options must be an object.");if(void 0!==t.bitrateMode&&!["constant","variable"].includes(t.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(void 0!==t.fullCodecString&&"string"!=typeof t.fullCodecString)throw new TypeError("fullCodecString, when provided, must be a string.");if(void 0!==t.fullCodecString&&wv(t.fullCodecString)!==e)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${e}).`)},OA=e=>{const t=e.bitrate instanceof NA?e.bitrate._toAudioBitrate(e.codec):e.bitrate;return{codec:e.fullCodecString??dv(e.codec,e.numberOfChannels,e.sampleRate),numberOfChannels:e.numberOfChannels,sampleRate:e.sampleRate,bitrate:t,bitrateMode:e.bitrateMode,...(n=e.codec,"aac"===n?{aac:{format:"aac"}}:"opus"===n?{opus:{format:"opus"}}:{})};var n};class NA{constructor(e){this._factor=e}_toVideoBitrate(e,t,n){const r=t*n,s=3e6*Math.pow(r/2073600,.95)*{avc:1,hevc:.6,vp9:.6,av1:.4,vp8:1.2}[e]*this._factor;return 1e3*Math.ceil(s/1e3)}_toAudioBitrate(e){if(Q_.includes(e)||"flac"===e)return;const t={aac:128e3,opus:64e3,mp3:16e4,vorbis:64e3}[e];if(!t)throw new Error(`Unhandled codec: ${e}`);let n=t*this._factor;if("aac"===e){n=[96e3,128e3,16e4,192e3].reduce((e,t)=>Math.abs(t-n)<Math.abs(e-n)?t:e)}else if("opus"===e||"vorbis"===e)n=Math.max(6e3,n);else if("mp3"===e){n=[8e3,16e3,24e3,32e3,4e4,48e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4].reduce((e,t)=>Math.abs(t-n)<Math.abs(e-n)?t:e)}return 1e3*Math.round(n/1e3)}}const RA=new NA(.6),MA=new NA(1),DA=new NA(2),FA=new NA(4),LA=async(e,t={})=>{const{width:n=1280,height:r=720,bitrate:s=1e6,...i}=t;if(!Y_.includes(e))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("width must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("height must be a positive integer.");if(!(s instanceof NA)&&(!Number.isInteger(s)||s<=0))throw new TypeError("bitrate must be a positive integer or a quality.");IA(e,i);let a=null;if(cS.length>0&&(a??=xA({codec:e,width:n,height:r,bitrate:s,framerate:void 0,...i}),cS.some(t=>t.supports(e,a))))return!0;if("undefined"==typeof VideoEncoder)return!1;if((n%2==1||r%2==1)&&("avc"===e||"hevc"===e))return!1;a??=xA({codec:e,width:n,height:r,bitrate:s,framerate:void 0,...i,alpha:"discard"});return!0===(await VideoEncoder.isConfigSupported(a)).supported},BA=async(e=Z_,t)=>{const n=await Promise.all(e.map(e=>(async(e,t={})=>{const{numberOfChannels:n=2,sampleRate:r=48e3,bitrate:s=128e3,...i}=t;if(!Z_.includes(e))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("numberOfChannels must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("sampleRate must be a positive integer.");if(!(s instanceof NA)&&(!Number.isInteger(s)||s<=0))throw new TypeError("bitrate must be a positive integer.");PA(e,i);let a=null;return!!(lS.length>0&&(a??=OA({codec:e,numberOfChannels:n,sampleRate:r,bitrate:s,...i}),lS.some(t=>t.supports(e,a))))||(!!Q_.includes(e)||"undefined"!=typeof AudioEncoder&&(a??=OA({codec:e,numberOfChannels:n,sampleRate:r,bitrate:s,...i}),!0===(await AudioEncoder.isConfigSupported(a)).supported))})(e,t)));return e.filter((e,t)=>n[t])};class zA{constructor(){this._connectedTrack=null,this._closingPromise=null,this._closed=!1,this._timestampOffset=0}_ensureValidAdd(){if(!this._connectedTrack)throw new Error("Source is not connected to an output track.");if("canceled"===this._connectedTrack.output.state)throw new Error("Output has been canceled.");if("finalizing"===this._connectedTrack.output.state||"finalized"===this._connectedTrack.output.state)throw new Error("Output has been finalized.");if("pending"===this._connectedTrack.output.state)throw new Error("Output has not started.");if(this._closed)throw new Error("Source is closed.")}async _start(){}async _flushAndClose(e){}close(){if(this._closingPromise)return;const e=this._connectedTrack;if(!e)throw new Error("Cannot call close without connecting the source to an output track.");if("pending"===e.output.state)throw new Error("Cannot call close before output has been started.");this._closingPromise=(async()=>{await this._flushAndClose(!1),this._closed=!0,"finalizing"!==e.output.state&&"finalized"!==e.output.state&&e.output._muxer.onTrackClose(e)})()}async _flushOrWaitForOngoingClose(e){return this._closingPromise?this._closingPromise:this._flushAndClose(e)}}class UA extends zA{constructor(e){if(super(),this._connectedTrack=null,!Y_.includes(e))throw new TypeError(`Invalid video codec '${e}'. Must be one of: ${Y_.join(", ")}.`);this._codec=e}}class $A extends UA{constructor(e){super(e)}add(e,t){if(!(e instanceof dS))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(void 0!==t&&(!t||"object"!=typeof t))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedVideoPacket(this._connectedTrack,e,t)}}class VA{constructor(e,t){this.source=e,this.encodingConfig=t,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastMultipleOfKeyFrameInterval=-1,this.codedWidth=null,this.codedHeight=null,this.resizeCanvas=null,this.customEncoder=null,this.customEncoderCallSerializer=new D_,this.customEncoderQueueSize=0,this.alphaEncoder=null,this.splitter=null,this.splitterCreationFailed=!1,this.alphaFrameQueue=[],this.error=null,this.errorNeedsNewStack=!0}async add(e,t,n){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),null!==this.codedWidth&&null!==this.codedHeight){if(e.codedWidth!==this.codedWidth||e.codedHeight!==this.codedHeight){const n=this.encodingConfig.sizeChangeBehavior??"deny";if("passThrough"===n);else{if("deny"===n)throw new Error(`Video sample size must remain constant. Expected ${this.codedWidth}x${this.codedHeight}, got ${e.codedWidth}x${e.codedHeight}. To allow the sample size to change over time, set \`sizeChangeBehavior\` to a value other than 'strict' in the encoding options.`);{let r=!1;this.resizeCanvas||("undefined"!=typeof document?(this.resizeCanvas=document.createElement("canvas"),this.resizeCanvas.width=this.codedWidth,this.resizeCanvas.height=this.codedHeight):this.resizeCanvas=new OffscreenCanvas(this.codedWidth,this.codedHeight),r=!0);const s=this.resizeCanvas.getContext("2d",{alpha:z_()});HT(s),r||(z_()?(s.fillStyle="black",s.fillRect(0,0,this.codedWidth,this.codedHeight)):s.clearRect(0,0,this.codedWidth,this.codedHeight)),e.drawWithFit(s,{fit:n}),t&&e.close(),e=new hS(this.resizeCanvas,{timestamp:e.timestamp,duration:e.duration,rotation:e.rotation}),t=!0}}}}else this.codedWidth=e.codedWidth,this.codedHeight=e.codedHeight;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),HT(this.encoderInitialized);const s=this.encodingConfig.keyFrameInterval??5,i=Math.floor(e.timestamp/s),a={...n,keyFrame:n?.keyFrame||0===s||i!==this.lastMultipleOfKeyFrameInterval};if(this.lastMultipleOfKeyFrameInterval=i,this.customEncoder){this.customEncoderQueueSize++;const t=e.clone(),n=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(t,a)).then(()=>this.customEncoderQueueSize--).catch(e=>this.error??=e).finally(()=>{t.close()});this.customEncoderQueueSize>=4&&await n}else{HT(this.encoder);const n=e.toVideoFrame();if(this.alphaEncoder){if(!!n.format&&!n.format.includes("A")||this.splitterCreationFailed)this.alphaFrameQueue.push(null),this.encoder.encode(n,a),n.close();else{const e=n.displayWidth,t=n.displayHeight;if(!this.splitter)try{this.splitter=new jA(e,t)}catch(r){this.splitterCreationFailed=!0,this.alphaFrameQueue.push(null),this.encoder.encode(n,a),n.close()}if(this.splitter){const e=this.splitter.extractColor(n),t=this.splitter.extractAlpha(n);this.alphaFrameQueue.push(t),this.encoder.encode(e,a),e.close(),n.close()}}}else this.encoder.encode(n,a),n.close();t&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(e=>this.encoder.addEventListener("dequeue",e,{once:!0}))}await this.muxer.mutex.currentPromise}finally{t&&e.close()}}ensureEncoder(e){const t=new Error;this.ensureEncoderPromise=(async()=>{const n=xA({width:e.codedWidth,height:e.codedHeight,...this.encodingConfig,framerate:this.source._connectedTrack?.metadata.frameRate});this.encodingConfig.onEncoderConfig?.(n);const r=cS.find(e=>e.supports(this.encodingConfig.codec,n));if(r)this.customEncoder=new r,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=n,this.customEncoder.onPacket=(e,t)=>{if(!(e instanceof dS))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(void 0!==t&&(!t||"object"!=typeof t))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(e,t),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,e,t).catch(e=>{this.error??=e,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else{if("undefined"==typeof VideoEncoder)throw new Error("VideoEncoder is not supported by this browser.");n.alpha="discard","keep"===this.encodingConfig.alpha&&(n.latencyMode="quality");if((n.width%2==1||n.height%2==1)&&("avc"===this.encodingConfig.codec||"hevc"===this.encodingConfig.codec))throw new Error(`The dimensions ${n.width}x${n.height} are not supported for codec '${this.encodingConfig.codec}'; both width and height must be even numbers. Make sure to round your dimensions to the nearest even number.`);if(!(await VideoEncoder.isConfigSupported(n)).supported)throw new Error(`This specific encoder configuration (${n.codec}, ${n.bitrate} bps, ${n.width}x${n.height}, hardware acceleration: ${n.hardwareAcceleration??"no-preference"}) is not supported by this browser. Consider using another codec or changing your video parameters.`);const e=[],r=[];let s=0,i=0;const a=(e,t,n)=>{const r={};if(t){const e=new Uint8Array(t.byteLength);t.copyTo(e),r.alpha=e}const s=dS.fromEncodedChunk(e,r);this.encodingConfig.onEncodedPacket?.(s,n),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,s,n).catch(e=>{this.error??=e,this.errorNeedsNewStack=!1})};this.encoder=new VideoEncoder({output:(t,n)=>{if(!this.alphaEncoder)return void a(t,null,n);const o=this.alphaFrameQueue.shift();HT(void 0!==o),o?(this.alphaEncoder.encode(o,{keyFrame:"key"===t.type}),i++,o.close(),e.push({chunk:t,meta:n})):0===i?a(t,null,n):(r.push(s+i),e.push({chunk:t,meta:n}))},error:e=>{e.stack=t.stack,this.error??=e}}),this.encoder.configure(n),"keep"===this.encodingConfig.alpha&&(this.alphaEncoder=new VideoEncoder({output:(t,n)=>{i--;const o=e.shift();for(HT(void 0!==o),a(o.chunk,t,o.meta),s++;r.length>0&&r[0]===s;){r.shift();const t=e.shift();HT(void 0!==t),a(t.chunk,null,t.meta)}},error:e=>{e.stack=t.stack,this.error??=e}}),this.alphaEncoder.configure(n))}HT(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||(await this.encoder.flush(),await(this.alphaEncoder?.flush())),"closed"!==this.encoder.state&&this.encoder.close(),this.alphaEncoder&&"closed"!==this.alphaEncoder.state&&this.alphaEncoder.close(),this.alphaFrameQueue.forEach(e=>e?.close()),this.splitter?.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=(new Error).stack),this.error}}class jA{constructor(e,t){this.lastFrame=null,"undefined"!=typeof OffscreenCanvas?this.canvas=new OffscreenCanvas(e,t):(this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t);const n=this.canvas.getContext("webgl2",{alpha:!0});if(!n)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=n,this.colorProgram=this.createColorProgram(),this.alphaProgram=this.createAlphaProgram(),this.vao=this.createVAO(),this.sourceTexture=this.createTexture(),this.alphaResolutionLocation=this.gl.getUniformLocation(this.alphaProgram,"u_resolution"),this.gl.useProgram(this.colorProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.colorProgram,"u_sourceTexture"),0),this.gl.useProgram(this.alphaProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.alphaProgram,"u_sourceTexture"),0)}createVertexShader(){return this.createShader(this.gl.VERTEX_SHADER,"#version 300 es\n\t\t\tin vec2 a_position;\n\t\t\tin vec2 a_texCoord;\n\t\t\tout vec2 v_texCoord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = vec4(a_position, 0.0, 1.0);\n\t\t\t\tv_texCoord = a_texCoord;\n\t\t\t}\n\t\t")}createColorProgram(){const e=this.createVertexShader(),t=this.createShader(this.gl.FRAGMENT_SHADER,"#version 300 es\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform sampler2D u_sourceTexture;\n\t\t\tin vec2 v_texCoord;\n\t\t\tout vec4 fragColor;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 source = texture(u_sourceTexture, v_texCoord);\n\t\t\t\tfragColor = vec4(source.rgb, 1.0);\n\t\t\t}\n\t\t"),n=this.gl.createProgram();return this.gl.attachShader(n,e),this.gl.attachShader(n,t),this.gl.linkProgram(n),n}createAlphaProgram(){const e=this.createVertexShader(),t=this.createShader(this.gl.FRAGMENT_SHADER,"#version 300 es\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform sampler2D u_sourceTexture;\n\t\t\tuniform vec2 u_resolution; // The width and height of the canvas\n\t\t\tin vec2 v_texCoord;\n\t\t\tout vec4 fragColor;\n\n\t\t\t// This function determines the value for a single byte in the YUV stream\n\t\t\tfloat getByteValue(float byteOffset) {\n\t\t\t\tfloat width = u_resolution.x;\n\t\t\t\tfloat height = u_resolution.y;\n\n\t\t\t\tfloat yPlaneSize = width * height;\n\n\t\t\t\tif (byteOffset < yPlaneSize) {\n\t\t\t\t\t// This byte is in the luma plane. Find the corresponding pixel coordinates to sample from\n\t\t\t\t\tfloat y = floor(byteOffset / width);\n\t\t\t\t\tfloat x = mod(byteOffset, width);\n\t\t\t\t\t\n\t\t\t\t\t// Add 0.5 to sample the center of the texel\n\t\t\t\t\tvec2 sampleCoord = (vec2(x, y) + 0.5) / u_resolution;\n\t\t\t\t\t\n\t\t\t\t\t// The luma value is the alpha from the source texture\n\t\t\t\t\treturn texture(u_sourceTexture, sampleCoord).a;\n\t\t\t\t} else {\n\t\t\t\t\t// Write a fixed value for chroma and beyond\n\t\t\t\t\treturn 128.0 / 255.0;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\t// Each fragment writes 4 bytes (R, G, B, A)\n\t\t\t\tfloat pixelIndex = floor(gl_FragCoord.y) * u_resolution.x + floor(gl_FragCoord.x);\n\t\t\t\tfloat baseByteOffset = pixelIndex * 4.0;\n\n\t\t\t\tvec4 result;\n\t\t\t\tfor (int i = 0; i < 4; i++) {\n\t\t\t\t\tfloat currentByteOffset = baseByteOffset + float(i);\n\t\t\t\t\tresult[i] = getByteValue(currentByteOffset);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfragColor = result;\n\t\t\t}\n\t\t"),n=this.gl.createProgram();return this.gl.attachShader(n,e),this.gl.attachShader(n,t),this.gl.linkProgram(n),n}createShader(e,t){const n=this.gl.createShader(e);return this.gl.shaderSource(n,t),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS),n}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const t=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW);const r=this.gl.getAttribLocation(this.colorProgram,"a_position"),s=this.gl.getAttribLocation(this.colorProgram,"a_texCoord");return this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}updateTexture(e){this.lastFrame!==e&&(e.displayWidth===this.canvas.width&&e.displayHeight===this.canvas.height||(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sourceTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.lastFrame=e)}extractColor(e){return this.updateTexture(e),this.gl.useProgram(this.colorProgram),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),new VideoFrame(this.canvas,{timestamp:e.timestamp,duration:e.duration??void 0,alpha:"discard"})}extractAlpha(e){this.updateTexture(e),this.gl.useProgram(this.alphaProgram),this.gl.uniform2f(this.alphaResolutionLocation,this.canvas.width,this.canvas.height),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const{width:t,height:n}=this.canvas,r=t*n+2*(Math.ceil(t/2)*Math.ceil(n/2)),s=Math.ceil(r/(4*t));let i=new Uint8Array(4*t*s);this.gl.readPixels(0,0,t,s,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),i=i.subarray(0,r),HT(128===i[t*n]),HT(128===i[i.length-1]);const a={format:"I420",codedWidth:t,codedHeight:n,timestamp:e.timestamp,duration:e.duration??void 0,transfer:[i.buffer]};return new VideoFrame(i,a)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class WA extends UA{constructor(e){CA(e),super(e.codec),this._encoder=new VA(this,e)}add(e,t){if(!(e instanceof hS))throw new TypeError("videoSample must be a VideoSample.");return this._encoder.add(e,!1,t)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class HA extends UA{constructor(e,t){if(!("undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new TypeError("canvas must be an HTMLCanvasElement or OffscreenCanvas.");CA(t),super(t.codec),this._encoder=new VA(this,t),this._canvas=e}add(e,t=0,n){if(!Number.isFinite(e)||e<0)throw new TypeError("timestamp must be a non-negative number.");if(!Number.isFinite(t)||t<0)throw new TypeError("duration must be a non-negative number.");const r=new hS(this._canvas,{timestamp:e,duration:t});return this._encoder.add(r,!0,n)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class qA extends zA{constructor(e){if(super(),this._connectedTrack=null,!Z_.includes(e))throw new TypeError(`Invalid audio codec '${e}'. Must be one of: ${Z_.join(", ")}.`);this._codec=e}}class XA extends qA{constructor(e){super(e)}add(e,t){if(!(e instanceof dS))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(void 0!==t&&(!t||"object"!=typeof t))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedAudioPacket(this._connectedTrack,e,t)}}class GA{constructor(e,t){this.source=e,this.encodingConfig=t,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastNumberOfChannels=null,this.lastSampleRate=null,this.isPcmEncoder=!1,this.outputSampleSize=null,this.writeOutputValue=null,this.customEncoder=null,this.customEncoderCallSerializer=new D_,this.customEncoderQueueSize=0,this.error=null,this.errorNeedsNewStack=!0}async add(e,t){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),null!==this.lastNumberOfChannels&&null!==this.lastSampleRate){if(e.numberOfChannels!==this.lastNumberOfChannels||e.sampleRate!==this.lastSampleRate)throw new Error(`Audio parameters must remain constant. Expected ${this.lastNumberOfChannels} channels at ${this.lastSampleRate} Hz, got ${e.numberOfChannels} channels at ${e.sampleRate} Hz.`)}else this.lastNumberOfChannels=e.numberOfChannels,this.lastSampleRate=e.sampleRate;if(this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),HT(this.encoderInitialized),this.customEncoder){this.customEncoderQueueSize++;const t=e.clone(),n=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(t)).then(()=>this.customEncoderQueueSize--).catch(e=>this.error??=e).finally(()=>{t.close()});this.customEncoderQueueSize>=4&&await n,await this.muxer.mutex.currentPromise}else if(this.isPcmEncoder)await this.doPcmEncoding(e,t);else{HT(this.encoder);const n=e.toAudioData();this.encoder.encode(n),n.close(),t&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(e=>this.encoder.addEventListener("dequeue",e,{once:!0})),await this.muxer.mutex.currentPromise}}finally{t&&e.close()}}async doPcmEncoding(e,t){HT(this.outputSampleSize),HT(this.writeOutputValue);const{numberOfChannels:n,numberOfFrames:r,sampleRate:s,timestamp:i}=e,a=2048,o=[];for(let d=0;d<r;d+=a){const t=Math.min(a,e.numberOfFrames-d),r=t*n*this.outputSampleSize,s=new ArrayBuffer(r),i=new DataView(s);o.push({frameCount:t,view:i})}const c=e.allocationSize({planeIndex:0,format:"f32-planar"}),l=new Float32Array(c/Float32Array.BYTES_PER_ELEMENT);for(let d=0;d<n;d++){e.copyTo(l,{planeIndex:d,format:"f32-planar"});for(let e=0;e<o.length;e++){const{frameCount:t,view:r}=o[e];for(let s=0;s<t;s++)this.writeOutputValue(r,(s*n+d)*this.outputSampleSize,l[e*a+s])}}t&&e.close();const u={decoderConfig:{codec:this.encodingConfig.codec,numberOfChannels:n,sampleRate:s}};for(let d=0;d<o.length;d++){const{frameCount:e,view:t}=o[d],n=t.buffer,r=d*a,c=new dS(new Uint8Array(n),"key",i+r/s,e/s);this.encodingConfig.onEncodedPacket?.(c,u),await this.muxer.addEncodedAudioPacket(this.source._connectedTrack,c,u)}}ensureEncoder(e){const t=new Error;this.ensureEncoderPromise=(async()=>{const{numberOfChannels:n,sampleRate:r}=e,s=OA({numberOfChannels:n,sampleRate:r,...this.encodingConfig});this.encodingConfig.onEncoderConfig?.(s);const i=lS.find(e=>e.supports(this.encodingConfig.codec,s));if(i)this.customEncoder=new i,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=s,this.customEncoder.onPacket=(e,t)=>{if(!(e instanceof dS))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(void 0!==t&&(!t||"object"!=typeof t))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(e,t),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,e,t).catch(e=>{this.error??=e,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else if(Q_.includes(this.encodingConfig.codec))this.initPcmEncoder();else{if("undefined"==typeof AudioEncoder)throw new Error("AudioEncoder is not supported by this browser.");if(!(await AudioEncoder.isConfigSupported(s)).supported)throw new Error(`This specific encoder configuration (${s.codec}, ${s.bitrate} bps, ${s.numberOfChannels} channels, ${s.sampleRate} Hz) is not supported by this browser. Consider using another codec or changing your audio parameters.`);this.encoder=new AudioEncoder({output:(e,t)=>{const n=dS.fromEncodedChunk(e);this.encodingConfig.onEncodedPacket?.(n,t),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,n,t).catch(e=>{this.error??=e,this.errorNeedsNewStack=!1})},error:e=>{e.stack=t.stack,this.error??=e}}),this.encoder.configure(s)}HT(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}initPcmEncoder(){this.isPcmEncoder=!0;const e=this.encodingConfig.codec,{dataType:t,sampleSize:n,littleEndian:r}=yv(e);switch(this.outputSampleSize=n,n){case 1:"unsigned"===t?this.writeOutputValue=(e,t,n)=>e.setUint8(t,E_(127.5*(n+1),0,255)):"signed"===t?this.writeOutputValue=(e,t,n)=>{e.setInt8(t,E_(Math.round(128*n),-128,127))}:"ulaw"===t?this.writeOutputValue=(e,t,n)=>{const r=E_(Math.floor(32767*n),-32768,32767);e.setUint8(t,(e=>{let t=e,n=4096,r=0,s=12,i=0;for(t<0&&(t=-t,r=128),t+=33,t>8191&&(t=8191);(t&n)!==n&&s>=5;)n>>=1,s--;return i=t>>s-4&15,255&~(r|s-5<<4|i)})(r))}:"alaw"===t?this.writeOutputValue=(e,t,n)=>{const r=E_(Math.floor(32767*n),-32768,32767);e.setUint8(t,(e=>{let t=2048,n=0,r=11,s=0,i=e;for(i<0&&(i=-i,n=128),i>4095&&(i=4095);(i&t)!==t&&r>=5;)t>>=1,r--;return s=i>>(4===r?1:r-4)&15,85^(n|r-4<<4|s)})(r))}:HT(!1);break;case 2:"unsigned"===t?this.writeOutputValue=(e,t,n)=>e.setUint16(t,E_(32767.5*(n+1),0,65535),r):"signed"===t?this.writeOutputValue=(e,t,n)=>e.setInt16(t,E_(Math.round(32767*n),-32768,32767),r):HT(!1);break;case 3:"unsigned"===t?this.writeOutputValue=(e,t,n)=>v_(e,t,E_(8388607.5*(n+1),0,16777215),r):"signed"===t?this.writeOutputValue=(e,t,n)=>((e,t,n,r)=>{(n=E_(n,-8388608,8388607))<0&&(n=n+16777216&16777215),v_(e,t,n,r)})(e,t,E_(Math.round(8388607*n),-8388608,8388607),r):HT(!1);break;case 4:"unsigned"===t?this.writeOutputValue=(e,t,n)=>e.setUint32(t,E_(2147483647.5*(n+1),0,4294967295),r):"signed"===t?this.writeOutputValue=(e,t,n)=>e.setInt32(t,E_(Math.round(2147483647*n),-2147483648,2147483647),r):"float"===t?this.writeOutputValue=(e,t,n)=>e.setFloat32(t,n,r):HT(!1);break;case 8:"float"===t?this.writeOutputValue=(e,t,n)=>e.setFloat64(t,n,r):HT(!1);break;default:T_(n),HT(!1)}}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||await this.encoder.flush(),"closed"!==this.encoder.state&&this.encoder.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.isPcmEncoder?0:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=(new Error).stack),this.error}}class KA extends qA{constructor(e){AA(e),super(e.codec),this._encoder=new GA(this,e)}add(e){if(!(e instanceof bS))throw new TypeError("audioSample must be an AudioSample.");return this._encoder.add(e,!1)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class YA extends qA{constructor(e){AA(e),super(e.codec),this._accumulatedTime=0,this._encoder=new GA(this,e)}async add(e){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const t=bS._fromAudioBuffer(e,this._accumulatedTime);this._accumulatedTime+=e.duration;for(const n of t)await this._encoder.add(n,!0)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class QA extends zA{constructor(e){if(super(),this._connectedTrack=null,!ev.includes(e))throw new TypeError(`Invalid subtitle codec '${e}'. Must be one of: ${ev.join(", ")}.`);this._codec=e}}const JA=["video","audio","subtitle"],ZA=e=>{if(!e||"object"!=typeof e)throw new TypeError("metadata must be an object.");if(void 0!==e.languageCode&&!P_(e.languageCode))throw new TypeError("metadata.languageCode, when provided, must be a three-letter, ISO 639-2/T language code.");if(void 0!==e.name&&"string"!=typeof e.name)throw new TypeError("metadata.name, when provided, must be a string.");if(void 0!==e.maximumPacketCount&&(!Number.isInteger(e.maximumPacketCount)||e.maximumPacketCount<0))throw new TypeError("metadata.maximumPacketCount, when provided, must be a non-negative integer.")};class eP{constructor(e){if(this.state="pending",this._tracks=[],this._startPromise=null,this._cancelPromise=null,this._finalizePromise=null,this._mutex=new h_,this._metadataTags={},!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(!(e.format instanceof wA))throw new TypeError("options.format must be an OutputFormat.");if(!(e.target instanceof oA))throw new TypeError("options.target must be a Target.");if(e.target._output)throw new Error("Target is already used for another output.");e.target._output=this,this.format=e.format,this.target=e.target,this._writer=e.target._createWriter(),this._muxer=e.format._createMuxer(this)}addVideoTrack(e,t={}){if(!(e instanceof UA))throw new TypeError("source must be a VideoSource.");if(ZA(t),void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw new TypeError(`Invalid video rotation: ${t.rotation}. Has to be 0, 90, 180 or 270.`);if(!this.format.supportsVideoRotationMetadata&&t.rotation)throw new Error(`${this.format._name} does not support video rotation metadata.`);if(void 0!==t.frameRate&&(!Number.isFinite(t.frameRate)||t.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${t.frameRate}. Must be a positive number.`);this._addTrack("video",e,t)}addAudioTrack(e,t={}){if(!(e instanceof qA))throw new TypeError("source must be an AudioSource.");ZA(t),this._addTrack("audio",e,t)}addSubtitleTrack(e,t={}){if(!(e instanceof QA))throw new TypeError("source must be a SubtitleSource.");ZA(t),this._addTrack("subtitle",e,t)}setMetadataTags(e){if(K_(e),"pending"!==this.state)throw new Error("Cannot set metadata tags after output has been started or canceled.");this._metadataTags=e}_addTrack(e,t,n){if("pending"!==this.state)throw new Error("Cannot add track after output has been started or canceled.");if(t._connectedTrack)throw new Error("Source is already used for a track.");const r=this.format.getSupportedTrackCounts(),s=this._tracks.reduce((t,n)=>t+(n.type===e?1:0),0),i=r[e].max;if(s===i)throw new Error(0===i?`${this.format._name} does not support ${e} tracks.`:`${this.format._name} does not support more than ${i} ${e} track${1===i?"":"s"}.`);const a=r.total.max;if(this._tracks.length===a)throw new Error(`${this.format._name} does not support more than ${a} tracks${1===a?"":"s"} in total.`);const o={id:this._tracks.length+1,output:this,type:e,source:t,metadata:n};if("video"===o.type){const e=this.format.getSupportedVideoCodecs();if(0===e.length)throw new Error(`${this.format._name} does not support video tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw new Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported video codecs are: ${e.map(e=>`'${e}'`).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}else if("audio"===o.type){const e=this.format.getSupportedAudioCodecs();if(0===e.length)throw new Error(`${this.format._name} does not support audio tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw new Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported audio codecs are: ${e.map(e=>`'${e}'`).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}else if("subtitle"===o.type){const e=this.format.getSupportedSubtitleCodecs();if(0===e.length)throw new Error(`${this.format._name} does not support subtitle tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw new Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported subtitle codecs are: ${e.map(e=>`'${e}'`).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}this._tracks.push(o),t._connectedTrack=o}async start(){const e=this.format.getSupportedTrackCounts();for(const n of JA){const t=this._tracks.reduce((e,t)=>e+(t.type===n?1:0),0),r=e[n].min;if(t<r)throw new Error(r===e[n].max?`${this.format._name} requires exactly ${r} ${n} track${1===r?"":"s"}.`:`${this.format._name} requires at least ${r} ${n} track${1===r?"":"s"}.`)}const t=e.total.min;if(this._tracks.length<t)throw new Error(t===e.total.max?`${this.format._name} requires exactly ${t} track${1===t?"":"s"}.`:`${this.format._name} requires at least ${t} track${1===t?"":"s"}.`);if("canceled"===this.state)throw new Error("Output has been canceled.");return this._startPromise?this._startPromise:this._startPromise=(async()=>{this.state="started",this._writer.start();const e=await this._mutex.acquire();await this._muxer.start();const t=this._tracks.map(e=>e.source._start());await Promise.all(t),e()})()}getMimeType(){return this._muxer.getMimeType()}async cancel(){return this._cancelPromise?this._cancelPromise:"finalizing"!==this.state&&"finalized"!==this.state?this._cancelPromise=(async()=>{this.state="canceled";const e=await this._mutex.acquire(),t=this._tracks.map(e=>e.source._flushOrWaitForOngoingClose(!0));await Promise.all(t),await this._writer.close(),e()})():void 0}async finalize(){if("pending"===this.state)throw new Error("Cannot finalize before starting.");if("canceled"===this.state)throw new Error("Cannot finalize after canceling.");return this._finalizePromise?this._finalizePromise:this._finalizePromise=(async()=>{this.state="finalizing";const e=await this._mutex.acquire(),t=this._tracks.map(e=>e.source._flushOrWaitForOngoingClose(!1));await Promise.all(t),await this._muxer.finalize(),await this._writer.flush(),await this._writer.finalize(),this.state="finalized",e()})()}}const tP=e=>{if(void 0!==e&&(!e||"object"!=typeof e))throw new TypeError("options.video, when provided, must be an object.");if(void 0!==e?.discard&&"boolean"!=typeof e.discard)throw new TypeError("options.video.discard, when provided, must be a boolean.");if(void 0!==e?.forceTranscode&&"boolean"!=typeof e.forceTranscode)throw new TypeError("options.video.forceTranscode, when provided, must be a boolean.");if(void 0!==e?.codec&&!Y_.includes(e.codec))throw new TypeError(`options.video.codec, when provided, must be one of: ${Y_.join(", ")}.`);if(void 0!==e?.bitrate&&!(e.bitrate instanceof NA)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw new TypeError("options.video.bitrate, when provided, must be a positive integer or a quality.");if(void 0!==e?.width&&(!Number.isInteger(e.width)||e.width<=0))throw new TypeError("options.video.width, when provided, must be a positive integer.");if(void 0!==e?.height&&(!Number.isInteger(e.height)||e.height<=0))throw new TypeError("options.video.height, when provided, must be a positive integer.");if(void 0!==e?.fit&&!["fill","contain","cover"].includes(e.fit))throw new TypeError("options.video.fit, when provided, must be one of 'fill', 'contain', or 'cover'.");if(void 0!==e?.width&&void 0!==e.height&&void 0===e.fit)throw new TypeError("When both options.video.width and options.video.height are provided, options.video.fit must also be provided.");if(void 0!==e?.rotate&&![0,90,180,270].includes(e.rotate))throw new TypeError("options.video.rotate, when provided, must be 0, 90, 180 or 270.");if(void 0!==e?.crop&&fS(e.crop,"options.video."),void 0!==e?.frameRate&&(!Number.isFinite(e.frameRate)||e.frameRate<=0))throw new TypeError("options.video.frameRate, when provided, must be a finite positive number.");if(void 0!==e?.alpha&&!["discard","keep"].includes(e.alpha))throw new TypeError("options.video.alpha, when provided, must be either 'discard' or 'keep'.")},nP=e=>{if(void 0!==e&&(!e||"object"!=typeof e))throw new TypeError("options.audio, when provided, must be an object.");if(void 0!==e?.discard&&"boolean"!=typeof e.discard)throw new TypeError("options.audio.discard, when provided, must be a boolean.");if(void 0!==e?.forceTranscode&&"boolean"!=typeof e.forceTranscode)throw new TypeError("options.audio.forceTranscode, when provided, must be a boolean.");if(void 0!==e?.codec&&!Z_.includes(e.codec))throw new TypeError(`options.audio.codec, when provided, must be one of: ${Z_.join(", ")}.`);if(void 0!==e?.bitrate&&!(e.bitrate instanceof NA)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw new TypeError("options.audio.bitrate, when provided, must be a positive integer or a quality.");if(void 0!==e?.numberOfChannels&&(!Number.isInteger(e.numberOfChannels)||e.numberOfChannels<=0))throw new TypeError("options.audio.numberOfChannels, when provided, must be a positive integer.");if(void 0!==e?.sampleRate&&(!Number.isInteger(e.sampleRate)||e.sampleRate<=0))throw new TypeError("options.audio.sampleRate, when provided, must be a positive integer.")},rP=48e3;class sP{static async init(e){const t=new sP(e);return await t._init(),t}constructor(e){if(this._addedCounts={video:0,audio:0,subtitle:0},this._totalTrackCount=0,this._trackPromises=[],this._executed=!1,this._synchronizer=new iP,this._totalDuration=null,this._maxTimestamps=new Map,this._canceled=!1,this.onProgress=void 0,this._computeProgress=!1,this._lastProgress=0,this.isValid=!1,this.utilizedTracks=[],this.discardedTracks=[],!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(!(e.input instanceof ZC))throw new TypeError("options.input must be an Input.");if(!(e.output instanceof eP))throw new TypeError("options.output must be an Output.");if(e.output._tracks.length>0||Object.keys(e.output._metadataTags).length>0||"pending"!==e.output.state)throw new TypeError("options.output must be fresh: no tracks or metadata tags added and not started.");if("function"!=typeof e.video&&tP(e.video),"function"!=typeof e.audio&&nP(e.audio),void 0!==e.trim&&(!e.trim||"object"!=typeof e.trim))throw new TypeError("options.trim, when provided, must be an object.");if(void 0!==e.trim?.start&&(!Number.isFinite(e.trim.start)||e.trim.start<0))throw new TypeError("options.trim.start, when provided, must be a non-negative number.");if(void 0!==e.trim?.end&&(!Number.isFinite(e.trim.end)||e.trim.end<0))throw new TypeError("options.trim.end, when provided, must be a non-negative number.");if(void 0!==e.trim?.start&&void 0!==e.trim.end&&e.trim.start>=e.trim.end)throw new TypeError("options.trim.start must be less than options.trim.end.");if(void 0!==e.tags&&("object"!=typeof e.tags||!e.tags)&&"function"!=typeof e.tags)throw new TypeError("options.tags, when provided, must be an object or a function.");if("object"==typeof e.tags&&K_(e.tags),void 0!==e.showWarnings&&"boolean"!=typeof e.showWarnings)throw new TypeError("options.showWarnings, when provided, must be a boolean.");this._options=e,this.input=e.input,this.output=e.output,this._startTimestamp=e.trim?.start??0,this._endTimestamp=e.trim?.end??1/0;const{promise:t,resolve:n}=y_();this._started=t,this._start=n}async _init(){const e=await this.input.getTracks(),t=this.output.format.getSupportedTrackCounts();let n=1,r=1;for(const c of e){let e;c.isVideoTrack()?this._options.video&&("function"==typeof this._options.video?(e=await this._options.video(c,n),tP(e),n++):e=this._options.video):c.isAudioTrack()?this._options.audio&&("function"==typeof this._options.audio?(e=await this._options.audio(c,r),nP(e),r++):e=this._options.audio):HT(!1),e?.discard?this.discardedTracks.push({track:c,reason:"discarded_by_user"}):this._totalTrackCount!==t.total.max?this._addedCounts[c.type]!==t[c.type].max?c.isVideoTrack()?await this._processVideoTrack(c,e??{}):c.isAudioTrack()&&await this._processAudioTrack(c,e??{}):this.discardedTracks.push({track:c,reason:"max_track_count_of_type_reached"}):this.discardedTracks.push({track:c,reason:"max_track_count_reached"})}const s=await this.input.getMetadataTags();let i;if(this._options.tags){const e="function"==typeof this._options.tags?await this._options.tags(s):this._options.tags;K_(e),i=e}else i=s;const a=(await this.input.getFormat()).mimeType===this.output.format.mimeType,o=s.raw===i.raw;if(s.raw&&o&&!a&&delete i.raw,this.output.setMetadataTags(i),this.isValid=this._totalTrackCount>=t.total.min&&this._addedCounts.video>=t.video.min&&this._addedCounts.audio>=t.audio.min&&this._addedCounts.subtitle>=t.subtitle.min,this._options.showWarnings??1){const e=[],t=this.discardedTracks.filter(e=>"discarded_by_user"!==e.reason);t.length>0&&e.push("Some tracks had to be discarded from the conversion:",t),this.isValid||e.push("\n\n"+this._getInvalidityExplanation().join("")),e.length}}_getInvalidityExplanation(){const e=[];if(0===this.discardedTracks.length)e.push("Due to missing tracks, this conversion cannot be executed.");else{const t=this.discardedTracks.every(e=>"discarded_by_user"===e.reason||"no_encodable_target_codec"===e.reason);if(e.push("Due to discarded tracks, this conversion cannot be executed."),t){const t=this.discardedTracks.flatMap(e=>"discarded_by_user"===e.reason?[]:"video"===e.track.type?this.output.format.getSupportedVideoCodecs():"audio"===e.track.type?this.output.format.getSupportedAudioCodecs():this.output.format.getSupportedSubtitleCodecs());1===t.length?e.push(`\nTracks were discarded because your environment is not able to encode '${t[0]}'.`):e.push(`\nTracks were discarded because your environment is not able to encode any of the following codecs: ${t.map(e=>`'${e}'`).join(", ")}.`),t.includes("mp3")&&e.push("\nThe @mediabunny/mp3-encoder extension package provides support for encoding MP3.")}else e.push("\nCheck the discardedTracks field for more info.")}return e}async execute(){if(!this.isValid)throw new Error("Cannot execute this conversion because its output configuration is invalid. Make sure to always check the isValid field before executing a conversion.\n"+this._getInvalidityExplanation().join(""));if(this._executed)throw new Error("Conversion cannot be executed twice.");if(this._executed=!0,this.onProgress){this._computeProgress=!0,this._totalDuration=Math.min(await this.input.computeDuration()-this._startTimestamp,this._endTimestamp-this._startTimestamp);for(const e of this.utilizedTracks)this._maxTimestamps.set(e.id,0);this.onProgress?.(0)}await this.output.start(),this._start();try{await Promise.all(this._trackPromises)}catch(e){throw this._canceled||this.cancel(),e}this._canceled&&await new Promise(()=>{}),await this.output.finalize(),this._computeProgress&&this.onProgress?.(1)}async cancel(){"finalizing"!==this.output.state&&"finalized"!==this.output.state&&(this._canceled||(this._canceled=!0,await this.output.cancel()))}async _processVideoTrack(e,t){const n=e.codec;if(!n)return void this.discardedTracks.push({track:e,reason:"unknown_source_codec"});let r;const s=qT(e.rotation+(t.rotate??0)),i=this.output.format.supportsVideoRotationMetadata,[a,o]=s%180==0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],c=t.crop;c&&pS(c,a,o);const[l,u]=c?[c.width,c.height]:[a,o];let d=l,h=u;const m=d/h,p=e=>2*Math.ceil(e/2);void 0!==t.width&&void 0===t.height?(d=p(t.width),h=p(Math.round(d/m))):void 0===t.width&&void 0!==t.height?(h=p(t.height),d=p(Math.round(h*m))):void 0!==t.width&&void 0!==t.height&&(d=p(t.width),h=p(t.height));const f=await e.getFirstTimestamp(),g=!!t.forceTranscode||this._startTimestamp>0||f<0||!!t.frameRate;let b=d!==l||h!==u||0!==s&&!i||!!c;const y=t.alpha??"discard";let w=this.output.format.getSupportedVideoCodecs();if(g||t.bitrate||b||!w.includes(n)||t.codec&&t.codec!==n){if(!(await e.canDecode()))return void this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});t.codec&&(w=w.filter(e=>e===t.codec));const n=t.bitrate??DA,i=await(async(e,t)=>{for(const n of e)if(await LA(n,t))return n;return null})(w,{width:d,height:h,bitrate:n});if(!i)return void this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});const a={codec:i,bitrate:n,sizeChangeBehavior:t.fit??"passThrough",alpha:y,onEncodedPacket:t=>this._reportProgress(e.id,t.timestamp+t.duration)},o=new WA(a);if(r=o,!b){const t=new eP({format:new TA,target:new lA}),n=new WA(a);t.addVideoTrack(n),await t.start();const r=new NS(e),s=await r.getSample(f);if(s)try{await n.add(s),s.close(),await t.finalize()}catch(k){b=!0,t.cancel()}else await t.cancel()}b?this._trackPromises.push((async()=>{await this._started;const n=new RS(e,{width:d,height:h,fit:t.fit??"fill",rotation:s,crop:t.crop,poolSize:1,alpha:"keep"===y}).canvases(this._startTimestamp,this._endTimestamp),r=t.frameRate;let i=null,a=null,c=null;const l=async e=>{HT(i),HT(void 0!==r);const t=Math.round((e-a)*r);for(let n=1;n<t;n++){const e=new hS(i,{timestamp:a+n/r,duration:1/r});await o.add(e)}};for await(const{canvas:t,timestamp:s,duration:u}of n){if(this._synchronizer.shouldWait(e.id,s)&&await this._synchronizer.wait(s),this._canceled)return;let n=Math.max(s-this._startTimestamp,0);if(c=n+u,void 0!==r){const e=Math.floor(n*r)/r;if(null!==i){if(e<=a){i=t,a=e;continue}await l(e)}n=e}const d=new hS(t,{timestamp:n,duration:void 0!==r?1/r:u});await o.add(d),void 0!==r?(i=t,a=n):d.close()}i&&(HT(null!==c),HT(void 0!==r),await l(Math.floor(c*r)/r)),o.close(),this._synchronizer.closeTrack(e.id)})()):this._trackPromises.push((async()=>{await this._started;const n=new NS(e),r=t.frameRate;let s=null,i=null,a=null;const c=async e=>{HT(s),HT(void 0!==r);const t=Math.round((e-i)*r);for(let n=1;n<t;n++)s.setTimestamp(i+n/r),s.setDuration(1/r),await o.add(s);s.close()};for await(const t of n.samples(this._startTimestamp,this._endTimestamp)){if(this._synchronizer.shouldWait(e.id,t.timestamp)&&await this._synchronizer.wait(t.timestamp),this._canceled)return void s?.close();let n=Math.max(t.timestamp-this._startTimestamp,0);if(a=n+t.duration,void 0!==r){const e=Math.floor(n*r)/r;if(null!==s){if(e<=i){s.close(),s=t,i=e;continue}await c(e)}n=e,t.setDuration(1/r)}t.setTimestamp(n),await o.add(t),void 0!==r?(s=t,i=n):t.close()}s&&(HT(null!==a),HT(void 0!==r),await c(Math.floor(a*r)/r)),o.close(),this._synchronizer.closeTrack(e.id)})())}else{const t=new $A(n);r=t,this._trackPromises.push((async()=>{await this._started;const n=new CS(e),r={decoderConfig:await e.getDecoderConfig()??void 0},s=Number.isFinite(this._endTimestamp)?await n.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const i of n.packets(void 0,s,{verifyKeyPackets:!0})){if(this._synchronizer.shouldWait(e.id,i.timestamp)&&await this._synchronizer.wait(i.timestamp),this._canceled)return;"discard"===y&&(delete i.sideData.alpha,delete i.sideData.alphaByteLength),await t.add(i,r),this._reportProgress(e.id,i.timestamp+i.duration)}t.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addVideoTrack(r,{frameRate:t.frameRate,languageCode:P_(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,rotation:b?0:s}),this._addedCounts.video++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _processAudioTrack(e,t){const n=e.codec;if(!n)return void this.discardedTracks.push({track:e,reason:"unknown_source_codec"});let r;const s=e.numberOfChannels,i=e.sampleRate,a=await e.getFirstTimestamp();let o=t.numberOfChannels??s,c=t.sampleRate??i,l=o!==s||c!==i||this._startTimestamp>0||a<0,u=this.output.format.getSupportedAudioCodecs();if(t.forceTranscode||t.bitrate||l||!u.includes(n)||t.codec&&t.codec!==n){if(!(await e.canDecode()))return void this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});let n=null;t.codec&&(u=u.filter(e=>e===t.codec));const s=t.bitrate??DA,i=await BA(u,{numberOfChannels:o,sampleRate:c,bitrate:s});if(i.some(e=>J_.includes(e))||!u.some(e=>J_.includes(e))||2===o&&c===rP)n=i[0]??null;else{const e=(await BA(u,{numberOfChannels:2,sampleRate:rP,bitrate:s})).find(e=>J_.includes(e));e&&(l=!0,n=e,o=2,c=rP)}if(null===n)return void this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});if(l)r=this._resampleAudio(e,n,o,c,s);else{const t=new KA({codec:n,bitrate:s,onEncodedPacket:t=>this._reportProgress(e.id,t.timestamp+t.duration)});r=t,this._trackPromises.push((async()=>{await this._started;const n=new FS(e);for await(const r of n.samples(void 0,this._endTimestamp)){if(this._synchronizer.shouldWait(e.id,r.timestamp)&&await this._synchronizer.wait(r.timestamp),this._canceled)return;await t.add(r),r.close()}t.close(),this._synchronizer.closeTrack(e.id)})())}}else{const t=new XA(n);r=t,this._trackPromises.push((async()=>{await this._started;const n=new CS(e),r={decoderConfig:await e.getDecoderConfig()??void 0},s=Number.isFinite(this._endTimestamp)?await n.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const i of n.packets(void 0,s)){if(this._synchronizer.shouldWait(e.id,i.timestamp)&&await this._synchronizer.wait(i.timestamp),this._canceled)return;await t.add(i,r),this._reportProgress(e.id,i.timestamp+i.duration)}t.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addAudioTrack(r,{languageCode:P_(e.languageCode)?e.languageCode:void 0,name:e.name??void 0}),this._addedCounts.audio++,this._totalTrackCount++,this.utilizedTracks.push(e)}_resampleAudio(e,t,n,r,s){const i=new KA({codec:t,bitrate:s,onEncodedPacket:t=>this._reportProgress(e.id,t.timestamp+t.duration)});return this._trackPromises.push((async()=>{await this._started;const t=new aP({targetNumberOfChannels:n,targetSampleRate:r,startTime:this._startTimestamp,endTime:this._endTimestamp,onSample:e=>i.add(e)}),s=new FS(e).samples(this._startTimestamp,this._endTimestamp);for await(const n of s){if(this._synchronizer.shouldWait(e.id,n.timestamp)&&await this._synchronizer.wait(n.timestamp),this._canceled)return;await t.add(n)}await t.finalize(),i.close(),this._synchronizer.closeTrack(e.id)})()),i}_reportProgress(e,t){if(!this._computeProgress)return;HT(null!==this._totalDuration),this._maxTimestamps.set(e,Math.max(t,this._maxTimestamps.get(e)));const n=Math.min(...this._maxTimestamps.values()),r=E_(n/this._totalDuration,0,1);r!==this._lastProgress&&(this._lastProgress=r,this.onProgress?.(r))}}class iP{constructor(){this.maxTimestamps=new Map,this.resolvers=[]}computeMinAndMaybeResolve(){let e=1/0;for(const[,t]of this.maxTimestamps)e=Math.min(e,t);for(let t=0;t<this.resolvers.length;t++){const n=this.resolvers[t];n.timestamp-e<5&&(n.resolve(),this.resolvers.splice(t,1),t--)}return e}shouldWait(e,t){this.maxTimestamps.set(e,Math.max(t,this.maxTimestamps.get(e)??-1/0));return t-this.computeMinAndMaybeResolve()>=5}wait(e){const{promise:t,resolve:n}=y_();return this.resolvers.push({timestamp:e,resolve:n}),t}closeTrack(e){this.maxTimestamps.delete(e),this.computeMinAndMaybeResolve()}}class aP{constructor(e){this.sourceSampleRate=null,this.sourceNumberOfChannels=null,this.targetSampleRate=e.targetSampleRate,this.targetNumberOfChannels=e.targetNumberOfChannels,this.startTime=e.startTime,this.endTime=e.endTime,this.onSample=e.onSample,this.bufferSizeInFrames=Math.floor(5*this.targetSampleRate),this.bufferSizeInSamples=this.bufferSizeInFrames*this.targetNumberOfChannels,this.outputBuffer=new Float32Array(this.bufferSizeInSamples),this.bufferStartFrame=0,this.maxWrittenFrame=-1}doChannelMixerSetup(){HT(null!==this.sourceNumberOfChannels);const e=this.sourceNumberOfChannels,t=this.targetNumberOfChannels;this.channelMixer=1===e&&2===t?(t,n)=>t[n*e]:1===e&&4===t?(t,n,r)=>t[n*e]*+(r<2):1===e&&6===t?(t,n,r)=>t[n*e]*+(2===r):2===e&&1===t?(t,n)=>{const r=n*e;return.5*(t[r]+t[r+1])}:2===e&&4===t||2===e&&6===t?(t,n,r)=>t[n*e+r]*+(r<2):4===e&&1===t?(t,n)=>{const r=n*e;return.25*(t[r]+t[r+1]+t[r+2]+t[r+3])}:4===e&&2===t?(t,n,r)=>{const s=n*e;return.5*(t[s+r]+t[s+r+2])}:4===e&&6===t?(t,n,r)=>{const s=n*e;return r<2?t[s+r]:2===r||3===r?0:t[s+r-2]}:6===e&&1===t?(t,n)=>{const r=n*e;return Math.SQRT1_2*(t[r]+t[r+1])+t[r+2]+.5*(t[r+4]+t[r+5])}:6===e&&2===t?(t,n,r)=>{const s=n*e;return t[s+r]+Math.SQRT1_2*(t[s+2]+t[s+r+4])}:6===e&&4===t?(t,n,r)=>{const s=n*e;return r<2?t[s+r]+Math.SQRT1_2*t[s+2]:t[s+r+2]}:(t,n,r)=>r<e?t[n*e+r]:0}ensureTempBufferSize(e){let t=this.tempSourceBuffer.length;for(;t<e;)t*=2;if(t!==this.tempSourceBuffer.length){const e=new Float32Array(t);e.set(this.tempSourceBuffer),this.tempSourceBuffer=e}}async add(e){null===this.sourceSampleRate&&(this.sourceSampleRate=e.sampleRate,this.sourceNumberOfChannels=e.numberOfChannels,this.tempSourceBuffer=new Float32Array(this.sourceSampleRate*this.sourceNumberOfChannels),this.doChannelMixerSetup());const t=e.numberOfFrames*e.numberOfChannels;this.ensureTempBufferSize(t);const n=e.allocationSize({planeIndex:0,format:"f32"}),r=new Float32Array(this.tempSourceBuffer.buffer,0,n/4);e.copyTo(r,{planeIndex:0,format:"f32"});const s=e.timestamp-this.startTime,i=e.numberOfFrames/this.sourceSampleRate,a=Math.min(s+i,this.endTime-this.startTime),o=Math.floor(s*this.targetSampleRate),c=Math.ceil(a*this.targetSampleRate);for(let l=o;l<c;l++){if(l<this.bufferStartFrame)continue;for(;l>=this.bufferStartFrame+this.bufferSizeInFrames;)await this.finalizeCurrentBuffer(),this.bufferStartFrame+=this.bufferSizeInFrames;const t=l-this.bufferStartFrame;HT(t<this.bufferSizeInFrames);const n=(l/this.targetSampleRate-s)*this.sourceSampleRate,i=Math.floor(n),a=Math.ceil(n),o=n-i;for(let s=0;s<this.targetNumberOfChannels;s++){let n=0,c=0;i>=0&&i<e.numberOfFrames&&(n=this.channelMixer(r,i,s)),a>=0&&a<e.numberOfFrames&&(c=this.channelMixer(r,a,s));const l=n+o*(c-n),u=t*this.targetNumberOfChannels+s;this.outputBuffer[u]+=l}this.maxWrittenFrame=Math.max(this.maxWrittenFrame,t)}}async finalizeCurrentBuffer(){if(this.maxWrittenFrame<0)return;const e=(this.maxWrittenFrame+1)*this.targetNumberOfChannels,t=new Float32Array(e);t.set(this.outputBuffer.subarray(0,e));const n=this.bufferStartFrame/this.targetSampleRate,r=new bS({format:"f32",sampleRate:this.targetSampleRate,numberOfChannels:this.targetNumberOfChannels,timestamp:n,data:t});await this.onSample(r),this.outputBuffer.fill(0),this.maxWrittenFrame=-1}finalize(){return this.finalizeCurrentBuffer()}}function oP(e,t,n,r,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n}function cP(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}let lP=function(){const{crypto:e}=globalThis;if(e?.randomUUID)return lP=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};function uP(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const dP=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class hP extends Error{}class mP extends hP{constructor(e,t,n,r){super(`${mP.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t;const s=t;this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new fP({message:n,cause:dP(t)});const s=t?.error;return 400===e?new bP(e,s,n,r):401===e?new yP(e,s,n,r):403===e?new wP(e,s,n,r):404===e?new kP(e,s,n,r):409===e?new TP(e,s,n,r):422===e?new _P(e,s,n,r):429===e?new vP(e,s,n,r):e>=500?new SP(e,s,n,r):new mP(e,s,n,r)}}class pP extends mP{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class fP extends mP{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class gP extends fP{constructor({message:e}={}){super({message:e??"Request timed out."})}}class bP extends mP{}class yP extends mP{}class wP extends mP{}class kP extends mP{}class TP extends mP{}class _P extends mP{}class vP extends mP{}class SP extends mP{}class EP extends hP{constructor(){super("Could not parse response content as the length limit was reached")}}class CP extends hP{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class IP extends Error{constructor(e){super(e)}}const xP=/^[a-z][a-z0-9+.-]*:/i;let AP=e=>(AP=Array.isArray,AP(e)),PP=AP;function OP(e){return"object"!=typeof e?{}:e??{}}function NP(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}const RP=e=>new Promise(t=>setTimeout(t,e)),MP="5.20.3";const DP=()=>{const e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":MP,"X-Stainless-OS":LP(Deno.build.os),"X-Stainless-Arch":FP(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":MP,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":MP,"X-Stainless-OS":LP(globalThis.process.platform??"unknown"),"X-Stainless-Arch":FP(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":MP,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":MP,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const FP=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",LP=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let BP;function zP(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function UP(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return zP({start(){},async pull(e){const{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await(t.return?.())}})}function $P(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(JB){throw t.releaseLock(),JB}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const VP=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),jP="RFC3986",WP=e=>String(e),HP={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:WP};let qP=(e,t)=>(qP=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),qP(e,t));const XP=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),GP=1024;function KP(e,t){if(AP(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const YP={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},QP=function(e,t){Array.prototype.push.apply(e,AP(t)?t:[t])};let JP;const ZP={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,s)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===n)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=GP){const e=i.length>=GP?i.slice(o,o+GP):i,t=[];for(let n=0;n<e.length;++n){let r=e.charCodeAt(n);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===s&&(40===r||41===r)?t[t.length]=e.charAt(n):r<128?t[t.length]=XP[r]:r<2048?t[t.length]=XP[192|r>>6]+XP[128|63&r]:r<55296||r>=57344?t[t.length]=XP[224|r>>12]+XP[128|r>>6&63]+XP[128|63&r]:(n+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t[t.length]=XP[240|r>>18]+XP[128|r>>12&63]+XP[128|r>>6&63]+XP[128|63&r])}a+=t.join("")}return a},encodeValuesOnly:!1,format:jP,formatter:WP,indices:!1,serializeDate:e=>(JP??(JP=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1};const eO={};function tO(e,t,n,r,s,i,a,o,c,l,u,d,h,m,p,f,g,b){let y=e,w=b,k=0,T=!1;for(;void 0!==(w=w.get(eO))&&!T;){const t=w.get(e);if(k+=1,void 0!==t){if(t===k)throw new RangeError("Cyclic object value");T=!0}void 0===w.get(eO)&&(k=0)}if("function"==typeof l?y=l(t,y):y instanceof Date?y=h?.(y):"comma"===n&&AP(y)&&(y=KP(y,function(e){return e instanceof Date?h?.(e):e})),null===y){if(i)return c&&!f?c(t,ZP.encoder,g,"key",m):t;y=""}if("string"==typeof(_=y)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(y)){if(c){const e=f?t:c(t,ZP.encoder,g,"key",m);return[p?.(e)+"="+p?.(c(y,ZP.encoder,g,"value",m))]}return[p?.(t)+"="+p?.(String(y))]}var _;const v=[];if(void 0===y)return v;let S;if("comma"===n&&AP(y))f&&c&&(y=KP(y,c)),S=[{value:y.length>0?y.join(",")||null:void 0}];else if(AP(l))S=l;else{const e=Object.keys(y);S=u?e.sort(u):e}const E=o?String(t).replace(/\./g,"%2E"):String(t),C=r&&AP(y)&&1===y.length?E+"[]":E;if(s&&AP(y)&&0===y.length)return C+"[]";for(let I=0;I<S.length;++I){const t=S[I],w="object"==typeof t&&void 0!==t.value?t.value:y[t];if(a&&null===w)continue;const T=d&&o?t.replace(/\./g,"%2E"):t,_=AP(y)?"function"==typeof n?n(C,T):C:C+(d?"."+T:"["+T+"]");b.set(e,k);const E=new WeakMap;E.set(eO,b),QP(v,tO(w,_,n,r,s,i,a,o,"comma"===n&&f&&AP(y)?null:c,l,u,d,h,m,p,f,g,E))}return v}function nO(e,t={}){let n=e;const r=function(e=ZP){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||ZP.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=jP;if(void 0!==e.format){if(!qP(HP,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=HP[n];let s,i=ZP.filter;if(("function"==typeof e.filter||AP(e.filter))&&(i=e.filter),s=e.arrayFormat&&e.arrayFormat in YP?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":ZP.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=void 0===e.allowDots?1==!!e.encodeDotInKeys||ZP.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:ZP.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:ZP.allowEmptyArrays,arrayFormat:s,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:ZP.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?ZP.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:ZP.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:ZP.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:ZP.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:ZP.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:ZP.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:ZP.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:ZP.strictNullHandling}}(t);let s,i;"function"==typeof r.filter?(i=r.filter,n=i("",n)):AP(r.filter)&&(i=r.filter,s=i);const a=[];if("object"!=typeof n||null===n)return"";const o=YP[r.arrayFormat],c="comma"===o&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);const l=new WeakMap;for(let h=0;h<s.length;++h){const e=s[h];r.skipNulls&&null===n[e]||QP(a,tO(n[e],e,o,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}const u=a.join(r.delimiter);let d=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}let rO,sO;function iO(e){let t;return(rO??(t=new globalThis.TextEncoder,rO=t.encode.bind(t)))(e)}function aO(e){let t;return(sO??(t=new globalThis.TextDecoder,sO=t.decode.bind(t)))(e)}var oO,cO;class lO{constructor(){oO.set(this,void 0),cO.set(this,void 0),oP(this,oO,new Uint8Array),oP(this,cO,null)}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?iO(e):e;oP(this,oO,function(e){let t=0;for(const s of e)t+=s.length;const n=new Uint8Array(t);let r=0;for(const s of e)n.set(s,r),r+=s.length;return n}([cP(this,oO,"f"),t]));const n=[];let r;for(;null!=(r=uO(cP(this,oO,"f"),cP(this,cO,"f")));){if(r.carriage&&null==cP(this,cO,"f")){oP(this,cO,r.index);continue}if(null!=cP(this,cO,"f")&&(r.index!==cP(this,cO,"f")+1||r.carriage)){n.push(aO(cP(this,oO,"f").subarray(0,cP(this,cO,"f")-1))),oP(this,oO,cP(this,oO,"f").subarray(cP(this,cO,"f"))),oP(this,cO,null);continue}const e=null!==cP(this,cO,"f")?r.preceding-1:r.preceding,t=aO(cP(this,oO,"f").subarray(0,e));n.push(t),oP(this,oO,cP(this,oO,"f").subarray(r.index)),oP(this,cO,null)}return n}flush(){return cP(this,oO,"f").length?this.decode("\n"):[]}}function uO(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function dO(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}oO=new WeakMap,cO=new WeakMap,lO.NEWLINE_CHARS=new Set(["\n","\r"]),lO.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const hO={off:0,error:200,warn:300,info:400,debug:500},mO=(e,t,n)=>{var r,s;if(e)return r=hO,s=e,Object.prototype.hasOwnProperty.call(r,s)?e:void yO(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(hO))}`)};function pO(){}function fO(e,t,n){return!t||hO[e]>hO[n]?pO:t[e].bind(t)}const gO={error:pO,warn:pO,info:pO,debug:pO};let bO=new WeakMap;function yO(e){const t=e.logger,n=e.logLevel??"off";if(!t)return gO;const r=bO.get(t);if(r&&r[0]===n)return r[1];const s={error:fO("error",t,n),warn:fO("warn",t,n),info:fO("info",t,n),debug:fO("debug",t,n)};return bO.set(t,[n,s]),s}const wO=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var kO,TO,_O;class vO{constructor(e,t,n){this.iterator=e,kO.set(this,void 0),this.controller=t,oP(this,kO,n)}static fromSSEResponse(e,t,n){let r=!1;const s=n?yO(n):console;return new vO(async function*(){if(r)throw new hP("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const r of async function*(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new hP("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new hP("Attempted to iterate over a response with no body")}const n=new SO,r=new lO,s=$P(e.body);for await(const i of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?iO(n):n;let r,s=new Uint8Array(t.length+e.length);for(s.set(t),s.set(e,t.length),t=s;-1!==(r=dO(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(s))for(const e of r.decode(i)){const t=n.decode(e);t&&(yield t)}for(const i of r.flush()){const e=n.decode(i);e&&(yield e)}}(e,t))if(!n)if(r.data.startsWith("[DONE]"))n=!0;else if(null!==r.event&&r.event.startsWith("thread.")){let e;try{e=JSON.parse(r.data)}catch(JB){throw JB}if("error"==r.event)throw new mP(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}else{let t;try{t=JSON.parse(r.data)}catch(JB){throw s.error("Could not parse message into JSON:",r.data),s.error("From chunk:",r.raw),JB}if(t&&t.error)throw new mP(void 0,t.error,void 0,e.headers);yield t}n=!0}catch(JB){if(uP(JB))return;throw JB}finally{n||t.abort()}},t,n)}static fromReadableStream(e,t,n){let r=!1;return new vO(async function*(){if(r)throw new hP("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const t of async function*(){const t=new lO,n=$P(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(JB){if(uP(JB))return;throw JB}finally{n||t.abort()}},t,n)}[(kO=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new vO(()=>r(e),this.controller,cP(this,kO,"f")),new vO(()=>r(t),this.controller,cP(this,kO,"f"))]}toReadableStream(){const e=this;let t;return zP({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:r}=await t.next();if(r)return e.close();const s=iO(JSON.stringify(n)+"\n");e.enqueue(s)}catch(n){e.error(n)}},async cancel(){await(t.return?.())}})}}class SO{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function EO(e,t){const{response:n,requestLogID:r,retryOfRequestLogID:s,startTime:i}=t,a=await(async()=>{if(t.options.stream)return yO(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):vO.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;const r=n.headers.get("content-type"),s=r?.split(";")[0]?.trim();if(s?.includes("application/json")||s?.endsWith("+json")){return CO(await n.json(),n)}return await n.text()})();return yO(e).debug(`[${r}] response parsed`,wO({retryOfRequestLogID:s,url:n.url,status:n.status,body:a,durationMs:Date.now()-i})),a}function CO(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class IO extends Promise{constructor(e,t,n=EO){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,TO.set(this,void 0),oP(this,TO,e)}_thenUnwrap(e){return new IO(cP(this,TO,"f"),this.responsePromise,async(t,n)=>CO(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(cP(this,TO,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}TO=new WeakMap;class xO{constructor(e,t,n,r){_O.set(this,void 0),oP(this,_O,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new hP("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await cP(this,_O,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(_O=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class AO extends IO{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await EO(e,t),t.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}class PO extends xO{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class OO extends xO{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){const e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...OP(this.options.query),after:t}}:null}}class NO extends xO{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?{...this.options,query:{...OP(this.options.query),after:e}}:null}}const RO=()=>{if("undefined"==typeof File){const{process:e}=globalThis,t="string"==typeof e?.versions?.node&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function MO(e,t,n){return RO(),new File(e,t??"unknown_file",n)}function DO(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const FO=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],LO=async(e,t)=>({...e,body:await zO(e.body,t)}),BO=new WeakMap;const zO=async(e,t)=>{if(!(await function(e){const t="function"==typeof e?e:e.fetch,n=BO.get(t);if(n)return n;const r=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch{return!0}})();return BO.set(t,r),r}(t)))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>UO(n,e,t))),n},UO=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(n instanceof Response)e.append(t,MO([await n.blob()],DO(n)));else if(FO(n))e.append(t,MO([await new Response(UP(n)).blob()],DO(n)));else if((e=>e instanceof Blob&&"name"in e)(n))e.append(t,n,DO(n));else if(Array.isArray(n))await Promise.all(n.map(n=>UO(e,t+"[]",n)));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map(([n,r])=>UO(e,`${t}[${n}]`,r)))}}},$O=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function VO(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if($O(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!FO(e)){const t=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}for await(const n of e)t.push(...await VO(n))}return t}class jO{constructor(e){this._client=e}}function WO(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const HO=Object.freeze(Object.create(null)),qO=((e=WO)=>function(t,...n){if(1===t.length)return t[0];let r=!1;const s=[],i=t.reduce((t,i,a)=>{/[?#]/.test(i)&&(r=!0);const o=n[a];let c=(r?encodeURIComponent:e)(""+o);return a!==n.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??HO)??HO)?.toString)&&(c=o+"",s.push({start:t.length+i.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+i+(a===n.length?"":c)},""),a=i.split(/[?#]/,1)[0],o=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;null!==(c=o.exec(a));)s.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(s.sort((e,t)=>e.start-t.start),s.length>0){let e=0;const t=s.reduce((t,n)=>{const r=" ".repeat(n.start-e),s="^".repeat(n.length);return e=n.start+n.length,t+r+s},"");throw new hP(`Path parameters result in path with invalid segments:\n${s.map(e=>e.error).join("\n")}\n${i}\n${t}`)}return i})(WO);let XO=class extends jO{list(e,t={},n){return this._client.getAPIList(qO`/chat/completions/${e}/messages`,OO,{query:t,...n})}};function GO(e){return void 0!==e&&"function"in e&&void 0!==e.function}function KO(e){return"auto-parseable-response-format"===e?.$brand}function YO(e){return"auto-parseable-tool"===e?.$brand}function QO(e,t){const n=e.choices.map(e=>{if("length"===e.finish_reason)throw new EP;if("content_filter"===e.finish_reason)throw new CP;return tN(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>function(e,t){const n=e.tools?.find(e=>GO(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:YO(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?JO(t,e.message.content):null}}});return{...e,choices:n}}function JO(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function ZO(e,t){if(!e||!("tools"in e)||!e.tools)return!1;const n=e.tools?.find(e=>GO(e)&&e.function?.name===t.function.name);return GO(n)&&(YO(n)||n?.function.strict||!1)}function eN(e){return!!KO(e.response_format)||(e.tools?.some(e=>YO(e)||"function"===e.type&&!0===e.function.strict)??!1)}function tN(e){for(const t of e||[])if("function"!==t.type)throw new hP(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}const nN=e=>"assistant"===e?.role,rN=e=>"tool"===e?.role;var sN,iN,aN,oN,cN,lN,uN,dN,hN,mN,pN,fN,gN,bN,yN,wN,kN,TN,_N,vN,SN;class EN{constructor(){sN.add(this),this.controller=new AbortController,iN.set(this,void 0),aN.set(this,()=>{}),oN.set(this,()=>{}),cN.set(this,void 0),lN.set(this,()=>{}),uN.set(this,()=>{}),dN.set(this,{}),hN.set(this,!1),mN.set(this,!1),pN.set(this,!1),fN.set(this,!1),oP(this,iN,new Promise((e,t)=>{oP(this,aN,e),oP(this,oN,t)})),oP(this,cN,new Promise((e,t)=>{oP(this,lN,e),oP(this,uN,t)})),cP(this,iN,"f").catch(()=>{}),cP(this,cN,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},cP(this,sN,"m",gN).bind(this))},0)}_connected(){this.ended||(cP(this,aN,"f").call(this),this._emit("connect"))}get ended(){return cP(this,hN,"f")}get errored(){return cP(this,mN,"f")}get aborted(){return cP(this,pN,"f")}abort(){this.controller.abort()}on(e,t){return(cP(this,dN,"f")[e]||(cP(this,dN,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=cP(this,dN,"f")[e];if(!n)return this;const r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(cP(this,dN,"f")[e]||(cP(this,dN,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{oP(this,fN,!0),"error"!==e&&this.once("error",n),this.once(e,t)})}async done(){oP(this,fN,!0),await cP(this,cN,"f")}_emit(e,...t){if(cP(this,hN,"f"))return;"end"===e&&(oP(this,hN,!0),cP(this,lN,"f").call(this));const n=cP(this,dN,"f")[e];if(n&&(cP(this,dN,"f")[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),"abort"===e){const e=t[0];return cP(this,fN,"f")||n?.length||Promise.reject(e),cP(this,oN,"f").call(this,e),cP(this,uN,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];cP(this,fN,"f")||n?.length||Promise.reject(e),cP(this,oN,"f").call(this,e),cP(this,uN,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function CN(e){return"function"==typeof e.parse}iN=new WeakMap,aN=new WeakMap,oN=new WeakMap,cN=new WeakMap,lN=new WeakMap,uN=new WeakMap,dN=new WeakMap,hN=new WeakMap,mN=new WeakMap,pN=new WeakMap,fN=new WeakMap,sN=new WeakSet,gN=function(e){if(oP(this,mN,!0),e instanceof Error&&"AbortError"===e.name&&(e=new pP),e instanceof pP)return oP(this,pN,!0),this._emit("abort",e);if(e instanceof hP)return this._emit("error",e);if(e instanceof Error){const t=new hP(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new hP(String(e)))};const IN=10;class xN extends EN{constructor(){super(...arguments),bN.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),rN(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(nN(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionToolCall",n.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new hP("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),cP(this,bN,"m",yN).call(this)}async finalMessage(){return await this.done(),cP(this,bN,"m",wN).call(this)}async finalFunctionToolCall(){return await this.done(),cP(this,bN,"m",kN).call(this)}async finalFunctionToolCallResult(){return await this.done(),cP(this,bN,"m",TN).call(this)}async totalUsage(){return await this.done(),cP(this,bN,"m",_N).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=cP(this,bN,"m",wN).call(this);t&&this._emit("finalMessage",t);const n=cP(this,bN,"m",yN).call(this);n&&this._emit("finalContent",n);const r=cP(this,bN,"m",kN).call(this);r&&this._emit("finalFunctionToolCall",r);const s=cP(this,bN,"m",TN).call(this);null!=s&&this._emit("finalFunctionToolCallResult",s),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",cP(this,bN,"m",_N).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),cP(this,bN,"m",vN).call(this,t);const s=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(QO(s,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){const r="tool",{tool_choice:s="auto",stream:i,...a}=t,o="string"!=typeof s&&"function"===s.type&&s?.function?.name,{maxChatCompletions:c=IN}=n||{},l=t.tools.map(e=>{if(YO(e)){if(!e.$callback)throw new hP("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(const m of l)"function"===m.type&&(u[m.function.name||m.function.function.name]=m.function);const d="tools"in t?l.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){const t=await this._createChatCompletion(e,{...a,tool_choice:s,tools:d,messages:[...this.messages]},n),i=t.choices[0]?.message;if(!i)throw new hP("missing message in ChatCompletion response");if(!i.tool_calls?.length)return;for(const e of i.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:s}=e.function,i=u[n];if(!i){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(o&&o!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let a;try{a=CN(i)?await i.parse(s):s}catch(h){const e=h instanceof Error?h.message:String(h);this._addMessage({role:r,tool_call_id:t,content:e});continue}const c=await i.function(a,this),l=cP(this,bN,"m",SN).call(this,c);if(this._addMessage({role:r,tool_call_id:t,content:l}),o)return}}}}bN=new WeakSet,yN=function(){return cP(this,bN,"m",wN).call(this).content??null},wN=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(nN(t)){return{...t,content:t.content??null,refusal:t.refusal??null}}}throw new hP("stream ended without producing a ChatCompletionMessage with role=assistant")},kN=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(nN(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},TN=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(rN(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},_N=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},vN=function(e){if(null!=e.n&&e.n>1)throw new hP("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},SN=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class AN extends xN{static runTools(e,t,n){const r=new AN,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,s)),r}_addMessage(e,t=!0){super._addMessage(e,t),nN(e)&&e.content&&this._emit("content",e.content)}}const PN=1,ON=2,NN=4,RN=8,MN=16,DN=32,FN=64,LN=128,BN=256,zN=511;class UN extends Error{}class $N extends Error{}const VN=(e,t)=>{const n=e.length;let r=0;const s=e=>{throw new UN(`${e} at position ${r}`)},i=e=>{throw new $N(`${e} at position ${r}`)},a=()=>(d(),r>=n&&s("Unexpected end of input"),'"'===e[r]?o():"{"===e[r]?c():"["===e[r]?l():"null"===e.substring(r,r+4)||MN&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||DN&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||DN&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||LN&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||BN&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||FN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),o=()=>{const a=r;let o=!1;for(r++;r<n&&('"'!==e[r]||o&&"\\"===e[r-1]);)o="\\"===e[r]&&!o,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(a,++r-Number(o)))}catch(JB){i(String(JB))}else if(PN&t)try{return JSON.parse(e.substring(a,r-Number(o))+'"')}catch(JB){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{r++,d();const i={};try{for(;"}"!==e[r];){if(d(),r>=n&&RN&t)return i;const s=o();d(),r++;try{const e=a();Object.defineProperty(i,s,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(JB){if(RN&t)return i;throw JB}d(),","===e[r]&&r++}}catch(JB){if(RN&t)return i;s("Expected '}' at end of object")}return r++,i},l=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(a()),d(),","===e[r]&&r++}catch(JB){if(NN&t)return n;s("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&ON&t&&s("Not sure what '-' is");try{return JSON.parse(e)}catch(JB){if(ON&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(o){}i(String(JB))}}const a=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||ON&t||s("Unterminated number literal");try{return JSON.parse(e.substring(a,r))}catch(JB){"-"===e.substring(a,r)&&ON&t&&s("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(o){i(String(o))}}},d=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return a()},jN=e=>function(e,t=zN){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return VN(e.trim(),t)}(e,zN^ON);var WN,HN,qN,XN,GN,KN,YN,QN,JN,ZN,eR,tR;class nR extends xN{constructor(e){super(),WN.add(this),HN.set(this,void 0),qN.set(this,void 0),XN.set(this,void 0),oP(this,HN,e),oP(this,qN,[])}get currentChatCompletionSnapshot(){return cP(this,XN,"f")}static fromReadableStream(e){const t=new nR(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new nR(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),cP(this,WN,"m",GN).call(this);const s=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const i of s)cP(this,WN,"m",YN).call(this,i);if(s.controller.signal?.aborted)throw new pP;return this._addChatCompletion(cP(this,WN,"m",ZN).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),cP(this,WN,"m",GN).call(this),this._connected();const r=vO.fromReadableStream(e,this.controller);let s;for await(const i of r)s&&s!==i.id&&this._addChatCompletion(cP(this,WN,"m",ZN).call(this)),cP(this,WN,"m",YN).call(this,i),s=i.id;if(r.controller.signal?.aborted)throw new pP;return this._addChatCompletion(cP(this,WN,"m",ZN).call(this))}[(HN=new WeakMap,qN=new WeakMap,XN=new WeakMap,WN=new WeakSet,GN=function(){this.ended||oP(this,XN,void 0)},KN=function(e){let t=cP(this,qN,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},cP(this,qN,"f")[e.index]=t,t)},YN=function(e){if(this.ended)return;const t=cP(this,WN,"m",tR).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=cP(this,WN,"m",KN).call(this,e);e.finish_reason&&(cP(this,WN,"m",JN).call(this,e),null!=r.current_tool_call_index&&cP(this,WN,"m",QN).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(cP(this,WN,"m",JN).call(this,e),null!=r.current_tool_call_index&&cP(this,WN,"m",QN).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&("function"===n?.type?this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):sR(n?.type))}}},QN=function(e,t){if(cP(this,WN,"m",KN).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=cP(this,HN,"f")?.tools?.find(e=>GO(e)&&e.function.name===n.function.name);this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:YO(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},JN=function(e){const t=cP(this,WN,"m",KN).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=cP(this,WN,"m",eR).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},ZN=function(){if(this.ended)throw new hP("stream has ended, this shouldn't happen");const e=cP(this,XN,"f");if(!e)throw new hP("request ended without sending any chunks");return oP(this,XN,void 0),oP(this,qN,[]),function(e,t){const{id:n,choices:r,created:s,model:i,system_fingerprint:a,...o}=e,c={...o,id:n,choices:r.map(({message:t,finish_reason:n,index:r,logprobs:s,...i})=>{if(!n)throw new hP(`missing finish_reason for choice ${r}`);const{content:a=null,function_call:o,tool_calls:c,...l}=t,u=t.role;if(!u)throw new hP(`missing role for choice ${r}`);if(o){const{arguments:e,name:c}=o;if(null==e)throw new hP(`missing function_call.arguments for choice ${r}`);if(!c)throw new hP(`missing function_call.name for choice ${r}`);return{...i,message:{content:a,function_call:{arguments:e,name:c},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:s}}return c?{...i,index:r,finish_reason:n,logprobs:s,message:{...l,role:u,content:a,refusal:t.refusal??null,tool_calls:c.map((t,n)=>{const{function:s,type:i,id:a,...o}=t,{arguments:c,name:l,...u}=s||{};if(null==a)throw new hP(`missing choices[${r}].tool_calls[${n}].id\n${rR(e)}`);if(null==i)throw new hP(`missing choices[${r}].tool_calls[${n}].type\n${rR(e)}`);if(null==l)throw new hP(`missing choices[${r}].tool_calls[${n}].function.name\n${rR(e)}`);if(null==c)throw new hP(`missing choices[${r}].tool_calls[${n}].function.arguments\n${rR(e)}`);return{...o,id:a,type:i,function:{...u,name:l,arguments:c}}})}}:{...i,message:{...l,content:a,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:s}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return function(e,t){return t&&eN(t)?QO(e,t):{...e,choices:e.choices.map(e=>(tN(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(c,t)}(e,cP(this,HN,"f"))},eR=function(){const e=cP(this,HN,"f")?.response_format;return KO(e)?e:null},tR=function(e){var t,n,r,s;let i=cP(this,XN,"f");const{choices:a,...o}=e;i?Object.assign(i,o):i=oP(this,XN,{...o,choices:[]});for(const{delta:c,finish_reason:l,index:u,logprobs:d=null,...h}of e.choices){let e=i.choices[u];if(e||(e=i.choices[u]={finish_reason:l,index:u,message:{},logprobs:d,...h}),d)if(e.logprobs){const{content:r,refusal:s,...i}=d;Object.assign(e.logprobs,i),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),s&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...s))}else e.logprobs=Object.assign({},d);if(l&&(e.finish_reason=l,cP(this,HN,"f")&&eN(cP(this,HN,"f")))){if("length"===l)throw new EP;if("content_filter"===l)throw new CP}if(Object.assign(e,h),!c)continue;const{content:a,refusal:o,function_call:m,role:p,tool_calls:f,...g}=c;if(Object.assign(e.message,g),o&&(e.message.refusal=(e.message.refusal||"")+o),p&&(e.message.role=p),m&&(e.message.function_call?(m.name&&(e.message.function_call.name=m.name),m.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=m.arguments)):e.message.function_call=m),a&&(e.message.content=(e.message.content||"")+a,!e.message.refusal&&cP(this,WN,"m",eR).call(this)&&(e.message.parsed=jN(e.message.content))),f){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:i,...a}of f){const o=(s=e.message.tool_calls)[t]??(s[t]={});Object.assign(o,a),n&&(o.id=n),r&&(o.type=r),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,ZO(cP(this,HN,"f"),o)&&(o.function.parsed_arguments=jN(o.function.arguments)))}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new vO(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function rR(e){return JSON.stringify(e)}function sR(e){}class iR extends nR{static fromReadableStream(e){const t=new iR(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new iR(t),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,s)),r}}let aR=class extends jO{constructor(){super(...arguments),this.messages=new XO(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(qO`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(qO`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",OO,{query:e,...t})}delete(e,t){return this._client.delete(qO`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new hP(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new hP(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>QO(t,e))}runTools(e,t){return e.stream?iR.runTools(this._client,e,t):AN.runTools(this._client,e,t)}stream(e,t){return nR.createChatCompletion(this._client,e,t)}};aR.Messages=XO;class oR extends jO{constructor(){super(...arguments),this.completions=new aR(this._client)}}oR.Completions=aR;const cR=Symbol("brand.privateNullableHeaders");function*lR(e){if(!e)return;if(cR in e){const{values:t,nulls:n}=e;yield*t.entries();for(const e of n)yield[e,null];return}let t,n=!1;e instanceof Headers?t=e.entries():PP(e)?t=e:(n=!0,t=Object.entries(e??{}));for(let r of t){const e=r[0];if("string"!=typeof e)throw new TypeError("expected header name to be a string");const t=PP(r[1])?r[1]:[r[1]];let s=!1;for(const r of t)void 0!==r&&(n&&!s&&(s=!0,yield[e,null]),yield[e,r])}}const uR=e=>{const t=new Headers,n=new Set;for(const r of e){const e=new Set;for(const[s,i]of lR(r)){const r=s.toLowerCase();e.has(r)||(t.delete(s),e.add(r)),null===i?(t.delete(s),n.add(r)):(t.append(s,i),n.delete(r))}}return{[cR]:!0,values:t,nulls:n}};class dR extends jO{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:uR([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class hR extends jO{create(e,t){return this._client.post("/audio/transcriptions",LO({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class mR extends jO{create(e,t){return this._client.post("/audio/translations",LO({body:e,...t,__metadata:{model:e.model}},this._client))}}class pR extends jO{constructor(){super(...arguments),this.transcriptions=new hR(this._client),this.translations=new mR(this._client),this.speech=new dR(this._client)}}pR.Transcriptions=hR,pR.Translations=mR,pR.Speech=dR;class fR extends jO{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(qO`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",OO,{query:e,...t})}cancel(e,t){return this._client.post(qO`/batches/${e}/cancel`,t)}}class gR extends jO{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(qO`/assistants/${e}`,{...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(qO`/assistants/${e}`,{body:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",OO,{query:e,...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(qO`/assistants/${e}`,{...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class bR extends jO{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class yR extends jO{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}let wR=class extends jO{constructor(){super(...arguments),this.sessions=new bR(this._client),this.transcriptionSessions=new yR(this._client)}};wR.Sessions=bR,wR.TranscriptionSessions=yR;class kR extends jO{create(e,t,n){return this._client.post(qO`/threads/${e}/messages`,{body:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(qO`/threads/${r}/messages/${e}`,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...s}=t;return this._client.post(qO`/threads/${r}/messages/${e}`,{body:s,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(qO`/threads/${e}/messages`,OO,{query:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{thread_id:r}=t;return this._client.delete(qO`/threads/${r}/messages/${e}`,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class TR extends jO{retrieve(e,t,n){const{thread_id:r,run_id:s,...i}=t;return this._client.get(qO`/threads/${r}/runs/${s}/steps/${e}`,{query:i,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){const{thread_id:r,...s}=t;return this._client.getAPIList(qO`/threads/${r}/runs/${e}/steps`,OO,{query:s,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}var _R={};const vR=e=>void 0!==globalThis.process?_R?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;var SR,ER,CR,IR,xR,AR,PR,OR,NR,RR,MR,DR,FR,LR,BR,zR,UR,$R,VR,jR,WR,HR,qR;class XR extends EN{constructor(){super(...arguments),SR.add(this),CR.set(this,[]),IR.set(this,{}),xR.set(this,{}),AR.set(this,void 0),PR.set(this,void 0),OR.set(this,void 0),NR.set(this,void 0),RR.set(this,void 0),MR.set(this,void 0),DR.set(this,void 0),FR.set(this,void 0),LR.set(this,void 0)}[(CR=new WeakMap,IR=new WeakMap,xR=new WeakMap,AR=new WeakMap,PR=new WeakMap,OR=new WeakMap,NR=new WeakMap,RR=new WeakMap,MR=new WeakMap,DR=new WeakMap,FR=new WeakMap,LR=new WeakMap,SR=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new ER;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=vO.fromReadableStream(e,this.controller);for await(const s of r)cP(this,SR,"m",BR).call(this,s);if(r.controller.signal?.aborted)throw new pP;return this._addRun(cP(this,SR,"m",zR).call(this))}toReadableStream(){return new vO(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const s=new ER;return s._run(()=>s._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,t,n,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},a=await e.submitToolOutputs(t,i,{...r,signal:this.controller.signal});this._connected();for await(const o of a)cP(this,SR,"m",BR).call(this,o);if(a.controller.signal?.aborted)throw new pP;return this._addRun(cP(this,SR,"m",zR).call(this))}static createThreadAssistantStream(e,t,n){const r=new ER;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const s=new ER;return s._run(()=>s._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return cP(this,DR,"f")}currentRun(){return cP(this,FR,"f")}currentMessageSnapshot(){return cP(this,AR,"f")}currentRunStepSnapshot(){return cP(this,LR,"f")}async finalRunSteps(){return await this.done(),Object.values(cP(this,IR,"f"))}async finalMessages(){return await this.done(),Object.values(cP(this,xR,"f"))}async finalRun(){if(await this.done(),!cP(this,PR,"f"))throw Error("Final run was not received.");return cP(this,PR,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const s={...t,stream:!0},i=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(const a of i)cP(this,SR,"m",BR).call(this,a);if(i.controller.signal?.aborted)throw new pP;return this._addRun(cP(this,SR,"m",zR).call(this))}async _createAssistantStream(e,t,n,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},a=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const o of a)cP(this,SR,"m",BR).call(this,o);if(a.controller.signal?.aborted)throw new pP;return this._addRun(cP(this,SR,"m",zR).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!NP(t)||!NP(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...r);continue}for(const e of r){if(!NP(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}ER=XR,BR=function(e){if(!this.ended)switch(oP(this,DR,e),cP(this,SR,"m",VR).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":cP(this,SR,"m",qR).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":cP(this,SR,"m",$R).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":cP(this,SR,"m",UR).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},zR=function(){if(this.ended)throw new hP("stream has ended, this shouldn't happen");if(!cP(this,PR,"f"))throw Error("Final run has not been received");return cP(this,PR,"f")},UR=function(e){const[t,n]=cP(this,SR,"m",WR).call(this,e,cP(this,AR,"f"));oP(this,AR,t),cP(this,xR,"f")[t.id]=t;for(const r of n){const e=t.content[r.index];"text"==e?.type&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=cP(this,OR,"f")){if(cP(this,NR,"f"))switch(cP(this,NR,"f").type){case"text":this._emit("textDone",cP(this,NR,"f").text,cP(this,AR,"f"));break;case"image_file":this._emit("imageFileDone",cP(this,NR,"f").image_file,cP(this,AR,"f"))}oP(this,OR,n.index)}oP(this,NR,t.content[n.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==cP(this,OR,"f")){const t=e.data.content[cP(this,OR,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,cP(this,AR,"f"));break;case"text":this._emit("textDone",t.text,cP(this,AR,"f"))}}cP(this,AR,"f")&&this._emit("messageDone",e.data),oP(this,AR,void 0)}},$R=function(e){const t=cP(this,SR,"m",jR).call(this,e);switch(oP(this,LR,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==cP(this,RR,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(cP(this,MR,"f")&&this._emit("toolCallDone",cP(this,MR,"f")),oP(this,RR,e.index),oP(this,MR,t.step_details.tool_calls[e.index]),cP(this,MR,"f")&&this._emit("toolCallCreated",cP(this,MR,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":oP(this,LR,void 0);"tool_calls"==e.data.step_details.type&&cP(this,MR,"f")&&(this._emit("toolCallDone",cP(this,MR,"f")),oP(this,MR,void 0)),this._emit("runStepDone",e.data,t)}},VR=function(e){cP(this,CR,"f").push(e),this._emit("event",e)},jR=function(e){switch(e.event){case"thread.run.step.created":return cP(this,IR,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=cP(this,IR,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=ER.accumulateDelta(t,n.delta);cP(this,IR,"f")[e.data.id]=r}return cP(this,IR,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":cP(this,IR,"f")[e.data.id]=e.data}if(cP(this,IR,"f")[e.data.id])return cP(this,IR,"f")[e.data.id];throw new Error("No snapshot available")},WR=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=cP(this,SR,"m",HR).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},HR=function(e,t){return ER.accumulateDelta(t,e)},qR=function(e){switch(oP(this,FR,e.data),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":oP(this,PR,e.data),cP(this,MR,"f")&&(this._emit("toolCallDone",cP(this,MR,"f")),oP(this,MR,void 0))}};let GR=class extends jO{constructor(){super(...arguments),this.steps=new TR(this._client)}create(e,t,n){const{include:r,...s}=t;return this._client.post(qO`/threads/${e}/runs`,{query:{include:r},body:s,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(qO`/threads/${r}/runs/${e}`,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...s}=t;return this._client.post(qO`/threads/${r}/runs/${e}`,{body:s,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(qO`/threads/${e}/runs`,OO,{query:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{thread_id:r}=t;return this._client.post(qO`/threads/${r}/runs/${e}/cancel`,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return XR.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r=uR([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:s,response:i}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=i.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await RP(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,n){return XR.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:r,...s}=t;return this._client.post(qO`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:s,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return XR.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};GR.Steps=TR;class KR extends jO{constructor(){super(...arguments),this.runs=new GR(this._client),this.messages=new kR(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(qO`/threads/${e}`,{...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(qO`/threads/${e}`,{body:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(qO`/threads/${e}`,{...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return XR.createThreadAssistantStream(e,this._client.beta.threads,t)}}KR.Runs=GR,KR.Messages=kR;class YR extends jO{constructor(){super(...arguments),this.realtime=new wR(this._client),this.assistants=new gR(this._client),this.threads=new KR(this._client)}}YR.Realtime=wR,YR.Assistants=gR,YR.Threads=KR;class QR extends jO{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class JR extends jO{retrieve(e,t,n){const{container_id:r}=t;return this._client.get(qO`/containers/${r}/files/${e}/content`,{...n,headers:uR([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}let ZR=class extends jO{constructor(){super(...arguments),this.content=new JR(this._client)}create(e,t,n){return this._client.post(qO`/containers/${e}/files`,LO({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get(qO`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(qO`/containers/${e}/files`,OO,{query:t,...n})}delete(e,t,n){const{container_id:r}=t;return this._client.delete(qO`/containers/${r}/files/${e}`,{...n,headers:uR([{Accept:"*/*"},n?.headers])})}};ZR.Content=JR;class eM extends jO{constructor(){super(...arguments),this.files=new ZR(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(qO`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",OO,{query:e,...t})}delete(e,t){return this._client.delete(qO`/containers/${e}`,{...t,headers:uR([{Accept:"*/*"},t?.headers])})}}eM.Files=ZR;class tM extends jO{create(e,t,n){const{include:r,...s}=t;return this._client.post(qO`/conversations/${e}/items`,{query:{include:r},body:s,...n})}retrieve(e,t,n){const{conversation_id:r,...s}=t;return this._client.get(qO`/conversations/${r}/items/${e}`,{query:s,...n})}list(e,t={},n){return this._client.getAPIList(qO`/conversations/${e}/items`,NO,{query:t,...n})}delete(e,t,n){const{conversation_id:r}=t;return this._client.delete(qO`/conversations/${r}/items/${e}`,n)}}class nM extends jO{constructor(){super(...arguments),this.items=new tM(this._client)}create(e,t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(qO`/conversations/${e}`,t)}update(e,t,n){return this._client.post(qO`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(qO`/conversations/${e}`,t)}}nM.Items=tM;class rM extends jO{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&yO(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const s=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?s:(yO(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)}),e)))}}class sM extends jO{retrieve(e,t,n){const{eval_id:r,run_id:s}=t;return this._client.get(qO`/evals/${r}/runs/${s}/output_items/${e}`,n)}list(e,t,n){const{eval_id:r,...s}=t;return this._client.getAPIList(qO`/evals/${r}/runs/${e}/output_items`,OO,{query:s,...n})}}class iM extends jO{constructor(){super(...arguments),this.outputItems=new sM(this._client)}create(e,t,n){return this._client.post(qO`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get(qO`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(qO`/evals/${e}/runs`,OO,{query:t,...n})}delete(e,t,n){const{eval_id:r}=t;return this._client.delete(qO`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post(qO`/evals/${r}/runs/${e}`,n)}}iM.OutputItems=sM;class aM extends jO{constructor(){super(...arguments),this.runs=new iM(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(qO`/evals/${e}`,t)}update(e,t,n){return this._client.post(qO`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",OO,{query:e,...t})}delete(e,t){return this._client.delete(qO`/evals/${e}`,t)}}aM.Runs=iM;let oM=class extends jO{create(e,t){return this._client.post("/files",LO({body:e,...t},this._client))}retrieve(e,t){return this._client.get(qO`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",OO,{query:e,...t})}delete(e,t){return this._client.delete(qO`/files/${e}`,t)}content(e,t){return this._client.get(qO`/files/${e}/content`,{...t,headers:uR([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),s=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await RP(t),i=await this.retrieve(e),Date.now()-s>n)throw new gP({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class cM extends jO{}let lM=class extends jO{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class uM extends jO{constructor(){super(...arguments),this.graders=new lM(this._client)}}uM.Graders=lM;class dM extends jO{create(e,t,n){return this._client.getAPIList(qO`/fine_tuning/checkpoints/${e}/permissions`,PO,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(qO`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(qO`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}let hM=class extends jO{constructor(){super(...arguments),this.permissions=new dM(this._client)}};hM.Permissions=dM;class mM extends jO{list(e,t={},n){return this._client.getAPIList(qO`/fine_tuning/jobs/${e}/checkpoints`,OO,{query:t,...n})}}class pM extends jO{constructor(){super(...arguments),this.checkpoints=new mM(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(qO`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",OO,{query:e,...t})}cancel(e,t){return this._client.post(qO`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(qO`/fine_tuning/jobs/${e}/events`,OO,{query:t,...n})}pause(e,t){return this._client.post(qO`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(qO`/fine_tuning/jobs/${e}/resume`,t)}}pM.Checkpoints=mM;class fM extends jO{constructor(){super(...arguments),this.methods=new cM(this._client),this.jobs=new pM(this._client),this.checkpoints=new hM(this._client),this.alpha=new uM(this._client)}}fM.Methods=cM,fM.Jobs=pM,fM.Checkpoints=hM,fM.Alpha=uM;class gM extends jO{}class bM extends jO{constructor(){super(...arguments),this.graderModels=new gM(this._client)}}bM.GraderModels=gM;class yM extends jO{createVariation(e,t){return this._client.post("/images/variations",LO({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",LO({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class wM extends jO{retrieve(e,t){return this._client.get(qO`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",PO,e)}delete(e,t){return this._client.delete(qO`/models/${e}`,t)}}class kM extends jO{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class TM extends jO{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class _M extends jO{constructor(){super(...arguments),this.clientSecrets=new TM(this._client)}}function vM(e,t){return t&&function(e){if(KO(e.text?.format))return!0;return!1}(t)?SM(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}function SM(e,t){const n=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:CM(t,e)};if("message"===e.type){const n=e.content.map(e=>"output_text"===e.type?{...e,parsed:EM(t,e.text)}:e);return{...e,content:n}}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||IM(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const e of r.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),r}function EM(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const n=e.text?.format;return n.$parseRaw(t)}return JSON.parse(t)}function CM(e,t){const n=(r=e.tools??[],s=t.name,r.find(e=>"function"===e.type&&e.name===s));var r,s,i;return{...t,...t,parsed_arguments:(i=n,"auto-parseable-tool"===i?.$brand?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null)}}function IM(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}var xM,AM,PM,OM,NM,RM,MM,DM;_M.ClientSecrets=TM;class FM extends EN{constructor(e){super(),xM.add(this),AM.set(this,void 0),PM.set(this,void 0),OM.set(this,void 0),oP(this,AM,e)}static createResponse(e,t,n){const r=new FM(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){const r=n?.signal;let s;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),cP(this,xM,"m",NM).call(this);let i=null;"response_id"in t?(s=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):s=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const a of s)cP(this,xM,"m",RM).call(this,a,i);if(s.controller.signal?.aborted)throw new pP;return cP(this,xM,"m",MM).call(this)}[(AM=new WeakMap,PM=new WeakMap,OM=new WeakMap,xM=new WeakSet,NM=function(){this.ended||oP(this,PM,void 0)},RM=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},r=cP(this,xM,"m",DM).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=r.output[e.output_index];if(!t)throw new hP(`missing output at index ${e.output_index}`);if("message"===t.type){const r=t.content[e.content_index];if(!r)throw new hP(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new hP(`expected content to be 'output_text', got ${r.type}`);n("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{const t=r.output[e.output_index];if(!t)throw new hP(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:n(e.type,e)}},MM=function(){if(this.ended)throw new hP("stream has ended, this shouldn't happen");const e=cP(this,PM,"f");if(!e)throw new hP("request ended without sending any events");oP(this,PM,void 0);const t=function(e,t){return vM(e,t)}(e,cP(this,AM,"f"));return oP(this,OM,t),t},DM=function(e){let t=cP(this,PM,"f");if(!t){if("response.created"!==e.type)throw new hP(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=oP(this,PM,e.response),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new hP(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new hP(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new hP(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new hP(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new hP(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":oP(this,PM,e.response)}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=cP(this,OM,"f");if(!e)throw new hP("stream ended without producing a ChatCompletion");return e}}class LM extends jO{list(e,t={},n){return this._client.getAPIList(qO`/responses/${e}/input_items`,OO,{query:t,...n})}}class BM extends jO{constructor(){super(...arguments),this.inputItems=new LM(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&IM(e),e))}retrieve(e,t={},n){return this._client.get(qO`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&IM(e),e))}delete(e,t){return this._client.delete(qO`/responses/${e}`,{...t,headers:uR([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>SM(t,e))}stream(e,t){return FM.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(qO`/responses/${e}/cancel`,t)}}BM.InputItems=LM;class zM extends jO{create(e,t,n){return this._client.post(qO`/uploads/${e}/parts`,LO({body:t,...n},this._client))}}class UM extends jO{constructor(){super(...arguments),this.parts=new zM(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(qO`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(qO`/uploads/${e}/complete`,{body:t,...n})}}UM.Parts=zM;class $M extends jO{create(e,t,n){return this._client.post(qO`/vector_stores/${e}/file_batches`,{body:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(qO`/vector_stores/${r}/file_batches/${e}`,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post(qO`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:r,...s}=t;return this._client.getAPIList(qO`/vector_stores/${r}/file_batches/${e}/files`,OO,{query:s,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){const r=uR([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:s,response:i}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(s.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=i.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await RP(e);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const s=r?.maxConcurrency??5,i=Math.min(s,t.length),a=this._client,o=t.values(),c=[...n];const l=Array(i).fill(o).map(async function(e){for(let t of e){const e=await a.files.create({file:t,purpose:"assistants"},r);c.push(e.id)}});return await(async e=>{const t=await Promise.allSettled(e),n=t.filter(e=>"rejected"===e.status);if(n.length){for(const e of n);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const s of t)"fulfilled"===s.status&&r.push(s.value);return r})(l),await this.createAndPoll(e,{file_ids:c})}}class VM extends jO{create(e,t,n){return this._client.post(qO`/vector_stores/${e}/files`,{body:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(qO`/vector_stores/${r}/files/${e}`,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{vector_store_id:r,...s}=t;return this._client.post(qO`/vector_stores/${r}/files/${e}`,{body:s,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(qO`/vector_stores/${e}/files`,OO,{query:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete(qO`/vector_stores/${r}/files/${e}`,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r=uR([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const s=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),i=s.data;switch(i.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await RP(e);break;case"failed":case"completed":return i}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList(qO`/vector_stores/${r}/files/${e}/content`,PO,{...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class jM extends jO{constructor(){super(...arguments),this.files=new VM(this._client),this.fileBatches=new $M(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(qO`/vector_stores/${e}`,{...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(qO`/vector_stores/${e}`,{body:t,...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",OO,{query:e,...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(qO`/vector_stores/${e}`,{...t,headers:uR([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(qO`/vector_stores/${e}/search`,PO,{body:t,method:"post",...n,headers:uR([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}var WM,HM,qM,XM,GM,KM,YM;jM.Files=VM,jM.FileBatches=$M;class QM extends jO{constructor(){super(...arguments),WM.add(this)}async unwrap(e,t,n=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,r=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");cP(this,WM,"m",HM).call(this,n);const s=uR([t]).values,i=cP(this,WM,"m",qM).call(this,s,"webhook-signature"),a=cP(this,WM,"m",qM).call(this,s,"webhook-timestamp"),o=cP(this,WM,"m",qM).call(this,s,"webhook-id"),c=parseInt(a,10);if(isNaN(c))throw new IP("Invalid webhook timestamp format");const l=Math.floor(Date.now()/1e3);if(l-c>r)throw new IP("Webhook timestamp is too old");if(c>l+r)throw new IP("Webhook timestamp is too new");const u=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),h=o?`${o}.${a}.${e}`:`${a}.${e}`,m=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const p of u)try{const e=Buffer.from(p,"base64");if(await crypto.subtle.verify("HMAC",m,e,(new TextEncoder).encode(h)))return}catch{continue}throw new IP("The given webhook signature does not match the expected signature")}}WM=new WeakSet,HM=function(e){if("string"!=typeof e||0===e.length)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},qM=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(null==n)throw new Error(`Missing required header: ${t}`);return n};class JM{constructor({baseURL:e=vR("OPENAI_BASE_URL"),apiKey:t=vR("OPENAI_API_KEY"),organization:n=vR("OPENAI_ORG_ID")??null,project:r=vR("OPENAI_PROJECT_ID")??null,webhookSecret:s=vR("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(XM.add(this),KM.set(this,void 0),this.completions=new QR(this),this.chat=new oR(this),this.embeddings=new rM(this),this.files=new oM(this),this.images=new yM(this),this.audio=new pR(this),this.moderations=new kM(this),this.models=new wM(this),this.fineTuning=new fM(this),this.graders=new bM(this),this.vectorStores=new jM(this),this.webhooks=new QM(this),this.beta=new YR(this),this.batches=new fR(this),this.uploads=new UM(this),this.responses=new BM(this),this.realtime=new _M(this),this.conversations=new nM(this),this.evals=new aM(this),this.containers=new eM(this),void 0===t)throw new hP("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const a={apiKey:t,organization:n,project:r,webhookSecret:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new hP("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??GM.DEFAULT_TIMEOUT,this.logger=a.logger??console;const o="warn";this.logLevel=o,this.logLevel=mO(a.logLevel,"ClientOptions.logLevel",this)??mO(vR("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),oP(this,KM,VP),this._options=a,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=n,this.project=r,this.webhookSecret=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return uR([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return nO(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${MP}`}defaultIdempotencyKey(){return`stainless-node-retry-${lP()}`}makeStatusError(e,t,n,r){return mP.generate(e,t,n,r)}async _callApiKey(){const e=this._options.apiKey;if("function"!=typeof e)return!1;let t;try{t=await e()}catch(n){if(n instanceof hP)throw n;throw new hP(`Failed to get token from 'apiKey' function: ${n.message}`,{cause:n})}if("string"!=typeof t||!t)throw new hP(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,n){const r=!cP(this,XM,"m",YM).call(this)&&n||this.baseURL,s=(e=>xP.test(e))(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(i)||(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new IO(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){const r=await e,s=r.maxRetries??this.maxRetries;null==t&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=await this.buildRequest(r,{retryCount:s-t});await this.prepareRequest(i,{url:a,options:r});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),l=void 0===n?"":`, retryOf: ${n}`,u=Date.now();if(yO(this).debug(`[${c}] sending request`,wO({retryOfRequestLogID:n,method:r.method,url:a,options:r,headers:i.headers})),r.signal?.aborted)throw new pP;const d=new AbortController,h=await this.fetchWithTimeout(a,i,o,d).catch(dP),m=Date.now();if(h instanceof globalThis.Error){const e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new pP;const s=uP(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(t)return yO(this).info(`[${c}] connection ${s?"timed out":"failed"} - ${e}`),yO(this).debug(`[${c}] connection ${s?"timed out":"failed"} (${e})`,wO({retryOfRequestLogID:n,url:a,durationMs:m-u,message:h.message})),this.retryRequest(r,t,n??c);if(yO(this).info(`[${c}] connection ${s?"timed out":"failed"} - error; no more retries left`),yO(this).debug(`[${c}] connection ${s?"timed out":"failed"} (error; no more retries left)`,wO({retryOfRequestLogID:n,url:a,durationMs:m-u,message:h.message})),s)throw new gP;throw new fP({cause:h})}const p=`[${c}${l}${[...h.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join("")}] ${i.method} ${a} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${m-u}ms`;if(!h.ok){const e=await this.shouldRetry(h);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void(await(e[Symbol.asyncIterator]().return?.()));const t=e.getReader(),n=t.cancel();t.releaseLock(),await n}(h.body),yO(this).info(`${p} - ${e}`),yO(this).debug(`[${c}] response error (${e})`,wO({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:m-u})),this.retryRequest(r,t,n??c,h.headers)}const s=e?"error; no more retries left":"error; not retryable";yO(this).info(`${p} - ${s}`);const i=await h.text().catch(e=>dP(e).message),a=(e=>{try{return JSON.parse(e)}catch(t){return}})(i),o=a?void 0:i;yO(this).debug(`[${c}] response error (${s})`,wO({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,message:o,durationMs:Date.now()-u}));throw this.makeStatusError(h.status,a,o,h.headers)}return yO(this).info(p),yO(this).debug(`[${c}] response start`,wO({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:m-u})),{response:h,options:r,controller:d,requestLogID:c,retryOfRequestLogID:n,startTime:u}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new AO(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:s,method:i,...a}=t||{};s&&s.addEventListener("abort",()=>r.abort());const o=setTimeout(()=>r.abort(),n),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,l={signal:r.signal,...c?{duplex:"half"}:{},method:"GET",...a};i&&(l.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(o)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n,r){let s;const i=r?.get("retry-after-ms");if(i){const e=parseFloat(i);Number.isNaN(e)||(s=e)}const a=r?.get("retry-after");if(a&&!s){const e=parseFloat(a);s=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(s&&0<=s&&s<6e4)){const n=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,n)}return await RP(s),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:s,query:i,defaultBaseURL:a}=n,o=this.buildURL(s,i,a);"timeout"in n&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new hP(`${e} must be an integer`);if(t<0)throw new hP(`${e} must be a positive integer`)})("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:c,body:l}=this.buildBody({options:n});return{req:{method:r,headers:await this.buildHeaders({options:e,method:r,bodyHeaders:c,retryCount:t}),...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...n.fetchOptions??{}},url:o,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let s={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);const i=uR([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...BP??(BP=DP()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=uR([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:UP(e)}:cP(this,KM,"f").call(this,{body:e,headers:n})}}GM=JM,KM=new WeakMap,XM=new WeakSet,YM=function(){return"https://api.openai.com/v1"!==this.baseURL},JM.OpenAI=GM,JM.DEFAULT_TIMEOUT=6e5,JM.OpenAIError=hP,JM.APIError=mP,JM.APIConnectionError=fP,JM.APIConnectionTimeoutError=gP,JM.APIUserAbortError=pP,JM.NotFoundError=kP,JM.ConflictError=TP,JM.RateLimitError=vP,JM.BadRequestError=bP,JM.AuthenticationError=yP,JM.InternalServerError=SP,JM.PermissionDeniedError=wP,JM.UnprocessableEntityError=_P,JM.InvalidWebhookSignatureError=IP,JM.toFile=async function(e,t,n){if(RO(),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&$O(e))(e=await e))return e instanceof File?e:MO([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),MO(await VO(r),t,n)}const r=await VO(e);if(t||(t=DO(e)),!n?.type){const e=r.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(n={...n,type:e})}return MO(r,t,n)},JM.Completions=QR,JM.Chat=oR,JM.Embeddings=rM,JM.Files=oM,JM.Images=yM,JM.Audio=pR,JM.Moderations=kM,JM.Models=wM,JM.FineTuning=fM,JM.Graders=bM,JM.VectorStores=jM,JM.Webhooks=QM,JM.Beta=YR,JM.Batches=fR,JM.Uploads=UM,JM.Responses=BM,JM.Realtime=_M,JM.Conversations=nM,JM.Evals=aM,JM.Containers=eM;var ZM,eD={exports:{}};var tD=(ZM||(ZM=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,i||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],o]:e._events[c].push(o):(e._events[c]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,a=new Array(i);s<i;s++)a[s]=r[s].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,s,i,a){var o=n?n+e:e;if(!this._events[o])return!1;var c,l,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,s),!0;case 5:return u.fn.call(u.context,t,r,s,i),!0;case 6:return u.fn.call(u.context,t,r,s,i,a),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,m=u.length;for(l=0;l<m;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,s);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},o.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,s){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||s&&!o.once||r&&o.context!==r||a(this,i);else{for(var c=0,l=[],u=o.length;c<u;c++)(o[c].fn!==t||s&&!o[c].once||r&&o[c].context!==r)&&l.push(o[c]);l.length?this._events[i]=1===l.length?l[0]:l:a(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(eD)),eD.exports);const nD=wc(tD);class rD extends Error{constructor(e){super(e),this.name="TimeoutError"}}class sD extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const iD=e=>void 0===globalThis.DOMException?new sD(e):new DOMException(e),aD=e=>{const t=void 0===e.reason?iD("This operation was aborted."):e.reason;return t instanceof Error?t:iD(t)};class oD{#e=[];enqueue(e,t){const n={priority:(t={priority:0,...t}).priority,id:t.id,run:e};if(0===this.size||this.#e[this.size-1].priority>=t.priority)return void this.#e.push(n);const r=function(e,t,n){let r=0,s=e.length;for(;s>0;){const i=Math.trunc(s/2);let a=r+i;n(e[a],t)<=0?(r=++a,s-=i+1):s=i}return r}(this.#e,n,(e,t)=>t.priority-e.priority);this.#e.splice(r,0,n)}setPriority(e,t){const n=this.#e.findIndex(t=>t.id===e);if(-1===n)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[r]=this.#e.splice(n,1);this.enqueue(r.run,{priority:t,id:e})}dequeue(){const e=this.#e.shift();return e?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this.#e.length}}class cD extends nD{#t;#n;#r=0;#s;#i;#a=0;#o;#c;#e;#l;#u=0;#d;#h;#m;#p=1n;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:oD,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#t=e.carryoverConcurrencyCount,this.#n=e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,this.#s=e.intervalCap,this.#i=e.interval,this.#e=new e.queueClass,this.#l=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#m=!0===e.throwOnTimeout,this.#h=!1===e.autoStart}get#f(){return this.#n||this.#r<this.#s}get#g(){return this.#u<this.#d}#b(){this.#u--,this.#y(),this.emit("next")}#w(){this.#k(),this.#T(),this.#c=void 0}get#_(){const e=Date.now();if(void 0===this.#o){const t=this.#a-e;if(!(t<0))return void 0===this.#c&&(this.#c=setTimeout(()=>{this.#w()},t)),!0;this.#r=this.#t?this.#u:0}return!1}#y(){if(0===this.#e.size)return this.#o&&clearInterval(this.#o),this.#o=void 0,this.emit("empty"),0===this.#u&&this.emit("idle"),!1;if(!this.#h){const e=!this.#_;if(this.#f&&this.#g){const t=this.#e.dequeue();return!!t&&(this.emit("active"),t(),e&&this.#T(),!0)}}return!1}#T(){this.#n||void 0!==this.#o||(this.#o=setInterval(()=>{this.#k()},this.#i),this.#a=Date.now()+this.#i)}#k(){0===this.#r&&0===this.#u&&this.#o&&(clearInterval(this.#o),this.#o=void 0),this.#r=this.#t?this.#u:0,this.#v()}#v(){for(;this.#y(););}get concurrency(){return this.#d}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#d=e,this.#v()}async#S(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(e.reason)},{once:!0})})}setPriority(e,t){this.#e.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#p++).toString(),t={timeout:this.timeout,throwOnTimeout:this.#m,...t},new Promise((n,r)=>{this.#e.enqueue(async()=>{this.#u++;try{t.signal?.throwIfAborted(),this.#r++;let r=e({signal:t.signal});t.timeout&&(r=function(e,t){const{milliseconds:n,fallback:r,message:s,customTimers:i={setTimeout:setTimeout,clearTimeout:clearTimeout}}=t;let a,o;const c=new Promise((c,l)=>{if("number"!=typeof n||1!==Math.sign(n))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(t.signal){const{signal:e}=t;e.aborted&&l(aD(e)),o=()=>{l(aD(e))},e.addEventListener("abort",o,{once:!0})}if(n===Number.POSITIVE_INFINITY)return void e.then(c,l);const u=new rD;a=i.setTimeout.call(void 0,()=>{if(r)try{c(r())}catch(t){l(t)}else"function"==typeof e.cancel&&e.cancel(),!1===s?c():s instanceof Error?l(s):(u.message=s??`Promise timed out after ${n} milliseconds`,l(u))},n),(async()=>{try{c(await e)}catch(t){l(t)}})()}).finally(()=>{c.clear(),o&&t.signal&&t.signal.removeEventListener("abort",o)});return c.clear=()=>{i.clearTimeout.call(void 0,a),a=void 0},c}(Promise.resolve(r),{milliseconds:t.timeout})),t.signal&&(r=Promise.race([r,this.#S(t.signal)]));const s=await r;n(s),this.emit("completed",s)}catch(s){if(s instanceof rD&&!t.throwOnTimeout)return void n();r(s),this.emit("error",s)}finally{this.#b()}},t),this.emit("add"),this.#y()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this.#h?(this.#h=!1,this.#v(),this):this}pause(){this.#h=!0}clear(){this.#e=new this.#l}async onEmpty(){0!==this.#e.size&&await this.#E("empty")}async onSizeLessThan(e){this.#e.size<e||await this.#E("next",()=>this.#e.size<e)}async onIdle(){0===this.#u&&0===this.#e.size||await this.#E("idle")}async#E(e,t){return new Promise(n=>{const r=()=>{t&&!t()||(this.off(e,r),n())};this.on(e,r)})}get size(){return this.#e.size}sizeBy(e){return this.#e.filter(e).length}get pending(){return this.#u}get isPaused(){return this.#h}}const lD=ku("music-metadata:id3v2:frame-parser"),uD="latin1";function dD(e){return"RX"===e?"Remix":"CR"===e?"Cover":e.match(/^\d*$/)?am[Number.parseInt(e)]:void 0}class hD{constructor(e,t){this.major=e,this.warningCollector=t}readData(e,t,n){if(0===e.length)return void this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${t}`);const{encoding:r,bom:s}=Bd(e,0),i=e.length;let a=0,o=[];const c=hD.getNullTerminatorLength(r);let l;switch(lD(`Parsing tag type=${t}, encoding=${r}, bom=${s}`),"TXXX"!==t&&"T"===t[0]?"T*":t){case"T*":case"GRP1":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":{let n;try{n=xd(e.slice(1),r).replace(/\x00+$/,"")}catch(u){if(u instanceof Error){this.warningCollector.addWarning(`id3v2.${this.major} type=${t} header has invalid string value: ${u.message}`);break}throw u}switch(t){case"TMCL":case"TIPL":case"IPLS":o=hD.functionList(this.splitValue(t,n));break;case"TRK":case"TRCK":case"TPOS":o=n;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":o=this.splitValue(t,n);break;case"TCO":case"TCON":o=this.splitValue(t,n).map(e=>function(e){const t=[];let n,r="";for(const s of e)if("string"==typeof n)if("("===s&&""===n)r+="(",n=void 0;else if(")"===s){""!==r&&(t.push(r),r="");const e=dD(n);e&&t.push(e),n=void 0}else n+=s;else"("===s?n="":r+=s;return r&&(0===t.length&&r.match(/^\d*$/)&&(r=dD(r)),r&&t.push(r)),t}(e)).reduce((e,t)=>e.concat(t),[]);break;case"PCS":case"PCST":o=this.major>=4?this.splitValue(t,n):[n],o=Array.isArray(o)&&""===o[0]?1:0;break;default:o=this.major>=4?this.splitValue(t,n):[n]}break}case"TXXX":{const n=hD.readIdentifierAndData(e,a+1,i,r);o={description:n.id,text:this.splitValue(t,xd(n.data,r).replace(/\x00+$/,""))};break}case"PIC":case"APIC":if(n){const t={};switch(a+=1,this.major){case 2:t.format=xd(e.slice(a,a+3),"latin1"),a+=3;break;case 3:case 4:l=Cd(e,a,i,uD),t.format=xd(e.slice(a,l),uD),a=l+1;break;default:throw function(e){throw new mD(`Unexpected majorVer: ${e}`)}(this.major)}t.format=hD.fixPictureMimeType(t.format),t.type=Nd[e[a]],a+=1,l=Cd(e,a,i,r),t.description=xd(e.slice(a,l),r),a=l+c,t.data=e.slice(a,i),o=t}break;case"CNT":case"PCNT":o=hl.get(e,0);break;case"SYLT":{const t=Vd(e,0);a+=$d;const n={descriptor:"",language:t.language,contentType:t.contentType,timeStampFormat:t.timeStampFormat,syncText:[]};let r=!1;for(;a<i;){const s=hD.readNullTerminatedString(e.subarray(a),t.encoding);if(a+=s.len,r){const t=hl.get(e,a);a+=hl.len,n.syncText.push({text:s.text,timestamp:t})}else n.descriptor=s.text,r=!0}o=n;break}case"ULT":case"USLT":case"COM":case"COMM":{const t=Ud(e,a);a+=zd;const n=hD.readNullTerminatedString(e.subarray(a),t.encoding);a+=n.len;const r=hD.readNullTerminatedString(e.subarray(a),t.encoding);o={language:t.language,descriptor:n.text,text:r.text};break}case"UFID":{const t=hD.readIdentifierAndData(e,a,i,uD);o={owner_identifier:t.id,identifier:t.data};break}case"PRIV":{const t=hD.readIdentifierAndData(e,a,i,uD);o={owner_identifier:t.id,data:t.data};break}case"POPM":{l=Cd(e,a,i,uD);const t=xd(e.slice(a,l),uD);a=l+1;const n=i-a;o={email:t,rating:al.get(e,a),counter:n>=5?hl.get(e,a+1):void 0};break}case"GEOB":{l=Cd(e,a+1,i,r);const t=xd(e.slice(a+1,l),uD);a=l+1,l=Cd(e,a,i,r);const n=xd(e.slice(a,l),uD);a=l+1,l=Cd(e,a,i,r);const s=xd(e.slice(a,l),uD);a=l+1;o={type:t,filename:n,description:s,data:e.slice(a,i)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":l=Cd(e,a+1,i,r),o=xd(e.slice(a,l),uD);break;case"WXXX":{l=Cd(e,a+1,i,r);const t=xd(e.slice(a+1,l),r);a=l+("utf-16le"===r?2:1),o={description:t,url:xd(e.slice(a,i),uD)};break}case"WFD":case"WFED":o=xd(e.slice(a+1,Cd(e,a+1,i,r)),r);break;case"MCDI":o=e.slice(0,i);break;default:lD(`Warning: unsupported id3v2-tag-type: ${t}`)}return o}static readNullTerminatedString(e,t){let n=t.bom?2:0;const r=Cd(e,n,e.length,t.encoding),s=e.slice(n,r);return n="utf-16le"===t.encoding?r+2:r+1,{text:xd(s,t.encoding),len:n}}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){const t={};for(let n=0;n+1<e.length;n+=2){const r=e[n+1].split(",");t[e[n]]=t[e[n]]?t[e[n]].concat(r):r}return t}splitValue(e,t){let n;return this.major<4?(n=t.split(/\x00/g),n.length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${e} uses non standard null-separator.`):n=t.split(/\//g)):n=t.split(/\x00/g),hD.trimArray(n)}static trimArray(e){return e.map(e=>e.replace(/\x00+$/,"").trim())}static readIdentifierAndData(e,t,n,r){const s=Cd(e,t,n,r),i=xd(e.slice(t,s),r);return t=s+hD.getNullTerminatorLength(r),{id:i,data:e.slice(t,n)}}static getNullTerminatorLength(e){return"utf-16le"===e?2:1}}class mD extends(Sd("id3v2")){}const pD=new TextDecoder("ascii");class fD{constructor(){this.tokenizer=void 0,this.id3Header=void 0,this.metadata=void 0,this.headerType=void 0,this.options=void 0}static removeUnsyncBytes(e){let t=0,n=0;for(;t<e.length-1;)t!==n&&(e[n]=e[t]),t+=255===e[t]&&0===e[t+1]?2:1,n++;return t<e.length&&(e[n++]=e[t]),e.slice(0,n)}static getFrameHeaderLength(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw gD(e)}}static readFrameFlags(e){return{status:{tag_alter_preservation:Ed(e,0,6),file_alter_preservation:Ed(e,0,5),read_only:Ed(e,0,4)},format:{grouping_identity:Ed(e,1,7),compression:Ed(e,1,3),encryption:Ed(e,1,2),unsynchronisation:Ed(e,1,1),data_length_indicator:Ed(e,1,0)}}}static readFrameData(e,t,n,r,s){const i=new hD(n,s);switch(n){case 2:return i.readData(e,t.id,r);case 3:case 4:return t.flags?.format.unsynchronisation&&(e=fD.removeUnsyncBytes(e)),t.flags?.format.data_length_indicator&&(e=e.slice(4,e.length)),i.readData(e,t.id,r);default:throw gD(n)}}static makeDescriptionTagName(e,t){return e+(t?`:${t}`:"")}async parse(e,t,n){this.tokenizer=t,this.metadata=e,this.options=n;const r=await this.tokenizer.readToken(Fd);if("ID3"!==r.fileIdentifier)throw new mD("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=r,this.headerType=`ID3v2.${r.version.major}`,r.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(r.size)}async parseExtendedHeader(){const e=await this.tokenizer.readToken(Ld),t=e.size-Ld.len;return t>0?this.parseExtendedHeaderData(t,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,t){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-t)}async parseId3Data(e){const t=await this.tokenizer.readToken(new Nl(e));for(const n of this.parseMetadata(t))if("TXXX"===n.id)n.value&&await this.handleTag(n,n.value.text,()=>n.value.description);else await(Array.isArray(n.value)?Promise.all(n.value.map(e=>this.addTag(n.id,e))):this.addTag(n.id,n.value))}async handleTag(e,t,n,r=e=>e){await Promise.all(t.map(t=>this.addTag(fD.makeDescriptionTagName(e.id,n(t)),r(t))))}async addTag(e,t){await this.metadata.addTag(this.headerType,e,t)}parseMetadata(e){let t=0;const n=[];for(;t!==e.length;){const r=fD.getFrameHeaderLength(this.id3Header.version.major);if(t+r>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const s=e.slice(t,t+r);t+=r;const i=this.readFrameHeader(s,this.id3Header.version.major),a=e.slice(t,t+i.length);t+=i.length;const o=fD.readFrameData(a,i,this.id3Header.version.major,!this.options.skipCovers,this.metadata);o&&n.push({id:i.id,value:o})}return n}readFrameHeader(e,t){let n;switch(t){case 2:n={id:pD.decode(e.slice(0,3)),length:ul.get(e,3)},n.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${n.id}`);break;case 3:case 4:n={id:pD.decode(e.slice(0,4)),length:(4===t?Dd:hl).get(e,4),flags:fD.readFrameFlags(e.slice(8,10))},n.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${n.id}`);break;default:throw gD(t)}return n}}function gD(e){throw new mD(`Unexpected majorVer: ${e}`)}const bD=ku("music-metadata:parser:ID3");class yD extends zh{constructor(){super(...arguments),this.id3parser=new fD}static async startsWithID3v2Header(e){return"ID3"===(await e.peekToken(Fd)).fileIdentifier}async parse(){try{await this.parseID3v2()}catch(e){if(!(e instanceof Hc))throw e;bD("End-of-stream")}}finalize(){}async parseID3v2(){if(await this.tryReadId3v2Headers(),bD("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny())this.finalize();else{const e=new lm(this.metadata,this.tokenizer,this.options);await e.parse(),this.finalize()}}async tryReadId3v2Headers(){if("ID3"===(await this.tokenizer.peekToken(Fd)).fileIdentifier)return bD("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}}const wD=(e,t)=>{const n=Pd(e,t,0,3),r=Pd(e,t,6,1),s=Pd(e,t,7,9)/10;if(n>0)return{type:Pd(e,t,0,3),origin:Pd(e,t,3,3),adjustment:r?-s:s}},kD={len:27,get:(e,t)=>{const n=hl.get(e,t+2);return{revision:Pd(e,t,0,4),vbr_method:Pd(e,t,4,4),lowpass_filter:100*al.get(e,t+1),track_peak:0===n?null:n/2**23,track_gain:wD(e,6),album_gain:wD(e,8),music_length:hl.get(e,t+20),music_crc:al.get(e,t+24),header_crc:cl.get(e,t+24)}}},TD=new Rl(4,"ascii"),_D=new Rl(6,"ascii"),vD={len:4,get:(e,t)=>({frames:Od(e,t,31),bytes:Od(e,t,30),toc:Od(e,t,29),vbrScale:Od(e,t,28)})};const SD=ku("music-metadata:parser:mpeg");class ED extends(Sd("MPEG")){}const CD={AudioObjectTypes:["AAC Main","AAC LC","AAC SSR","AAC LTP"],SamplingFrequencies:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,null,null,-1]},ID=[void 0,["front-center"],["front-left","front-right"],["front-center","front-left","front-right"],["front-center","front-left","front-right","back-center"],["front-center","front-left","front-right","back-left","back-right"],["front-center","front-left","front-right","back-left","back-right","LFE-channel"],["front-center","front-left","front-right","side-left","side-right","back-left","back-right","LFE-channel"]];class xD{constructor(e,t){this.bitrateIndex=null,this.sampRateFreqIndex=null,this.padding=null,this.privateBit=null,this.channelModeIndex=null,this.modeExtension=null,this.isOriginalMedia=null,this.version=null,this.bitrate=null,this.samplingRate=null,this.frameLength=0,this.versionIndex=Pd(e,t+1,3,2),this.layer=xD.LayerDescription[Pd(e,t+1,5,2)],this.versionIndex>1&&0===this.layer?this.parseAdtsHeader(e,t):this.parseMpegHeader(e,t),this.isProtectedByCRC=!Od(e,t+1,7)}calcDuration(e){return null==this.samplingRate?null:e*this.calcSamplesPerFrame()/this.samplingRate}calcSamplesPerFrame(){return xD.samplesInFrameTable[1===this.version?0:1][this.layer]}calculateSideInfoLength(){if(3!==this.layer)return 2;if(3===this.channelModeIndex){if(1===this.version)return 17;if(2===this.version||2.5===this.version)return 9}else{if(1===this.version)return 32;if(2===this.version||2.5===this.version)return 17}return null}calcSlotSize(){return[null,4,1,1][this.layer]}parseMpegHeader(e,t){this.container="MPEG",this.bitrateIndex=Pd(e,t+2,0,4),this.sampRateFreqIndex=Pd(e,t+2,4,2),this.padding=Od(e,t+2,6),this.privateBit=Od(e,t+2,7),this.channelModeIndex=Pd(e,t+3,0,2),this.modeExtension=Pd(e,t+3,2,2),this.isCopyrighted=Od(e,t+3,4),this.isOriginalMedia=Od(e,t+3,5),this.emphasis=Pd(e,t+3,7,2),this.version=xD.VersionID[this.versionIndex],this.channelMode=xD.ChannelMode[this.channelModeIndex],this.codec=`MPEG ${this.version} Layer ${this.layer}`;const n=this.calcBitrate();if(!n)throw new ED("Cannot determine bit-rate");if(this.bitrate=1e3*n,this.samplingRate=this.calcSamplingRate(),null==this.samplingRate)throw new ED("Cannot determine sampling-rate")}parseAdtsHeader(e,t){SD("layer=0 => ADTS"),this.version=2===this.versionIndex?4:2,this.container=`ADTS/MPEG-${this.version}`;const n=Pd(e,t+2,0,2);this.codec="AAC",this.codecProfile=CD.AudioObjectTypes[n],SD(`MPEG-4 audio-codec=${this.codec}`);const r=Pd(e,t+2,2,4);this.samplingRate=CD.SamplingFrequencies[r],SD(`sampling-rate=${this.samplingRate}`);const s=Pd(e,t+2,7,3);this.mp4ChannelConfig=ID[s],SD(`channel-config=${this.mp4ChannelConfig?this.mp4ChannelConfig.join("+"):"?"}`),this.frameLength=Pd(e,t+3,6,2)<<11}calcBitrate(){if(0===this.bitrateIndex||15===this.bitrateIndex)return null;if(this.version&&this.bitrateIndex){const e=10*Math.floor(this.version)+this.layer;return xD.bitrate_index[this.bitrateIndex][e]}return null}calcSamplingRate(){return 3===this.sampRateFreqIndex||null===this.version||null==this.sampRateFreqIndex?null:xD.sampling_rate_freq_index[this.version][this.sampRateFreqIndex]}}xD.SyncByte1=255,xD.SyncByte2=224,xD.VersionID=[2.5,null,2,1],xD.LayerDescription=[0,3,2,1],xD.ChannelMode=["stereo","joint_stereo","dual_channel","mono"],xD.bitrate_index={1:{11:32,12:32,13:32,21:32,22:8,23:8},2:{11:64,12:48,13:40,21:48,22:16,23:16},3:{11:96,12:56,13:48,21:56,22:24,23:24},4:{11:128,12:64,13:56,21:64,22:32,23:32},5:{11:160,12:80,13:64,21:80,22:40,23:40},6:{11:192,12:96,13:80,21:96,22:48,23:48},7:{11:224,12:112,13:96,21:112,22:56,23:56},8:{11:256,12:128,13:112,21:128,22:64,23:64},9:{11:288,12:160,13:128,21:144,22:80,23:80},10:{11:320,12:192,13:160,21:160,22:96,23:96},11:{11:352,12:224,13:192,21:176,22:112,23:112},12:{11:384,12:256,13:224,21:192,22:128,23:128},13:{11:416,12:320,13:256,21:224,22:144,23:144},14:{11:448,12:384,13:320,21:256,22:160,23:160}},xD.sampling_rate_freq_index={1:{0:44100,1:48e3,2:32e3},2:{0:22050,1:24e3,2:16e3},2.5:{0:11025,1:12e3,2:8e3}},xD.samplesInFrameTable=[[0,384,1152,1152],[0,384,1152,576]];const AD=4,PD=(e,t)=>new xD(e,t);const OD=Object.freeze(Object.defineProperty({__proto__:null,MpegContentError:ED,MpegParser:class extends yD{constructor(){super(...arguments),this.frameCount=0,this.syncFrameCount=-1,this.countSkipFrameData=0,this.totalDataLength=0,this.bitrates=[],this.offset=0,this.frame_size=0,this.crc=null,this.calculateEofDuration=!1,this.samplesPerFrame=null,this.buf_frame_header=new Uint8Array(4),this.mpegOffset=null,this.syncPeek={buf:new Uint8Array(1024),len:0}}async postId3v2Parse(){this.metadata.setFormat("lossless",!1),this.metadata.setAudioOnly();try{let e=!1;for(;!e;)await this.sync(),e=await this.parseCommonMpegHeader()}catch(e){if(!(e instanceof Hc))throw e;if(SD("End-of-stream"),this.calculateEofDuration&&null!==this.samplesPerFrame){const e=this.frameCount*this.samplesPerFrame;if(this.metadata.setFormat("numberOfSamples",e),this.metadata.format.sampleRate){const t=e/this.metadata.format.sampleRate;SD(`Calculate duration at EOF: ${t} sec.`,t),this.metadata.setFormat("duration",t)}}}}finalize(){const e=this.metadata.format,t=!!this.metadata.native.ID3v1;if(null!==this.mpegOffset){if(e.duration&&this.tokenizer.fileInfo.size){const n=this.tokenizer.fileInfo.size-this.mpegOffset-(t?128:0);e.codecProfile&&"V"===e.codecProfile[0]&&this.metadata.setFormat("bitrate",8*n/e.duration)}if(this.tokenizer.fileInfo.size&&"CBR"===e.codecProfile){const n=this.tokenizer.fileInfo.size-this.mpegOffset-(t?128:0);if(null!==this.frame_size&&null!==this.samplesPerFrame){const t=Math.round(n/this.frame_size)*this.samplesPerFrame;if(this.metadata.setFormat("numberOfSamples",t),e.sampleRate&&!e.duration){const n=t/e.sampleRate;SD("Calculate CBR duration based on file size: %s",n),this.metadata.setFormat("duration",n)}}}}}async sync(){let e=!1;for(;;){let t=0;if(this.syncPeek.len=await this.tokenizer.peekBuffer(this.syncPeek.buf,{length:1024,mayBeLess:!0}),this.syncPeek.len<=163)throw new Hc;for(;;){if(e&&!(224&~this.syncPeek.buf[t]))return this.buf_frame_header[0]=xD.SyncByte1,this.buf_frame_header[1]=this.syncPeek.buf[t],await this.tokenizer.ignore(t),SD(`Sync at offset=${this.tokenizer.position-1}, frameCount=${this.frameCount}`),this.syncFrameCount===this.frameCount&&(SD(`Re-synced MPEG stream, frameCount=${this.frameCount}`),this.frameCount=0,this.frame_size=0),void(this.syncFrameCount=this.frameCount);if(e=!1,t=this.syncPeek.buf.indexOf(xD.SyncByte1,t),-1===t){if(this.syncPeek.len<this.syncPeek.buf.length)throw new Hc;await this.tokenizer.ignore(this.syncPeek.len);break}++t,e=!0}}}async parseCommonMpegHeader(){let e;0===this.frameCount&&(this.mpegOffset=this.tokenizer.position-1),await this.tokenizer.peekBuffer(this.buf_frame_header.subarray(1),{length:3});try{e=PD(this.buf_frame_header,0)}catch(t){if(await this.tokenizer.ignore(1),t instanceof Error)return this.metadata.addWarning(`Parse error: ${t.message}`),!1;throw t}return await this.tokenizer.ignore(3),this.metadata.setFormat("container",e.container),this.metadata.setFormat("codec",e.codec),this.metadata.setFormat("lossless",!1),this.metadata.setFormat("sampleRate",e.samplingRate),this.frameCount++,null!==e.version&&e.version>=2&&0===e.layer?this.parseAdts(e):this.parseAudioFrameHeader(e)}async parseAudioFrameHeader(e){this.metadata.setFormat("numberOfChannels","mono"===e.channelMode?1:2),this.metadata.setFormat("bitrate",e.bitrate),this.frameCount<2e5&&SD("offset=%s MP%s bitrate=%s sample-rate=%s",this.tokenizer.position-4,e.layer,e.bitrate,e.samplingRate);const t=e.calcSlotSize();if(null===t)throw new ED("invalid slot_size");const n=e.calcSamplesPerFrame();SD(`samples_per_frame=${n}`);const r=n/8;if(null!==e.bitrate&&null!=e.samplingRate){const n=r*e.bitrate/e.samplingRate+(e.padding?t:0);this.frame_size=Math.floor(n)}if(this.audioFrameHeader=e,null!==e.bitrate&&this.bitrates.push(e.bitrate),1===this.frameCount)return this.offset=AD,await this.skipSideInformation(),!1;if(3===this.frameCount){if(this.areAllSame(this.bitrates)){if(this.samplesPerFrame=n,this.metadata.setFormat("codecProfile","CBR"),this.tokenizer.fileInfo.size)return!0}else if(this.metadata.format.duration)return!0;if(!this.options.duration)return!0}return this.options.duration&&4===this.frameCount&&(this.samplesPerFrame=n,this.calculateEofDuration=!0),this.offset=4,e.isProtectedByCRC?(await this.parseCrc(),!1):(await this.skipSideInformation(),!1)}async parseAdts(e){const t=new Uint8Array(3);if(await this.tokenizer.readBuffer(t),e.frameLength+=Pd(t,0,0,11),this.totalDataLength+=e.frameLength,this.samplesPerFrame=1024,null!==e.samplingRate){const t=e.samplingRate/this.samplesPerFrame,n=8*(0===this.frameCount?0:this.totalDataLength/this.frameCount)*t+.5;this.metadata.setFormat("bitrate",n),SD(`frame-count=${this.frameCount}, size=${e.frameLength} bytes, bit-rate=${n}`)}if(await this.tokenizer.ignore(e.frameLength>7?e.frameLength-7:1),3===this.frameCount){if(this.metadata.setFormat("codecProfile",e.codecProfile),e.mp4ChannelConfig&&this.metadata.setFormat("numberOfChannels",e.mp4ChannelConfig.length),!this.options.duration)return!0;this.calculateEofDuration=!0}return!1}async parseCrc(){return this.crc=await this.tokenizer.readNumber(pl),this.offset+=2,this.skipSideInformation()}async skipSideInformation(){if(this.audioFrameHeader){const e=this.audioFrameHeader.calculateSideInfoLength();if(null!==e)return await this.tokenizer.readToken(new Nl(e)),this.offset+=e,void(await this.readXtraInfoHeader())}}async readXtraInfoHeader(){const e=await this.tokenizer.readToken(TD);switch(this.offset+=TD.len,e){case"Info":return this.metadata.setFormat("codecProfile","CBR"),this.readXingInfoHeader();case"Xing":{const e=await this.readXingInfoHeader();if(null!==e.vbrScale){const n=(t=e.vbrScale,`V${Math.floor((100-t)/10)}`);this.metadata.setFormat("codecProfile",n)}return null}case"Xtra":break;case"LAME":{const e=await this.tokenizer.readToken(_D);if(null!==this.frame_size&&this.frame_size>=this.offset+_D.len)return this.offset+=_D.len,this.metadata.setFormat("tool",`LAME ${e}`),await this.skipFrameData(this.frame_size-this.offset),null;this.metadata.addWarning("Corrupt LAME header");break}}var t;const n=this.frame_size-this.offset;return n<0?this.metadata.addWarning(`Frame ${this.frameCount}corrupt: negative frameDataLeft`):await this.skipFrameData(n),null}async readXingInfoHeader(){const e=this.tokenizer.position,t=await async function(e){const t=await e.readToken(vD),n={numFrames:null,streamSize:null,vbrScale:null};if(t.frames&&(n.numFrames=await e.readToken(hl)),t.bytes&&(n.streamSize=await e.readToken(hl)),t.toc&&(n.toc=new Uint8Array(100),await e.readBuffer(n.toc)),t.vbrScale&&(n.vbrScale=await e.readToken(hl)),"LAME"===await e.peekToken(new Rl(4,"ascii"))){await e.ignore(4),n.lame={version:await e.readToken(new Rl(5,"ascii"))};const t=n.lame.version.match(/\d+.\d+/g);if(null!==t){const r=t[0].split(".").map(e=>Number.parseInt(e,10));r[0]>=3&&r[1]>=90&&(n.lame.extended=await e.readToken(kD))}}return n}(this.tokenizer);if(this.offset+=this.tokenizer.position-e,t.lame&&(this.metadata.setFormat("tool",`LAME ${Ad(t.lame.version)}`),t.lame.extended&&(this.metadata.setFormat("trackPeakLevel",t.lame.extended.track_peak),t.lame.extended.track_gain&&this.metadata.setFormat("trackGain",t.lame.extended.track_gain.adjustment),t.lame.extended.album_gain&&this.metadata.setFormat("albumGain",t.lame.extended.album_gain.adjustment),this.metadata.setFormat("duration",t.lame.extended.music_length/1e3))),t.streamSize&&this.audioFrameHeader&&null!==t.numFrames){const e=this.audioFrameHeader.calcDuration(t.numFrames);return this.metadata.setFormat("duration",e),SD("Get duration from Xing header: %s",this.metadata.format.duration),t}const n=this.frame_size-this.offset;return await this.skipFrameData(n),t}async skipFrameData(e){if(e<0)throw new ED("frame-data-left cannot be negative");await this.tokenizer.ignore(e),this.countSkipFrameData+=e}areAllSame(e){const t=e[0];return e.every(e=>e===t)}}},Symbol.toStringTag,{value:"Module"}));class ND{static fromBin(e,t=0){return new ND(ND.decode(e,t))}static decode(e,t=0){const n=new DataView(e.buffer,t);return`${n.getUint32(0,!0).toString(16)}-${n.getUint16(4,!0).toString(16)}-${n.getUint16(6,!0).toString(16)}-${n.getUint16(8).toString(16)}-${qu(e.slice(t+10,t+16))}`.toUpperCase()}static decodeMediaType(e){switch(e.str){case ND.AudioMedia.str:return"audio";case ND.VideoMedia.str:return"video";case ND.CommandMedia.str:return"command";case ND.Degradable_JPEG_Media.str:return"degradable-jpeg";case ND.FileTransferMedia.str:return"file-transfer";case ND.BinaryMedia.str:return"binary"}}static encode(e){const t=new Uint8Array(16),n=new DataView(t.buffer);return n.setUint32(0,Number.parseInt(e.slice(0,8),16),!0),n.setUint16(4,Number.parseInt(e.slice(9,13),16),!0),n.setUint16(6,Number.parseInt(e.slice(14,18),16),!0),t.set(Gu(e.slice(19,23)),8),t.set(Gu(e.slice(24)),10),t}constructor(e){this.str=e}equals(e){return this.str===e.str}toBin(){return ND.encode(this.str)}}function RD(e){return Ad(xd(e,"utf-16le"))}ND.HeaderObject=new ND("75B22630-668E-11CF-A6D9-00AA0062CE6C"),ND.DataObject=new ND("75B22636-668E-11CF-A6D9-00AA0062CE6C"),ND.SimpleIndexObject=new ND("33000890-E5B1-11CF-89F4-00A0C90349CB"),ND.IndexObject=new ND("D6E229D3-35DA-11D1-9034-00A0C90349BE"),ND.MediaObjectIndexObject=new ND("FEB103F8-12AD-4C64-840F-2A1D2F7AD48C"),ND.TimecodeIndexObject=new ND("3CB73FD0-0C4A-4803-953D-EDF7B6228F0C"),ND.FilePropertiesObject=new ND("8CABDCA1-A947-11CF-8EE4-00C00C205365"),ND.StreamPropertiesObject=new ND("B7DC0791-A9B7-11CF-8EE6-00C00C205365"),ND.HeaderExtensionObject=new ND("5FBF03B5-A92E-11CF-8EE3-00C00C205365"),ND.CodecListObject=new ND("86D15240-311D-11D0-A3A4-00A0C90348F6"),ND.ScriptCommandObject=new ND("1EFB1A30-0B62-11D0-A39B-00A0C90348F6"),ND.MarkerObject=new ND("F487CD01-A951-11CF-8EE6-00C00C205365"),ND.BitrateMutualExclusionObject=new ND("D6E229DC-35DA-11D1-9034-00A0C90349BE"),ND.ErrorCorrectionObject=new ND("75B22635-668E-11CF-A6D9-00AA0062CE6C"),ND.ContentDescriptionObject=new ND("75B22633-668E-11CF-A6D9-00AA0062CE6C"),ND.ExtendedContentDescriptionObject=new ND("D2D0A440-E307-11D2-97F0-00A0C95EA850"),ND.ContentBrandingObject=new ND("2211B3FA-BD23-11D2-B4B7-00A0C955FC6E"),ND.StreamBitratePropertiesObject=new ND("7BF875CE-468D-11D1-8D82-006097C9A2B2"),ND.ContentEncryptionObject=new ND("2211B3FB-BD23-11D2-B4B7-00A0C955FC6E"),ND.ExtendedContentEncryptionObject=new ND("298AE614-2622-4C17-B935-DAE07EE9289C"),ND.DigitalSignatureObject=new ND("2211B3FC-BD23-11D2-B4B7-00A0C955FC6E"),ND.PaddingObject=new ND("1806D474-CADF-4509-A4BA-9AABCB96AAE8"),ND.ExtendedStreamPropertiesObject=new ND("14E6A5CB-C672-4332-8399-A96952065B5A"),ND.AdvancedMutualExclusionObject=new ND("A08649CF-4775-4670-8A16-6E35357566CD"),ND.GroupMutualExclusionObject=new ND("D1465A40-5A79-4338-B71B-E36B8FD6C249"),ND.StreamPrioritizationObject=new ND("D4FED15B-88D3-454F-81F0-ED5C45999E24"),ND.BandwidthSharingObject=new ND("A69609E6-517B-11D2-B6AF-00C04FD908E9"),ND.LanguageListObject=new ND("7C4346A9-EFE0-4BFC-B229-393EDE415C85"),ND.MetadataObject=new ND("C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA"),ND.MetadataLibraryObject=new ND("44231C94-9498-49D1-A141-1D134E457054"),ND.IndexParametersObject=new ND("D6E229DF-35DA-11D1-9034-00A0C90349BE"),ND.MediaObjectIndexParametersObject=new ND("6B203BAD-3F11-48E4-ACA8-D7613DE2CFA7"),ND.TimecodeIndexParametersObject=new ND("F55E496D-9797-4B5D-8C8B-604DFE9BFB24"),ND.CompatibilityObject=new ND("26F18B5D-4584-47EC-9F5F-0E651F0452C9"),ND.AdvancedContentEncryptionObject=new ND("43058533-6981-49E6-9B74-AD12CB86D58C"),ND.AudioMedia=new ND("F8699E40-5B4D-11CF-A8FD-00805F5C442B"),ND.VideoMedia=new ND("BC19EFC0-5B4D-11CF-A8FD-00805F5C442B"),ND.CommandMedia=new ND("59DACFC0-59E6-11D0-A3AC-00A0C90348F6"),ND.JFIF_Media=new ND("B61BE100-5B4E-11CF-A8FD-00805F5C442B"),ND.Degradable_JPEG_Media=new ND("35907DE0-E415-11CF-A917-00805F5C442B"),ND.FileTransferMedia=new ND("91BD222C-F21C-497A-8B6D-5AA86BFC0185"),ND.BinaryMedia=new ND("3AFB65E2-47EF-40F2-AC2C-70A90D71D343"),ND.ASF_Index_Placeholder_Object=new ND("D9AADE20-7C17-4F9C-BC28-8555DD98E2A2");const MD=[RD,DD,function(e,t=0){return 1===FD(e,t)},function(e,t=0){return dl.get(e,t)},function(e,t=0){return kl.get(e,t)},FD,DD];function DD(e){return new Uint8Array(e)}function FD(e,t=0){return ol.get(e,t)}class LD extends(Sd("ASF")){}const BD={len:30,get:(e,t)=>({objectId:ND.fromBin(e,t),objectSize:Number(kl.get(e,t+16)),numberOfHeaderObjects:dl.get(e,t+24)})},zD={len:24,get:(e,t)=>({objectId:ND.fromBin(e,t),objectSize:Number(kl.get(e,t+16))})};class UD{constructor(e){this.len=Number(e.objectSize)-zD.len}postProcessTag(e,t,n,r){if("WM/Picture"===t)e.push({id:t,value:tF.fromBuffer(r)});else{const s=function(e){return MD[e]}(n);if(!s)throw new LD(`unexpected value headerType: ${n}`);e.push({id:t,value:s(r)})}}}class $D extends UD{get(e,t){return null}}class VD extends UD{get(e,t){return{fileId:ND.fromBin(e,t),fileSize:kl.get(e,t+16),creationDate:kl.get(e,t+24),dataPacketsCount:kl.get(e,t+32),playDuration:kl.get(e,t+40),sendDuration:kl.get(e,t+48),preroll:kl.get(e,t+56),flags:{broadcast:Ed(e,t+64,24),seekable:Ed(e,t+64,25)},minimumDataPacketSize:dl.get(e,t+68),maximumDataPacketSize:dl.get(e,t+72),maximumBitrate:dl.get(e,t+76)}}}VD.guid=ND.FilePropertiesObject;class jD extends UD{get(e,t){return{streamType:ND.decodeMediaType(ND.fromBin(e,t)),errorCorrectionType:ND.fromBin(e,t+8)}}}jD.guid=ND.StreamPropertiesObject;class WD{constructor(){this.len=22}get(e,t){const n=new DataView(e.buffer,t);return{reserved1:ND.fromBin(e,t),reserved2:n.getUint16(16,!0),extensionDataSize:n.getUint16(18,!0)}}}WD.guid=ND.HeaderExtensionObject;const HD={len:20,get:(e,t)=>({entryCount:new DataView(e.buffer,t).getUint16(16,!0)})};async function qD(e){const t=await e.readNumber(ol);return(await e.readToken(new Rl(2*t,"utf-16le"))).replace("\0","")}async function XD(e){const t=await e.readToken(HD),n=[];for(let r=0;r<t.entryCount;++r)n.push(await KD(e));return n}async function GD(e){const t=await e.readNumber(ol),n=new Uint8Array(t);return await e.readBuffer(n),n}async function KD(e){const t=await e.readNumber(ol);return{type:{videoCodec:!(1&~t),audioCodec:!(2&~t)},codecName:await qD(e),description:await qD(e),information:await GD(e)}}class YD extends UD{get(e,t){const n=[],r=new DataView(e.buffer,t);let s=10;for(let i=0;i<YD.contentDescTags.length;++i){const a=r.getUint16(2*i,!0);if(a>0){const r=YD.contentDescTags[i],o=s+a;n.push({id:r,value:RD(e.slice(t+s,t+o))}),s=o}}return n}}YD.guid=ND.ContentDescriptionObject,YD.contentDescTags=["Title","Author","Copyright","Description","Rating"];class QD extends UD{get(e,t){const n=[],r=new DataView(e.buffer,t),s=r.getUint16(0,!0);let i=2;for(let a=0;a<s;a+=1){const s=r.getUint16(i,!0);i+=2;const a=RD(e.slice(t+i,t+i+s));i+=s;const o=r.getUint16(i,!0);i+=2;const c=r.getUint16(i,!0);i+=2;const l=e.slice(t+i,t+i+c);i+=c,this.postProcessTag(n,a,o,l)}return n}}QD.guid=ND.ExtendedContentDescriptionObject;class JD extends UD{get(e,t){const n=new DataView(e.buffer,t);return{startTime:kl.get(e,t),endTime:kl.get(e,t+8),dataBitrate:n.getInt32(12,!0),bufferSize:n.getInt32(16,!0),initialBufferFullness:n.getInt32(20,!0),alternateDataBitrate:n.getInt32(24,!0),alternateBufferSize:n.getInt32(28,!0),alternateInitialBufferFullness:n.getInt32(32,!0),maximumObjectSize:n.getInt32(36,!0),flags:{reliableFlag:Ed(e,t+40,0),seekableFlag:Ed(e,t+40,1),resendLiveCleanpointsFlag:Ed(e,t+40,2)},streamNumber:n.getInt16(42,!0),streamLanguageId:n.getInt16(44,!0),averageTimePerFrame:n.getInt32(52,!0),streamNameCount:n.getInt32(54,!0),payloadExtensionSystems:n.getInt32(56,!0),streamNames:[],streamPropertiesObject:null}}}JD.guid=ND.ExtendedStreamPropertiesObject;class ZD extends UD{get(e,t){const n=[],r=new DataView(e.buffer,t),s=r.getUint16(0,!0);let i=2;for(let a=0;a<s;a+=1){i+=4;const s=r.getUint16(i,!0);i+=2;const a=r.getUint16(i,!0);i+=2;const o=r.getUint32(i,!0);i+=4;const c=RD(e.slice(t+i,t+i+s));i+=s;const l=e.slice(t+i,t+i+o);i+=o,this.postProcessTag(n,c,a,l)}return n}}ZD.guid=ND.MetadataObject;class eF extends ZD{}eF.guid=ND.MetadataLibraryObject;class tF{static fromBuffer(e){return new tF(e.length).get(e,0)}constructor(e){this.len=e}get(e,t){const n=new DataView(e.buffer,t),r=n.getUint8(0),s=n.getInt32(1,!0);let i=5;for(;0!==n.getUint16(i);)i+=2;const a=new Rl(i-5,"utf-16le").get(e,5);for(;0!==n.getUint16(i);)i+=2;const o=new Rl(i-5,"utf-16le").get(e,5);return{type:Nd[r],format:a,description:o,size:s,data:e.slice(i+4)}}}const nF=ku("music-metadata:parser:ASF");const rF=Object.freeze(Object.defineProperty({__proto__:null,AsfParser:class extends zh{async parse(){const e=await this.tokenizer.readToken(BD);if(!e.objectId.equals(ND.HeaderObject))throw new LD(`expected asf header; but was not found; got: ${e.objectId.str}`);try{await this.parseObjectHeader(e.numberOfHeaderObjects)}catch(t){nF("Error while parsing ASF: %s",t)}}async parseObjectHeader(e){let t;do{const e=await this.tokenizer.readToken(zD);switch(nF("header GUID=%s",e.objectId.str),e.objectId.str){case VD.guid.str:{const t=await this.tokenizer.readToken(new VD(e));this.metadata.setFormat("duration",Number(t.playDuration/BigInt(1e3))/1e4-Number(t.preroll)/1e3),this.metadata.setFormat("bitrate",t.maximumBitrate);break}case jD.guid.str:{const t=await this.tokenizer.readToken(new jD(e));this.metadata.setFormat("container",`ASF/${t.streamType}`);break}case WD.guid.str:{const e=await this.tokenizer.readToken(new WD);await this.parseExtensionObject(e.extensionDataSize);break}case YD.guid.str:t=await this.tokenizer.readToken(new YD(e)),await this.addTags(t);break;case QD.guid.str:t=await this.tokenizer.readToken(new QD(e)),await this.addTags(t);break;case ND.CodecListObject.str:{const e=await XD(this.tokenizer);e.forEach(e=>{this.metadata.addStreamInfo({type:e.type.videoCodec?ud:dd,codecName:e.codecName})});const t=e.filter(e=>e.type.audioCodec).map(e=>e.codecName).join("/");this.metadata.setFormat("codec",t);break}case ND.StreamBitratePropertiesObject.str:await this.tokenizer.ignore(e.objectSize-zD.len);break;case ND.PaddingObject.str:nF("Padding: %s bytes",e.objectSize-zD.len),await this.tokenizer.ignore(e.objectSize-zD.len);break;default:this.metadata.addWarning(`Ignore ASF-Object-GUID: ${e.objectId.str}`),nF("Ignore ASF-Object-GUID: %s",e.objectId.str),await this.tokenizer.readToken(new $D(e))}}while(--e)}async addTags(e){await Promise.all(e.map(({id:e,value:t})=>this.metadata.addTag("asf",e,t)))}async parseExtensionObject(e){do{const t=await this.tokenizer.readToken(zD),n=t.objectSize-zD.len;switch(t.objectId.str){case JD.guid.str:await this.tokenizer.readToken(new JD(t));break;case ZD.guid.str:{const e=await this.tokenizer.readToken(new ZD(t));await this.addTags(e);break}case eF.guid.str:{const e=await this.tokenizer.readToken(new eF(t));await this.addTags(e);break}case ND.PaddingObject.str:case ND.CompatibilityObject.str:case ND.ASF_Index_Placeholder_Object.str:await this.tokenizer.ignore(n);break;default:this.metadata.addWarning(`Ignore ASF-Object-GUID: ${t.objectId.str}`),await this.tokenizer.readToken(new $D(t))}e-=t.objectSize}while(e>0)}}},Symbol.toStringTag,{value:"Module"})),sF={len:12,get:(e,t)=>({chunkID:$h.get(e,t),chunkSize:vl.get(e,t+4)})},iF=ku("music-metadata:parser:aiff");class aF extends(Sd("DSDIFF")){}const oF=Object.freeze(Object.defineProperty({__proto__:null,DsdiffContentParseError:aF,DsdiffParser:class extends zh{async parse(){const e=await this.tokenizer.readToken(sF);if("FRM8"!==e.chunkID)throw new aF("Unexpected chunk-ID");this.metadata.setAudioOnly();const t=(await this.tokenizer.readToken($h)).trim();if("DSD"===t)return this.metadata.setFormat("container",`DSDIFF/${t}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(e.chunkSize-BigInt($h.len));throw new aF(`Unsupported DSDIFF type: ${t}`)}async readFmt8Chunks(e){for(;e>=sF.len;){const t=await this.tokenizer.readToken(sF);iF(`Chunk id=${t.chunkID}`),await this.readData(t),e-=BigInt(sF.len)+t.chunkSize}}async readData(e){iF(`Reading data of chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);const t=this.tokenizer.position;switch(e.chunkID.trim()){case"FVER":{const e=await this.tokenizer.readToken(dl);iF(`DSDIFF version=${e}`);break}case"PROP":if("SND "!==await this.tokenizer.readToken($h))throw new aF("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(e.chunkSize-BigInt($h.len));break;case"ID3":{const t=tl(await this.tokenizer.readToken(new Nl(Number(e.chunkSize))));await(new fD).parse(this.metadata,t,this.options);break}case"DSD":this.metadata.format.numberOfChannels&&this.metadata.setFormat("numberOfSamples",Number(e.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.format.numberOfSamples&&this.metadata.format.sampleRate&&this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate);break;default:iF(`Ignore chunk[ID=${e.chunkID}, size=${e.chunkSize}]`)}const n=e.chunkSize-BigInt(this.tokenizer.position-t);n>0&&(iF(`After Parsing chunk, remaining ${n} bytes`),await this.tokenizer.ignore(Number(n)))}async handleSoundPropertyChunks(e){for(iF(`Parsing sound-property-chunks, remainingSize=${e}`);e>0;){const t=await this.tokenizer.readToken(sF);iF(`Sound-property-chunk[ID=${t.chunkID}, size=${t.chunkSize}]`);const n=this.tokenizer.position;switch(t.chunkID.trim()){case"FS":{const e=await this.tokenizer.readToken(hl);this.metadata.setFormat("sampleRate",e);break}case"CHNL":{const e=await this.tokenizer.readToken(cl);this.metadata.setFormat("numberOfChannels",e),await this.handleChannelChunks(t.chunkSize-BigInt(cl.len));break}case"CMPR":{const e=(await this.tokenizer.readToken($h)).trim(),t=await this.tokenizer.readToken(al),n=await this.tokenizer.readToken(new Rl(t,"ascii"));"DSD"===e&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${e} (${n})`);break}case"ABSS":{const e=await this.tokenizer.readToken(cl),t=await this.tokenizer.readToken(al),n=await this.tokenizer.readToken(al),r=await this.tokenizer.readToken(hl);iF(`ABSS ${e}:${t}:${n}.${r}`);break}case"LSCO":{const e=await this.tokenizer.readToken(cl);iF(`LSCO lsConfig=${e}`);break}default:iF(`Unknown sound-property-chunk[ID=${t.chunkID}, size=${t.chunkSize}]`),await this.tokenizer.ignore(Number(t.chunkSize))}const r=t.chunkSize-BigInt(this.tokenizer.position-n);r>0&&(iF(`After Parsing sound-property-chunk ${t.chunkSize}, remaining ${r} bytes`),await this.tokenizer.ignore(Number(r))),e-=BigInt(sF.len)+t.chunkSize,iF(`Parsing sound-property-chunks, remainingSize=${e}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){const e=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",e)}}async handleChannelChunks(e){iF(`Parsing channel-chunks, remainingSize=${e}`);const t=[];for(;e>=$h.len;){const n=await this.tokenizer.readToken($h);iF(`Channel[ID=${n}]`),t.push(n),e-=BigInt($h.len)}return iF(`Channels: ${t.join(", ")}`),t}}},Symbol.toStringTag,{value:"Module"})),cF={NONE:"not compressed\tPCM\tApple Computer",sowt:"PCM (byte swapped)",fl32:"32-bit floating point IEEE 32-bit float",fl64:"64-bit floating point IEEE 64-bit float\tApple Computer",alaw:"ALaw 2:1\t8-bit ITU-T G.711 A-law",ulaw:"µLaw 2:1\t8-bit ITU-T G.711 µ-law\tApple Computer",ULAW:"CCITT G.711 u-law 8-bit ITU-T G.711 µ-law",ALAW:"CCITT G.711 A-law 8-bit ITU-T G.711 A-law",FL32:"Float 32\tIEEE 32-bit float "};class lF extends(Sd("AIFF")){}class uF{constructor(e,t){this.isAifc=t;const n=t?22:18;if(e.chunkSize<n)throw new lF(`COMMON CHUNK size should always be at least ${n}`);this.len=e.chunkSize}get(e,t){const n=cl.get(e,t+8)-16398,r=cl.get(e,t+8+2),s={numChannels:cl.get(e,t),numSampleFrames:hl.get(e,t+2),sampleSize:cl.get(e,t+6),sampleRate:n<0?r>>Math.abs(n):r<<n};if(this.isAifc){if(s.compressionType=$h.get(e,t+18),this.len>22){const n=al.get(e,t+22);if(n>0){if(23+n+(n+1)%2!==this.len)throw new lF("Illegal pstring length");s.compressionName=new Rl(n,"latin1").get(e,t+23)}else s.compressionName=void 0}}else s.compressionName="PCM";return s}}const dF={len:8,get:(e,t)=>({chunkID:$h.get(e,t),chunkSize:Number(BigInt(hl.get(e,t+4)))})},hF=ku("music-metadata:parser:aiff");const mF=Object.freeze(Object.defineProperty({__proto__:null,AIFFParser:class extends zh{constructor(){super(...arguments),this.isCompressed=null}async parse(){if("FORM"!==(await this.tokenizer.readToken(dF)).chunkID)throw new lF("Invalid Chunk-ID, expected 'FORM'");const e=await this.tokenizer.readToken($h);switch(e){case"AIFF":this.metadata.setFormat("container",e),this.isCompressed=!1;break;case"AIFC":this.metadata.setFormat("container","AIFF-C"),this.isCompressed=!0;break;default:throw new lF(`Unsupported AIFF type: ${e}`)}this.metadata.setFormat("lossless",!this.isCompressed),this.metadata.setAudioOnly();try{for(;!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=dF.len;){hF(`Reading AIFF chunk at offset=${this.tokenizer.position}`);const e=await this.tokenizer.readToken(dF),t=2*Math.round(e.chunkSize/2),n=await this.readData(e);await this.tokenizer.ignore(t-n)}}catch(t){if(!(t instanceof Hc))throw t;hF("End-of-stream")}}async readData(e){switch(e.chunkID){case"COMM":{if(null===this.isCompressed)throw new lF("Failed to parse AIFF.COMM chunk when compression type is unknown");const t=await this.tokenizer.readToken(new uF(e,this.isCompressed));return this.metadata.setFormat("bitsPerSample",t.sampleSize),this.metadata.setFormat("sampleRate",t.sampleRate),this.metadata.setFormat("numberOfChannels",t.numChannels),this.metadata.setFormat("numberOfSamples",t.numSampleFrames),this.metadata.setFormat("duration",t.numSampleFrames/t.sampleRate),(t.compressionName||t.compressionType)&&this.metadata.setFormat("codec",t.compressionName??cF[t.compressionType]),e.chunkSize}case"ID3 ":{const t=tl(await this.tokenizer.readToken(new Nl(e.chunkSize)));return await(new fD).parse(this.metadata,t,this.options),e.chunkSize}case"SSND":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*e.chunkSize/this.metadata.format.duration),0;case"NAME":case"AUTH":case"(c) ":case"ANNO":return this.readTextChunk(e);default:return hF(`Ignore chunk id=${e.chunkID}, size=${e.chunkSize}`),0}}async readTextChunk(e){const t=(await this.tokenizer.readToken(new Rl(e.chunkSize,"ascii"))).split("\0").map(e=>e.trim()).filter(e=>e?.length);return await Promise.all(t.map(t=>this.metadata.addTag("AIFF",e.chunkID,t))),e.chunkSize}}},Symbol.toStringTag,{value:"Module"})),pF={len:12,get:(e,t)=>({id:$h.get(e,t),size:kl.get(e,t+4)})},fF={len:16,get:(e,t)=>({fileSize:Tl.get(e,t),metadataPointer:Tl.get(e,t+8)})},gF={len:40,get:(e,t)=>({formatVersion:wl.get(e,t),formatID:wl.get(e,t+4),channelType:wl.get(e,t+8),channelNum:wl.get(e,t+12),samplingFrequency:wl.get(e,t+16),bitsPerSample:wl.get(e,t+20),sampleCount:Tl.get(e,t+24),blockSizePerChannel:wl.get(e,t+32)})},bF=ku("music-metadata:parser:DSF");class yF extends(Sd("DSD")){}const wF=Object.freeze(Object.defineProperty({__proto__:null,DsdContentParseError:yF,DsfParser:class extends yD{async postId3v2Parse(){const e=this.tokenizer.position,t=await this.tokenizer.readToken(pF);if("DSD "!==t.id)throw new yF("Invalid chunk signature");this.metadata.setFormat("container","DSF"),this.metadata.setFormat("lossless",!0),this.metadata.setAudioOnly();const n=await this.tokenizer.readToken(fF);if(n.metadataPointer!==BigInt(0))return bF(`expect ID3v2 at offset=${n.metadataPointer}`),await this.parseChunks(n.fileSize-t.size),await this.tokenizer.ignore(Number(n.metadataPointer)-this.tokenizer.position-e),(new fD).parse(this.metadata,this.tokenizer,this.options);bF("No ID3v2 tag present")}async parseChunks(e){for(;e>=pF.len;){const t=await this.tokenizer.readToken(pF);if(bF(`Parsing chunk name=${t.id} size=${t.size}`),"fmt "===t.id){const e=await this.tokenizer.readToken(gF);this.metadata.setFormat("numberOfChannels",e.channelNum),this.metadata.setFormat("sampleRate",e.samplingFrequency),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("numberOfSamples",e.sampleCount),this.metadata.setFormat("duration",Number(e.sampleCount)/e.samplingFrequency);const t=e.bitsPerSample*e.samplingFrequency*e.channelNum;return void this.metadata.setFormat("bitrate",t)}this.tokenizer.ignore(Number(t.size)-pF.len),e-=t.size}}}},Symbol.toStringTag,{value:"Module"}));class kF{static fromBase64(e){return kF.fromBuffer(Uint8Array.from(atob(e),e=>e.charCodeAt(0)))}static fromBuffer(e){return new kF(e.length).get(e,0)}constructor(e){this.len=e}get(e,t){const n=Nd[hl.get(e,t)];t+=4;const r=hl.get(e,t);t+=4;const s=new Rl(r,"utf-8").get(e,t);t+=r;const i=hl.get(e,t);t+=4;const a=new Rl(i,"utf-8").get(e,t);t+=i;const o=hl.get(e,t);t+=4;const c=hl.get(e,t);t+=4;const l=hl.get(e,t);t+=4;const u=hl.get(e,t);t+=4;const d=hl.get(e,t);t+=4;return{type:n,format:s,description:a,width:o,height:c,colour_depth:l,indexed_color:u,data:Uint8Array.from(e.slice(t,t+d))}}}const TF=7,_F=(e,t)=>({packetType:al.get(e,t),vorbis:new Rl(6,"ascii").get(e,t+1)}),vF=(e,t)=>({version:dl.get(e,t+0),channelMode:al.get(e,t+4),sampleRate:dl.get(e,t+5),bitrateMax:dl.get(e,t+9),bitrateNominal:dl.get(e,t+13),bitrateMin:dl.get(e,t+17)});class SF{constructor(e,t){this.data=e,this.offset=t}readInt32(){const e=dl.get(this.data,this.offset);return this.offset+=4,e}readStringUtf8(){const e=this.readInt32(),t=new TextDecoder("utf-8").decode(this.data.subarray(this.offset,this.offset+e));return this.offset+=e,t}parseUserComment(){const e=this.offset,t=this.readStringUtf8(),n=t.indexOf("=");return{key:t.slice(0,n).toUpperCase(),value:t.slice(n+1),len:this.offset-e}}}const EF=ku("music-metadata:parser:ogg:vorbis1");class CF extends(Sd("Vorbis")){}class IF{constructor(e,t){this.pageSegments=[],this.durationOnLastPage=!0,this.metadata=e,this.options=t}async parsePage(e,t){if(this.lastPageHeader=e,e.headerType.firstPage)this.parseFirstPage(e,t);else{if(e.headerType.continued){if(0===this.pageSegments.length)throw new CF("Cannot continue on previous page");this.pageSegments.push(t)}if(e.headerType.lastPage||!e.headerType.continued){if(this.pageSegments.length>0){const e=IF.mergeUint8Arrays(this.pageSegments);await this.parseFullPage(e)}this.pageSegments=e.headerType.lastPage?[]:[t]}}}static mergeUint8Arrays(e){const t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);return e.forEach((e,t,r)=>{const s=r.slice(0,t).reduce((e,t)=>e+t.length,0);n.set(e,s)}),n}async flush(){await this.parseFullPage(IF.mergeUint8Arrays(this.pageSegments))}async parseUserComment(e,t){const n=new SF(e,t).parseUserComment();return await this.addTag(n.key,n.value),n.len}async addTag(e,t){if("METADATA_BLOCK_PICTURE"===e&&"string"==typeof t){if(this.options.skipCovers)return void EF("Ignore picture");t=kF.fromBase64(t),EF(`Push picture: id=${e}, format=${t.format}`)}else EF(`Push tag: id=${e}, value=${t}`);await this.metadata.addTag("vorbis",e,t)}calculateDuration(){this.lastPageHeader&&this.metadata.format.sampleRate&&this.lastPageHeader.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",this.lastPageHeader.absoluteGranulePosition),this.metadata.setFormat("duration",this.lastPageHeader.absoluteGranulePosition/this.metadata.format.sampleRate))}parseFirstPage(e,t){this.metadata.setFormat("codec","Vorbis I"),this.metadata.setFormat("hasAudio",!0),EF("Parse first page");const n=_F(t,0);if("vorbis"!==n.vorbis)throw new CF("Metadata does not look like Vorbis");if(1!==n.packetType)throw new CF("First Ogg page should be type 1: the identification header");{const e=vF(t,TF);this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("bitrate",e.bitrateNominal),this.metadata.setFormat("numberOfChannels",e.channelMode),EF("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",e.sampleRate,e.bitrateNominal,e.channelMode)}}async parseFullPage(e){const t=_F(e,0);if(EF("Parse full page: type=%s, byteLength=%s",t.packetType,e.byteLength),3===t.packetType)return this.parseUserCommentList(e,TF)}async parseUserCommentList(e,t){const n=dl.get(e,t);t+=4,t+=n;let r=dl.get(e,t);for(t+=4;r-- >0;)t+=await this.parseUserComment(e,t)}}const xF=0,AF=1,PF=2,OF=3,NF=4,RF=5,MF=6,DF={len:4,get:(e,t)=>({lastBlock:Ed(e,t,7),type:Pd(e,t,1,7),length:ul.get(e,t+1)})},FF={len:34,get:(e,t)=>({minimumBlockSize:cl.get(e,t),maximumBlockSize:cl.get(e,t+2)/1e3,minimumFrameSize:ul.get(e,t+4),maximumFrameSize:ul.get(e,t+7),sampleRate:ul.get(e,t+10)>>4,channels:Pd(e,t+12,4,3)+1,bitsPerSample:Pd(e,t+12,7,5)+1,totalSamples:Pd(e,t+13,4,36),fileMD5:new Nl(16).get(e,t+18)})},LF=ku("music-metadata:parser:FLAC");class BF extends(Sd("FLAC")){}class zF extends yD{constructor(){super(...arguments),this.vorbisParser=new IF(this.metadata,this.options),this.padding=0}async postId3v2Parse(){if("fLaC"!==(await this.tokenizer.readToken($h)).toString())throw new BF("Invalid FLAC preamble");let e;do{e=await this.tokenizer.readToken(DF),await this.parseDataBlock(e)}while(!e.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const e=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*e/this.metadata.format.duration)}}async parseDataBlock(e){switch(LF(`blockHeader type=${e.type}, length=${e.length}`),e.type){case xF:return this.readBlockStreamInfo(e.length);case AF:this.padding+=e.length;break;case PF:case OF:break;case NF:return this.readComment(e.length);case RF:break;case MF:return void(await this.parsePicture(e.length));default:this.metadata.addWarning(`Unknown block type: ${e.type}`)}return this.tokenizer.ignore(e.length).then()}async readBlockStreamInfo(e){if(e!==FF.len)throw new BF("Unexpected block-stream-info length");const t=await this.tokenizer.readToken(FF);this.metadata.setFormat("container","FLAC"),this.processsStreamInfo(t)}processsStreamInfo(e){this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("hasAudio",!0),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",e.channels),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("sampleRate",e.sampleRate),e.totalSamples>0&&this.metadata.setFormat("duration",e.totalSamples/e.sampleRate)}async readComment(e){const t=await this.tokenizer.readToken(new Nl(e));return this.parseComment(t)}async parseComment(e){const t=new SF(e,0);t.readStringUtf8();const n=t.readInt32(),r=new Array(n);for(let s=0;s<n;s++)r[s]=t.parseUserComment();await Promise.all(r.map(e=>this.addTag(e.key,e.value)))}async parsePicture(e){return this.options.skipCovers?this.tokenizer.ignore(e):this.addPictureTag(await this.tokenizer.readToken(new kF(e)))}addPictureTag(e){return this.addTag("METADATA_BLOCK_PICTURE",e)}addTag(e,t){return this.vorbisParser.addTag(e,t)}}const UF=Object.freeze(Object.defineProperty({__proto__:null,FlacParser:zF},Symbol.toStringTag,{value:"Module"})),$F=0,VF=1,jF=2,WF=3,HF=4,qF=5,XF={name:"dtd",container:{440786851:{name:"ebml",container:{17030:{name:"ebmlVersion",value:VF},17143:{name:"ebmlReadVersion",value:VF},17138:{name:"ebmlMaxIDWidth",value:VF},17139:{name:"ebmlMaxSizeWidth",value:VF},17026:{name:"docType",value:$F},17031:{name:"docTypeVersion",value:VF},17029:{name:"docTypeReadVersion",value:VF}}},408125543:{name:"segment",container:{290298740:{name:"seekHead",container:{19899:{name:"seek",multiple:!0,container:{21419:{name:"id",value:HF},21420:{name:"position",value:VF}}}}},357149030:{name:"info",container:{29604:{name:"uid",value:jF},29572:{name:"filename",value:$F},3979555:{name:"prevUID",value:jF},3965867:{name:"prevFilename",value:$F},4110627:{name:"nextUID",value:jF},4096955:{name:"nextFilename",value:$F},2807729:{name:"timecodeScale",value:VF},17545:{name:"duration",value:qF},17505:{name:"dateUTC",value:VF},31657:{name:"title",value:$F},19840:{name:"muxingApp",value:$F},22337:{name:"writingApp",value:$F}}},524531317:{name:"cluster",multiple:!0,container:{231:{name:"timecode",value:jF},22743:{name:"silentTracks ",multiple:!0},167:{name:"position",value:jF},171:{name:"prevSize",value:jF},160:{name:"blockGroup"},163:{name:"simpleBlock"}}},374648427:{name:"tracks",container:{174:{name:"entries",multiple:!0,container:{215:{name:"trackNumber",value:VF},29637:{name:"uid",value:jF},131:{name:"trackType",value:VF},185:{name:"flagEnabled",value:WF},136:{name:"flagDefault",value:WF},21930:{name:"flagForced",value:WF},156:{name:"flagLacing",value:WF},28135:{name:"minCache",value:VF},28136:{name:"maxCache",value:VF},2352003:{name:"defaultDuration",value:VF},2306383:{name:"timecodeScale",value:qF},21358:{name:"name",value:$F},2274716:{name:"language",value:$F},134:{name:"codecID",value:$F},25506:{name:"codecPrivate",value:HF},2459272:{name:"codecName",value:$F},3839639:{name:"codecSettings",value:$F},3883072:{name:"codecInfoUrl",value:$F},2536e3:{name:"codecDownloadUrl",value:$F},170:{name:"codecDecodeAll",value:WF},28587:{name:"trackOverlay",value:VF},224:{name:"video",container:{154:{name:"flagInterlaced",value:WF},21432:{name:"stereoMode",value:VF},176:{name:"pixelWidth",value:VF},186:{name:"pixelHeight",value:VF},21680:{name:"displayWidth",value:VF},21690:{name:"displayHeight",value:VF},21683:{name:"aspectRatioType",value:VF},3061028:{name:"colourSpace",value:VF},3126563:{name:"gammaValue",value:qF}}},225:{name:"audio",container:{181:{name:"samplingFrequency",value:qF},30901:{name:"outputSamplingFrequency",value:qF},159:{name:"channels",value:VF},148:{name:"channels",value:VF},32123:{name:"channelPositions",value:HF},25188:{name:"bitDepth",value:VF}}},28032:{name:"contentEncodings",container:{25152:{name:"contentEncoding",container:{20529:{name:"order",value:VF},20530:{name:"scope",value:WF},20531:{name:"type",value:VF},20532:{name:"contentEncoding",container:{16980:{name:"contentCompAlgo",value:VF},16981:{name:"contentCompSettings",value:HF}}},20533:{name:"contentEncoding",container:{18401:{name:"contentEncAlgo",value:VF},18402:{name:"contentEncKeyID",value:HF},18403:{name:"contentSignature ",value:HF},18404:{name:"ContentSigKeyID  ",value:HF},18405:{name:"contentSigAlgo ",value:VF},18406:{name:"contentSigHashAlgo ",value:VF}}},25188:{name:"bitDepth",value:VF}}}}}}}}},475249515:{name:"cues",container:{187:{name:"cuePoint",container:{179:{name:"cueTime",value:jF},183:{name:"positions",container:{247:{name:"track",value:VF},241:{name:"clusterPosition",value:VF},21368:{name:"blockNumber",value:VF},234:{name:"codecState",value:VF},219:{name:"reference",container:{150:{name:"time",value:VF},151:{name:"cluster",value:VF},21343:{name:"number",value:VF},235:{name:"codecState",value:VF}}},240:{name:"relativePosition",value:VF}}}}}}},423732329:{name:"attachments",container:{24999:{name:"attachedFiles",multiple:!0,container:{18046:{name:"description",value:$F},18030:{name:"name",value:$F},18016:{name:"mimeType",value:$F},18012:{name:"data",value:HF},18094:{name:"uid",value:jF}}}}},272869232:{name:"chapters",container:{17849:{name:"editionEntry",container:{182:{name:"chapterAtom",container:{29636:{name:"uid",value:jF},145:{name:"timeStart",value:VF},146:{name:"timeEnd",value:jF},152:{name:"hidden",value:WF},17816:{name:"enabled",value:jF},143:{name:"track",container:{137:{name:"trackNumber",value:jF},128:{name:"display",container:{133:{name:"string",value:$F},17276:{name:"language ",value:$F},17278:{name:"country ",value:$F}}}}}}}}}}},307544935:{name:"tags",container:{29555:{name:"tag",multiple:!0,container:{25536:{name:"target",container:{25541:{name:"tagTrackUID",value:jF},25540:{name:"tagChapterUID",value:VF},25542:{name:"tagAttachmentUID",value:jF},25546:{name:"targetType",value:$F},26826:{name:"targetTypeValue",value:VF},25545:{name:"tagEditionUID",value:jF}}},26568:{name:"simpleTags",multiple:!0,container:{17827:{name:"name",value:$F},17543:{name:"string",value:$F},17541:{name:"binary",value:HF},17530:{name:"language",value:$F},17531:{name:"languageIETF",value:$F},17540:{name:"default",value:WF}}}}}}}}}}},GF=ku("music-metadata:parser:ebml");class KF extends(Sd("EBML")){}const YF=0,QF=2,JF=3,ZF=4,eL=5;class tL{constructor(e){this.padding=0,this.parserMap=new Map,this.ebmlMaxIDLength=4,this.ebmlMaxSizeLength=8,this.tokenizer=e,this.parserMap.set(VF,e=>this.readUint(e)),this.parserMap.set($F,e=>this.readString(e)),this.parserMap.set(HF,e=>this.readBuffer(e)),this.parserMap.set(jF,async e=>this.readBuffer(e)),this.parserMap.set(WF,e=>this.readFlag(e)),this.parserMap.set(qF,e=>this.readFloat(e))}async iterate(e,t,n){return this.parseContainer(rL(e),t,n)}async parseContainer(e,t,n){const r={};for(;this.tokenizer.position<t;){let i;const a=this.tokenizer.position;try{i=await this.readElement()}catch(s){if(s instanceof Hc)break;throw s}const o=e.container[i.id];if(o){switch(n.startNext(o)){case YF:if(i.id,GF(`Read element: name=${sL(o)}{id=0x${i.id.toString(16)}, container=${!!o.container}} at position=${a}`),o.container){const e=await this.parseContainer(o,i.len>=0?this.tokenizer.position+i.len:-1,n);o.multiple?(r[o.name]||(r[o.name]=[]),r[o.name].push(e)):r[o.name]=e,await n.elementValue(o,e,a)}else{const e=this.parserMap.get(o.value);if("function"==typeof e){const t=await e(i);r[o.name]=t,await n.elementValue(o,t,a)}}break;case eL:GF(`Go to next element: name=${sL(o)}, element.id=0x${i.id}, container=${!!o.container} at position=${a}`);break;case QF:GF(`Ignore element: name=${sL(o)}, element.id=0x${i.id}, container=${!!o.container} at position=${a}`),await this.tokenizer.ignore(i.len);break;case JF:GF(`Ignore remaining container, at: name=${sL(o)}, element.id=0x${i.id}, container=${!!o.container} at position=${a}`),await this.tokenizer.ignore(t-this.tokenizer.position);break;case ZF:return GF(`Terminate parsing at element: name=${sL(o)}, element.id=0x${i.id}, container=${!!o.container} at position=${a}`),r}}else if(236===i.id)this.padding+=i.len,await this.tokenizer.ignore(i.len);else GF(`parseEbml: parent=${sL(e)}, unknown child: id=${i.id.toString(16)} at position=${a}`),this.padding+=i.len,await this.tokenizer.ignore(i.len)}return r}async readVintData(e){const t=await this.tokenizer.peekNumber(al);let n=128,r=1;for(;0===(t&n);){if(r>e)throw new KF("VINT value exceeding maximum size");++r,n>>=1}const s=new Uint8Array(r);return await this.tokenizer.readBuffer(s),s}async readElement(){const e=await this.readVintData(this.ebmlMaxIDLength),t=await this.readVintData(this.ebmlMaxSizeLength);return t[0]^=128>>t.length-1,{id:nL(e,e.length),len:nL(t,t.length)}}async readFloat(e){switch(e.len){case 0:return 0;case 4:return this.tokenizer.readNumber(Cl);case 8:case 10:return this.tokenizer.readNumber(xl);default:throw new KF(`Invalid IEEE-754 float length: ${e.len}`)}}async readFlag(e){return 1===await this.readUint(e)}async readUint(e){return nL(await this.readBuffer(e),e.len)}async readString(e){return(await this.tokenizer.readToken(new Rl(e.len,"utf-8"))).replace(/\x00.*$/g,"")}async readBuffer(e){const t=new Uint8Array(e.len);return await this.tokenizer.readBuffer(t),t}}function nL(e,t){return Number(function(e,t){const n=new Uint8Array(8),r=e.subarray(0,t);try{return n.set(r,8-t),_l.get(n,0)}catch(s){return BigInt(-1)}}(e,t))}function rL(e){return e.container&&Object.keys(e.container).map(t=>{const n=e.container[t];return n.id=Number.parseInt(t),n}).forEach(t=>{t.parent=e,rL(t)}),e}function sL(e){let t="";return e.parent&&"dtd"!==e.parent.name&&(t+=`${sL(e.parent)}/`),t+e.name}const iL=ku("music-metadata:parser:matroska");const aL=Object.freeze(Object.defineProperty({__proto__:null,MatroskaParser:class extends zh{constructor(){super(...arguments),this.seekHeadOffset=0,this.flagUseIndexToSkipClusters=this.options.mkvUseIndex??!1}async parse(){const e=this.tokenizer.fileInfo.size??Number.MAX_SAFE_INTEGER,t=new tL(this.tokenizer);iL("Initializing DTD end MatroskaIterator"),await t.iterate(XF,e,{startNext:e=>{switch(e.id){case 475249515:return iL(`Skip element: name=${e.name}, id=0x${e.id.toString(16)}`),QF;case 524531317:if(this.flagUseIndexToSkipClusters&&this.seekHead){const e=this.seekHead.seek.find(e=>e.position+this.seekHeadOffset>this.tokenizer.position);if(e){const t=e.position+this.seekHeadOffset-this.tokenizer.position;return iL(`Use index to go to next position, ignoring ${t} bytes`),this.tokenizer.ignore(t),eL}}return QF;default:return YF}},elementValue:async(e,t,n)=>{switch(iL(`Received: name=${e.name}, value=${t}`),e.id){case 17026:this.metadata.setFormat("container",`EBML/${t}`);break;case 290298740:this.seekHead=t,this.seekHeadOffset=n;break;case 357149030:{const e=t,n=e.timecodeScale?e.timecodeScale:1e6;if("number"==typeof e.duration){const t=e.duration*n/1e9;await this.addTag("segment:title",e.title),this.metadata.setFormat("duration",Number(t))}}break;case 374648427:{const e=t;if(e?.entries){e.entries.forEach(e=>{const t={codecName:e.codecID.replace("A_","").replace("V_",""),codecSettings:e.codecSettings,flagDefault:e.flagDefault,flagLacing:e.flagLacing,flagEnabled:e.flagEnabled,language:e.language,name:e.name,type:e.trackType,audio:e.audio,video:e.video};this.metadata.addStreamInfo(t)});const t=e.entries.filter(e=>e.trackType===dd).reduce((e,t)=>e?t.flagDefault&&!e.flagDefault||t.trackNumber<e.trackNumber?t:e:t,null);t&&(this.metadata.setFormat("codec",t.codecID.replace("A_","")),this.metadata.setFormat("sampleRate",t.audio.samplingFrequency),this.metadata.setFormat("numberOfChannels",t.audio.channels))}}break;case 307544935:{const e=t;await Promise.all(e.tag.map(async e=>{const t=e.target,n=t?.targetTypeValue?ld[t.targetTypeValue]:t?.targetType?t.targetType:"track";await Promise.all(e.simpleTags.map(async e=>{const t=e.string?e.string:e.binary;await this.addTag(`${n}:${e.name}`,t)}))}))}break;case 423732329:{const e=t;await Promise.all(e.attachedFiles.filter(e=>e.mimeType.startsWith("image/")).map(e=>this.addTag("picture",{data:e.data,format:e.mimeType,description:e.description,name:e.name})))}}}})}async addTag(e,t){await this.metadata.addTag("matroska",e,t)}}},Symbol.toStringTag,{value:"Module"})),oL=ku("music-metadata:parser:MP4:atom");class cL extends(Sd("MP4")){}const lL={len:8,get:(e,t)=>{const n=hl.get(e,t);if(n<0)throw new cL("Invalid atom header length");return{length:BigInt(n),name:new Rl(4,"latin1").get(e,t+4)}},put:(e,t,n)=>(hl.put(e,t,Number(n.length)),$h.put(e,t+4,n.name))},uL=_l,dL={len:4,get:(e,t)=>({type:new Rl(4,"ascii").get(e,t)})};class hL{constructor(e,t,n){if(e<t)throw new cL(`Atom ${n} expected to be ${t}, but specifies ${e} bytes long.`);e>t&&oL(`Warning: atom ${n} expected to be ${t}, but was actually ${e} bytes long.`),this.len=e}}const mL=(e,t)=>{const n=hl.get(e,t)-2082844800;return new Date(1e3*n)};class pL extends hL{constructor(e){super(e,24,"mdhd")}get(e,t){return{version:al.get(e,t+0),flags:ul.get(e,t+1),creationTime:mL(e,t+4),modificationTime:mL(e,t+8),timeScale:hl.get(e,t+12),duration:hl.get(e,t+16),language:cl.get(e,t+20),quality:cl.get(e,t+22)}}}class fL extends hL{constructor(e){super(e,100,"mvhd")}get(e,t){return{version:al.get(e,t),flags:ul.get(e,t+1),creationTime:mL(e,t+4),modificationTime:mL(e,t+8),timeScale:hl.get(e,t+12),duration:hl.get(e,t+16),preferredRate:hl.get(e,t+20),preferredVolume:cl.get(e,t+24),previewTime:hl.get(e,t+72),previewDuration:hl.get(e,t+76),posterTime:hl.get(e,t+80),selectionTime:hl.get(e,t+84),selectionDuration:hl.get(e,t+88),currentTime:hl.get(e,t+92),nextTrackID:hl.get(e,t+96)}}}class gL{constructor(e){this.len=e}get(e,t){return{type:{set:al.get(e,t+0),type:ul.get(e,t+1)},locale:ul.get(e,t+4),value:new Nl(this.len-8).get(e,t+8)}}}class bL{constructor(e){this.len=e}get(e,t){return{version:al.get(e,t),flags:ul.get(e,t+1),name:new Rl(this.len-4,"utf-8").get(e,t+4)}}}class yL{constructor(e){this.len=e}get(e,t){return{version:al.get(e,t),flags:ul.get(e,t+1),creationTime:mL(e,t+4),modificationTime:mL(e,t+8),trackId:hl.get(e,t+12),duration:hl.get(e,t+20),layer:cl.get(e,t+24),alternateGroup:cl.get(e,t+26),volume:cl.get(e,t+28)}}}const wL=8,kL=(e,t)=>({version:al.get(e,t),flags:ul.get(e,t+1),numberOfEntries:hl.get(e,t+4)});class TL{constructor(e){this.len=e}get(e,t){const n=this.len-12;return{dataFormat:$h.get(e,t),dataReferenceIndex:cl.get(e,t+10),description:n>0?new Nl(n).get(e,t+12):void 0}}}class _L{constructor(e){this.len=e}get(e,t){const n=kL(e,t);t+=wL;const r=[];for(let s=0;s<n.numberOfEntries;++s){const n=hl.get(e,t);t+=hl.len,r.push(new TL(n-hl.len).get(e,t)),t+=n}return{header:n,table:r}}}const vL={len:8,get:(e,t)=>({version:pl.get(e,t),revision:pl.get(e,t+2),vendor:yl.get(e,t+4)})},SL={len:12,get:(e,t)=>({numAudioChannels:pl.get(e,t+0),sampleSize:pl.get(e,t+2),compressionId:pl.get(e,t+4),packetSize:pl.get(e,t+6),sampleRate:cl.get(e,t+8)+cl.get(e,t+10)/1e4})};class EL{constructor(e,t){this.len=e,this.token=t}get(e,t){const n=yl.get(e,t+4);return{version:ml.get(e,t+0),flags:bl.get(e,t+1),numberOfEntries:n,entries:RL(e,this.token,t+8,this.len-8,n)}}}const CL={len:8,get:(e,t)=>({count:yl.get(e,t+0),duration:yl.get(e,t+4)})};class IL extends EL{constructor(e){super(e,CL)}}const xL={len:12,get:(e,t)=>({firstChunk:yl.get(e,t),samplesPerChunk:yl.get(e,t+4),sampleDescriptionId:yl.get(e,t+8)})};class AL extends EL{constructor(e){super(e,xL)}}class PL{constructor(e){this.len=e}get(e,t){const n=yl.get(e,t+8);return{version:ml.get(e,t),flags:bl.get(e,t+1),sampleSize:yl.get(e,t+4),numberOfEntries:n,entries:RL(e,yl,t+12,this.len-12,n)}}}class OL extends EL{constructor(e){super(e,yl),this.len=e}}class NL{constructor(e){this.len=e}get(e,t){const n=pl.get(e,t+0);return new Rl(n,"utf-8").get(e,t+2)}}function RL(e,t,n,r,s){if(oL(`remainingLen=${r}, numberOfEntries=${s} * token-len=${t.len}`),0===r)return[];if(r!==s*t.len)throw new cL("mismatch number-of-entries with remaining atom-length");const i=[];for(let a=0;a<s;++a)i.push(t.get(e,n)),n+=t.len;return i}class ML{constructor(e){this.len=e}get(e,t){const n=t+1,r={version:ml.get(e,t),flags:{baseDataOffsetPresent:Ed(e,n+2,0),sampleDescriptionIndexPresent:Ed(e,n+2,1),defaultSampleDurationPresent:Ed(e,n+2,3),defaultSampleSizePresent:Ed(e,n+2,4),defaultSampleFlagsPresent:Ed(e,n+2,5),defaultDurationIsEmpty:Ed(e,n,0),defaultBaseIsMoof:Ed(e,n,1)},trackId:hl.get(e,4)};let s=8;return r.flags.baseDataOffsetPresent&&(r.baseDataOffset=_l.get(e,s),s+=8),r.flags.sampleDescriptionIndexPresent&&(r.sampleDescriptionIndex=hl.get(e,s),s+=4),r.flags.defaultSampleDurationPresent&&(r.defaultSampleDuration=hl.get(e,s),s+=4),r.flags.defaultSampleSizePresent&&(r.defaultSampleSize=hl.get(e,s),s+=4),r.flags.defaultSampleFlagsPresent&&(r.defaultSampleFlags=hl.get(e,s)),r}}class DL{constructor(e){this.len=e}get(e,t){const n=t+1,r={version:ml.get(e,t),flags:{dataOffsetPresent:Ed(e,n+2,0),firstSampleFlagsPresent:Ed(e,n+2,2),sampleDurationPresent:Ed(e,n+1,0),sampleSizePresent:Ed(e,n+1,1),sampleFlagsPresent:Ed(e,n+1,2),sampleCompositionTimeOffsetsPresent:Ed(e,n+1,3)},sampleCount:hl.get(e,t+4),samples:[]};let s=t+8;r.flags.dataOffsetPresent&&(r.dataOffset=hl.get(e,s),s+=4),r.flags.firstSampleFlagsPresent&&(r.firstSampleFlags=hl.get(e,s),s+=4);for(let i=0;i<r.sampleCount;++i){if(s>=this.len){oL("TrackRunBox size mismatch");break}const t={};r.flags.sampleDurationPresent&&(t.sampleDuration=hl.get(e,s),s+=4),r.flags.sampleSizePresent&&(t.sampleSize=hl.get(e,s),s+=4),r.flags.sampleFlagsPresent&&(t.sampleFlags=hl.get(e,s),s+=4),r.flags.sampleCompositionTimeOffsetsPresent&&(t.sampleCompositionTimeOffset=hl.get(e,s),s+=4),r.samples.push(t)}return r}}class FL{constructor(e){this.len=e}get(e,t){const n=new Rl(4,"utf-8");return{version:ml.get(e,t),flags:ul.get(e,t+1),componentType:n.get(e,t+4),handlerType:n.get(e,t+8),componentName:new Rl(this.len-28,"utf-8").get(e,t+28)}}}class LL{constructor(e){this.len=e}get(e,t){let n=0;const r=[];for(;n<this.len;)r.push(hl.get(e,t+n)),n+=4;return r}}const BL=ku("music-metadata:parser:MP4:Atom");class zL{static async readAtom(e,t,n,r){const s=e.position;BL(`Reading next token on offset=${s}...`);const i=await e.readToken(lL),a=1n===i.length;a&&(i.length=await e.readToken(uL));const o=new zL(i,a,n),c=o.getPayloadLength(r);return BL(`parse atom name=${o.atomPath}, extended=${o.extended}, offset=${s}, len=${o.header.length}`),await o.readData(e,t,c),o}constructor(e,t,n){this.header=e,this.extended=t,this.parent=n,this.children=[],this.atomPath=(this.parent?`${this.parent.atomPath}.`:"")+this.header.name}getHeaderLength(){return this.extended?16:8}getPayloadLength(e){return(0n===this.header.length?e:Number(this.header.length))-this.getHeaderLength()}async readAtoms(e,t,n){for(;n>0;){const r=await zL.readAtom(e,t,this,n);this.children.push(r),n-=0n===r.header.length?n:Number(r.header.length)}}async readData(e,t,n){switch(this.header.name){case"moov":case"udta":case"mdia":case"minf":case"stbl":case"<id>":case"ilst":case"tref":case"moof":return this.readAtoms(e,t,this.getPayloadLength(n));case"meta":{const r="hdlr"===(await e.peekToken(lL)).name?0:4;return await e.ignore(r),this.readAtoms(e,t,this.getPayloadLength(n)-r)}default:return t(this,n)}}}const UL=ku("music-metadata:parser:MP4"),$L={raw:{lossy:!1,format:"raw"},MAC3:{lossy:!0,format:"MACE 3:1"},MAC6:{lossy:!0,format:"MACE 6:1"},ima4:{lossy:!0,format:"IMA 4:1"},ulaw:{lossy:!0,format:"uLaw 2:1"},alaw:{lossy:!0,format:"uLaw 2:1"},Qclp:{lossy:!0,format:"QUALCOMM PureVoice"},".mp3":{lossy:!0,format:"MPEG-1 layer 3"},alac:{lossy:!1,format:"ALAC"},"ac-3":{lossy:!0,format:"AC-3"},mp4a:{lossy:!0,format:"MPEG-4/AAC"},mp4s:{lossy:!0,format:"MP4S"},c608:{lossy:!0,format:"CEA-608"},c708:{lossy:!0,format:"CEA-708"}};function VL(e,t,n){return n.indexOf(e)===t}class jL extends zh{constructor(){super(...arguments),this.tracks=new Map,this.hasVideoTrack=!1,this.hasAudioTrack=!0,this.atomParsers={mvhd:async e=>{const t=await this.tokenizer.readToken(new fL(e));this.metadata.setFormat("creationTime",t.creationTime),this.metadata.setFormat("modificationTime",t.modificationTime)},chap:async e=>{const t=this.getTrackDescription(),n=[];for(;e>=hl.len;)n.push(await this.tokenizer.readNumber(hl)),e-=hl.len;t.chapterList=n},mdat:async e=>{if(this.audioLengthInBytes=e,this.calculateBitRate(),this.options.includeChapters){const t=[...this.tracks.values()].filter(e=>e.chapterList);if(1===t.length){const n=t[0].chapterList,r=[...this.tracks.values()].filter(e=>-1!==n.indexOf(e.header.trackId));if(1===r.length)return this.parseChapterTrack(r[0],t[0],e)}}await this.tokenizer.ignore(e)},ftyp:async e=>{const t=[];for(;e>0;){const n=await this.tokenizer.readToken(dL);e-=dL.len;const r=n.type.replace(/\W/g,"");r.length>0&&t.push(r)}UL(`ftyp: ${t.join("/")}`);const n=t.filter(VL).join("/");this.metadata.setFormat("container",n)},stsd:async e=>{const t=await this.tokenizer.readToken(new _L(e));this.getTrackDescription().soundSampleDescription=t.table.map(e=>this.parseSoundSampleDescription(e))},stsz:async e=>{const t=await this.tokenizer.readToken(new PL(e)),n=this.getTrackDescription();n.sampleSize=t.sampleSize,n.sampleSizeTable=t.entries},date:async e=>{const t=await this.tokenizer.readToken(new Rl(e,"utf-8"));await this.addTag("date",t)}}}static read_BE_Integer(e,t){const n=(t?"INT":"UINT")+8*e.length+(e.length>1?"_BE":""),r=Ml[n];if(!r)throw new cL(`Token for integer type not found: "${n}"`);return Number(r.get(e,0))}async parse(){this.hasVideoTrack=!1,this.hasAudioTrack=!0,this.tracks.clear();let e=this.tokenizer.fileInfo.size||0;for(;!this.tokenizer.fileInfo.size||e>0;){try{if("\0\0\0\0"===(await this.tokenizer.peekToken(lL)).name){const e=`Error at offset=${this.tokenizer.position}: box.id=0`;UL(e),this.addWarning(e);break}}catch(r){if(!(r instanceof Error))throw r;{const e=`Error at offset=${this.tokenizer.position}: ${r.message}`;UL(e),this.addWarning(e)}break}const t=await zL.readAtom(this.tokenizer,(e,t)=>this.handleAtom(e,t),null,e);e-=t.header.length===BigInt(0)?e:Number(t.header.length)}const t=[];this.tracks.forEach(e=>{const n=[];e.soundSampleDescription.forEach(e=>{const t={},r=$L[e.dataFormat];if(r?(n.push(r.format),t.codecName=r.format):t.codecName=`<${e.dataFormat}>`,e.description){const{description:n}=e;n.sampleRate>0&&(t.type=dd,t.audio={samplingFrequency:n.sampleRate,bitDepth:n.sampleSize,channels:n.numAudioChannels})}this.metadata.addStreamInfo(t)}),n.length>=1&&t.push(n.join("/"))}),t.length>0&&this.metadata.setFormat("codec",t.filter(VL).join("+"));const n=[...this.tracks.values()].filter(e=>e.soundSampleDescription.length>=1&&e.soundSampleDescription[0].description&&e.soundSampleDescription[0].description.numAudioChannels>0);if(n.length>=1){const e=n[0];if(e.media.header&&e.media.header.timeScale>0)if(e.media.header.duration>0){UL("Using duration defined on audio track");const t=e.media.header.duration/e.media.header.timeScale;this.metadata.setFormat("duration",t)}else if(e.fragments.length>0){UL("Calculate duration defined in track fragments");let t=0;for(const n of e.fragments){const e=n.header.defaultSampleDuration;for(const r of n.trackRun.samples){const n=r.sampleDuration??e;if(null==n)throw new Error("Missing sampleDuration and no default_sample_duration in tfhd");t+=n}}this.metadata.setFormat("duration",t/e.media.header.timeScale)}const t=e.soundSampleDescription[0];if(t.description&&e.media.header&&(this.metadata.setFormat("sampleRate",t.description.sampleRate),this.metadata.setFormat("bitsPerSample",t.description.sampleSize),this.metadata.setFormat("numberOfChannels",t.description.numAudioChannels),0===e.media.header.timeScale&&e.timeToSampleTable.length>0)){const n=e.timeToSampleTable.map(e=>e.count*e.duration).reduce((e,t)=>e+t)/t.description.sampleRate;this.metadata.setFormat("duration",n)}const r=$L[t.dataFormat];r&&this.metadata.setFormat("lossless",!r.lossy),this.calculateBitRate()}this.metadata.setFormat("hasAudio",this.hasAudioTrack),this.metadata.setFormat("hasVideo",this.hasVideoTrack)}async handleAtom(e,t){if(e.parent)switch(e.parent.header.name){case"ilst":case"<id>":return this.parseMetadataItemData(e);case"moov":if("trak"===e.header.name)return this.parseTrackBox(e);break;case"moof":if("traf"===e.header.name)return this.parseTrackFragmentBox(e)}if(this.atomParsers[e.header.name])return this.atomParsers[e.header.name](t);UL(`No parser for atom path=${e.atomPath}, payload-len=${t}, ignoring atom`),await this.tokenizer.ignore(t)}getTrackDescription(){const e=[...this.tracks.values()];return e[e.length-1]}calculateBitRate(){this.audioLengthInBytes&&this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLengthInBytes/this.metadata.format.duration)}async addTag(e,t){await this.metadata.addTag("iTunes",e,t)}addWarning(e){UL(`Warning: ${e}`),this.metadata.addWarning(e)}parseMetadataItemData(e){let t=e.header.name;return e.readAtoms(this.tokenizer,async(e,n)=>{const r=e.getPayloadLength(n);switch(e.header.name){case"data":return this.parseValueAtom(t,e);case"name":case"mean":case"rate":{const e=await this.tokenizer.readToken(new bL(r));t+=`:${e.name}`;break}default:{const n=await this.tokenizer.readToken(new Nl(r));this.addWarning(`Unsupported meta-item: ${t}[${e.header.name}] => value=${qu(n)} ascii=${Vu(n,"ascii")}`)}}},e.getPayloadLength(0))}async parseValueAtom(e,t){const n=await this.tokenizer.readToken(new gL(Number(t.header.length)-lL.len));if(0!==n.type.set)throw new cL(`Unsupported type-set != 0: ${n.type.set}`);switch(n.type.type){case 0:switch(e){case"trkn":case"disk":{const t=al.get(n.value,3),r=al.get(n.value,5);await this.addTag(e,`${t}/${r}`);break}case"gnre":{const t=al.get(n.value,1),r=am[t-1];await this.addTag(e,r);break}case"rate":{const t=new TextDecoder("ascii").decode(n.value);await this.addTag(e,t);break}default:UL(`unknown proprietary value type for: ${t.atomPath}`)}break;case 1:case 18:await this.addTag(e,new TextDecoder("utf-8").decode(n.value));break;case 13:if(this.options.skipCovers)break;await this.addTag(e,{format:"image/jpeg",data:Uint8Array.from(n.value)});break;case 14:if(this.options.skipCovers)break;await this.addTag(e,{format:"image/png",data:Uint8Array.from(n.value)});break;case 21:await this.addTag(e,jL.read_BE_Integer(n.value,!0));break;case 22:await this.addTag(e,jL.read_BE_Integer(n.value,!1));break;case 65:await this.addTag(e,al.get(n.value,0));break;case 66:await this.addTag(e,cl.get(n.value,0));break;case 67:await this.addTag(e,hl.get(n.value,0));break;default:this.addWarning(`atom key=${e}, has unknown well-known-type (data-type): ${n.type.type}`)}}async parseTrackBox(e){const t={media:{},fragments:[]};await e.readAtoms(this.tokenizer,async(e,n)=>{const r=e.getPayloadLength(n);switch(e.header.name){case"chap":{const e=await this.tokenizer.readToken(new LL(n));t.chapterList=e;break}case"tkhd":t.header=await this.tokenizer.readToken(new yL(r));break;case"hdlr":switch(t.handler=await this.tokenizer.readToken(new FL(r)),t.handler.handlerType){case"audi":UL("Contains audio track"),this.hasAudioTrack=!0;break;case"vide":UL("Contains video track"),this.hasVideoTrack=!0}break;case"mdhd":{const e=await this.tokenizer.readToken(new pL(r));t.media.header=e;break}case"stco":{const e=await this.tokenizer.readToken(new OL(r));t.chunkOffsetTable=e.entries;break}case"stsc":{const e=await this.tokenizer.readToken(new AL(r));t.sampleToChunkTable=e.entries;break}case"stsd":{const e=await this.tokenizer.readToken(new _L(r));t.soundSampleDescription=e.table.map(e=>this.parseSoundSampleDescription(e));break}case"stts":{const e=await this.tokenizer.readToken(new IL(r));t.timeToSampleTable=e.entries;break}case"stsz":{const e=await this.tokenizer.readToken(new PL(r));t.sampleSize=e.sampleSize,t.sampleSizeTable=e.entries;break}case"dinf":case"vmhd":case"smhd":UL(`Ignoring: ${e.header.name}`),await this.tokenizer.ignore(r);break;default:UL(`Unexpected track box: ${e.header.name}`),await this.tokenizer.ignore(r)}},e.getPayloadLength(0)),this.tracks.set(t.header.trackId,t)}parseTrackFragmentBox(e){let t;return e.readAtoms(this.tokenizer,async(e,n)=>{const r=e.getPayloadLength(n);switch(e.header.name){case"tfhd":{const r=new ML(e.getPayloadLength(n));t=await this.tokenizer.readToken(r);break}case"tfdt":await this.tokenizer.ignore(r);break;case"trun":{const e=new DL(r),n=await this.tokenizer.readToken(e);if(t){const e=this.tracks.get(t.trackId);e?.fragments.push({header:t,trackRun:n})}break}default:UL(`Unexpected box: ${e.header.name}`),await this.tokenizer.ignore(r)}},e.getPayloadLength(0))}parseSoundSampleDescription(e){const t={dataFormat:e.dataFormat,dataReferenceIndex:e.dataReferenceIndex};let n=0;if(e.description){const r=vL.get(e.description,n);n+=vL.len,0===r.version||1===r.version?t.description=SL.get(e.description,n):UL(`Warning: sound-sample-description ${r} not implemented`)}return t}async parseChapterTrack(e,t,n){if(!e.sampleSize&&e.chunkOffsetTable.length!==e.sampleSizeTable.length)throw new Error("Expected equal chunk-offset-table & sample-size-table length.");const r=[];for(let s=0;s<e.chunkOffsetTable.length&&n>0;++s){const i=e.timeToSampleTable.slice(0,s).reduce((e,t)=>e+t.duration,0),a=e.chunkOffsetTable[s]-this.tokenizer.position,o=e.sampleSize>0?e.sampleSize:e.sampleSizeTable[s];if((n-=a+o)<0)throw new cL("Chapter chunk exceeding token length");await this.tokenizer.ignore(a);const c=await this.tokenizer.readToken(new NL(o));UL(`Chapter ${s+1}: ${c}`);const l={title:c,timeScale:e.media.header?e.media.header.timeScale:0,start:i,sampleOffset:this.findSampleOffset(t,this.tokenizer.position)};UL(`Chapter title=${l.title}, offset=${l.sampleOffset}/${t.header.duration}`),r.push(l)}this.metadata.setFormat("chapters",r),await this.tokenizer.ignore(n)}findSampleOffset(e,t){let n=0;for(;n<e.chunkOffsetTable.length&&e.chunkOffsetTable[n]<t;)++n;return this.getChunkDuration(n+1,e)}getChunkDuration(e,t){let n=0,r=t.timeToSampleTable[n].count,s=t.timeToSampleTable[n].duration,i=1,a=this.getSamplesPerChunk(i,t.sampleToChunkTable),o=0;for(;i<e;){const e=Math.min(r,a);o+=e*s,r-=e,a-=e,0===a?(++i,a=this.getSamplesPerChunk(i,t.sampleToChunkTable)):(++n,r=t.timeToSampleTable[n].count,s=t.timeToSampleTable[n].duration)}return o}getSamplesPerChunk(e,t){for(let n=0;n<t.length-1;++n)if(e>=t[n].firstChunk&&e<t[n+1].firstChunk)return t[n].samplesPerChunk;return t[t.length-1].samplesPerChunk}}const WL=Object.freeze(Object.defineProperty({__proto__:null,MP4Parser:jL},Symbol.toStringTag,{value:"Module"})),HL=ku("music-metadata:parser:musepack:sv8"),qL=new Rl(2,"latin1"),XL={len:5,get:(e,t)=>({crc:dl.get(e,t),streamVersion:al.get(e,t+4)})},GL={len:2,get:(e,t)=>({sampleFrequency:[44100,48e3,37800,32e3][Pd(e,t,0,3)],maxUsedBands:Pd(e,t,3,5),channelCount:Pd(e,t+1,0,4)+1,msUsed:Od(e,t+1,4),audioBlockFrames:Pd(e,t+1,5,3)})};class KL{get tokenizer(){return this._tokenizer}set tokenizer(e){this._tokenizer=e}constructor(e){this._tokenizer=e}async readPacketHeader(){const e=await this.tokenizer.readToken(qL),t=await this.readVariableSizeField();return{key:e,payloadLength:t.value-2-t.len}}async readStreamHeader(e){const t={};HL(`Reading SH at offset=${this.tokenizer.position}`);const n=await this.tokenizer.readToken(XL);e-=XL.len,Object.assign(t,n),HL(`SH.streamVersion = ${n.streamVersion}`);const r=await this.readVariableSizeField();e-=r.len,t.sampleCount=r.value;const s=await this.readVariableSizeField();e-=s.len,t.beginningOfSilence=s.value;const i=await this.tokenizer.readToken(GL);return e-=GL.len,Object.assign(t,i),await this.tokenizer.ignore(e),t}async readVariableSizeField(e=1,t=0){let n=await this.tokenizer.readNumber(al);return 128&n?(n&=127,n+=t,this.readVariableSizeField(e+1,n<<7)):{len:e,value:t+n}}}class YL extends(Sd("Musepack")){}const QL=ku("music-metadata:parser:musepack");class JL extends zh{constructor(){super(...arguments),this.audioLength=0}async parse(){if("MPCK"!==await this.tokenizer.readToken($h))throw new YL("Invalid Magic number");return this.metadata.setFormat("container","Musepack, SV8"),this.parsePacket()}async parsePacket(){const e=new KL(this.tokenizer);for(;;){const t=await e.readPacketHeader();switch(QL(`packet-header key=${t.key}, payloadLength=${t.payloadLength}`),t.key){case"SH":{const n=await e.readStreamHeader(t.payloadLength);this.metadata.setFormat("numberOfSamples",n.sampleCount),this.metadata.setFormat("sampleRate",n.sampleFrequency),this.metadata.setFormat("duration",n.sampleCount/n.sampleFrequency),this.metadata.setFormat("numberOfChannels",n.channelCount);break}case"AP":this.audioLength+=t.payloadLength,await this.tokenizer.ignore(t.payloadLength);break;case"RG":case"EI":case"SO":case"ST":case"CT":await this.tokenizer.ignore(t.payloadLength);break;case"SE":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLength/this.metadata.format.duration),nm(this.metadata,this.tokenizer,this.options);default:throw new YL(`Unexpected header: ${t.key}`)}}}}class ZL{constructor(e){this.pos=0,this.dword=null,this.tokenizer=e}async read(e){for(;null===this.dword;)this.dword=await this.tokenizer.readToken(dl);let t=this.dword;return this.pos+=e,this.pos<32?(t>>>=32-this.pos,t&(1<<e)-1):(this.pos-=32,0===this.pos?(this.dword=null,t&(1<<e)-1):(this.dword=await this.tokenizer.readToken(dl),this.pos&&(t<<=this.pos,t|=this.dword>>>32-this.pos),t&(1<<e)-1))}async ignore(e){if(this.pos>0){const t=32-this.pos;this.dword=null,e-=t,this.pos=0}const t=e%32,n=(e-t)/32;return await this.tokenizer.ignore(4*n),this.read(t)}}const eB={len:24,get:(e,t)=>{const n={signature:new TextDecoder("latin1").decode(e.subarray(t,t+3)),streamMinorVersion:Pd(e,t+3,0,4),streamMajorVersion:Pd(e,t+3,4,4),frameCount:dl.get(e,t+4),maxLevel:ol.get(e,t+8),sampleFrequency:[44100,48e3,37800,32e3][Pd(e,t+10,0,2)],link:Pd(e,t+10,2,2),profile:Pd(e,t+10,4,4),maxBand:Pd(e,t+11,0,6),intensityStereo:Od(e,t+11,6),midSideStereo:Od(e,t+11,7),titlePeak:ol.get(e,t+12),titleGain:ol.get(e,t+14),albumPeak:ol.get(e,t+16),albumGain:ol.get(e,t+18),lastFrameLength:dl.get(e,t+20)>>>20&2047,trueGapless:Od(e,t+23,0)};return n.lastFrameLength=n.trueGapless?dl.get(e,20)>>>20&2047:0,n}},tB=ku("music-metadata:parser:musepack");class nB extends zh{constructor(){super(...arguments),this.bitreader=null,this.audioLength=0,this.duration=null}async parse(){const e=await this.tokenizer.readToken(eB);if("MP+"!==e.signature)throw new YL("Unexpected magic number");tB(`stream-version=${e.streamMajorVersion}.${e.streamMinorVersion}`),this.metadata.setFormat("container","Musepack, SV7"),this.metadata.setFormat("sampleRate",e.sampleFrequency);const t=1152*(e.frameCount-1)+e.lastFrameLength;this.metadata.setFormat("numberOfSamples",t),this.duration=t/e.sampleFrequency,this.metadata.setFormat("duration",this.duration),this.bitreader=new ZL(this.tokenizer),this.metadata.setFormat("numberOfChannels",e.midSideStereo||e.intensityStereo?2:1);const n=await this.bitreader.read(8);return this.metadata.setFormat("codec",(n/100).toFixed(2)),await this.skipAudioData(e.frameCount),tB(`End of audio stream, switching to APEv2, offset=${this.tokenizer.position}`),nm(this.metadata,this.tokenizer,this.options)}async skipAudioData(e){for(;e-- >0;){const e=await this.bitreader.read(20);this.audioLength+=20+e,await this.bitreader.ignore(e)}const t=await this.bitreader.read(11);this.audioLength+=t,null!==this.duration&&this.metadata.setFormat("bitrate",this.audioLength/this.duration)}}const rB=ku("music-metadata:parser:musepack");const sB=Object.freeze(Object.defineProperty({__proto__:null,MusepackParser:class extends yD{async postId3v2Parse(){let e;switch(await this.tokenizer.peekToken(new Rl(3,"latin1"))){case"MP+":rB("Stream-version 7"),e=new nB(this.metadata,this.tokenizer,this.options);break;case"MPC":rB("Stream-version 8"),e=new JL(this.metadata,this.tokenizer,this.options);break;default:throw new YL("Invalid signature prefix")}return this.metadata.setAudioOnly(),e.parse()}}},Symbol.toStringTag,{value:"Module"}));class iB extends(Sd("Opus")){}class aB{constructor(e){if(e<19)throw new iB("ID-header-page 0 should be at least 19 bytes long");this.len=e}get(e,t){return{magicSignature:new Rl(8,"ascii").get(e,t+0),version:al.get(e,t+8),channelCount:al.get(e,t+9),preSkip:ol.get(e,t+10),inputSampleRate:dl.get(e,t+12),outputGain:ol.get(e,t+16),channelMapping:al.get(e,t+18)}}}class oB extends IF{constructor(e,t,n){super(e,t),this.idHeader=null,this.lastPos=-1,this.tokenizer=n,this.durationOnLastPage=!0}parseFirstPage(e,t){if(this.metadata.setFormat("codec","Opus"),this.idHeader=new aB(t.length).get(t,0),"OpusHead"!==this.idHeader.magicSignature)throw new iB("Illegal ogg/Opus magic-signature");this.metadata.setFormat("sampleRate",this.idHeader.inputSampleRate),this.metadata.setFormat("numberOfChannels",this.idHeader.channelCount),this.metadata.setAudioOnly()}async parseFullPage(e){if("OpusTags"===new Rl(8,"ascii").get(e,0))await this.parseUserCommentList(e,8),this.lastPos=this.tokenizer.position-e.length}calculateDuration(){if(this.lastPageHeader&&this.metadata.format.sampleRate&&this.lastPageHeader.absoluteGranulePosition>=0){const e=this.lastPageHeader.absoluteGranulePosition-this.idHeader.preSkip;if(this.metadata.setFormat("numberOfSamples",e),this.metadata.setFormat("duration",e/48e3),-1!==this.lastPos&&this.tokenizer.fileInfo.size&&this.metadata.format.duration){const e=this.tokenizer.fileInfo.size-this.lastPos;this.metadata.setFormat("bitrate",8*e/this.metadata.format.duration)}}}}const cB=(e,t)=>({speex:new Rl(8,"ascii").get(e,t+0),version:Id(new Rl(20,"ascii").get(e,t+8)),version_id:wl.get(e,t+28),header_size:wl.get(e,t+32),rate:wl.get(e,t+36),mode:wl.get(e,t+40),mode_bitstream_version:wl.get(e,t+44),nb_channels:wl.get(e,t+48),bitrate:wl.get(e,t+52),frame_size:wl.get(e,t+56),vbr:wl.get(e,t+60),frames_per_packet:wl.get(e,t+64),extra_headers:wl.get(e,t+68),reserved1:wl.get(e,t+72),reserved2:wl.get(e,t+76)}),lB=ku("music-metadata:parser:ogg:speex");class uB extends IF{constructor(e,t,n){super(e,t)}parseFirstPage(e,t){lB("First Ogg/Speex page");const n=cB(t,0);this.metadata.setFormat("codec",`Speex ${n.version}`),this.metadata.setFormat("numberOfChannels",n.nb_channels),this.metadata.setFormat("sampleRate",n.rate),-1!==n.bitrate&&this.metadata.setFormat("bitrate",n.bitrate),this.metadata.setAudioOnly()}}const dB=(e,t)=>({id:new Rl(7,"ascii").get(e,t),vmaj:al.get(e,t+7),vmin:al.get(e,t+8),vrev:al.get(e,t+9),vmbw:cl.get(e,t+10),vmbh:cl.get(e,t+17),nombr:ul.get(e,t+37),nqual:al.get(e,t+40)}),hB=ku("music-metadata:parser:ogg:theora");class mB{constructor(e,t,n){this.durationOnLastPage=!1,this.metadata=e}async parsePage(e,t){e.headerType.firstPage&&await this.parseFirstPage(e,t)}calculateDuration(){hB("duration calculation not implemented")}async parseFirstPage(e,t){hB("First Ogg/Theora page"),this.metadata.setFormat("codec","Theora");const n=dB(t,0);this.metadata.setFormat("bitrate",n.nombr),this.metadata.setFormat("hasVideo",!0)}flush(){return Promise.resolve()}}const pB={len:27,get:(e,t)=>({capturePattern:new Rl(4,"latin1").get(e,t),version:al.get(e,t+4),headerType:{continued:Ed(e,t+5,0),firstPage:Ed(e,t+5,1),lastPage:Ed(e,t+5,2)},absoluteGranulePosition:Number(kl.get(e,t+6)),streamSerialNumber:dl.get(e,t+14),pageSequenceNo:dl.get(e,t+18),pageChecksum:dl.get(e,t+22),page_segments:al.get(e,t+26)})};class fB{static sum(e,t,n){const r=new DataView(e.buffer,0);let s=0;for(let i=t;i<t+n;++i)s+=r.getUint8(i);return s}constructor(e){this.len=e.page_segments}get(e,t){return{totalPageSize:fB.sum(e,t,this.len)}}}const gB=ku("music-metadata:parser:ogg:theora");class bB{constructor(e,t,n){this.durationOnLastPage=!1,this.metadata=e,this.options=t,this.tokenizer=n,this.flacParser=new zF(this.metadata,this.tokenizer,t)}async parsePage(e,t){e.headerType.firstPage&&await this.parseFirstPage(e,t)}calculateDuration(){gB("duration calculation not implemented")}async parseFirstPage(e,t){gB("First Ogg/FLAC page");if("fLaC"!==(await $h.get(t,9)).toString())throw new Error("Invalid FLAC preamble");const n=await DF.get(t,13);await this.parseDataBlock(n,t.subarray(13+DF.len))}async parseDataBlock(e,t){switch(gB(`blockHeader type=${e.type}, length=${e.length}`),e.type){case xF:{const e=FF.get(t,0);return this.flacParser.processsStreamInfo(e)}case AF:case PF:case OF:break;case NF:return this.flacParser.parseComment(t);case MF:if(!this.options.skipCovers){const e=new kF(t.length).get(t,0);return this.flacParser.addPictureTag(e)}break;default:this.metadata.addWarning(`Unknown block type: ${e.type}`)}return this.tokenizer.ignore(e.length).then()}flush(){return Promise.resolve()}}class yB extends(Sd("Ogg")){}const wB=ku("music-metadata:parser:ogg");class kB{constructor(e,t,n){this.pageNumber=0,this.closed=!1,this.metadata=e,this.streamSerial=t,this.options=n}async parsePage(e,t){this.pageNumber=t.pageSequenceNo,wB("serial=%s page#=%s, Ogg.id=%s",t.streamSerialNumber,t.pageSequenceNo,t.capturePattern);const n=await e.readToken(new fB(t));wB("totalPageSize=%s",n.totalPageSize);const r=await e.readToken(new Nl(n.totalPageSize));if(wB("firstPage=%s, lastPage=%s, continued=%s",t.headerType.firstPage,t.headerType.lastPage,t.headerType.continued),t.headerType.firstPage){this.metadata.setFormat("container","Ogg");const n=r.slice(0,7),s=Array.from(n).filter(e=>e>=32&&e<=126).map(e=>String.fromCharCode(e)).join("");switch(s){case"vorbis":wB(`Set Ogg stream serial ${t.streamSerialNumber}, codec=Vorbis`),this.pageConsumer=new IF(this.metadata,this.options);break;case"OpusHea":wB("Set page consumer to Ogg/Opus"),this.pageConsumer=new oB(this.metadata,this.options,e);break;case"Speex  ":wB("Set page consumer to Ogg/Speex"),this.pageConsumer=new uB(this.metadata,this.options,e);break;case"fishead":case"theora":wB("Set page consumer to Ogg/Theora"),this.pageConsumer=new mB(this.metadata,this.options,e);break;case"FLAC":wB("Set page consumer to Vorbis"),this.pageConsumer=new bB(this.metadata,this.options,e);break;default:throw new yB(`Ogg codec not recognized (id=${s}`)}}if(t.headerType.lastPage&&(this.closed=!0),!this.pageConsumer)throw new Error("pageConsumer should be initialized");await this.pageConsumer.parsePage(t,r)}}const TB=Object.freeze(Object.defineProperty({__proto__:null,OggContentError:yB,OggParser:class extends zh{constructor(){super(...arguments),this.streams=new Map}async parse(){let e;this.streams=new Map;try{do{if(e=await this.tokenizer.readToken(pB),"OggS"!==e.capturePattern)throw new yB("Invalid Ogg capture pattern");let t=this.streams.get(e.streamSerialNumber);if(t||(t=new kB(this.metadata,e.streamSerialNumber,this.options),this.streams.set(e.streamSerialNumber,t)),await t.parsePage(this.tokenizer,e),t.pageNumber>12&&(!this.options.duration||![...this.streams.values()].find(e=>e.pageConsumer?.durationOnLastPage))){wB("Stop processing Ogg stream");break}}while(![...this.streams.values()].every(e=>e.closed))}catch(t){if(t instanceof Hc)wB("Reached end-of-stream");else{if(!(t instanceof yB))throw t;this.metadata.addWarning(`Corrupt Ogg content at ${this.tokenizer.position}`)}}for(const n of this.streams.values())n.closed||(this.metadata.addWarning(`End-of-stream reached before reaching last page in Ogg stream serial=${n.streamSerial}`),await(n.pageConsumer?.flush())),n.pageConsumer?.calculateDuration()}}},Symbol.toStringTag,{value:"Module"})),_B=[6e3,8e3,9600,11025,12e3,16e3,22050,24e3,32e3,44100,48e3,64e3,88200,96e3,192e3,-1],vB={len:32,get:(e,t)=>{const n=dl.get(e,t+24),r={BlockID:$h.get(e,t),blockSize:dl.get(e,t+4),version:ol.get(e,t+8),totalSamples:dl.get(e,t+12),blockIndex:dl.get(e,t+16),blockSamples:dl.get(e,t+20),flags:{bitsPerSample:8*(1+CB(n,0,2)),isMono:EB(n,2),isHybrid:EB(n,3),isJointStereo:EB(n,4),crossChannel:EB(n,5),hybridNoiseShaping:EB(n,6),floatingPoint:EB(n,7),samplingRate:_B[CB(n,23,4)],isDSD:EB(n,31)},crc:new Nl(4).get(e,t+28)};return r.flags.isDSD&&(r.totalSamples*=8),r}},SB={len:1,get:(e,t)=>({functionId:CB(e[t],0,6),isOptional:EB(e[t],5),isOddSize:EB(e[t],6),largeBlock:EB(e[t],7)})};function EB(e,t){return 1===CB(e,t,1)}function CB(e,t,n){return e>>>t&4294967295>>>32-n}const IB=ku("music-metadata:parser:WavPack");class xB extends(Sd("WavPack")){}const AB=Object.freeze(Object.defineProperty({__proto__:null,WavPackContentError:xB,WavPackParser:class extends zh{constructor(){super(...arguments),this.audioDataSize=0}async parse(){return this.metadata.setAudioOnly(),this.audioDataSize=0,await this.parseWavPackBlocks(),nm(this.metadata,this.tokenizer,this.options)}async parseWavPackBlocks(){do{if("wvpk"!==await this.tokenizer.peekToken($h))break;const e=await this.tokenizer.readToken(vB);if("wvpk"!==e.BlockID)throw new xB("Invalid WavPack Block-ID");IB(`WavPack header blockIndex=${e.blockIndex}, len=${vB.len}`),0!==e.blockIndex||this.metadata.format.container||(this.metadata.setFormat("container","WavPack"),this.metadata.setFormat("lossless",!e.flags.isHybrid),this.metadata.setFormat("bitsPerSample",e.flags.bitsPerSample),e.flags.isDSD||(this.metadata.setFormat("sampleRate",e.flags.samplingRate),this.metadata.setFormat("duration",e.totalSamples/e.flags.samplingRate)),this.metadata.setFormat("numberOfChannels",e.flags.isMono?1:2),this.metadata.setFormat("numberOfSamples",e.totalSamples),this.metadata.setFormat("codec",e.flags.isDSD?"DSD":"PCM"));const t=e.blockSize-(vB.len-8);await(0===e.blockIndex?this.parseMetadataSubBlock(e,t):this.tokenizer.ignore(t)),e.blockSamples>0&&(this.audioDataSize+=e.blockSize)}while(!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=vB.len);this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioDataSize/this.metadata.format.duration)}async parseMetadataSubBlock(e,t){let n=t;for(;n>SB.len;){const t=await this.tokenizer.readToken(SB),r=await this.tokenizer.readNumber(t.largeBlock?ll:al),s=new Uint8Array(2*r-(t.isOddSize?1:0));switch(await this.tokenizer.readBuffer(s),IB(`Metadata Sub-Blocks functionId=0x${t.functionId.toString(16)}, id.largeBlock=${t.largeBlock},data-size=${s.length}`),t.functionId){case 0:break;case 14:{IB("ID_DSD_BLOCK");const t=1<<al.get(s,0),n=e.flags.samplingRate*t*8;if(!e.flags.isDSD)throw new xB("Only expect DSD block if DSD-flag is set");this.metadata.setFormat("sampleRate",n),this.metadata.setFormat("duration",e.totalSamples/n);break}case 36:IB("ID_ALT_TRAILER: trailer for non-wav files");break;case 38:this.metadata.setFormat("audioMD5",s);break;case 47:IB(`ID_BLOCK_CHECKSUM: checksum=${qu(s)}`);break;default:IB(`Ignore unsupported meta-sub-block-id functionId=0x${t.functionId.toString(16)}`)}n-=SB.len+(t.largeBlock?ll.len:al.len)+2*r,IB(`remainingLength=${n}`),t.isOddSize&&this.tokenizer.ignore(1)}if(0!==n)throw new xB("metadata-sub-block should fit it remaining length")}}},Symbol.toStringTag,{value:"Module"})),PB={len:8,get:(e,t)=>({chunkID:new Rl(4,"latin1").get(e,t),chunkSize:dl.get(e,t+4)})};class OB{constructor(e){this.tagHeader=e,this.len=e.chunkSize,this.len+=1&this.len}get(e,t){return new Rl(this.tagHeader.chunkSize,"ascii").get(e,t)}}class NB extends(Sd("Wave")){}const RB=1,MB=2,DB=3,FB=5632,LB=5634,BB=255,zB=146,UB=8192,$B=576,VB=577,jB=9,WB=8193,HB=80,qB={[RB]:"PCM",[MB]:"ADPCM",[DB]:"IEEE_FLOAT",[FB]:"MPEG_ADTS_AAC",[LB]:"MPEG_LOAS",[BB]:"RAW_AAC1",[zB]:"DOLBY_AC3_SPDIF",[UB]:"DVM",[$B]:"RAW_SPORT",[VB]:"ESST_AC3",[jB]:"DRM",[WB]:"DTS2",[HB]:"MPEG"};class XB{constructor(e){if(e.chunkSize<16)throw new NB("Invalid chunk size");this.len=e.chunkSize}get(e,t){return{wFormatTag:ol.get(e,t),nChannels:ol.get(e,t+2),nSamplesPerSec:dl.get(e,t+4),nAvgBytesPerSec:dl.get(e,t+8),nBlockAlign:ol.get(e,t+12),wBitsPerSample:ol.get(e,t+14)}}}class GB{constructor(e){if(e.chunkSize<4)throw new NB("Invalid fact chunk size.");this.len=e.chunkSize}get(e,t){return{dwSampleLength:dl.get(e,t)}}}const KB={len:420,get:(e,t)=>({description:Ad(new Rl(256,"ascii").get(e,t)).trim(),originator:Ad(new Rl(32,"ascii").get(e,t+256)).trim(),originatorReference:Ad(new Rl(32,"ascii").get(e,t+288)).trim(),originationDate:Ad(new Rl(10,"ascii").get(e,t+320)).trim(),originationTime:Ad(new Rl(8,"ascii").get(e,t+330)).trim(),timeReferenceLow:dl.get(e,t+338),timeReferenceHigh:dl.get(e,t+342),version:ol.get(e,t+346),umid:new Nl(64).get(e,t+348),loudnessValue:ol.get(e,t+412),maxTruePeakLevel:ol.get(e,t+414),maxMomentaryLoudness:ol.get(e,t+416),maxShortTermLoudness:ol.get(e,t+418)})},YB=ku("music-metadata:parser:RIFF");const QB=Object.freeze(Object.defineProperty({__proto__:null,WaveParser:class extends zh{constructor(){super(...arguments),this.blockAlign=0}async parse(){const e=await this.tokenizer.readToken(PB);if(YB(`pos=${this.tokenizer.position}, parse: chunkID=${e.chunkID}`),"RIFF"===e.chunkID)return this.metadata.setAudioOnly(),this.parseRiffChunk(e.chunkSize).catch(e=>{if(!(e instanceof Hc))throw e})}async parseRiffChunk(e){const t=await this.tokenizer.readToken($h);if(this.metadata.setFormat("container",t),"WAVE"===t)return this.readWaveChunk(e-$h.len);throw new NB(`Unsupported RIFF format: RIFF/${t}`)}async readWaveChunk(e){for(;e>=PB.len;){const t=await this.tokenizer.readToken(PB);switch(e-=PB.len+t.chunkSize,t.chunkSize>e&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=t,YB(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${t.chunkID}`),t.chunkID){case"LIST":await this.parseListTag(t);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new GB(t));break;case"fmt ":{const e=await this.tokenizer.readToken(new XB(t));let n=qB[e.wFormatTag];n||(YB(`WAVE/non-PCM format=${e.wFormatTag}`),n=`non-PCM (${e.wFormatTag})`),this.metadata.setFormat("codec",n),this.metadata.setFormat("bitsPerSample",e.wBitsPerSample),this.metadata.setFormat("sampleRate",e.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",e.nChannels),this.metadata.setFormat("bitrate",e.nBlockAlign*e.nSamplesPerSec*8),this.blockAlign=e.nBlockAlign;break}case"id3 ":case"ID3 ":{const e=tl(await this.tokenizer.readToken(new Nl(t.chunkSize)));await(new fD).parse(this.metadata,e,this.options);break}case"data":{!1!==this.metadata.format.lossless&&this.metadata.setFormat("lossless",!0);let e=t.chunkSize;if(this.tokenizer.fileInfo.size){const t=this.tokenizer.fileInfo.size-this.tokenizer.position;t<e&&(this.metadata.addWarning("data chunk length exceeding file length"),e=t)}const n=this.fact?this.fact.dwSampleLength:4294967295===e?void 0:e/this.blockAlign;n&&(this.metadata.setFormat("numberOfSamples",n),this.metadata.format.sampleRate&&this.metadata.setFormat("duration",n/this.metadata.format.sampleRate)),"ADPCM"===this.metadata.format.codec?this.metadata.setFormat("bitrate",352e3):this.metadata.format.sampleRate&&this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(t.chunkSize);break}case"bext":{const e=await this.tokenizer.readToken(KB);Object.keys(e).forEach(t=>{this.metadata.addTag("exif",`bext.${t}`,e[t])});const n=t.chunkSize-KB.len;await this.tokenizer.ignore(n);break}case"\0\0\0\0":YB(`Ignore padding chunk: RIFF/${t.chunkID} of ${t.chunkSize} bytes`),this.metadata.addWarning(`Ignore chunk: RIFF/${t.chunkID}`),await this.tokenizer.ignore(t.chunkSize);break;default:YB(`Ignore chunk: RIFF/${t.chunkID} of ${t.chunkSize} bytes`),this.metadata.addWarning(`Ignore chunk: RIFF/${t.chunkID}`),await this.tokenizer.ignore(t.chunkSize)}this.header.chunkSize%2==1&&(YB("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(e){const t=await this.tokenizer.readToken(new Rl(4,"latin1"));return YB("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,t),"INFO"===t?this.parseRiffInfoTags(e.chunkSize-4):(this.metadata.addWarning(`Ignore chunk: RIFF/WAVE/LIST/${t}`),YB(`Ignoring chunkID=RIFF/WAVE/LIST/${t}`),this.tokenizer.ignore(e.chunkSize-4).then())}async parseRiffInfoTags(e){for(;e>=8;){const t=await this.tokenizer.readToken(PB),n=new OB(t),r=await this.tokenizer.readToken(n);this.addTag(t.chunkID,Ad(r)),e-=8+n.len}if(0!==e)throw new NB(`Illegal remaining size: ${e}`)}addTag(e,t){this.metadata.addTag("exif",e,t)}}},Symbol.toStringTag,{value:"Module"}));export{zn as $,Cn as A,WT as B,Ta as C,Gi as D,Gt as E,Ii as F,gp as G,Ht as H,Zr as I,ZC as J,Pr as K,HC as L,XC as M,cA as N,eP as O,sP as P,SA as Q,TA as R,HA as S,FA as T,DA as U,MA as V,EA as W,RA as X,YA as Y,ro as Z,Wc as _,Ri as a,ia as a0,JM as a1,Rr as a2,es as a3,cD as a4,YC as a5,RS as a6,LS as a7,ss as a8,ee as a9,qi as aa,Zi as ab,os as ac,$a as ad,Wo as ae,uc as af,Wi as b,Bi as c,pr as d,Z as e,Dt as f,Kt as g,Ki as h,Ut as i,$r as j,Hr as k,Qr as l,Hi as m,G as n,Nr as o,dm as p,Un as q,is as r,hm as s,ke as t,Zt as u,jo as v,nc as w,rs as x,Xo as y,zi as z};
